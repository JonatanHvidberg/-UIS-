$$WPUtil.guaranteeExistence($$WP,"Clinical.CareTeam.Components.CareTeam");$$WP.Clinical.CareTeam.Components.CareTeam=function $$WP$Cln$CareTeam(b){var e="&actions=",d="&sources=",a=this,f,c;a.RegistryID=b.RegistryID||"";a.RegistryName=b.RegistryName||"";a.DontShowExternalData=b.DontShowExternalData||false;if(b.TemplateSettings){a.Sources=b.TemplateSettings.Sources||"";a.Actions=b.TemplateSettings.Actions||"";c=b.TemplateSettings.ProviderLinkSource||"";f=b.TemplateSettings.Title||"";if(b.TemplateSettings.DisableExternal)a.DontShowExternalData=true}a.Url=makeLink("Clinical/CareTeam/Load?hfrId="+a.RegistryID+d+a.Sources+e+a.Actions);a.UrlExternal=makeLink("Clinical/CareTeam/LoadExternal?hfrId="+a.RegistryID+d+a.Sources+e+a.Actions);a.ProviderLinkSource=c||"widget";a.TitleText=f||$$WP.Strings.getForTemplate("Title","Clinical.CareTeam");a.IsCondensed=b.IsCondensed!==false;if(b.IsPOC){a.pocArguments="&fromplanofcare=1&from=poc";if(b.RegistryID)a.pocArguments=a.pocArguments+"&RegistryID="+b.RegistryID}else a.pocArguments="&from=home";if(a.IsCondensed){b.Class+=" condensed";a.template=$$WP.Templates.Clinical.ProviderList}else b.Class+=" fullscreen";a.Components$TemplateComponent(b);a.addEventListener("click",a._careTeamClick);a.addEventListener("keydown",a._providersListKeyDown)};$$WP.Clinical.CareTeam.Components.CareTeam.prototype={template:$$WP.Templates.Clinical.FullScreen,Class:"careteam pocdefault",IsCondensed:true,ShowPocExpandIcon:true,IsPOC:"",pocArguments:"",RegistryID:"",RegistryName:"",DontShowExternalData:false,ProviderLinkSource:"",StringsNamespace:"Clinical.CareTeam",Sources:"",Actions:"",UrlExternal:"",LocalProvidersLoaded:false,ExternalProvidersLoaded:false,ExternalData:{},LoadingComponent:{},IsUnauthorized:false,_careTeamClick:function $$WP$Cln$CT$_click(i){var m="viewmore",h="Clinical.CareTeam",e=true,l="&eDeptId=",k="inside.asp?mode=apptsched&eProvId=",c=false,b=this,n,a,d,f={},g,j,o;if(!i)return c;if(i.$target){n=i.$target.closest(".careteam");d=parseInt(n.safeAttr("data-index"),10)}if(isNaN(d))d=b.Data.SelectedIndex||0;a=b.Data.ProvidersList[d];switch(i.dataId){case"message":if(a.IsExternal){!b.IsCondensed&&b.ContainerComponent.dispose();$$WP.CommunityUtilities.openDeepLink("medadvice",a.Organizations[0],{eProvId:a.ID})}else $$WP.Utilities.TryRedirect(makeLink("inside.asp?mode=medadvice&eProvId="+a.ID+b.pocArguments));return c;case"customschedule":$$WP.Utilities.TryRedirect(a.CustomScheduleLink);return c;case"requestschedule":if(a.IsExternal){!b.IsCondensed&&b.ContainerComponent.dispose();$$WP.CommunityUtilities.openDeepLink("apptsched",a.Organizations[0],{eProvId:a.ID,eDeptId:a.DepartmentID})}else $$WP.Utilities.TryRedirect(makeLink(k+a.ID+l+a.DepartmentID+b.pocArguments));return c;case"directschedule":a.CanRequest=c;if(a.CanRequestAppointment){a.CanRequest=e;a.RequestLink=makeLink(k+a.ID+l+a.DepartmentID+b.pocArguments)}else if(a.CanCustomSchedule){a.CanRequest=e;a.RequestLink=a.CustomScheduleLink}a.RequestButtonText=$$WP.Strings.getForTemplate("visit_type_request_button_text",h);a.PreText=$$WP.Strings.getForTemplate("visit_type_pre_text",h);a.PostText=$$WP.Strings.getForTemplate("visit_type_post_text",h);o=$$WP.Strings.getForTemplate("visit_type_title",h);f.SupressTitle=e;f.TitleText="";f.IsCondensed=c;f.Class="visittype";g=new $$WP.Clinical.CareTeam.Components.SelectVisitTypePopup(f);a.pocArguments=b.pocArguments;g.setData(a);g.addEventListener("click",b._selectVisitTypeClick);j=new $$WPContain.Popup({Components:[g],TitleText:o,positioningFunction:$$WPContain.Positions.CenterInside,Class:"pocdefaultpopup ",Size:$$WPContain.Popup.SizeEnum.SMALL});!b.IsCondensed&&b.ContainerComponent.dispose();g.show();j.show();return c;case"newdirectschedule":if(a.IsExternal){!b.IsCondensed&&b.ContainerComponent.dispose();$$WP.CommunityUtilities.openDeepLink("scheduling",a.Organizations[0],{prov:a.ID,workflow:"ExistingProvider"})}else $$WP.Utilities.TryRedirect(makeLink("inside.asp?mode=scheduling&workflow=ExistingProvider&prov="+a.ID+b.pocArguments));return c;case"select":case $$WPComp.TITLEBARIDENTIFIER+m:case m:return b._openPopup(d,a,c);case"selectli":case"selectlianchor":if(b.IsCondensed)return b._openPopup(d,a,e);b._updateSelected(d,a,e);return c;case"providerdetails":if(a.DetailsUrl){if(a.IsExternal)$$WP.CommunityUtilities.openDeepLink("provider",a.Organizations[0],{widgetmode:"1",id:a.ID},$$WP.CommunityUtilities.openDeepLinkType.InNewWindow);else openWindow(a.DetailsUrl,null,"width=1024,height=800,resizable,status,scrollbars").focus();return c}break;case"externalicon":return c}return e},_selectVisitTypeClick:function $$WP$Cln$SelVT$_click(e){var a=this,f=e.$target.closest(".visitlink"),c,b,d;switch(e.dataId){case"schedulevisit":b=parseInt(f.safeAttr("data-index"),10);if(!isNaN(b)){c=a.Data.SchedulableVisitTypes[b];if(a.Data.IsExternal){a.ContainerComponent.dispose();$$WP.CommunityUtilities.openDeepLink("apptmake",a.Data.Organizations[0],{eRFVIndx:c.ID,eProvId:a.Data.ID,action:"schednewstart",flow:"ct",step:"SHOWVTS"})}else{d="inside.asp?mode=apptmake&action=schednewstart&flow=ct&step=SHOWVTS&eRFVIndx="+c.ID+"&eProvId="+a.Data.ID+a.Data.pocArguments;$$WP.Utilities.TryRedirect(makeLink(d))}}return false;case"requestvisit":if(a.Data.CanRequest&&a.Data.RequestLink)if(a.Data.IsExternal&&a.Data.CanRequestAppointment){a.ContainerComponent.dispose();$$WP.CommunityUtilities.openDeepLink("apptsched",a.Data.Organizations[0],{eProvId:a.Data.ID,eDeptId:a.Data.DepartmentID})}else $$WP.Utilities.TryRedirect(a.Data.RequestLink);return false}return false},_openPopup:function $$WP$Cln$CT$openPopup(d,e,f){var a=this;if(a.IsCondensed){var g,b,c;a.Data.SelectedIndex=d;a.Data.Selected=e;b=new $$WP.Clinical.CareTeam.Components.CareTeam({Data:a.Data,IsCondensed:false,IsClosable:true,IsPOC:a.IsPOC,RegistryID:a.RegistryID,RegistryName:a.RegistryName,TitleText:a.TitleText,ProviderLinkSource:a.ProviderLinkSource});c={Class:"careteam pocdefaultpopup",HasOverlay:true,Size:$$WPContain.Popup.SizeEnum.LARGE,StringsNamespace:"Clinical.CareTeam",positioningFunction:$$WPContain.Positions.InsideNearTop,GetLastFocus:function(b){var a=$afe.jq(b),c=a.find("ul .careteam").length-1;return a.find('[data-index="'+c+'"] a:first')[0]}};b.Data.IsFullScreen=true;g=$$WPUtil.quickPopup(b,c);a._updateSelected(d,e,f);a._updateAccessibilityString();$afe.jq(window).on("resize",a._updateAccessibilityString);return false}},_updateAccessibilityString:function $$WP$Cln$CT$updateAccessibilityString(){var a="Clinical.CareTeam",b=$afe.select(".focusanchor.tabToGoBack");if($(".fullscreen.careteam .leftcolumn").css("display")==="none")b.safeAttr("title",$$WP.Strings.getForTemplate("go_back_to_exit_button",a));else b.safeAttr("title",$$WP.Strings.getForTemplate("go_back_to_providers_list",a))},_updateSelected:function $$WP$Cln$CT$updateSelected(a,i,h){var g="div.column2[data-index = '",f="li.careteam[data-index = '",e="selected";this.Data.SelectedIndex=a;var c=$afe.select(".fullscreen ul.careteam"),b=$afe.select(".fullscreen div.column3");c.find("li.careteam.selected").removeClass(e);c.find(f+a+"']").addClass(e);c.find(f+a+"'] .anchorListElement").focus();b.find("div.column2").addClass("hidden");b.find(g+a+"']").removeClass("hidden");var d=b.find(g+a+"'] iframe");d.length>0&&!d.safeAttr("src")&&d.safeAttr("src",i.Profile);h&&b.find("a[name=provmaintop]").focus()},setData:function $$WP$Cln$CT$setData(a){var d=true,b=this,e,c;if(a.Text&&a.Text==="ErrorCode"){b.LocalProvidersLoaded=d;if(a.Value==="unauthorized"){b.IsUnauthorized=d;a.HasNoData=d;a.NoDataText=$$WP.Strings.getForTemplate(a.Value,"Clinical.CareTeam")}else if(b.IsCondensed)a.ProvidersList=[]}if(a.ProvidersList){b.LocalProvidersLoaded=d;if(b.DontShowExternalData){if(a.ProvidersList.length===0){a.HasNoData=d;a.NoDataText=b.getNoDataText(a)}}else if(b.ExternalProvidersLoaded){c=b.ExternalData;if(c&&c.ProvidersList&&c.ProvidersList.length>0){b.filterExternalData(a,c);for(e=0;e<c.ProvidersList.length;e++)a.ProvidersList.push(c.ProvidersList[e])}if(a.ProvidersList.length===0){a.HasNoData=d;a.NoDataText=b.getNoDataText(a,c)}}if(a.ProvidersList.length>0){a.pocArguments=b.pocArguments;b.AlwaysShowExpandIcon=d;a=b._updateMnemonics(a)}b.IsCondensed&&b.LocalProvidersLoaded&&!b.ExternalProvidersLoaded&&!b.isUnauthorized&&b.showLoadingComponent()}b.Components$TemplateComponent$setData(a)},loadExternalData:function $$WP$Cln$CT$loadExternalData(){var a=this;if(a.IsCondensed){var b=a;getCSRFTokenAsQS(function(){b.makeRequest({type:"POST",success:b.setExternalData,failure:b.externalDataFailure,dataType:"json",url:b.UrlExternal},"load",false)});a.LoadingComponent=new $$WPComp.InlineLoadingComponentWithSources({Data:{PrimaryMessage:a.CommunicationsIndicator},AreaName:"GetCareTeam",DataFromMultipleSources:true});a.LoadingComponent.show=function(b){var a=this;b=a.$PermanentParent||b;a.$container.parent().length===0&&a.$container.safeAppendTo(b);a.Components$TemplateComponent$show()}}},setExternalData:function $$WP$Cln$CT$setExternalData(b){var a=this,d,f,c,e;a.ExternalProvidersLoaded=true;a.ExternalData=b;if(a.LocalProvidersLoaded){if(a.IsUnauthorized)return;a.hideLoadingComponent();c=a.Data;f=a;if(c&&c.ProvidersList&&b&&b.ProvidersList&&b.ProvidersList.length>0){a.filterExternalData(c,b);b=a._updateMnemonics(b);b.Offset=c.ProvidersList.length;e=$afe.renderTemplate(a.template,b);f.$content.find("ul.careteam").safeAppend(e.find("li.careteam.listelement"));for(d=0;d<b.ProvidersList.length;d++)c.ProvidersList.push(b.ProvidersList[d])}c.ProvidersList&&c.ProvidersList.length===0&&a.appendNoData();$$WPUtil&&typeof $$WPUtil.AddPopupListener==="function"&&$$WPUtil.AddPopupListener(a.$container);a.$container.resize()}},getNoDataText:function $$WP$Cln$CT$getNoData(b,a){var c="Clinical.CareTeam",d="ErrorCode";return b&&b.Text&&b.Text===d?$$WP.Strings.getForTemplate(b.Value,c):a&&a.Text&&a.Text===d?$$WP.Strings.getForTemplate(a.Value,c):$$WP.Strings.getForTemplate("nodatatext",c)},filterExternalData:function $$WP$Cln$CT$filterExternalData(f,a){var c,b,e,d;if(f&&f.ProvidersList&&a&&a.ProvidersList){d=[];for(c=0;c<a.ProvidersList.length;c++){e=false;if(a.ProvidersList[c].NationalProviderID){for(b=0;b<f.ProvidersList.length;b++)if(a.ProvidersList[c].NationalProviderID===f.ProvidersList[b].NationalProviderID){e=true;break}if(!e)for(b=0;b<d.length;b++)if(a.ProvidersList[c].NationalProviderID===d[b].NationalProviderID){e=true;break}}!e&&d.push(a.ProvidersList[c])}a.ProvidersList=d}},_updateMnemonics:function $$WP$Cln$CT$updateMnemonics(b){var h="newdirectschedule",g="profile_link_hover_text",f="@MYCHART@PROVIDERNAME@",e,d,a,c;$$WP.Strings.setDefaultNamespace("Clinical.CareTeam");e=makeLink("inside.asp?mode="+b.CustomRequestAppointmentLink);c=$$WP.Strings.getForTemplate("pretext");if(c&&!$$WPUtil.IsNullOrEmpty(c.string))b.PreText=c;b.AboutMeHeading=$$WP.Strings.getForTemplate("aboutMe");for(d=0;d<b.ProvidersList.length;d++){a=b.ProvidersList[d];$$WP.Strings.addMnemonic(f,a.Name);if(a.Photo)a.ImageUrl=makeLink(a.Photo);else a.ImageUrl=makeStaticLink("images/ProxySilhouette.png");a.ImageAltText=$$WP.Strings.getForTemplate("provider_image_alt_text");a.Profile=a.InfoBlurbUrl||"";if(a.CanViewProviderDetails&&!a.HasNoProviderRecord)if(a.IsExternal){a.DetailsUrl="#";a.DetailsUrlHoverText=$$WP.Strings.getForTemplate(g)}else{a.DetailsUrl=makeLink("inside1.asp?mode=provider&widgetmode=1&id="+a.ID);a.DetailsUrlHoverText=$$WP.Strings.getForTemplate(g);if(!a.Profile&&a.AboutMeBlurb.length===0)a.Profile=a.WebPageUrl}if(a.Profile)if(a.IsExternal)a.Profile=makeLink(addQueryStringToUrl(a.Profile,"source","widget"));else a.Profile=makeLink(addQueryStringToUrl(a.Profile,"source",this.ProviderLinkSource));else a.ProfileNotFoundText=$$WP.Strings.getForTemplate("profile_not_found_text");if(a.CanMessage){a.MessageButton=$$WP.Strings.getForTemplate("send_message_button");a.MessageHover=$$WP.Strings.getForTemplate("send_message_hover");a.MessageDataId="message"}if(a.CanDirectSchedule){a.ScheduleButton=$$WP.Strings.getForTemplate("direct_schedule_appointment_button");a.ScheduleHover=$$WP.Strings.getForTemplate("direct_schedule_appointment_hover");if(a.IsNewSchedulingEnabled)a.ScheduleDataId=h;else a.ScheduleDataId="directschedule"}else if(a.CanRequestAppointment){a.ScheduleButton=$$WP.Strings.getForTemplate("request_appointment_button");a.ScheduleHover=$$WP.Strings.getForTemplate("request_appointment_hover");if(a.IsNewSchedulingEnabled)a.ScheduleDataId=h;else a.ScheduleDataId="requestschedule"}else if(a.CanRequestCustomAppt&&b.IsCustomApptReqEnabled){a.ScheduleButton=$$WP.Strings.getForTemplate("custom_schedule_appointment_button");a.ScheduleHover=$$WP.Strings.getForTemplate("custom_schedule_appointment_hover");a.ScheduleDataId="customschedule"}if(a.CanRequestCustomAppt&&b.IsCustomApptReqEnabled){a.CanCustomSchedule=true;a.CustomScheduleLink=e}$$WP.Strings.removeMnemonic(f)}$$WP.Strings.clearDefaultNamespace();return b},_providersListKeyDown:function $$WP$Cln$CT$provLstKeyDwn(a){var f='.cancelworkflow [data-id="titlebarclose"]',e='"] a:first',d='[data-index="',c,g,h,b;if(this.Data.IsFullScreen&&a.keyCode===9)if(a.dataId==="selectlianchor"){c=a.$target.closest("ul");g=a.$target.closest("li");h=c.find(".careteam").length-1;b=Number(g.safeAttr("data-index"));if(h===b){if(a.shiftKey)c.find(d+(b-1)+e).focus();else $afe.select(f).focus();return false}if(b===0){if(a.shiftKey)$afe.select(f).focus();else c.find(d+(b+1)+e).focus();return false}}else if(a.dataId==="endanchor"){$afe.select(".fullscreen .careteam.listelement.selected a:first").focus();return false}return true},"set":function $$WP$Cln$CT$set(a){if(!this.IsCondensed){a.SelectedIndex=a.SelectedIndex||0;a.Selected=a.ProvidersList[a.SelectedIndex]}this.Components$TemplateComponent$set(a)},load:function $$WP$Cln$CT$load(){this.Components$TemplateComponent$load();!this.DontShowExternalData&&this.loadExternalData()},externalDataFailure:function $$WP$Cln$CT$externalDataFailure(){var a=this;a.ExternalProvidersLoaded=true;if(a.LocalProvidersLoaded){a.hideLoadingComponent();a.Data.ProvidersList&&a.Data.ProvidersList.length===0&&a.appendNoData()}},showLoadingComponent:function $$WP$Cln$CT$showLoadingComponent(){var a=this;a.IsCondensed&&a.LoadingComponent&&$$WPComp.isComponent(a.LoadingComponent)&&a.LoadingComponent.show(a.$container,true)},hideLoadingComponent:function $$WP$Cln$CT$hideLoadingComponent(){var a=this;if(a.IsCondensed&&a.LoadingComponent&&$$WPComp.isComponent(a.LoadingComponent)){a.LoadingComponent.parentComponent=a;a.LoadingComponent.hide()}},appendNoData:function $$WP$Cln$CT$appendNoData(){var a=this,b=a.Data,e=a.ExternalData,d=a,c;b.HasNoData=true;b.NoDataText=a.getNoDataText(b,e);c=$afe.renderTemplate(a.template,b);d.$content.find("ul.careteam").safeAppend(c.find("li.nodatalistelement.nohover"))}};$$WP.Clinical.CareTeam.Components.CareTeam.extend("Components.TemplateComponent")
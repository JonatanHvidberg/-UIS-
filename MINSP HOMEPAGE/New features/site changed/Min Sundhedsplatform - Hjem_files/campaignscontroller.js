/*! Copyright (c) Epic Systems Corporation 2017-2018 */
$$WP.CampaignOutreach=$$WP.CampaignOutreach||{};$$WP.CampaignOutreach.ValidateEvent=function WP$CampaignOutreach$ValidateEvent(a,b){var d=a&&a.type==="click"&&a.which===1,c=a&&a.type==="mouseup"&&a.which===2;if(d||c){$.isFunction(b)&&b(a);return true}else return false},$$WP.CampaignOutreach.CampaignsController=function CampaignOutreach$CampaignsController(a){this.$root=a};$$WP.CampaignOutreach.CampaignsController.prototype={_auditor:null,_viewModel:null,_viewModelDict:null,_unloadedCardImageCount:0,render:function WP$CampaignOutreach$render(){if(this.$root instanceof jQuery)$.post({url:makeLink("CampaignOutreach/Campaigns/LoadCampaignCards"),data:{},cache:false,success:$.proxy(this._onDataLoaded,this)});else $$WP.Debug.logError("Couldn't find the Campaigns content container element.")},_onDataLoaded:function WP$CampaignsOutreach$_onDataLoaded(b){var a=this;a._viewModel=b;a._buildViewModelDict();a._drawCampaignTemplate();a._addHandlers()},_buildViewModelDict:function WP$CampaignOutreach$_buildViewModelDict(){var a=this;a._viewModelDict={};if(a._viewModel)for(var b=0;b<a._viewModel.length;b++)a._viewModelDict[a._viewModel[b].CardOutreachID]=a._viewModel[b]},_addHandlers:function WP$CampaignOutreach$_drawCampaignTemplate(){var a=this;a._auditor=new $$WP.CampaignOutreach.CampaignsAudit(a._viewModel);a._auditor.addHandlers();var b="click mouseup",f=a.$root.find(".dismissalButton"),c=a.$root.find(".campaignButton"),i=a.$root.find(".popupLink"),h=$.proxy(function(a){$$WP.CampaignOutreach.ValidateEvent(a,$.proxy(this._redrawHandler,this))},a),g=$.proxy(function(a){$$WP.CampaignOutreach.ValidateEvent(a,$.proxy(this._showDismissCardPopup,this))},a),d=$.proxy(function(a){$$WP.CampaignOutreach.ValidateEvent(a,$.proxy(this._redirectHandler,this))},a),e=$.proxy(function(a){$$WP.CampaignOutreach.ValidateEvent(a,$.proxy(this._launchPopupHandler,this))},a);i.on(b,e);c.on(b,d);c.on(b,h);f.on(b,g)},_redirectHandler:function WP$CampaignOutreach$_redirectHandler(c){var b=this._getCardViewModel(c.target),a=this._getButtonURLFromCard(b);a&&$$WPUtil.TryRedirect(a)},_launchPopupHandler:function WP$CampaignOutreach$_launchPopupHandler(b){var a=this._getCardViewModel(b.target);this._drawLightbox(a.Title,a.CardOutreachID)},_getButtonURLFromCard:function WP$CampaignOutreach$_getButtonURL(a){return a&&a.Buttons&&a.Buttons.length>0&&a.Buttons[0]?a.Buttons[0].DestinationURL:null},_drawCampaignTemplate:function WP$CampaignOutreach$_drawCampaignTemplate(){var a=this;if(a._viewModel!=null&&a._viewModel.length>0){a.$root.empty();var b=$$WP.Templates.CampaignOutreach.Campaigns;a.$root.safeAppend($afe.renderTemplate(b,{Campaigns:a._viewModel}));a.$root.find(".campaignCardList.matchHeights").each($$WP.Utilities.UI.Cards.MatchHeights)}},_redrawHandler:function WP$CampaignOutreach$_redrawHandler(c){var a=this._getCardViewModel(c.target);if(a&&a.HasHyperlinkButton){var b=$$WP.Strings.getNamespace("campaignoutreach");b.addMnemonic("@MYCHART@LASTCLICKEDDATE@",a.TodayDate);a.WasActedUpon=true;a.ShowLastVisitedDate=true;a.LastClickedDateReminder=b.getString("LastClickedBlurb");this._drawCampaignTemplate();this._addHandlers()}},_showDismissCardPopup:function WP$CampaignOutreach$_showDismissCardPopup(h){var c=this,a=$$WP.Strings.getNamespace("campaignoutreach"),b=c._getCardViewModel(h.target),f=$afe.jq(h.target).closest(".campaignCard"),e=false,d,i="goBack",g="hideContent",k=[{Text:a.getString("HideContentLabel"),Class:"inlinedelete",Identifier:g},{Text:a.getString("DoNotHideContentLabel"),Class:"otherbutton",Identifier:i}],j=$.proxy(function(a){a.indexOf(g)>0&&this._dismissCard(f)},c);a.addMnemonic("@MYCHART@OUTREACHTITLE@",b.Title);if(c._hasSchedulingButton(b)&&!b.WasScheduledOrRequested){e=true;d=a.getString("ConfirmRemoveSchedulingOutreach")}else if(b.HasHyperlinkButton&&!b.WasButtonLinkVisited&&!f.hasClass("visited")){e=true;d=a.getString("ConfirmRemoveHyperlinkOutreach")}if(e)$$WPUtil.quickMessageBox(d,a.getStringForTemplate("DismissalConfirmationTitle"),k,j);else c._dismissCard(f)},_drawLightbox:function WP$Campaigns$_drawLightbox(b,a){$.post({url:makeLink("CampaignOutreach/Campaigns/LoadCardPopup"),data:{OutreachContact:a},success:function(d){var a=new $$WP.Components.Component;a.html(d);var c=new $$WPContain.Popup({Components:[a],TitleText:b,positioningFunction:$$WPContain.Positions.InsideNearTop,Size:$$WPContain.Popup.SizeEnum.MEDIUM,SupportAnimations:false});a.show();c.show()}})},_dismissCard:function WP$CampaignOutreach$_dismissCard(a){$.post({url:makeLink("CampaignOutreach/Campaigns/DismissHomeOutreaches"),data:{OutreachContacts:a.safeAttr("id")},cache:false,success:$.proxy(this._postDismissCard,this,a)})},_getCardViewModel:function WP$CampaignOutreach$_getCardViewModel(b){var a=$afe.jq(b).closest(".campaignCard").safeAttr("id");return this._viewModelDict[a]},_postDismissCard:function WP$CampaignOutreach$_postDismissCard(a){this._removeCardElement(a);this._removeCardViewModel(a.attr("id"));this._auditor.auditSeenCards()},_removeCardElement:function WP$CampaignOutreach$_removeCardElement(b){var a=b.closest(".cardlist");if(a.children().length>1){b.remove();a.each($$WP.Utilities.UI.Cards.MatchHeights)}else a.parent().remove()},_removeCardViewModel:function WP$CampaignOutreach$_removeCardViewModel(b){for(var a=this._viewModel.length-1;a>=0;a--)this._viewModel[a].CardOutreachID===b&&this._viewModel.splice(a,1)},_hasSchedulingButton:function WP$CampaignOutreach$_hasSchedulingButton(a){if(a&&a.Buttons&&a.Buttons.constructor===Array)for(var b=0;b<a.Buttons.length;b++)if(a.Buttons[b].IsSchedulingButton)return true;return false}}
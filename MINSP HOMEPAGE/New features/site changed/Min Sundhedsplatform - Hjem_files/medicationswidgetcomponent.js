/*! Copyright (c) Epic Systems Corporation 2015-2019 */
$$WPUtil.guaranteeExistence($$WP,"Clinical.Medications.Components");$$WP.Clinical.Medications.Components.MedicationsWidgetComponent=function WP$Clinical$Medications$Components$MedicationsWidgetComponent(b){var a=this;a.Components$TemplateComponent(b);a.Url=makeLink("Clinical/Medications/LoadMedsForWidget?RegistryID="+encodeURIComponent(a.RegistryID));if(a.IsPOC){a.FromURLQueryParameters="fromplanofcare=1";if(a.RegistryID!=="")a.FromURLQueryParameters=a.FromURLQueryParameters+"&RegistryID="+encodeURIComponent(a.RegistryID)}a.addEventListener("click",a._clickEvent);a.addEventListener("mouseover",a._mouseOverEvent);a.addEventListener("mouseout",a._mouseOutEvent);a.addEventListener("focusout",a._tabFocusOut,a,null,"a.filteredwarningicon");a._tabFocus=$.proxy(a._tabFocus,a)};$$WP.Clinical.Medications.Components.MedicationsWidgetComponent.prototype={Class:"medicationslist pocdefault",ToolbarButtons:null,template:$$WP.Templates.Clinical.MedicationsWidget,Url:makeLink("Clinical/Medications/LoadMedsForWidget"),RegistryName:"",PopupTitle:null,IsPOC:false,FromURLQueryParameters:"fromhomepage=1",StringsNamespace:"clinical.medications",RegistryID:"",ShowPocExpandIcon:true,MedicationsPageData:null,showFilteredWarningTooltip:function $$WP$Clinical$Medications$showFilteredWarningTooltip(){var d="filtered",f,e,c,a=$afe.select(".medicationslist.component .filteredwarningtooltip"),b=$afe.select(".medicationslist.component");if(a.length===0){e=$afe.select(".medicationslist .titlebar").outerHeight()+15+"px";c=$$WP.SimpleTemplates.Div({"class":"filteredwarningtooltip subtle hidden",style:"top:"+e},null);b.safeAppend(c)}$$WP.Strings.setDisplayText(a,"filteredwarning","clinical.medications");if(!b.hasClass(d)){f=a.removeClass("hidden").height();b.css("min-height",f+100+"px").addClass(d)}a.removeClass("hidden")},showAllContentInPopup:function $$WP$Clinical$Medications$showAllContentInPopup(j,h){var f="@MYCHART@TITLE@",e="@MYCHART@CONDITIONTITLE@",d=false,a=this,b,c,g,i={Class:"medicationspopup",MnemonicsUpdated:true,ShowTopNavigation:d,RegistryName:a.RegistryName,FromURLQueryParameters:a.FromURLQueryParameters,SelectedMedId:j,mode:"medswidget",ShowPendingUpdatesSection:h};if(a.RegistryID!==""){$$WP.Strings.setDefaultNamespace("clinical.medications");$$WP.Strings.addMnemonic(e,a.RegistryName);$$WP.Strings.addMnemonic(f,$$WP.Strings.get("Title"),d,null,$$WP.Strings.EncodingTypes.None);a.PopupTitle=$$WP.Strings.getForTemplate("widgettitle");$$WP.Strings.removeMnemonic(e);$$WP.Strings.removeMnemonic(f);$$WP.Strings.clearDefaultNamespace()}else a.PopupTitle=a.TitleText;b=new $$WP.Clinical.Medications.Components.MedicationsHostComponent(i,a.MedicationsPageData,a);g=new $$WPContain.Popup({Components:[b],TitleText:a.PopupTitle,Class:"medspopupcontainer",positioningFunction:$$WPContain.Positions.InsideNearTop,Size:$$WPContain.Popup.SizeEnum.MEDIUM,SupportAnimations:d});b._oldshow=b.show;b.show=function(){var b="tabindex",d="selected",a=this;a.ContainerComponent&&a.ContainerComponent.show();a._oldshow();if(a.SelectedMedId&&a.SelectedMedId!==null){c=a.$content.find('.medcard[data-med-id="'+a.SelectedMedId+'"]');typeof a._timeout!=="undefined"&&clearTimeout(a._timeout);c&&c.length>0&&c.addClass(d);a._timeout=setTimeout(function(){c.removeClass(d)},3e3);c.prop(b,0).focus().removeAttr(b)}else if(a.ShowPendingUpdatesSection){var e=a.$content.find(".pendingUpdatesSection .header").first();e.length>0&&e.prop(b,0).focus().blur().removeAttr(b)}};b.show();g.show();$$WP.Medications.MedicationHelpers.setupExpandableSection(b.$content);return d},setData:function $$WP$Clinical$Medications$setData(h){var f="filteredwarning",c=true,b=this,d;b.MedicationsPageData=h;if(!b.MedicationsPageData.CommunityMembers)return;var a=b.MedicationsPageData.CommunityMembers[0];$$WP.Medications.DisplayStringHelpers.setMemberDisplayStrings(a,c);$$WP.Medications.MedicationsUpdateHelpers.setPendingUpdateLists(a);if(!a.PrescriptionList)return;if(a.PrescriptionList.IsPossiblyFiltered){d=b._Title.Buttons||[];d.push(new $$WPComp.ComplexObjects.Button("",new $$WPComp.ComplexObjects.Image(makeStaticLink("images/info_grey.png"),f,h.FilteredWarning,""),"selected filteredwarningicon",f));b.setTitle(b.TitleText,d)}if(a.PrescriptionList.Prescriptions&&a.PrescriptionList.Prescriptions.length>0&&!b.MedicationsPageData.ErrorMessage){$$WP.Strings.setDefaultNamespace("clinical.medications");var g=$$WP.Strings.getForTemplate("duplicatetext"),e=$$WP.Strings.getForTemplate("duplicatetooltip");$$WP.Strings.clearDefaultNamespace();a.PrescriptionList.Prescriptions.forEach(function(a){if(a.Warning||a.ShowDuplicateWarning){a.CombinedWarning=c;if(a.Warning&&!a.ShowDuplicateWarning)a.CombinedWarningText=a.Warning;else if(!a.Warning&&a.ShowDuplicateWarning)a.CombinedWarningText=g+" "+e;else a.CombinedWarningText=a.Warning+"\n"+g+" "+e}});b.AlwaysShowExpandIcon=c}if(a.PrescriptionList.pendingAddList&&a.PrescriptionList.pendingAddList.length>0||a.PrescriptionList.pendingDeleteList&&a.PrescriptionList.pendingDeleteList.length>0)a.PrescriptionList.HasPendingUpdates=c;b.Components$TemplateComponent$setData(b.MedicationsPageData)},setTitle:function $$WP$Clinical$Medications$setTitle(h,f,g,e,d){var c="a.filteredwarningicon",a=this,b;if(a.$title){b=a.$title.find(c);b.length>0&&b.off("focus",a._tabFocus)}a.Components$TemplateComponent$setTitle(h,f,g,e,d);if(a.$title){b=a.$title.find(c);if(b.length>0)b.on("focus",a._tabFocus)}},_clickEvent:function $$WP$Clinical$Medications$_clickEvent(c){var e=".medicationlistelement",g,d,a,f,b=true,h;if(!c)return b;switch(c.dataId){case"refilllink":g=c.$target.closest(e);d=parseInt(g.safeAttr("data-index"),10);if(isNaN(d))return false;var j=this.Data.CommunityMembers[0];a=j.PrescriptionList.currentList[d];var i={selectedPrescriptionIDs:a&&a.ID,navFrom:$$WP.Clinical.Medications.Controllers.CommunityMemberViewModelContext.MedicationsWidget};a&&$$WP.Utilities.TryRedirect(makeLink("Clinical/Medications/List?"+$.param(i)));b=false;break;case"select":f=c.$target.closest(e);h=f.safeAttr("data-med-id");this.showAllContentInPopup(h);b=false;break;case"pendingupdates":this.showAllContentInPopup(null,true)}return b},_mouseOverEvent:function $$WP$Clinical$Medications$_moueOverEvent(a){if(a)if(a.dataId==="titlebarfilteredwarning"){this.showFilteredWarningTooltip();return false}},_mouseOutEvent:function $$WP$Clinical$Medications$_mouseOverEvent(a){a.dataId==="titlebarfilteredwarning"&&$afe.select(".medicationslist.component .filteredwarningtooltip").addClass("hidden")},_tabFocus:function $$WP$Clinical$Medications$_tabFocus(){this.showFilteredWarningTooltip()},_tabFocusOut:function $$WP$Clinical$Medications$_tabFocusOut(a){a.dataId==="titlebarfilteredwarning"&&$afe.select(".medicationslist.component .filteredwarningtooltip").addClass("hidden")},dispose:function $$WP$Clinical$Medications$dispose(a){this._tabFocus=null;this.Components$TemplateComponent$dispose(a)}};$$WP.Clinical.Medications.Components.MedicationsWidgetComponent.extend("Components.TemplateComponent")
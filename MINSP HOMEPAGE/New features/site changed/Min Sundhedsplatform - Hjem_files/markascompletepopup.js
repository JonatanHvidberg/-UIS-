var Epic;(function(a){var b;(function(a){var b;(function(b){var a=function(){var e="disabled",f=".button.satisfyTopicAccept",d="#satisfyTopicDatepicker",a=false,c="clinical.healthmaintenance",b=null;function MarkAsCompletePopup(c){var a=this;a.hmTopic=b;a.popupContainer=b;a.onClose=b;a.hmTopic=c}MarkAsCompletePopup.prototype.ShowPopup=function(){this.createPopup();this.popupContainer.show()};MarkAsCompletePopup.prototype.DisposePopup=function(){this.popupContainer.dispose()};MarkAsCompletePopup.prototype.createPopup=function(){this.popupContainer=new $$WPContain.Popup({Components:b,TitleText:$$WP.Strings.getForTemplate("MarkAsCompletePopupTitle",c),Class:"healthadvisorysatisfactionpopupcontainer",positioningFunction:$$WPContain.Positions.InsideCentered,Size:$$WPContain.Popup.SizeEnum.SMALL,SupportAnimations:a});this.setUpForm()};MarkAsCompletePopup.prototype.setUpForm=function(){var e=this,c=e,g=e.popupContainer.$content,h=WP.Utils.date2dte(e.convertISOtoUTC(e.hmTopic.UpdateInformation.EarliestCompletionDateISO)),i=WP.Utils.date2dte(new Date);g.safeAppend($afe.renderTemplate($$WP.Templates.HealthAdvisory.MarkAsCompleteForm,e.hmTopic,{}));var f=g.find(d);writeCalendar(f,"range",makeStaticLink("images/calendar.svg"),h,i,b,a);g.on("click","input[type='button'].satisfyTopicAccept",function(){c.onFormSubmit()});g.on("click","input[type='button'].satisfyTopicCancel",function(){c.DisposePopup();if(c.onClose)c.onClose(a)});f.on("blur",function(){c.validateDate()});f.on("keyup change",function(){var a=$(f.get(0)).val();if(a.length>0)c.enableAccept();else c.disableAccept()})};MarkAsCompletePopup.prototype.onFormSubmit=function(){var a=this,b=a;if(a.validateDate()){var c=a.getCompletionDate(),d={date:c,topicId:a.hmTopic.TopicId};getCSRFTokenAsQS(function(c){b.disableAccept();var a={success:function(a){b.onSatisfyTopicSuccess(a)},error:function(){b.onSatisfyTopicFailure([])},data:d,dataType:"json",type:"POST",url:makeLink("HealthAdvisories/MarkAsComplete?"+c)};$.ajax(a)})}};MarkAsCompletePopup.prototype.onSatisfyTopicSuccess=function(b){var a=this;a.DisposePopup();if(!b.Success){a.onSatisfyTopicFailure(b.ErrorCodes);return}if(a.onClose)a.onClose(true)};MarkAsCompletePopup.prototype.onSatisfyTopicFailure=function(d){this.DisposePopup();var e=$$WP.Strings.getForTemplate("ErrorOkButton",c),g=$$WP.Strings.getForTemplate("ErrorTitle",c),f=[new $$WPComp.ComplexObjects.Button(e,b,"previousstep","continue")],a="";if(d&&d.length>0)a=$$WP.Strings.get("ErrorMessage_"+d[0],c);if(a.length===0)a=$$WP.Strings.get("ErrorMessage",c);new $$WPUtil.quickMessageBox(a,g,f)};MarkAsCompletePopup.prototype.getCompletionDate=function(){var c=this.popupContainer.$content.find(d).val(),a="";if(c.trim().length>0){var b=new Date(c);a=b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate()}else a="";return a};MarkAsCompletePopup.prototype.validateDate=function(){var b=this,c=true,e=b.popupContainer.$content.find(d),f=e.val();if(f.length>0){var g=b.convertISOtoUTC(b.hmTopic.UpdateInformation.EarliestCompletionDateISO),h=formatDateField(e.get(0),5,g,new Date,a);if(!h)c=a}else c=a;if(!c)b.disableAccept();else b.enableAccept();return c};MarkAsCompletePopup.prototype.disableAccept=function(){var b=this.popupContainer.$content,a=b.find(f);a.safeAttr(e,e)};MarkAsCompletePopup.prototype.enableAccept=function(){var b=this.popupContainer.$content,a=b.find(f);a.removeAttr(e)};MarkAsCompletePopup.prototype.convertISOtoUTC=function(c){var a=new Date(c),b=new Date;b.setFullYear(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate());b.setHours(0,0,0,0);return b};return MarkAsCompletePopup}();b.MarkAsCompletePopup=a})(b=a.HealthAdvisories||(a.HealthAdvisories={}))})(b=a.PatientAccess||(a.PatientAccess={}))})(Epic||(Epic={}))
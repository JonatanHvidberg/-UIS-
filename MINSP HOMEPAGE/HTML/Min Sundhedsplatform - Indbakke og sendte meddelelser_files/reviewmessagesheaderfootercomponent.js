/*! Copyright (c) Epic Systems Corporation 2019 */
$$WPUtil.guaranteeExistence($$WP,"Messaging");$$WP.Messaging.ReviewMessagesHeaderFooterComponent=function ReviewMessagesHeaderFooterComponent(b){var a=this;a.Components$TemplateComponent(b);a.addEventListener("change",a._change);a.addEventListener("keyup",a._keyup);a.addEventListener("click",a._reviewHeaderClick)};$$WP.Messaging.ReviewMessagesHeaderFooterComponent.prototype={template:$$WP.Templates.Messaging.ReviewMessagesHeader,SupportAnimations:false,MaintainFocus:true,Url:makeLink("Messaging/Review/ListHeader?mailbox="),IsClosable:false,TitleText:null,load:function(){var a=this;return!a.Url?void 0:a.Components$TemplateComponent$load(a.Url+a.ContainerComponent.ListComponent.Mailbox,false)},ContainerComponent:$$WPContain.CommunityListManagerContainer.prototype,setData:function(a){this.Components$TemplateComponent$setData(a);this.Components$Component$show()},_reviewHeaderClick:function(g){var i="undelete",b=false,h="data-value",d=this,a=d.ContainerComponent.ListComponent,k;switch(g.dataId){case"mailbox":if(a.Mailbox!==g.$target.safeAttr(h)){d.Data.UnreadMessagesFilter=b;d.Data.UnfinishedTasksFilter=b;a.Mailbox=g.$target.safeAttr(h);a.Filter="None";a.reload();d.load()}return b;case"loadmore":a.addNextPage();return b;case"searchimg":a.setSearch(a.SearchString===""?g.$dataId.parent().children("input").val():"");return b;case i:a.Data.UndeleteCount=0;a._updateHeaderFooter();a.makeRequest({url:makeLink("ReviewSynchronous/CancelDeletion?mailbox="+a.Mailbox),success:a.reload},i,b,null);return;case"markallasread":var f={},c,e,j;k=a.$content.find("ul");for(e=0;e<a.RenderedData.length;e++){c=a.RenderedData[e];if(!c.WasRead)if(c.Organization.CanMarkAsRead){f[c.Organization.OrganizationId]=f[c.Organization.OrganizationId]||[];f[c.Organization.OrganizationId].push(c.Id);c.WasRead=true}else j=true}for(e in f)d.makeRequest({success:function(){},type:"POST",data:{ids:f[e]},traditional:true,url:makeLink("Messaging/Review/MarkAsRead?organizationId="+encodeURIComponent(e))},"readmessage",b);k.children("li.Unread.CanMark").removeClass("Unread");d.ContainerComponent.ListComponent.refresh();j&&$$WPUtil.quickMessageBoxByEnum($$WP.Strings.get("InconsistentMarkAllAsReadWarning","Messaging.Review"),$$WPUtil.quickMessageBoxByEnum.typeEnum.YesNo,function(b,a){if(a==="toolbarcancel"||a==="close")return;$afe.select("#messaging-customfilters-"+b.ComponentNumber).val("Unread").trigger("change")},[d],"MarkAllAsReadWarning");return b}},refresh:function(){var a=this;a.Data=$$WPUtil.mergeObjects(a.ListData,a.Data,false,true);a.Components$TemplateComponent$refresh();$afe.jq(window).trigger("matchColumnHeights")},_keyup:function(a){var b=null;if(a.dataId!=="search")return;if(a.keyCode===13)b=a.$target.val();else if(a.keyCode===27){b="";a.$target.val("")}if(b!==null){this.ContainerComponent.ListComponent.setSearch(b);return false}},_change:function(b){var a=this,c=b.$dataId.val(),d;switch(b.dataId){case"sort":d=c==="PrimaryDate"?true:false;a.ContainerComponent.ListComponent.collapseExpanded();a.ContainerComponent.ListComponent.setSort(c,d);break;case"applyfilters":a.Data.UnreadMessagesFilter=b.$target.val()==="Unread";a.Data.UnfinishedTasksFilter=b.$target.val()==="Unfinished";a.ContainerComponent.ListComponent.collapseExpanded();a.ContainerComponent.ListComponent.applyFilters();return;case"filter":a.ContainerComponent.ListComponent.collapseExpanded();a.ContainerComponent.ListComponent.setFilter(c)}}};$$WP.Messaging.ReviewMessagesHeaderFooterComponent.extend("Components.TemplateComponent")
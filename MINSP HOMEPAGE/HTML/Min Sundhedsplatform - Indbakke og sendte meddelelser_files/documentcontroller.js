/*! Copyright (c) Epic Systems Corporation 2017 */
(function ClassDefinition(){var u="max-width",t="1px #ccc solid",s="background-color",r="._footerContent",q="._mainContent",e="min-height",a="inherit",d="padding",p="._headerContent",o="method=print",n="method=view",m=".esigned",l=".titlebar span",f=false,i="title",h="head",k="about:blank",c="width",b="printFrame",j="#section-to-print",g=null;$$WP.Utilities.guaranteeExistence($$WP,"Documents.ViewDocument.Controllers");var y=$$WP.Documents.ViewDocument.Controllers,x=$$WP.Documents.ViewDocument.Models,v=$$WP.Strings.getNamespace("viewdocument"),w=function DocumentController(b,c){var a=this;a.proxify("_displayDoc","clickBack","_registerHandlers","clickPrint");var d=$afe.select(".back");a.DocumentDiv=c;a.Document=new x.DocumentModel(b,{});a._displayDoc()};w.prototype={IsMobile:$afe.select("html").hasClass("mobile"),DocumentDiv:g,Document:g,_displayDoc:function _displayDoc(){var c=".loadingHeart",b="matchColumnHeights",i="@MYCHART@DOWNLOADLINK@",h="noAcordex",e="#noAcordex",g="@MyChart@DownloadLink@",a=this;if(a.Document.DownloadOnly){$$WP.Strings.addMnemonic(g,a.Document.DownloadUrl,$$WP.Strings.EncodingTypes.None);dangerou$.setHtml($afe.select(e),v.getString(h));$$WP.Strings.removeMnemonic(g);return}if(a.IsMobile){var m=$afe.select("#doc_title");if(a.Document.PendingApproval||a.Document.Rejected)m.text(a.Document.DocDesc);else m.text(a.Document.DocType)}if(a.Document.DownloadOnly){if(a.IsMobile)dangerou$.setHtml($afe.select(e),v.getString("cannotDisplayMobile"));else{$$WP.Strings.addMnemonic(i,a.Document.DownloadUrl,$$WP.Strings.EncodingTypes.None);dangerou$.setHtml($afe.select(e),v.getString(h));$$WP.Strings.removeMnemonic(i)}a._hideButtons();a._registerHandlers();return}(a.Document.WasESigned==="1"||a.Document.WasESigned===true)&&a.Document.displayESign();var n=$afe.renderTemplate(a.Document.Template,a.Document);a.DocumentDiv.safeAppend(n);for(var f=$afe.select("img"),l=0,d=0;d<f.length;d++){f[d].onload=function(){$afe.jq(window).trigger(b);l++;$afe.select(c).remove()};f[d].onerror=function(){$afe.jq(window).trigger(b);$afe.select(c).remove()}}f.length>0&&setTimeout(function(){if(f.length!==l){$afe.select(c).remove();$afe.select(j).remove();var b=$afe.select(".content"),a=document.createElement("p");a.setAttribute("id","errorloading");b.safeAppend(a);dangerou$.setHtml($afe.select("#errorloading"),v.getString("errorLoadTime"));$afe.jq(window).trigger("popupResize")}},3e4);var k=$afe.select("video");for(d=0;d<k.length;d++){k[d].onload=function(){$afe.jq(window).trigger(b)};k[d].onerror=function(){$afe.jq(window).trigger(b)}}a._hideButtons();a._registerHandlers();$afe.jq(window).trigger(b)},_registerHandlers:function _registerHandlers(){var a=this,b,c;c=$afe.select(".back");c&&c.click(a,a.clickBack);b=$afe.select(".printIcon");b&&b.click(a,a.clickPrint)},clickPrint:function clickPrint(){var D,y,x,v,w,z,B;x=document.getElementById(b);if(!x){x=document.createElement("iframe");v=$afe.jq(x);v.safeAttr("name",b);v.safeAttr("id",b);v.prop(c,"0");v.prop("height","0");v.prop("src",k);$afe.jq(document.body).safeAppend(v);v.contents().find(h).safeAppend($afe.jq(document.createElement(i)));v.load(function(){var a=document.getElementById(b);a.contentWindow.focus();if(WP.DOM.Browser.isIE)a.contentWindow.document.execCommand("print",f,g);else a.contentWindow.print()})}v=$afe.jq(x);z=v.contents().find(h);z.find(i).text($afe.select(l)[0].innerHTML);w=v.contents().find("body");y=$afe.select(m);if(!y||y.length===0)y=$afe.select(".letterNote");if(y.length>0)dangerou$.setHtml(w,y[0].innerHTML);else dangerou$.setHtml(w,$afe.select(j)[0].outerHTML.replace(n,o));w.find(p).css(d,a).css(c,a).css(e,a);w.find(q).css(d,a).css(c,a).css(e,a);w.find(r).css(d,a).css(c,a).css(e,a);w.find("canvas").css(s,"#eee").css("border",t);images=w.find("img");for(var A=0;A<images.length;A++){var C=$afe.jq(images[A]);console.log(C);C.css(u,"7in")}B=navigator.userAgent.toLowerCase().indexOf("safari/")>-1&&navigator.userAgent.toLowerCase().indexOf("chrome/")===-1;if(B)setTimeout(function(){x.contentWindow.document.write(z[0].outerHTML+w[0].outerHTML);x.contentWindow.document.close()},200);else{x.contentWindow.document.write(z[0].outerHTML+w[0].outerHTML);x.contentWindow.document.close()}return f},_printDoc:function _printDoc(){var E,A,x,v,w,z,C,y;x=document.getElementById(b);if(!x){x=document.createElement("iframe");v=$afe.jq(x);v.safeAttr("name",b);v.safeAttr("id",b);v.prop(c,"0");v.prop("height","0");v.prop("src",k);$afe.jq(document.body).safeAppend(v);v.contents().find(h).safeAppend($afe.jq(document.createElement(i)));v.load(function(){var a=document.getElementById(b);a.contentWindow.focus();if(WP.DOM.Browser.isIE)a.contentWindow.document.execCommand("print",f,g);else a.contentWindow.print()})}v=$afe.jq(x);z=v.contents().find(h);z.find(i).text($afe.select(l)[0].innerHTML);w=v.contents().find("body");A=$afe.select(m);if(A.length>0){dangerou$.setHtml(w,A[0].innerHTML);y=$afe.select(".downloadIcon");if(y)y=y.safeAttr("href");$.ajax({url:makeLink("Documents/ViewDocument/SecureAuditEsignPrint"),data:{dcsIDURL:y,accessType:2},type:"POST"})}else dangerou$.setHtml(w,$afe.select(j)[0].outerHTML.replace(n,o));images=w.find("img");for(var B=0;B<images.length;B++){var D=$afe.jq(images[B]);D.css(u,"7in")}w.find(p).css(d,a).css(c,a).css(e,a);w.find(q).css(d,a).css(c,a).css(e,a);w.find(r).css(d,a).css(c,a).css(e,a);w.find("canvas").css(s,"#eee").css("border",t);C=navigator.userAgent.toLowerCase().indexOf("safari/")>-1&&navigator.userAgent.toLowerCase().indexOf("chrome/")===-1;if(C)setTimeout(function(){x.contentWindow.document.write(z[0].outerHTML+w[0].outerHTML);x.contentWindow.document.close()},200);else{x.contentWindow.document.write(z[0].outerHTML+w[0].outerHTML);x.contentWindow.document.close()}return f}};$$WP.Documents.ViewDocument.Controllers.DocumentController=w;w.extend($$WP.Controllers.Controller,"WP$Documents$ViewDocuments$Controllers$DocumentController")})()
/*! Copyright (c) Epic Systems Corporation 2017-2018 */
$$WPUtil.guaranteeExistence($$WP,"Clinical.HealthIssues.Components");$$WP.Clinical.HealthIssues.Components.HealthIssues=function $$WP$Cln$HthIss(b){var a=this;a.Components$TemplateComponent(b);a.addEventListener("click",a._clickEvent);if(a.mode==="evisit"||a.mode==="echeckin"){a.Url=addQueryStringToUrl(a.Url,"localonly",1);a.DataFromMultipleSources=false}};$$WP.Clinical.HealthIssues.Components.HealthIssues.prototype={template:$$WP.Templates.Clinical.HealthIssues,Class:"",Url:makeLink("Clinical/HealthIssues/LoadListData"),DataFromMultipleSources:true,AreaName:"healthissues",mode:"",parent:null,setData:function $$WP$Clinical$HealthIssues$setData(a){if(a.DataList){a=$$WP.Clinical.Common.UpdateStrings(a,"clinical.healthissues",this.mode,3);a.UpdateDxrAccountLink=$$WP.CommunityUtilities.createUpdateOrganizationURL();this.Components$TemplateComponent$setData(a)}},html:function $$WP$Clinical$HealthIssues$html(b){var a=this;a.Components$TemplateComponent$html(b);if(a.$content.height()>0&&a.Data.DataList&&a.Data.DataList!==null){$$WP.Behaviors.matchRowHeights(a.$content,".cardlist > .card");a.$content.trigger("resize",{forceShrink:true});if(a.mode==="echeckin")$afe.select(".vb_navigation").addClass("show");else{$afe.select(".component[data-component-id='"+a.ComponentNumber+"']").parents(".haspersonalnotes").removeClass("hidepersonalnotes").addClass("componentsloaded");$afe.select(".personalnotessection.component").trigger("resize")}}a.parent&&typeof a.parent[0]._onComponentLoaded==="function"&&a.parent[0]._onComponentLoaded();$$WP.Utilities.UI.MatchColumnHeights()},_clickEvent:function $$WP$$Clinical$$HealthIssues$_clickEvent(l){var e=false,i="clinical.healthissues",h=true,d=this;if(l){var a,f,g,m;m=l.dataId;if(!m)return h;a=$$WP.Clinical.Common.GetClickedObject(d.Data,l,i);if(!a)return h;a.UseNativeDatePicker=$$WP.Utilities.UI.IsMobile||WP.DOM.Browser.isMobile;if(a.action>2&&a.action<7){var p={SupressTitle:h,TitleText:"",IsCondensed:e,Class:m,ParentD:d};f=new $$WP.Clinical.Common.Components.DeletePopup(p);f.setData(a);f.addEventListener("click",d._detailsClick);g=new $$WPContain.Popup({Components:[f],TitleText:a.title,positioningFunction:$$WPContain.Positions.CenterInside,Class:"pocdefaultpopup ",Size:$$WPContain.Popup.SizeEnum.SMALL});g._goBack=function(){this.dispose()};f.show();g.show();d.PopupContainer=g}else{var c;if(a.action===1){var n={Namespace:i};n.AlwaysShowSearchMore=d.Data.AlwaysShowSearchMore;c=new $$WP.Clinical.HealthIssues.Components.HealthIssuesLookup(n)}var o={SupressTitle:h,IsCondensed:e,ParentD:d},b=new $$WP.Clinical.Common.Components.ClinicalDetailsPopup(o);b.setData(a);b.addEventListener("click",d._detailsClick);b.addEventListener("submit",function(){return e});var j;if(a.action===1)j=[c,b];else j=[b];var k=new $$WPContain.Popup({Components:j,TitleText:a.title,Class:"lookupcontainer",positioningFunction:$$WPContain.Positions.InsideNearTop,Size:$$WPContain.Popup.SizeEnum.MEDIUM,SupportAnimations:e,BackButtonText:$$WP.Strings.get("popup_cancelbutton_label",i)});c.selectedResult=function(c){a.selectedId=c.ID;a.selectedName=c.Name;b.setData(a);b.refresh();b.show()};c.startOver=function(){b.hide();this.Components$LookupComponent$startOver()};k._goBack=function(){if(c)c.startOver();else this.dispose()};k.show();if(a.action===1){c.load();c.show()}else b.show();d.PopupContainer=k}return e}},_detailsClick:function $$WP$Clinical$HealthIssues$Details$_click(q){var p="disabled",j=".button",c=this;if(!q)return true;var r=q.dataId,v=q.$target.closest(j),t=$afe.jq(v),e=t.safeAttr("index"),a,d,h="";if(!r)return true;else if(r==="cancelitem")c.ContainerComponent._goBack();else{var k,l,i,m=c.$content.find("#datepicker");if(m.length>0){if(m.hasClass("nativeCalendar"))i=$$WP.I18N.formatPatientGivenDate(WP.Utils.iso2date(m.val()));else i=m.val();if(i.length>0){l="";if(IsDateValid(i,4,null,null,null))l=i;else return true}k=c.$content.find("#updatecomments");h=k.val()}switch(r){case"addeditem":a={};a.BaseID=e;a.Name=t.safeAttr("record-name");d=1;break;case"editeditem":a=c.ParentD.Data.currentList[e];d=2;break;case"editededititem":a=c.ParentD.Data.pendingEditList[e];d=2;break;case"editedadditem":a=c.ParentD.Data.pendingAddList[e];d=2;break;case"deleteditem":k=c.$content.find("#deletecomments");h=k.val();a=c.ParentD.Data.currentList[e];d=3;break;case"unaddeditem":a=c.ParentD.Data.pendingAddList[e];d=4;break;case"undeleteditem":a=c.ParentD.Data.pendingDeleteList[e];d=5;break;case"unediteditem":a=c.ParentD.Data.pendingEditList[e];d=6;break;default:return false}var u=c.ParentD;c.$content.find(j).addClass(p);var s=function(a){$$WP.Clinical.Common.handleAJAXResponse(a,"clinical.healthissues",this);this.$content.find(j).removeClass(p)},b="action="+d,n="";if(a.DisplayObject&&a.DisplayObject.Name)n=a.DisplayObject.Name;else if(a.Name)n=a.Name;if(n!=="")b=b+"&name="+encodeURIComponent(n);if(h&&h!=="")b=b+"&comments="+encodeURIComponent(h.trim());if(a.DisplayObject&&a.DisplayObject.ID)b=b+"&id="+a.DisplayObject.ID;if(l)b=b+"&date="+l;if(a.DisplayObject&&a.DisplayObject.UpdateInformation&&a.DisplayObject.UpdateInformation.ReferenceID)b=b+"&referenceID="+encodeURIComponent(a.DisplayObject.UpdateInformation.ReferenceID);if(a.BaseID)b=b+"&edgID="+a.BaseID;if(a.ShowExternalItems&&a.ExternalItems&&a.ExternalItems.length>0){for(var f="",g="",o=0;o<a.ExternalItems.length;o++){if(f.length>0){f=f+"^";g=g+"^"}f=f+a.ExternalItems[o].Organization.OrganizationId;g=g+a.ExternalItems[o].ID}b=b+"&externalMembers="+f+"&externalIDs="+g}$.ajax({url:makeLink("Clinical/HealthIssues/SubmitUpdate"),context:u,type:"POST",data:b,error:s,success:s})}return false}};$$WP.Clinical.HealthIssues.Components.HealthIssues.extend("Components.TemplateComponent")
$$WPUtil.guaranteeExistence($$WP,"Documents.ReleasedDocumentsController");$afe.onDocumentReady(function(){var b="#expiredHeader",a="#recentHeader",c=new $$WP.Controllers.ReleasedDocumentsController;$afe.select(a).keypress(function(b){b.keyCode==13&&$afe.select(a).click()});$afe.select(b).keypress(function(a){a.keyCode==13&&$afe.select(b).click()})});$$WP.Controllers.ReleasedDocumentsController=function ReleasedDocumentsController(){var d="matchColumnHeights",c="collasped",b="true",a="aria-expanded";this.Controllers$Controller();$afe.select("#loadingScreen").addClass("hidden");this.loadDownloads(this);$afe.select("#recentHeaderContainer").click(function(){var e=$afe.select("#recentHeader");e.safeAttr(a,e.safeAttr(a)===b?"false":b);$afe.select("#downloadRecords").toggleClass(c);$afe.select("#arrow1").toggleClass(c);setTimeout(function(){$afe.jq(window).resize();$afe.jq(window).trigger(d)},300)});$afe.select("#expiredHeaderContainer").click(function(){var e=$afe.select("#expiredHeader");e.safeAttr(a,e.safeAttr(a)===b?"false":b);$afe.select("#expiredRecords").toggleClass(c);$afe.select("#arrow2").toggleClass(c);setTimeout(function(){$afe.jq(window).resize();$afe.jq(window).trigger(d)},300)})};$$WP.Controllers.ReleasedDocumentsController.prototype={templates:$$WP.Templates.Documents.DownloadRecordCards,DocumentList:null,ExpiredDocList:null,_initializeOnClicks:function __initializeOnClicks(){$afe.select("#ROIList .button").click(this,this.downloadDocument)},loadDownloads:function loadDownloads(c){var g="#expiredRecords",f="#downloadRecords",a=true,e="hidden",d="#loadingScreen";$afe.select(d).removeClass(e);var b,h;$.ajax({type:"POST",url:makeLink("Documents/Released/LoadDownloads"),dataType:"json",success:function(i){var o="expiredStatusString",l="@MYCHART@EXPIRATIONDATE@",n="@MYCHART@REQUESTEDDATE@",k=false,m="@MYCHART@NOTIFICATIONPAGE@",j="documents.released";i.Current={Docs:[]};i.Past={Docs:[]};i.Current.IsNotify=i.IsNotify;$afe.select(d).addClass(e);$$WP.Strings.setDefaultNamespace(j);$$WP.Strings.addMnemonic(m,makeLink("Preferences"));i.Current.PrefLinkString=$$WP.Strings.getForTemplate("takeAwhileTextNotificationSettings",j);$$WP.Strings.removeMnemonic(m);i.Current.NoData=k;i.Current.CurrentDocs=a;i.Current.PastDocs=k;i.Past.NoData=k;i.Past.PastDocs=a;i.Past.CurrentDocs=k;for(var q in i.Docs){var h=i.Docs[q];h.IsDownloadable=k;h.IsPending=k;h.RequestedDate=new Date(parseInt(h.RequestedDate.substr(6)));if(!$$WPUtil.IsNullOrEmpty(h.ExpiresOnDateIso)&&!$$WPUtil.IsNullOrEmpty(h.ExpiresOnTimeIso))h.ExpiresOn=new Date(h.ExpiresOnDateIso+"T"+h.ExpiresOnTimeIso);h.StatusChangedOn=new Date(h.StatusChangedOnDateIso+"T"+h.StatusChangedOnTimeIso);$$WP.Strings.addMnemonic(n,h.requestedDateString);h.requestDateString=$$WP.Strings.getForTemplate("requestDateString",j);$$WP.Strings.removeMnemonic(n);var p=new Date;switch(h.StatusCode){case 1:case 7:i.Current.Docs.push(h);h.statusStringDoc=$$WP.Strings.getForTemplate("pendingStatusString",j);h.IsPending=a;h.refreshTemplateText=$$WP.Strings.getForTemplate("refreshText",j);break;case 2:!$$WPUtil.IsNullOrEmpty(h.ExpiresOn)&&$$WP.Strings.addMnemonic(l,h.expiredDateString);if(h.ExpiresOn<p&&!$$WPUtil.IsNullOrEmpty(h.ExpiresOn)){i.Past.Docs.push(h);h.statusStringDoc=$$WP.Strings.getForTemplate(o,j);h.IsDownloadable=k}else{i.Current.Docs.push(h);h.downloadLink=makeLink("Documents/Released/Download?releaseId="+h.ReleaseID+"&docId="+h.DocumentID+"&downloadedFileName="+h.PackageName+"&idx="+q.toString());if(!$$WPUtil.IsNullOrEmpty(h.ExpiresOn))h.statusStringDoc=$$WP.Strings.getForTemplate("downloadableStatusString",j);h.IsDownloadable=a}!$$WPUtil.IsNullOrEmpty(h.ExpiresOn)&&$$WP.Strings.removeMnemonic(l);break;case 3:if(h.ExpiresOn>p)i.Current.Docs.push(h);else break;h.statusStringDoc=$$WP.Strings.getForTemplate("revokedStatusString",j);break;case 4:$$WP.Strings.addMnemonic(l,h.statusChangeOnString);i.Past.Docs.push(h);h.statusStringDoc=$$WP.Strings.getForTemplate(o,j);$$WP.Strings.removeMnemonic(l);break;case 5:case 6:if(h.ExpiresOn>p)i.Current.Docs.push(h);else break;h.statusStringDoc=$$WP.Strings.getForTemplate("failedStatusString",j);h.IsWarningStatus=a}}if(i.Current.Docs<=0)i.Current.NoData=a;b=$afe.renderTemplate($$WP.Templates.Documents.DownloadRecordCards,i.Current);$afe.select(f).safeAppend(b);if(i.Past.Docs<=0)i.Past.NoData=a;b=$afe.renderTemplate($$WP.Templates.Documents.DownloadRecordCards,i.Past);$afe.select(g).safeAppend(b);c.DocumentList=i.Current.Docs;c.ExpiredDocList=i.Past.Docs;c._initializeOnClicks();c.appendPastDocumentsCount(c.ExpiredDocList.length);$afe.select(".cardlist.matchHeights").each($$WP.Utilities.UI.Cards.MatchHeights);$$WP.Utilities.UI.MatchColumnHeights()},error:function(){var h={};h.error=a;$afe.select(d).addClass(e);b=$afe.renderTemplate($$WP.Templates.Documents.DownloadRecordCards,h);$afe.select(f).safeAppend(b);b=$afe.renderTemplate($$WP.Templates.Documents.DownloadRecordCards,h);$afe.select(g).safeAppend(b);c.appendPastDocumentsCount(0)}})},appendPastDocumentsCount:function(c){var b="@MYCHART@NUMBEROFPASTDOCUMENTS@",a;$$WP.Strings.addMnemonic(b,c);a=$$WP.Strings.get("pastDocumentsCount","documents.released");$afe.select("#arrow2").safeBefore(" "+a);$$WP.Strings.removeMnemonic(b)},downloadDocument:function downloadDocument(f){var a,c,b,e,d=$afe.select("#errorMessage");d&&d.addClass("hidden");a=f.data||this;c=f.currentTarget.getAttribute("data-index");a.ActiveIndex=c;b=a.DocumentList[c];if(!b.IsEncrypted)return;if(b.IsVDT){e=$$WP.Strings.get("passwordTextMessageBoxForVDT","documents.released");a.passwordPrompt(e);return}a.showPassword(b,a);return},showPassword:function showPassword(f,d){var c="documents.released",b="@MYCHART@ROIPASSOWRD@",e=f.Password,a;if(e){$$WP.Strings.addMnemonic(b,e);a=$$WP.Strings.get("passwordTextMessageBox",c);$$WP.Strings.removeMnemonic(b);d.passwordPrompt(a)}else{var a=$$WP.Strings.get("passwordTextMessageBoxError",c);d.passwordPrompt(a)}},passwordPrompt:function passwordPrompt(b){var a,c=$$WP.Strings.get("passwordMessageBoxTitle","documents.released");a=new $$WPComp.MessageComponent({TitleText:c,Message:b,ToolbarButtons:[new $$WPComp.ComplexObjects.Button($$WP.Strings.get("MessageBoxOK","global"),null,"cancel","")],IsCloseable:true});return popup=$$WPUtil.quickPopup(a,{Size:$$WPContain.Popup.SizeEnum.MEDIUM,Class:"popupPassword"})},changeIcon:function changeIcon(){var b="cancelworkflow",a=$afe.select('[data-id="titlebarclose"]');a.removeClass(b);a.addClass(b)}};$$WP.Controllers.ReleasedDocumentsController.extend("Controllers.Controller")
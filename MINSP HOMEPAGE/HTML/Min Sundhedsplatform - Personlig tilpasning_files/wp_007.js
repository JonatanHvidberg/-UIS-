/*! Copyright (c) Epic Systems Corporation 2012 - 2018 */
if(typeof WP==="undefined")var WP={};if(typeof WP.Controls==="undefined")WP.Controls={};if(typeof WP.Controls.ImageViewer==="undefined"){WP.Controls.ImageViewer=function(h,l,i,e,k,n,j,m,a,o){var d="disabled",c=true,b=this,f=b,g;e=e&&window.location.href.indexOf("printmode=true")===-1;b.imgsContainer=createElement("div","imagescontainer row");b.ID=h;if(e!==c&&e!==false)e=c;b.visibleLabel=document.getElementById("iframelabel");b.AllowEdit=e;b.ImageList=[];b.iframe=document.getElementById("iframe"+h);b.maxDescLength=k||200;b.formName=n||"";b.afterValidate=j||null;b.maxImages=m||5;l.appendChild(b.imgsContainer);b.isPrintMode=window.location.href.indexOf("printmode")>-1;if(b.isPrintMode)b.imgsContainer.style.width="99%";b.alertDiv=document.getElementById("imgalert");b.setActivity=SetActivity;b.setActivity();b.mode=parseInt(o||3,10);if(a){a.mode=3;g=a.parentNode.lastChild.previousSibling;b.browse=a;a.writeError=function(b){a.dontOverwriteError!==c&&dangerou$.setHtml(g,b);a.uploading=false;spin.hide();removeClassNames(a.button,d);f.setActivity()};a.beforeupload=function(){a.writeError("");spin.show();applyClass(a.button,d);f.setActivity()};a.setDisabled=function(b){var e,f=b?applyClass:removeClassNames;f(a.button,d);a.disabled=b;if(a.setDisabledInner)a.setDisabledInner(b);else if(b===c){a.dontOverwriteError=c;e=function(){if(!a.setDisabledInner){window.setTimeout(e,1);return}a.setDisabledInner(b);a.dontOverwriteError=false};e()}};$afe.jq(window).load(function(){a.style.width=a.button.offsetWidth+"px";a.style.height=a.button.offsetHeight+"px"});a.onupload=function(b,e,c,d){f.addImage(b,e,c,d);f.transferToForm();a.button.style.display=""}}b.setSerialized(i);return b};WP.Controls.ImageViewer.prototype.updateLabel=function(f,a){var c=this,b,d,g,e;b=c.imgsContainer.children[f];d=b.children[2];if(d.value!==a)d.value=a;c.ImageList[f].label=a;b=b.children[1].children[0];b.alt=a;b.title=a;e=c.ImageList[f];g="upload.asp?mode=update&thumb="+(e.srcThumb+"&full="+e.srcFull+"&label="+encodeURI(a));$.ajax({url:g,method:"POST"});c.reserialize();c.setActivity()};WP.Controls.ImageViewer.prototype.addImage=function(e,k,E,z){var D="textarea.filedescription",w="matchColumnHeights",v="click",l="filedescription",C="imagediv",u="showfile.asp?key=",r="img",q="uploadedimage",p=true,o="div",a=this;if(typeof e==="string")try{e=parseInt(e,10)}catch(H){return}if(a.imageCount()>=a.maxImages)return false;else if(e!==1&&e!==2&&e!==3)return false;var b,d,x,g,h,F,G,t,m,c,s,y,n,i,j,A,f,B;b=a.ImageList.length;d=createElement(o,"filecontainer col-4","filecontainer"+b);t=createElement(o,"buttondiv");h=createElement("a","zoom");$T(h," ");h.href="#";G=createImage("zoom","","magnify.png","Vis i fuld størrelse");h.appendChild(G);h.tabindex="0";t.appendChild(h);if(a.AllowEdit===p){g=createElement("a","deletex");$T(g," ");g.href="#";g.tabindex="0";F=createImage("deletex","","close.svg","Slet");g.appendChild(F);t.appendChild(g)}d.appendChild(t);if(e===2)i=createImage(q,r+b,"msgattachment_pdf.png",k);else if(e===3)i=createImage(q,r+b,"msgattachment_video.png",k);else{i=createImage(q,r+b,"",k);i.src=u+(E||z)}x=createElement(o,q,C+b);x.appendChild(i);d.appendChild(x);if(a.AllowEdit===p){s=createElement(o,"ghostInput");m=createElement("label",l);$afe.jq(m).safeAttr("for",l+b);$afe.jq(m).addClass("required");$T(m,"Indtast navn:");m.title="Indtast et navn på eller en kort beskrivelse af billedet.";s.appendChild(m);c=createElement("textarea",l,l+b);$afe.jq(c).safeAttr("for",C+b);$afe.jq(c).safeAttr("data-validation-settings",'{"required":true, "maxLength":30}');c.value=k;s.appendChild(c);y=createElement("p","helptext imagelabelerror");d.appendChild(s);d.appendChild(y);WP.Validators.Text.MaxLengthAndRequired(c,"<span class=\"clearlabel\">Fejl: </span>Navn er påkrævet.",a.maxDescLength,y,a.formName,a.afterValidate);window.setTimeout(function(){c.focus()},1)}else{n=createElement("h3",l,l+b);$T(n,k);n.title=k;$afe.jq(n).safeAttr("for",r+b);d.appendChild(n)}a.imgsContainer.appendChild(d);A=a;j={srcThumb:E,srcFull:z,imageType:e,label:k,del:function(){A.deleteImage(b)},mag:function(){window.open(u+z)},upd:function(){A.updateLabel(b,c.value)},labelObj:c,foc:function(){c.select()}};if(!a.isPrintMode){WP.Events.addListener(h,v,j.mag);WP.Events.addListener(i,v,j.mag)}if(a.AllowEdit===p){WP.Events.addListener(g,v,j.del);WP.Events.addListener(c,"change",j.upd);WP.Events.addListener(c,"focus",j.foc)}WP.Events.addListener(i,"load",function(){$afe.jq(window).trigger(w)});a.ImageList[b]=j;f=a.imgsContainer.parentNode;f.style.display="";f=f.previousSibling;if(f&&f.tagName==="H2"){f.style.display="";B=$afe.jq(f);!B.hasClass("header")&&B.addClass("header")}a.reserialize();a.transferCorrectLabel();if(a.iframe)if(a.imageCount()===a.maxImages){a.iframe.setDisabled(p);if(a.maxImages===1)$T(a.alertDiv,"Du kan kun overføre én vedhæftet fil.");else $T(a.alertDiv,decodeMnemonics("Du kan kun overføre @MYCHART@MAXIMAGES@ vedhæftede filer.",{"@MYCHART@MAXIMAGES@":a.maxImages}));a.alertDiv.className="helptext"}else a.iframe.setDisabled(false);a.singleWidth=d.scrollWidth+15;$afe.jq(window).trigger(w);$afe.jq(f).parents("form").change();$afe.jq(d).find(D).change();$afe.jq(d).find(D).blur();return b};WP.Controls.ImageViewer.prototype.setSerialized=function(a){var c=this,g,f,e,b,d;c.serializedData=a;c.clear();g=String.fromCharCode(9);f=String.fromCharCode(10);a=a.replace(/`~`z_/g,g);a=a.replace(/`~~`z_/g,f);e=a.split(g);for(d=0;d<e.length;d++){b=e[d].split(f);b.length===4&&c.addImage(b[0],b[1],b[2],b[3])}c.transferToForm();c.setActivity();c.transferCorrectLabel()};WP.Controls.ImageViewer.prototype.reserialize=function(){var c=this,a,b,g,d,e,f;g=String.fromCharCode(9);d=String.fromCharCode(10);f=c.ImageList;b="";for(e=0;e<f.length;e++){a=f[e];if(typeof a.label!=="undefined"){a.label=a.label.replace(/(\t|\n|\r)/g," ");b+=g+a.imageType+d+a.label+d+a.srcThumb+d+a.srcFull}}b=b.substr(1);c.serializedData=b;c.transferToForm();c.setActivity()};WP.Controls.ImageViewer.prototype.deleteImage=function(f){var d="click",a=this,b,c,h,g,e;b=a.imgsContainer.children[f];g=$afe.jq(b);c=a.ImageList[f];WP.Events.removeListener(b.children[0].children[0],d,c.mag);WP.Events.removeListener(b.children[1].firstChild,d,c.mag);a.AllowEdit===true&&WP.Events.removeListener(b.children[0].children[1],d,c.del);e=g.find("textarea").get(0);WP.Events.removeListener(e,"change",c.upd);e.removeMaxLength();clearElement(b);b.style.display="none";h="upload.asp?mode=delete&thumb="+(c.srcThumb+"&full="+c.srcFull);$.ajax({url:h,method:"POST"});a.ImageList[f]={};if(a.imageCount()===0){a.clear();matchWrapHeight()}else a.reserialize();a.transferCorrectLabel();if(a.imageCount()<a.maxImages&&a.iframe)if(a.imageCount()===a.maxImages-1){a.iframe.setDisabled(false);$T(a.alertDiv,"");a.alertDiv.className="alert"}$$WP.FormValidation.checkIfFormIsValid($afe.select("form#MedAdvice"),true);setAppropriateHeight()};WP.Controls.ImageViewer.prototype.clear=function(){var b=this,c,a,d;d=b.ImageList;for(c=0;c<d.length;c++)d[c].srcFull&&b.deleteImage(c);delete b.ImageList;b.ImageList=[];a=b.imgsContainer;$afe.jq(a).empty();a=a.parentNode;a.style.display="none";a=a.previousSibling;if(a&&a.tagName==="H2")a.style.display="none";b.serializedData="";b.transferToForm();b.iframe&&b.iframe.setDisabled(false);b.setActivity()};WP.Controls.ImageViewer.prototype.transferToForm=function(){var a=document.getElementById(this.ID);if(a)a.value=this.serializedData;this.setActivity()};WP.Controls.ImageViewer.prototype.imageCount=function(){for(var b=this.ImageList,c=0,a=0;a<b.length;a++)if(b[a]&&(b[a].srcThumb||b[a].srcFull))c++;return c};WP.Controls.ImageViewer.uploadLabels=[["Vedhæft et billede","Vedhæft yderligere et billede"],["Vedhæft en video:","Vedhæft yderligere en video"],["Vedhæft et billede eller en video","Vedhæft yderligere et billede eller en video"]];WP.Controls.ImageViewer.prototype.transferCorrectLabel=function(){var a=this.imageCount()===0?0:1;$T($afe.select(".uploaderbutton > .button").get(0),WP.Controls.ImageViewer.uploadLabels[this.mode-1][a])}}
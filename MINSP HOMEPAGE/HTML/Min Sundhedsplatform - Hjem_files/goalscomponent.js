/*! Copyright (c) Epic Systems Corporation 2015-2017 */
$$WPUtil.guaranteeExistence($$WP,"Clinical.Goals.Components");$$WP.Clinical.Goals.Components.GoalsComponent=function $$WP$Clinical$Goals$Components$GoalsComponent(b){var a=this;a.RegistryID=b.RegistryID||"";a.RegistryName=b.RegistryName||"";a.Url=makeLink("Clinical/Goals/Load?hfrId="+a.RegistryID);a.TitleText=$$WP.Strings.getForTemplate("Title","Clinical.Goals");a.Components$TemplateComponent(b);a.addEventListener("click",a._goalsClick)};$$WP.Clinical.Goals.Components.GoalsComponent.prototype={Class:"goalssmall pocdefault withborder ",template:$$WP.Templates.Clinical.GoalsList,RegistryID:"",RegistryName:"",ShowPocExpandIcon:true,setData:function(a){var f="@MYCHART@CONDITION@",c="Clinical.Goals",d=true,b=this;if(a.Text&&a.Text==="ErrorCode"){a.HasNoData=d;a.NoDataText=$$WP.Strings.getForTemplate(a.Value,c);b.$container.addClass("noinfo")}if(a.GoalsList){var e=$$WP.Strings.getForTemplate("pretext","clinical.Goals");if(e&&!$$WPUtil.IsNullOrEmpty(e.string))a.PreText=e;if(a.GoalsList.length<1){a.HasNoData=d;b.$container.addClass("noinfo");if(b.RegistryName){$$WP.Strings.addMnemonic(f,b.RegistryName,false,c);a.NoDataText=$$WP.Strings.getForTemplate("nodatatext_condition",c);$$WP.Strings.removeMnemonic(f,c)}else a.NoDataText=$$WP.Strings.getForTemplate("nodatatext",c)}else{a=b._updateMnemonics(a);a.NotesLabel=$$WP.Strings.getForTemplate("noteslabel",c);a.NoNotesText=$$WP.Strings.getForTemplate("nonotestext",c);if(a.HasChartGraphSecurity){b.AlwaysShowExpandIcon=d;b.Components$Component$capHeight(3e3)}else if(!a.IsSharingNotesEnabled)a.UnClickable=d}}b.Components$TemplateComponent$setData(a)},_updateMnemonics:function $$WP$Cln$Goal$updateMnemonics(h){var o="@MYCHART@DATE@",n="@MYCHART@VALUE@",m="@MYCHART@GOALTITLE@",l="@MYCHART@GOALHIGH@",k="@MYCHART@GOALLOW@",f=null,e=false,j="@MYCHART@GOALITEM@";$$WP.Strings.setDefaultNamespace("Clinical.Goals");for(var c,a,d,b,g,i=0;i<h.GoalsList.length;i++){a=h.GoalsList[i];b=a.TitleInfo;if(b&&b.Pattern)if(b.Target1||b.Target2){d=b.Item;if(!d)d=$$WP.Strings.getForTemplate("goaltype_"+a.GoalType).string;if(d){$$WP.Strings.addMnemonic(j,d,e,f,$$WP.Strings.EncodingTypes.None);$$WP.Strings.addMnemonic(k,b.Target1,e,f,$$WP.Strings.EncodingTypes.None);$$WP.Strings.addMnemonic(l,b.Target2,e,f,$$WP.Strings.EncodingTypes.None);a.Title=$$WP.Strings.getForTemplate(b.Pattern).string;$$WP.Strings.removeMnemonic(j);$$WP.Strings.removeMnemonic(k);$$WP.Strings.removeMnemonic(l)}}$$WP.Strings.addMnemonic(m,a.Title,e,f,$$WP.Strings.EncodingTypes.html);a.Title=$$WP.Strings.getForTemplate("goal_name");$$WP.Strings.removeMnemonic(m);if(a.Readings&&a.Readings[0]){for(c=0;c<a.Readings.length;c++)if(a.ComplianceType!==1)a.Readings[c].Status=this._getGoalValue(a.Readings[c]);else a.Readings[c].Status=a.Readings[c].Value;g="mostrecenttext_numeric";if(a.ComplianceType!==1)g="mostrecenttext_nonnumeric";$$WP.Strings.addMnemonic(n,a.Readings[0].Value);$$WP.Strings.addMnemonic(o,a.Readings[0].DateDisplay);a.MostRecent=$$WP.Strings.getForTemplate(g);$$WP.Strings.removeMnemonic(n);$$WP.Strings.removeMnemonic(o)}else a.MostRecent=$$WP.Strings.getForTemplate("mostrecenttext_absent")}$$WP.Strings.clearDefaultNamespace();return h},_getGoalValue:function $$WP$Cln$Goal$getGoalValue(b){var a;a=$$WP.Strings.getForTemplate("progressvalue_"+b.Value);if(a.string==="")a=b.ValueTitle;return a},_goalsClick:function $$WP$Cln$Goal$click(b){var d="Clinical.Goals",f="@MYCHART@CONDITION@",c="viewmore",a=this;switch(b.dataId){case"selectli":case"selectlianchor":case"selectti":case"selectda":case $$WPComp.TITLEBARIDENTIFIER+c:case c:break;default:return false}var e=a.TitleText;if(a.RegistryName){$$WP.Strings.addMnemonic(f,a.RegistryName,false,d);e=$$WP.Strings.getForTemplate("Title_Condition",d);$$WP.Strings.removeMnemonic(f,d)}if(a.Data.HasChartGraphSecurity||a.Data.IsSharingNotesEnabled)a._openGraphPopup(b,e);else(b.dataId===$$WPComp.TITLEBARIDENTIFIER+c||b.dataId===c)&&a._openListPopup(b,e);return false},_openGraphPopup:function $$WP$Cln$Goal$openGraph(p,q){var g=false,c=true,a=this,f,l,h,n,o,k,j={},b={},e={},i={},d={},m;o=p.$target.closest(".goalslistelement");k=parseInt(o.safeAttr("data-index"),10);if(isNaN(k))k=0;j.SupressTitle=c;j.IsCondensed=g;j.Class="goalsleft leftcolumn column";f=new $$WP.Clinical.Goals.Components.GoalsPopupComponent(j);f._showSelectedGoalGraph=a._showSelectedGoalGraph;f.setData(a.Data);f.Data.IsInPopup=c;f.addEventListener("keydown",a._goalsListKeyDown);b.SupressTitle=c;b.IsCondensed=g;b.RegistryID=a.RegistryID;b._showSelectedGoalGraph=a._showSelectedGoalGraph;b._switchTableGraph=a._switchTableGraph;b._selectedIndex=k;l=$$WPUtil.ComponentFactory.Clinical.goals(b);l.load();e.SupressTitle=c;e.TitleText="";e.IsCondensed=g;e.template=$$WP.Templates.Clinical.GoalsTable;e.Class="goalsdetails section";h=new $$WP.Clinical.Goals.Components.GoalsPopupComponent(e);h.setData(a.Data);h.addEventListener("click",function(){return g});h.addEventListener("focusout",a._goalDetailsFocusOut);i.Class="goalsoverallcontainer";i.Components=[f,l,h];i.TitleText=q;n=new $$WPContain.ContainerComponent(i);d.Components=n;d.Class="goalslarge pocdefaultpopup ";d.Size=$$WP.Containers.Popup.SizeEnum.LARGE;d.IsClosable=c;d.positioningFunction=$$WPContain.Positions.InsideNearTop;m=new $$WPContain.Popup(d);m.show(c);$afe.select(".goalsvb6, .goalsdetails").safeWrapAll($$WP.SimpleTemplates.Div({"class":"goalsright rightcolumn column"}));$afe.select(".goalsoverallcontainer > .content").addClass("menudetailstable leftmenu");a.$container.trigger("resize",{forceShrink:c});$afe.jq(window).trigger("matchColumnHeights")},_openListPopup:function $$WP$Cln$Goal$openList(e,d){var a={},b,c;a.SupressTitle=true;a.TitleText="";a.IsCondensed=false;a.Class="HPcell";b=new $$WP.Clinical.Goals.Components.GoalsComponent(a);b.setData(this.Data);b.addEventListener("click",function(){return false});c=new $$WPContain.Popup({Components:[b],TitleText:d,positioningFunction:$$WPContain.Positions.InsideNearTop,Class:"goalsnarrow pocdefaultpopup ",Size:$$WPContain.Popup.SizeEnum.LARGE});b.show();c.show()},_showSelectedGoalGraph:function $$WP$Cln$Goal$showSelected(g){var s="#noteslabel",r="#notesbox",c="selected",a="hidden",q=".goalrecentvalue";if(g){var t,e,p,j,f,m,n,i,b,d,h,k,l,o;e=$afe.jq(document.getElementById(g));p=e.find(".goaltitlerow");j=e.find(".goaldatarow");$afe.select(".goaltitle").text(p.text());f=$afe.select(q);if(j.length){t=j.html();o=j.clone();dangerou$.setHtml(o,t);f.safeReplaceWith(o.safeAttr("id","goalrecentvalue").safeAttr("class","").addClass("goalrecentvalue nodata").addClass(a))}else f.safeAttr("class",a);if(e.length){$afe.select(".goalslistelement.selected").removeClass(c);e.addClass(c)}i=$afe.jq(document.getElementById("goal_lst_"+g));h=$afe.select(".goalbuttonlist");$afe.select(".chartgraph").addClass(a);$afe.select(".goalnotes").addClass(a);f=$afe.select(q);if(i.length){i.removeClass(a);b=i.find(".graph");d=i.find(".chart");if(b.length&&d.length){k=$afe.select(".graphButton");l=$afe.select(".tableButton");h.removeClass(a);if(b.hasClass(a)&&d.hasClass(a)){b.removeClass(a);k.addClass(c);l.removeClass(c)}else if(b.hasClass(a)){k.removeClass(c);l.addClass(c)}else{k.addClass(c);l.removeClass(c)}}else if(b.length&&!d.length){b.removeClass(a);h.addClass(a)}else if(!b.length&&d.length){d.removeClass(a);h.addClass(a)}else f.removeClass(a)}else{h.addClass(a);m=$afe.jq(document.getElementById("chart_"+g));if(m.length){m.removeClass(a);$afe.jq(document.getElementById("chartgraph_"+g)).removeClass(a)}else f.removeClass(a)}n=$afe.jq(document.getElementById("notes_"+g));if(n.length){n.removeClass(a);$afe.select(r).removeClass(a);$afe.select(s).removeClass(a)}else{$afe.select(r).addClass(a);$afe.select(s).addClass(a)}e.find("a:first").focus();$afe.select("a[name=goalmaintop]").focus()}},_switchTableGraph:function $$WP$Cln$Goal$switch(i){var h="a[name=goalmaintop]",b="hidden",a="selected",j,e,c,d,f,g;j=$afe.select(".goalslistelement.selected").safeAttr("id");e=$afe.jq(document.getElementById("goal_lst_"+j));c=e.find(".graph");d=e.find(".chart");f=$afe.select(".graphButton");g=$afe.select(".tableButton");if(i.dataId==="titlebargraph"){f.addClass(a);g.removeClass(a);c.removeClass(b).css("display","block");d.addClass(b);$afe.select(h).focus()}if(i.dataId==="titlebartable"){f.removeClass(a);g.addClass(a);d.removeClass(b).css("display","block");c.addClass(b);$afe.select(h).focus()}},_goalDetailsFocusOut:function $$WP$Cln$Goal$glDetFcsOut(a){a.dataId==="endanchor"&&$afe.select(".goalslistelement.selected a:first").focus()},_goalsListKeyDown:function $$WP$Cln$Goal$glsLstKeyDwn(b){var e='"] a:first',d='[data-index="',a,g,f,c;if(b.dataId==="selectlianchor"&&b.keyCode===9){a=b.$target.closest("ul");g=b.$target.closest("li");f=a.find(".goalslistelement").length-1;c=Number(g.safeAttr("data-index"));if(f===c){if(b.shiftKey)a.find(d+(c-1)+e).focus();else a.find('[data-index="0"] a:first').focus();return false}if(c===0){if(b.shiftKey)a.find(d+f+e).focus();else a.find(d+(c+1)+e).focus();return false}}}};$$WP.Clinical.Goals.Components.GoalsComponent.extend("Components.TemplateComponent")
/*! Copyright (c) Epic Systems Corporation 2015-2016 */
$$WP.Utilities.guaranteeExistence($$WP,"Clinical.ToDo.Containers");$$WP.Clinical.ToDo.Containers.ToDoEventsPopup=function $$WPClinical$ToDoEventsPopup$Container(b){var c="clinical.todo",e="listview",a=this;b=b||{};a.CurrentView=b.CurrentView||e;a.ClickedEventIndex=b.ClickedIndex||-1;a.CalendarDate=b.CalendarDate||new Date;a.Containers$ContainerComponent(b);a.ToDoListsPopupComponent=new $$WP.Clinical.ToDo.Components.ToDoListPopupComponent({Class:"todolistspopup"});a.addComponent(a.ToDoListsPopupComponent);a.ToDoCalendarPopupComponent=new $$WP.Clinical.ToDo.Components.ToDoCalendarPopupComponent({Class:"todocalendarpopup",CalendarDate:a.CalendarDate});a.addComponent(a.ToDoCalendarPopupComponent);var d=[];d.push(new $$WPComp.ComplexObjects.Button($$WP.Strings.getForTemplate("toolbarlist",c),"","listviewtoolbarlink selected",e,$$WP.Strings.getForTemplate("listviewanchortitle",c)));d.push(new $$WPComp.ComplexObjects.Button($$WP.Strings.getForTemplate("toolbarcalendar",c),"","weekcalendartoolbarlink","weekcalendar",$$WP.Strings.getForTemplate("calendarviewanchortitle",c)));a.setTitle(null,d);a.addEventListener("click",a._clickEvent)};$$WP.Clinical.ToDo.Containers.ToDoEventsPopup.prototype={IsClosable:false,TitleText:"",Class:"ToDoEventsPopup",Identifier:"ToDoEventsPopup",CurrentView:"",CalendarDate:null,ClickedEventIndex:-1,_clickEvent:function $$WP$Clinical$ToDo$ToDoEventsPopup$$_clickEvent(a){var b=this,c,e,d;if(a)if(a.dataId==="titlebarweekcalendar"){b.toggleToView("calendar");b.ToDoCalendarPopupComponent.refresh();b.ContainerComponent.setFocus();return false}else if(a.dataId==="titlebarlistview"){b.toggleToView("list");return false}else if(a.dataId==="previousweek"||a.dataId==="nextweek")b.$content.find("a:first").focus();else if(a.dataId==="markascompleteitem"){c=$afe.jq(a.target).closest("a[href]").safeAttr("data-topic-id");b._showPopupForMarkAsComplete(c)}},_showPopupForMarkAsComplete:function $$WP$Clinical$ToDo$Containers$ToDoEventsPopup$_showPopupForMarkAsComplete(e){var a=this;for(var d=(a.Data.ToDoEventsList||[]).length,c,f=a,b=0;b<d;++b)if(a.Data.ToDoEventsList[b].HaTopicEvent&&a.Data.ToDoEventsList[b].HaTopicEvent.TopicId===e){c=new Epic.PatientAccess.HealthAdvisories.MarkAsCompletePopup(a.Data.ToDoEventsList[b].HaTopicEvent);c.onClose=function(a){f._onMarkAsCompletePopupDone(a)};a.ContainerComponent.hide();c.ShowPopup();return false}},_onMarkAsCompletePopupDone:function(b){var a=this;if(b)if(a.ContainerComponent.ToDoListComponent.IsPOC){a.ContainerComponent.ToDoListComponent.load();a.ContainerComponent.dispose()}else window.location.reload();else a.ContainerComponent.show()},toggleToView:function $$WP$Clinical$ToDo$Containers$ToDoEventsPopup$toggleToView(h){var g=".listviewtoolbarlink",b="selected",f=".weekcalendartoolbarlink",e=".todolistspopup.component",a="hidden",d=".todoweekcalendar .todoweekcalendarcontent",c=this;if(h==="list"){$afe.select(d).addClass(a);$afe.select(e).removeClass(a);$afe.select(f).removeClass(b);$afe.select(g).addClass(b);c.ContainerComponent.setFocus();c.$container.trigger("resize")}else{$afe.select(d).removeClass(a);$afe.select(e).addClass(a);$afe.select(f).addClass(b);$afe.select(g).removeClass(b);c.ContainerComponent.setFocus();c.$container.trigger("resize")}},load:function $$WP$Clinical$ToDo$Containers$ToDoEventsPopup$load(){var c="tabindex",b="selected",a=this;a.ToDoListsPopupComponent.show();a.ToDoCalendarPopupComponent.show();if(a.CurrentView==="listview"){a.toggleToView("list");if(a.ClickedEventIndex!==-1){typeof todotimeout!=="undefined"&&clearTimeout(todotimeout);$afe.select(".todolistspopup div[data-event-index='"+a.ClickedEventIndex+"']").addClass(b).safeAttr(c,"0").focus().removeAttr(c);todotimeout=setTimeout(function(){$afe.select(".todolistspopup .selected").removeClass(b)},5e3)}}else{a.toggleToView("calendar");a.ToDoCalendarPopupComponent.refresh()}},setData:function $$WP$Clinical$ToDO$Containers$ToDoEventsPopup$set(a){this.Data=a;this.ToDoListsPopupComponent.setData(a);this.ToDoCalendarPopupComponent.setData(a)}};$$WP.Clinical.ToDo.Containers.ToDoEventsPopup.extend("Containers.ContainerComponent")
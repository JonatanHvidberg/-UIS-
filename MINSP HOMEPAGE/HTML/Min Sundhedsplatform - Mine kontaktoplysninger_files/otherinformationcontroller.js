(function WP$PI$OIC$definition(){var g=".cancelButton",a=true,b=false,e=null,d=".cardlist.matchHeights",f,s_getFieldIdFromErrorIndex,c=function WP$PI$OIC(c,b){var a=this;a._settings=b||new f;a.WP$Controllers$EditableViewController(c,$$WP.Templates.PersonalInformation.OtherInformation);a.$root.addClass("other-information-content card col-6");!$$WP.Utilities.UI.IsMobile&&a.$root.addClass("withButton");a.$root.parents(".cardlist").trigger("cardLoad");a.$root.on("submit",function(a){a.preventDefault()});$afe.select("body").on("input change focusout",$.proxy(function(){this.$root.parents(d).each($$WP.Utilities.UI.Cards.MatchHeights)},a))},i={_settings:e,_initialViewModel:e,_wasJumpedToEditMode:b,_onLoadSuccess:function WP$PI$OIC$_OLS(j){var f="function",d=this,h,e,i=b;d.ViewModel=j;if(d.ViewModel.Fields.length===0){d.$root.hide();typeof d._settings.onLoadSuccessCallback===f&&d._settings.onLoadSuccessCallback();return}if(!c.WereRELFieldsShown)for(e=0;e<d.ViewModel.Fields.length;e++)if(d.ViewModel.Fields[e].FieldId==="7"||d.ViewModel.Fields[e].FieldId==="8"||d.ViewModel.Fields[e].FieldId==="9"||d.ViewModel.Fields[e].FieldId==="10")c.WereRELFieldsShown=a;for(h=0;h<d.ViewModel.Fields.length;h++)if(d.ViewModel.Fields[h].Type===1&&d.ViewModel.Fields[h].Values[0].length===0)d.ViewModel.Fields[h].Values=[];d.ViewModel.ValidationSettings=$$WP.FormValidation.ValidationSettings.Required;for(e=0;e<d.ViewModel.Fields.length;e++)if(d.ViewModel.Fields[e].IsRequired)if(d.ViewModel.Fields[e].Type===1&&d.ViewModel.Fields[e].Values[0]===""||d.ViewModel.Fields[e].Values.length===0)i=a;d.render(i);typeof d._settings.onLoadSuccessCallback===f&&d._settings.onLoadSuccessCallback();if(i){d._initialViewModel=$.extend(a,{},d.ViewModel);d.$root.find(g).remove();d._wasJumpedToEditMode=a;!d._settings.isEmbedded&&WP.Events.beforeUnload();typeof d._settings.onEditClickedCallback===f&&d._settings.onEditClickedCallback()}},_onSaveSuccess:function WP$PI$OIC$_OSS(f){var c=this;for(var h,e=0;e<f.ViewModel.Fields.length;e++)delete f.ViewModel.Fields[e].IsRequired;c.ViewModel=$.extend(a,{},c.ViewModel,f.ViewModel);if(f.Success){for(e=0;e<c.ViewModel.Fields.length;e++)if(c.ViewModel.Fields[e].Type===1&&c.ViewModel.Fields[e].Values[0].length===0)c.ViewModel.Fields[e].Values=[];c.render(b);c._wasJumpedToEditMode=b;$.isFunction(c._settings.onSaveSuccessCallback)&&c._settings.onSaveSuccessCallback()}else{c.render(a);c._wasJumpedToEditMode&&c.$root.find(g).remove();if(f.ViewModel.ValidationErrors)for(e=0;e<f.ViewModel.ValidationErrors.length;e++){h=$afe.select(s_getFieldIdFromErrorIndex(f.ViewModel.ValidationErrors[e].ErrorIndex));$$WP.FormValidation.addValidationError(h,f.ViewModel.ValidationErrors[e].ErrorKey)}c.$root.parents(d).each($$WP.Utilities.UI.Cards.MatchHeights)}},onEditClicked:function WP$PI$CIC$OEC(c){var b=this;b._initialViewModel=$.extend(a,{},b.ViewModel);b.WP$Controllers$EditableViewController$onEditClicked(c);$.isFunction(b._settings.onEditClickedCallback)&&b._settings.onEditClickedCallback()},onSaveClicked:function WP$PI$CIC$OEC(a){this.WP$Controllers$EditableViewController$onSaveClicked(a)},onCancelClicked:function WP$PI$CIC$OEC(b){var a=this;a.ViewModel=a._initialViewModel;a.WP$Controllers$EditableViewController$onCancelClicked(b);$.isFunction(a._settings.onCancelClickedCallback)&&a._settings.onCancelClickedCallback()},_getPostableViewModel:function WP$PI$OIC$_GPVM(){var b=this,e,d,a,c;e=[];for(a=0;a<b.ViewModel.Fields.length;a++){if(b.ViewModel.Fields[a].Type===1)d=b.ViewModel.Fields[a].Values.length?b.ViewModel.Fields[a].Values:[""];else{d=[];for(c=0;c<b.ViewModel.Fields[a].Categories.length;c++)b.ViewModel.Fields[a].Categories[c].IsSelected&&d.push(b.ViewModel.Fields[a].Categories[c].Number)}e.push({FieldId:b.ViewModel.Fields[a].FieldId,Type:b.ViewModel.Fields[a].Type,Values:d})}return{Fields:e,disableRTL:b._settings.disableRTL}},loadData:function WP$PI$OIC$LD(){var a=this;$.ajax({type:"POST",url:makeLink("PersonalInformation/GetOtherInformation?checkRELFrequency="+a._settings.checkRELFrequency),data:$$WPUtil.postify({disableRTL:a._settings.disableRTL}),dataType:"json",success:$.proxy(a._onLoadSuccess,a)})},saveData:function WP$PI$OIC$SD(){var a=this;a.$root.find(".loadingIndicator").show();a.updateViewModel();$.ajax({type:"POST",url:makeLink("PersonalInformation/UpdateOtherInformation"),data:$$WPUtil.postify(a._getPostableViewModel()),dataType:"json",success:$.proxy(a._onSaveSuccess,a)})},afterRender:function WP$PI$OIC$AR(){var a=this;if(!a._settings.isEmbedded)if(a.ViewModel.DisplayEditable)WP.Events.beforeUnload();else WP.Events.cancelBeforeUnload();$$WP.FormValidation.initializeDOMSubtree(a.$root);a.$root.find(".hideLongContentWithEllipses").each(function(){if(this.getClientRects().length>2){var a=$afe.jq(this);a.addClass("overflowHiddenWithEllipses").safeAttr("title",a.text())}});a.$root.parent(d).each($$WP.Utilities.UI.Cards.MatchHeights);$$WP.Utilities.UI.IsMobile&&a.$root.find(".formbuttons").removeClass("buttonList right");if(typeof a._settings.focusAfterRender!=="undefined")a.focusAfterRender=a._settings.focusAfterRender;a.WP$Controllers$EditableViewController$afterRender()},updateViewModel:function WP$PI$OIC$UVM(){var g="disabled",f=".button, input, select, textarea",e=this,h,c,d;e.$root.find(f).prop(g,b);h=e.$root.find("form").serializeArray();e.$root.find(f).prop(g,a);for(c=0;c<e.ViewModel.Fields.length;c++){e.ViewModel.Fields[c].Values=[];if(e.ViewModel.Fields[c].Type!==1)for(d=0;d<e.ViewModel.Fields[c].Categories.length;d++)e.ViewModel.Fields[c].Categories[d].IsSelected=b;$.each(h,$.proxy(function(f,e){var b=this;if(b.ViewModel.Fields[c].FieldId===e.name){if(b.ViewModel.Fields[c].Type===1)e.value&&b.ViewModel.Fields[c].Values.push(e.value);else for(d=0;d<b.ViewModel.Fields[c].Categories.length;d++)if(b.ViewModel.Fields[c].Categories[d].Number===e.value){b.ViewModel.Fields[c].Categories[d].IsSelected=a;b.ViewModel.Fields[c].Values.push(b.ViewModel.Fields[c].Categories[d].Title);break}return}},e))}}};s_getFieldIdFromErrorIndex=function s_getFieldIdFromErrorIndex(){return"#OtherInformation_1"};f=function WP$PersonalInformation$Controllers$OtherInformationSettings(){};var h={checkRELFrequency:b,onEditClickedCallback:e,onSaveSuccessCallback:e,onCancelClickedCallback:e,onEditTemporaryAddressCallback:e,onLoadSuccessCallback:e,isEmbedded:b,disableRTL:b};c.prototype=i;c.WereRELFieldsShown=c.WereRELFieldsShown||b;f.prototype=h;$$WP.PersonalInformation=$$WP.PersonalInformation||{};$$WP.PersonalInformation.OtherInformationController=c;$$WP.PersonalInformation.OtherInformationSettings=f;c.extend($$WP.Controllers.EditableViewController,"WP$PersonalInformation$Controllers$OtherInformationController");f.extend($$WP.BaseObject,"WP$PersonalInformation$Controllers$OtherInformationSettings")})()
(function WP$PI$CIC$definition(){var E="#ContactInformation_TemporaryPhoneNumber",D="buttonList right",C=".formbuttons",B="#ContactInformation_WorkPhone",A="#ContactInformation_MobilePhone",z="#ContactInformation_HomePhone",y="input, select, textarea",x=".permanentInformation .address",n="form",d="undefined",f="data-validation-settings",e="disabled",j=".saveButton",w=".cancelButton",m="#ContactInformation_PreferredDevice",v="#ContactInformation_PermanentDefaultOverrideCheck",g="checked",u="#ContactInformation_TemporaryDefaultOverrideCheck",a=true,b=false,c=null,k=".cardlist.matchHeights",t="#ContactInformation_TemporaryEndDate_Calendar",s="#ContactInformation_TemporaryStartDate_Calendar",i="#ContactInformation_TemporaryEndDate",h="#ContactInformation_TemporaryStartDate",r=".preferredDeviceSelector",l=$$WP.Controllers.EditableViewController,q=new Date(1841,0,1),p=new Date(2114,9,15),o,s_isStartDateValid,s_isEndDateValid,s_userDateToISO,s_getYesterday,s_getFieldIdFromErrorIndex,F=function ContactInformationController(d,c){var b="click",a=this;a._settings=c||new o;a.WP$Controllers$EditableViewController(d,$$WP.Templates.PersonalInformation.ContactInformation);a.$root.addClass("contact-information-content card col-6");!$$WP.Utilities.UI.IsMobile&&a.$root.addClass("withButton");a.$root.parents(".cardlist").trigger("cardLoad");a.proxify("_onAddTemporaryAddressClicked","_onRemoveTemporaryAddressClicked","_onPreferredDeviceSelectorClicked","_onStartDateUpdate","_onEndDateUpdate","_onStartDateCalendarClick","_onEndDateCalendarClick","_afterTemporaryAddressRender","_onAddressLoadStart","_onAddressLoadEnd","_addressAfterRender","_onAddressListSelect");a.$root.on(b,".addTemporaryAddressLink",a._onAddTemporaryAddressClicked);a.$root.on(b,".removeTemporaryAddressLink",a._onRemoveTemporaryAddressClicked);a.$root.on(b,r,a._onPreferredDeviceSelectorClicked);a.$root.on(b,".defaultSelect",a._onAddressListSelect);a.$root.on("blur",h,a._onStartDateUpdate);a.$root.on("blur",i,a._onEndDateUpdate);a.$root.on(b,s,a._onStartDateCalendarClick);a.$root.on(b,t,a._onEndDateCalendarClick);a.$root.on("keyup",".addressDefaultListItem",function(a){a.keyCode===13&&a.target.click()});$afe.select("body").on("input change focusout",$.proxy(function(){this.$root.parents(k).each($$WP.Utilities.UI.Cards.MatchHeights)},a))},H={_addressData:c,_initialViewModel:c,_permanentAddressController:c,_temporaryAddressController:c,_pendingAddressLoads:0,_wasJumpedToEditMode:b,_settings:c,_permanentAddressIndex:-1,_temporaryAddressIndex:-1,_hasTemporaryAddressDefaults:b,_hasPermanentAddressDefaults:b,onEditClicked:function onEditClicked(c){var b=this;b._initialViewModel=$.extend(a,{},b.ViewModel);b.ViewModel.EditTemporaryAddress=!b.ViewModel.HideTemporaryAddress;b.WP$Controllers$EditableViewController$onEditClicked(c);$.isFunction(b._settings.onEditClickedCallback)&&b._settings.onEditClickedCallback()},onSaveClicked:function onSaveClicked(e){var d=this;if(d._hasTemporaryAddressDefaults===a)d._hasTemporaryAddressDefaults=b;else d._hasPermanentAddressDefaults=b;if(d._addressData!=c&&(d._hasPermanentAddressDefaults||d._hasTemporaryAddressDefaults)){d._moveToNextDefaultScreen();e.preventDefault();return}if(d.$root.find(u).prop(g)===a)d._temporaryAddressIndex=-2;if(d.$root.find(v).prop(g)===a)d._permanentAddressIndex=-2;d.WP$Controllers$EditableViewController$onSaveClicked(e)},onCancelClicked:function onCancelClicked(b){var a=this;a._resetDefaults();a.ViewModel=a._initialViewModel;a._permanentAddressController.setViewModel(a._initialViewModel.PermanentAddress);!a.ViewModel.IsNonPatientProxyRecord&&!a.ViewModel.IsTemporaryAddressDisabled&&a._temporaryAddressController.setViewModel(a._initialViewModel.TemporaryAddress);a.WP$Controllers$EditableViewController$onCancelClicked(b);$.isFunction(a._settings.onCancelClickedCallback)&&a._settings.onCancelClickedCallback()},_onAddTemporaryAddressClicked:function _onAddTemporaryAddressClicked(d){var c=this;if(c.ViewModel.DisplayEditable){c.ViewModel.EditTemporaryAddress=a;c.ViewModel.HideTemporaryAddress=b;c.ViewModel.RemoveTemporaryAddress=b;c._showOrHideTemporaryAddress();d.preventDefault()}else{c._initialViewModel=$.extend(a,{},c.ViewModel);c.ViewModel.EditTemporaryAddress=a;c.ViewModel.HideTemporaryAddress=b;c.ViewModel.RemoveTemporaryAddress=b;c.WP$Controllers$EditableViewController$onEditClicked(d)}$.isFunction(c._settings.onEditTemporaryAddressCallback)&&c._settings.onEditTemporaryAddressCallback()},_onRemoveTemporaryAddressClicked:function _onRemoveTemporaryAddressClicked(d){var c=this;c.ViewModel.EditTemporaryAddress=b;c.ViewModel.HideTemporaryAddress=a;c.ViewModel.RemoveTemporaryAddress=!c._initialViewModel.HideTemporaryAddress;c.ViewModel.TemporaryAddress.EndDateDisplay=formatDate(s_getYesterday());if(c.ViewModel.TemporaryAddress.StartDateDisplay&&parseDate(c.ViewModel.TemporaryAddress.StartDateDisplay,a)>s_getYesterday())c.ViewModel.TemporaryAddress.StartDateDisplay=formatDate(s_getYesterday());c._showOrHideTemporaryAddress();d.preventDefault()},_onPreferredDeviceSelectorClicked:function _onPreferredDeviceSelectorClicked(f){var d="selected",c="input",e=$afe.jq(f.currentTarget);!$afe.jq(f.target).is(c)&&f.preventDefault();if(e.hasClass(d)){e.removeClass(d).find(c).prop(g,b);$afe.select(m).val("")}else{this.$root.find(r).removeClass(d).find(c).prop(g,b);e.addClass(d);$afe.select(m).val(e.find(c).prop(g,a).val())}this._setPreferredDeviceToBeRequired()},_onLoadSuccess:function _onLoadSuccess(h){var g="function",c=this,d,e,f=b;c.ViewModel=h;if(c.ViewModel.IsNonPatientProxyRecord||c.ViewModel.IsTemporaryAddressDisabled||!c.ViewModel.TemporaryAddress.StartDateDisplay||c.ViewModel.TemporaryAddress.EndDateDisplay&&parseDate(c.ViewModel.TemporaryAddress.EndDateDisplay,a)<=s_getYesterday())c.ViewModel.HideTemporaryAddress=a;else{c._initialHideTemporaryAddress=b;c.ViewModel.EditTemporaryAddress=a;c.ViewModel.HideTemporaryAddress=b;c.ViewModel.RemoveTemporaryAddress=b;c._initialTemporaryAddressEndDate=c.ViewModel.TemporaryAddress?c.ViewModel.TemporaryAddress.EndDateDisplay:""}d={};for(e=0;e<c.ViewModel.RequiredFieldNames.length;e++)d[c.ViewModel.RequiredFieldNames[e]]=a;c.ViewModel.RequiredFieldNames=d;f=c.ViewModel.RequiredFieldNames.HomePhone&&!c.ViewModel.HomePhone||c.ViewModel.RequiredFieldNames.MobilePhone&&!c.ViewModel.MobilePhone||c.ViewModel.RequiredFieldNames.WorkPhone&&!c.ViewModel.WorkPhone||c.ViewModel.RequiredFieldNames.Email&&!c.ViewModel.Email;if(!c.ViewModel.PermanentAddress.IsViewOnly){d={};for(e=0;e<c.ViewModel.PermanentAddress.RequiredFieldNames.length;e++)d[c.ViewModel.PermanentAddress.RequiredFieldNames[e]]=a;f=f||d.HouseNumber&&!c.ViewModel.PermanentAddress.HouseNumber||d.Street&&!c.ViewModel.PermanentAddress.Street||d.City&&!c.ViewModel.PermanentAddress.City||d.County&&!c.ViewModel.PermanentAddress.County.Number||d.State&&!c.ViewModel.PermanentAddress.State.Number||d.Zip&&!c.ViewModel.PermanentAddress.Zip||d.Country&&!c.ViewModel.PermanentAddress.Country.Number||d.District&&!c.ViewModel.PermanentAddress.District.Number||d.Building&&!c.ViewModel.PermanentAddress.Building||d.Floor&&!c.ViewModel.PermanentAddress.Floor||d.Unit&&!c.ViewModel.PermanentAddress.Unit}if(!c.ViewModel.HideTemporaryAddress){d={};for(e=0;e<c.ViewModel.TemporaryAddress.RequiredFieldNames.length;e++)d[c.ViewModel.TemporaryAddress.RequiredFieldNames[e]]=a;f=f||d.HouseNumber&&!c.ViewModel.TemporaryAddress.HouseNumber||d.Street&&!c.ViewModel.TemporaryAddress.Street||d.City&&!c.ViewModel.TemporaryAddress.City||d.County&&!c.ViewModel.TemporaryAddress.County.Number||d.State&&!c.ViewModel.TemporaryAddress.State.Number||d.Zip&&!c.ViewModel.TemporaryAddress.Zip||d.Country&&!c.ViewModel.TemporaryAddress.Country.Number||d.District&&!c.ViewModel.TemporaryAddress.District.Number||d.Building&&!c.ViewModel.TemporaryAddress.Building||d.Floor&&!c.ViewModel.TemporaryAddress.Floor||d.Unit&&!c.ViewModel.TemporaryAddress.Unit}c.ViewModel.Validation={Required:$$WP.FormValidation.ValidationSettings.Required};c.ViewModel.Validation.Email=new $$WP.FormValidation.ValidationSettings({isEmail:a,required:c.ViewModel.RequiredFieldNames.Email===a});if(!c.ViewModel.IsNonPatientProxyRecord&&!c.ViewModel.IsTemporaryAddressDisabled){c.ViewModel.TemporaryAddress.Validation={};c.ViewModel.TemporaryAddress.Validation.StartDate=new $$WP.FormValidation.ValidationSettings({isDate:a,minDate:q,maxDate:c.ViewModel.TemporaryAddress.EndDateDisplay?parseDate(c.ViewModel.TemporaryAddress.EndDateDisplay,a):p,required:a});c.ViewModel.TemporaryAddress.Validation.EndDate=new $$WP.FormValidation.ValidationSettings({isDate:a,minDate:c.ViewModel.TemporaryAddress.StartDateDisplay?parseDate(c.ViewModel.TemporaryAddress.StartDateDisplay,a):q,maxDate:p,required:a});if($.inArray("Phone",c.ViewModel.TemporaryAddress.RequiredFieldNames)!==-1)c.ViewModel.TemporaryAddress.IsPhoneRequired=a}c._permanentAddressController=new $$WP.PersonalInformation.AddressController("PermanentAddress",c.ViewModel.PermanentAddress,c.ViewModel.AddressConfiguration,c.ViewModel.PermanentAddress.RequiredFieldNames,!c.ViewModel.IsNonPatientProxyRecord,c._settings.disableRTL);c._permanentAddressController.onDataLoadStart=c._onAddressLoadStart;c._permanentAddressController.onDataLoadEnd=c._onAddressLoadEnd;c._permanentAddressController.afterRender=c._addressAfterRender;if(!c.ViewModel.IsNonPatientProxyRecord&&!c.ViewModel.IsTemporaryAddressDisabled){c._temporaryAddressController=new $$WP.PersonalInformation.AddressController("TemporaryAddress",c.ViewModel.TemporaryAddress,c.ViewModel.AddressConfiguration,c.ViewModel.TemporaryAddress.RequiredFieldNames,a,c._settings.disableRTL);c._temporaryAddressController.onDataLoadStart=c._onAddressLoadStart;c._temporaryAddressController.onDataLoadEnd=c._onAddressLoadEnd;c._temporaryAddressController.afterRender=c._addressAfterRender}c.focusAfterRender=c._focusOnLoad;c.render(f);c.focusAfterRender=a;typeof c._settings.onLoadSuccessCallback===g&&c._settings.onLoadSuccessCallback();if(f){c._initialViewModel=$.extend(a,{},c.ViewModel);c.ViewModel.EditTemporaryAddress=!c.ViewModel.HideTemporaryAddress;c.$root.find(w).remove();c._wasJumpedToEditMode=a;!c._settings.isEmbedded&&WP.Events.beforeUnload();typeof c._settings.onEditClickedCallback===g&&c._settings.onEditClickedCallback()}},_onSaveSuccess:function _onSaveSuccess(e){var d=this,f,g;d._resetDefaults();if(!d.ViewModel.EditTemporaryAddress)delete e.ViewModel.TemporaryAddress;if(d.ViewModel.PermanentAddress.IsViewOnly)delete e.ViewModel.PermanentAddress;delete e.ViewModel.RequiredFieldNames;delete e.ViewModel.IsNonPatientProxyRecord;delete e.ViewModel.IsTemporaryAddressDisabled;if(d.ViewModel.TemporaryAddress)delete d.ViewModel.TemporaryAddress.FormattedValues;if(d.ViewModel.PermanentAddress)delete d.ViewModel.PermanentAddress.FormattedValues;d.ViewModel=$.extend(a,{},d.ViewModel,e.ViewModel);if(e.Success){if(d.ViewModel.EditTemporaryAddress||d.ViewModel.RemoveTemporaryAddress){d.ViewModel.HideTemporaryAddress=d.ViewModel.TemporaryAddress.EndDateDisplay&&parseDate(d.ViewModel.TemporaryAddress.EndDateDisplay,a)<=s_getYesterday();d.ViewModel.EditTemporaryAddress=b;d.ViewModel.RemoveTemporaryAddress=b}d._showNoMatches(b,b,b);d.render(b);d._wasJumpedToEditMode=b;d._permanentAddressController.setViewModel(d.ViewModel.PermanentAddress);!d.ViewModel.IsNonPatientProxyRecord&&!d.ViewModel.IsTemporaryAddressDisabled&&d._temporaryAddressController.setViewModel(d.ViewModel.TemporaryAddress);$.isFunction(d._settings.onSaveSuccessCallback)&&d._settings.onSaveSuccessCallback()}else{if(e.ViewModel.TemporaryAddress===c&&e.ViewModel.PermanentAddress===c||!e.ViewModel.AllowDefaults)d.render(a);else if(e.ViewModel.TemporaryAddress&&!e.ViewModel.TemporaryAddress.Success&&e.ViewModel.TemporaryDefaults.length===0||e.ViewModel.PermanentAddress&&!e.ViewModel.PermanentAddress.Success&&e.ViewModel.PermanentDefaults.length===0){d.render(a);d._showNoMatches(e.ViewModel.TemporaryAddress&&!e.ViewModel.TemporaryAddress.Success&&e.ViewModel.TemporaryDefaults.length===0,e.ViewModel.PermanentAddress&&!e.ViewModel.PermanentAddress.Success&&e.ViewModel.PermanentDefaults.length===0,e.ViewModel.AllowArbitraryInput)}else{d._addressData=e;if(e.ViewModel.TemporaryAddress&&!e.ViewModel.TemporaryAddress.Success&&e.ViewModel.TemporaryDefaults.length>0)d._hasTemporaryAddressDefaults=a;if(e.ViewModel.PermanentAddress&&!e.ViewModel.PermanentAddress.Success&&e.ViewModel.PermanentDefaults.length>0)d._hasPermanentAddressDefaults=a;d._moveToNextDefaultScreen()}d._wasJumpedToEditMode&&d.$root.find(w).remove();if(e.ViewModel.ValidationErrors)for(f=0;f<e.ViewModel.ValidationErrors.length;f++){g=$afe.select(s_getFieldIdFromErrorIndex(e.ViewModel.ValidationErrors[f].ErrorIndex));$$WP.FormValidation.addValidationError(g,e.ViewModel.ValidationErrors[f].ErrorKey)}d.$root.parents(k).each($$WP.Utilities.UI.Cards.MatchHeights)}$$WP.Utilities.UI.MatchColumnHeights()},_onAddressListSelect:function _onAddressListSelect(f){var h="#default",c=this,g,d;g=$afe.jq(f.target);d=parseInt(g.safeAttr("data-id"));if(c._hasTemporaryAddressDefaults)if(d===c._temporaryAddressIndex){$$WP.Utilities.UI.ToggleButtonClick(g,f,0);c._temporaryAddressIndex=-1;d=-1}else{c._temporaryAddressIndex!==-1&&$$WP.Utilities.UI.ToggleButtonClick($(c.$root.find(h+c._temporaryAddressIndex)),f,0);$$WP.Utilities.UI.ToggleButtonClick(g,f,0);c._temporaryAddressIndex=d}else if(c._hasPermanentAddressDefaults)if(d===c._permanentAddressIndex){$$WP.Utilities.UI.ToggleButtonClick(g,f,0);c._permanentAddressIndex=-1;d=-1}else{c._permanentAddressIndex!==-1&&$$WP.Utilities.UI.ToggleButtonClick($(c.$root.find(h+c._permanentAddressIndex)),f,0);$$WP.Utilities.UI.ToggleButtonClick(g,f,0);c._permanentAddressIndex=d}if(d!==-1)c.$root.find(j).prop(e,b);else c.$root.find(j).prop(e,a)},_onStartDateUpdate:function _onStartDateUpdate(c){var b=this.ViewModel.TemporaryAddress.Validation.EndDate;b.minDate=c.currentTarget.value?parseDate(c.currentTarget.value,a):q;$afe.select(i).safeAttr(f,b.toJSON());$afe.select("#ContactInformation_TemporaryEndDate.invalid").change()},_onStartDatePicked:function _onStartDatePicked(c,b,a){typeof c!==d&&typeof b!==d&&typeof a!==d&&$afe.select(h).val(formatDate(new Date(c,b,a))).change().focus()},_onEndDatePicked:function _onEndDatePicked(c,b,a){typeof c!==d&&typeof b!==d&&typeof a!==d&&$afe.select(i).val(formatDate(new Date(c,b,a))).change().focus()},_onEndDateUpdate:function _onEndDateUpdate(c){var b=this.ViewModel.TemporaryAddress.Validation.StartDate;b.maxDate=c.currentTarget.value?parseDate(c.currentTarget.value,a):p;$afe.select(h).safeAttr(f,b.toJSON());$afe.select("#ContactInformation_TemporaryStartDate.invalid").change()},_onStartDateCalendarClick:function _onStartDateCalendarClick(){var c=$afe.select(s),b=$afe.select(h);new DateChooser(c[0],this._onStartDatePicked,s_isStartDateValid,parseDate(b.val(),a),b).drawCalendar()},_onEndDateCalendarClick:function _onEndDateCalendarClick(){var c=$afe.select(t),b=$afe.select(i);new DateChooser(c[0],this._onEndDatePicked,s_isEndDateValid,parseDate(b.val(),a),b).drawCalendar()},_onAddressLoadStart:function _onAddressLoadStart(){this._pendingAddressLoads++;this.$root.find(j).prop(e,a)},_onAddressLoadEnd:function _onAddressLoadEnd(){this._pendingAddressLoads--},_addressAfterRender:function _addressAfterRender(){var b=this;$$WP.FormValidation.initializeDOMSubtree(b.$root.find(n));b._pendingAddressLoads>1&&b.$root.find(j).prop(e,a);b.ViewModel.PermanentAddress.IsViewOnly&&b.$root.find(x).find(y).prop(e,a);b.$root.parent(k).each($$WP.Utilities.UI.Cards.MatchHeights)},_setPreferredDeviceToBeRequired:function _setPreferredDeviceToBeRequired(){var n="label[for='ContactInformation_WorkPhone']",m="label[for='ContactInformation_MobilePhone']",d="aria-required",c="required",l="label[for='ContactInformation_HomePhone']",e=".preferredDeviceSelector.selected",j,i,k,g,h;g=$$WP.FormValidation.ValidationSettings.Required.toJSON();h=$$WP.FormValidation.ValidationSettings.None.toJSON();if(!this.ViewModel.RequiredFieldNames.HomePhone){j=$afe.select(z);if(j.siblings(e).length){$afe.select(l).addClass(c);j.safeAttr(f,g).safeAttr(d,a).change()}else{$afe.select(l).removeClass(c);j.safeAttr(f,h).safeAttr(d,b).change()}}if(!this.ViewModel.RequiredFieldNames.MobilePhone){i=$afe.select(A);if(i.siblings(e).length){$afe.select(m).addClass(c);i.safeAttr(f,g).safeAttr(d,a).change()}else{$afe.select(m).removeClass(c);i.safeAttr(f,h).safeAttr(d,b).change()}}if(!this.ViewModel.RequiredFieldNames.WorkPhone){k=$afe.select(B);if(k.siblings(e).length){$afe.select(n).addClass(c);k.safeAttr(f,g).safeAttr(d,a).change()}else{$afe.select(n).removeClass(c);k.safeAttr(f,h).safeAttr(d,b).change()}}},_showNoMatches:function _showNoMatches(o,m,l){var k=".permanentInformation p.buttoncheck",j=".permanentInformation .noMatchesMessage",i=".permanentInformation",h="unchecked",g="hidden checked",f=".temporaryInformation p.buttoncheck",b="hidden",e=".temporaryInformation .noMatchesMessage",c="noMatchesContainer",d=".temporaryInformation",a=this;if(o){a.$root.find(d).addClass(c);a.$root.find(e).removeClass(b);l&&a.$root.find(f).removeClass(g).addClass(h)}else{a.$root.find(d).removeClass(c);a.$root.find(e).addClass(b);a.$root.find(f).addClass(b)}if(m){a.$root.find(i).addClass(c);a.$root.find(j).removeClass(b);l&&a.$root.find(k).removeClass(g).addClass(h)}else{a.$root.find(i).removeClass(c);a.$root.find(j).addClass(b);a.$root.find(k).addClass(b)}(o||m)&&setupButtoncheck(a.$root.find(n))},_moveToNextDefaultScreen:function _moveToNextDefaultScreen(){var b="PersonalInformation.ContactInformation",a=this,d;if(!(a._hasPermanentAddressDefaults||a._hasTemporaryAddressDefaults)||a._addressData===c)return;a.$root.empty();if(a._hasTemporaryAddressDefaults)d={DefaultList:a._addressData.ViewModel.TemporaryDefaults,EnteredAddress:a._addressData.ViewModel.TemporaryAddress,Title:$$WP.Strings.get("TemporaryAddressLabel",b),AllowArbitraryInput:a._addressData.ViewModel.AllowArbitraryInput};else d={DefaultList:a._addressData.ViewModel.PermanentDefaults,EnteredAddress:a._addressData.ViewModel.PermanentAddress,Title:$$WP.Strings.get("PermanentAddressLabel",b),AllowArbitraryInput:a._addressData.ViewModel.AllowArbitraryInput};a.$root.safeAppend($afe.renderTemplate($$WP.Templates.PersonalInformation.AddressDefaultsCard,d));$$WP.Utilities.UI.IsMobile&&a.$root.find(C).removeClass(D);a.$root.find(".addressList .togglebutton").first().focus()},_resetDefaults:function __resetDefaults(){var a=this;a._addressData=c;a._hasTemporaryAddressDefaults=b;a._hasPermanentAddressDefaults=b;a._temporaryAddressIndex=-1;a._permanentAddressIndex=-1;a.$root.find(u).prop(g,b);a.$root.find(v).prop(g,b)},_afterTemporaryAddressRender:function _afterTemporaryAddressRender(){var b=this;$$WP.FormValidation.checkIfFormIsValid(b.$root.find(n),a);b._pendingAddressLoads>0&&b.$root.find(j).prop(e,a);b.$root.parent(k).each($$WP.Utilities.UI.Cards.MatchHeights);b.WP$Controllers$EditableViewController$afterRender()},_showOrHideTemporaryAddress:function _showOrHideTemporaryAddress(){var c=".temporaryAddressContent",b=".addTemporaryAddressLinkContainer",a=".permanentHeader";if(this.ViewModel.EditTemporaryAddress){$afe.select(a).show();$afe.select(b).hide();$afe.select(c).slideDown(500,this._afterTemporaryAddressRender)}else{$afe.select(a).hide();$afe.select(b).show();$afe.select(c).slideUp(500,this._afterTemporaryAddressRender)}},loadData:function loadData(){var a=this,b={useLoginUserEpt:a._settings.useLoginUserEpt,disableRTL:a._settings.disableRTL};$.ajax({type:"POST",url:makeLink("PersonalInformation/GetContactInformation"),data:$$WPUtil.postify(b),dataType:"json",success:$.proxy(a._onLoadSuccess,a)})},saveData:function saveData(){var b=this,f,d,e;b.$root.find(".loadingIndicator").show();b.updateViewModel();d=c;if(b.ViewModel.EditTemporaryAddress||b.ViewModel.RemoveTemporaryAddress){if(b.ViewModel.EditTemporaryAddress&&b.ViewModel.AddressConfiguration.AddressHxEnabled&&!b.ViewModel.TemporaryAddress.StartDateDisplay)b.ViewModel.TemporaryAddress.StartDateDisplay=formatDate(new Date);b.ViewModel.TemporaryAddress.StartDateISO=s_userDateToISO(b.ViewModel.TemporaryAddress.StartDateDisplay);b.ViewModel.TemporaryAddress.EndDateISO=s_userDateToISO(b.ViewModel.TemporaryAddress.EndDateDisplay);if(b._temporaryAddressIndex===-1||b._addressData===c)d=$.extend(a,{},b.ViewModel.TemporaryAddress);else if(b._temporaryAddressIndex===-2){d=b._addressData.ViewModel.TemporaryAddress;d.StartDateISO=b.ViewModel.TemporaryAddress.StartDateISO;d.EndDateISO=b.ViewModel.TemporaryAddress.EndDateISO}else{d=b._addressData.ViewModel.TemporaryDefaults[b._temporaryAddressIndex];d.StartDateISO=b.ViewModel.TemporaryAddress.StartDateISO;d.EndDateISO=b.ViewModel.TemporaryAddress.EndDateISO}delete d.Validation}if(b._permanentAddressIndex===-1||b._addressData===c)e=b.ViewModel.PermanentAddress;else if(b._permanentAddressIndex===-2)e=b._addressData.ViewModel.PermanentAddress;else e=b._addressData.ViewModel.PermanentDefaults[b._permanentAddressIndex];f={PermanentAddress:e,TemporaryAddress:d,Email:b.ViewModel.Email,MobilePhone:b.ViewModel.MobilePhone,HomePhone:b.ViewModel.HomePhone,WorkPhone:b.ViewModel.WorkPhone,PreferredDevice:b.ViewModel.PreferredDevice};$.ajax({type:"POST",url:makeLink("PersonalInformation/UpdateContactInformation"),data:{viewModelJson:JSON.stringify(f),useLoginUserEpt:b._settings.useLoginUserEpt,needTempDefault:b._temporaryAddressIndex!==-2,needPermDefault:b._permanentAddressIndex!==-2,disableRTL:b._settings.disableRTL},dataType:"json",success:$.proxy(b._onSaveSuccess,b)});b.WP$Controllers$EditableViewController$afterRender()},updateViewModel:function updateViewModel(){var b=this,c,d,j,g,n,p,k,f,o,q,e;if(b.$root.find(".addressDefaults").length>0)return;if(b.ViewModel.EditTemporaryAddress){g=$afe.select(E,b.$root);n=$afe.select(h,b.$root);p=$afe.select(i,b.$root);b.ViewModel=b.ViewModel||{};b.ViewModel.TemporaryAddress=b.ViewModel.TemporaryAddress||{};c=b.ViewModel.TemporaryAddress.RequiredFieldNames;j=b.ViewModel.TemporaryAddress.Validation;d=b.ViewModel.TemporaryAddress.FormattedValues;b.ViewModel.TemporaryAddress=b._temporaryAddressController.getViewModel();b.ViewModel.TemporaryAddress.PhoneNumber=l.getValIfExists(g);b.ViewModel.TemporaryAddress.StartDateDisplay=l.getValIfExists(n);b.ViewModel.TemporaryAddress.EndDateDisplay=l.getValIfExists(p);b.ViewModel.TemporaryAddress.RequiredFieldNames=c;b.ViewModel.TemporaryAddress.Validation=j;b.ViewModel.TemporaryAddress.FormattedValues=d;if($.inArray("Phone",c)!==-1)b.ViewModel.TemporaryAddress.IsPhoneRequired=a}b.ViewModel=b.ViewModel||{};b.ViewModel.PermanentAddress=b.ViewModel.PermanentAddress||{};if(!b.ViewModel.PermanentAddress.IsViewOnly){c=b.ViewModel.PermanentAddress.RequiredFieldNames;d=b.ViewModel.PermanentAddress.FormattedValues;b.ViewModel.PermanentAddress=b._permanentAddressController.getViewModel();b.ViewModel.PermanentAddress.RequiredFieldNames=c;b.ViewModel.PermanentAddress.FormattedValues=d}k=$afe.select(z,b.$root);f=$afe.select(A,b.$root);o=$afe.select(B,b.$root);q=$afe.select("#ContactInformation_Email",b.$root);e=$afe.select(m,b.$root);b.ViewModel=b.ViewModel||{};b.ViewModel.HomePhone=l.getValIfExists(k);b.ViewModel.MobilePhone=l.getValIfExists(f);b.ViewModel.WorkPhone=l.getValIfExists(o);b.ViewModel.Email=l.getValIfExists(q);b.ViewModel.PreferredDevice=l.getValIfExists(e)},afterRender:function afterRender(){var b=this;if(b.ViewModel.DisplayEditable){b._permanentAddressController.renderTo(b.$root.find(".permanentAddress"));!b.ViewModel.IsNonPatientProxyRecord&&!b.ViewModel.IsTemporaryAddressDisabled&&b._temporaryAddressController.renderTo(b.$root.find(".temporaryAddress"));!b._settings.isEmbedded&&WP.Events.beforeUnload()}else!b._settings.isEmbedded&&WP.Events.cancelBeforeUnload();b.ViewModel.PermanentAddress.IsViewOnly&&$afe.select(x).find(y).prop(e,a);b._showOrHideTemporaryAddress();b._setPreferredDeviceToBeRequired();$$WP.FormValidation.initializeDOMSubtree(b.$root);b._pendingAddressLoads>0&&b.$root.find(j).prop(e,a);b.$root.find(".hideLongContentWithEllipses").each(function(){if(this.getClientRects().length>1){var a=$afe.jq(this);a.addClass("overflowHiddenWithEllipses").safeAttr("title",a.text())}});b.$root.parent(k).each($$WP.Utilities.UI.Cards.MatchHeights);$$WP.Utilities.UI.IsMobile&&b.$root.find(C).removeClass(D);b.WP$Controllers$EditableViewController$afterRender()}};s_isStartDateValid=function s_isStartDateValid(g,f,e){var b,c;if(typeof g!==d&&typeof f!==d&&typeof e!==d){b=$afe.select(i).val();c=new Date(g,f,e);return q<=c&&c<=(b?parseDate(b,a):p)}return a};s_isEndDateValid=function s_isEndDateValid(g,f,e){var b,c;if(typeof g!==d&&typeof f!==d&&typeof e!==d){b=$afe.select(h).val();c=new Date(g,f,e);return(b?parseDate(b,a):q)<=c&&c<=p}return a};s_userDateToISO=function s_userDateToISO(a){return a?$$WP.I18N.parseDate(a).toISOString().split("T")[0]:""};s_getYesterday=function s_getYesterday(){var a=new Date;a.setDate(a.getDate()-1);return a};s_getFieldIdFromErrorIndex=function s_getFieldIdFromErrorIndex(a){switch(a){case"PermanentAddress.Zip":return"#PermanentAddress_Zip";case"TemporaryAddress.Zip":return"#TemporaryAddress_Zip";case"TemporaryPhone":return E;case"HomePhone":case"MobilePhone":case"WorkPhone":return"#ContactInformation_"+a}return""};o=function WP$PersonalInformation$Controllers$ContactInformationSettings(){};var G={onEditClickedCallback:c,onSaveSuccessCallback:c,onCancelClickedCallback:c,onEditTemporaryAddressCallback:c,onLoadSuccessCallback:c,useLoginUserEpt:b,focusOnLoad:a,isEmbedded:b,disableRTL:b};F.prototype=H;o.prototype=G;$$WP.PersonalInformation=$$WP.PersonalInformation||{};$$WP.PersonalInformation.ContactInformationController=F;$$WP.PersonalInformation.ContactInformationSettings=o;F.extend(l,"WP$PersonalInformation$Controllers$ContactInformationController");o.extend($$WP.BaseObject,"WP$PersonalInformation$Controllers$ContactInformationSettings")})()
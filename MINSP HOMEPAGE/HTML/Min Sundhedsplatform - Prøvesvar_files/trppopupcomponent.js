/*! Copyright (c) Epic Systems Corporation 2018 */
$$WPUtil.guaranteeExistence($$WP,"Clinical.TestResultsPOC.Components");$$WP.Clinical.TestResultsPOC.Components.TRPPopupComponent=function $$WP$Clinical$Components$TRPPopupComponent(b){var a=this;a.Components$CommunityListManagerComponent(b);a.RegistryID=b.RegistryID||"";a.RegistryName=b.RegistryName||"";a._showSelectedComponentGraph=b.showSelectedComponentGraph;a._showSelectedTestResult=b.showSelectedTestResult;a._dataTransform=b.dataTransform;a.setBaseUrl(b.baseUrl);if(b.FilterInpatient!==undefined)a.FilterInpatient=b.FilterInpatient;a.IsRegistryFilterActive=a.RegistryID!=="";a.stickyHeadersDelegate=$.proxy(a._stickyHeaders,a);a.Class=b.Class;a.addEventListener("click",a._resultsPopupComponentClick);a.addEventListener("keyup",a._resultsPopupComponentKeyup)};$$WP.Clinical.TestResultsPOC.Components.TRPPopupComponent.prototype={_showSelectedComponentGraph:null,_showSelectedTestResult:null,_dataTransform:null,_baseUrl:"",template:$$WP.Templates.Clinical.TRPListAbbrev,IsRegistryFilterActive:false,RegistryID:"",RegistryName:"",FilterInpatient:"1",SearchString:"",OpenedWith:"",OldestRenderedDate:null,NeverAutoFocus:true,PageOffset:0,PositionEnum:{ABOVE:1,BELOW:2,VISIBLE:3},stickyHeadersDelegate:null,dispose:function $$WP$Clinical$Components$TRPPopupComponent$dispose(a){$afe.select("head style.initReportStyles").remove();$afe.select("head link#EpicBase").remove();this.Components$CommunityListManagerComponent$dispose(a)},setData:function $$WP$Clinical$Components$TRPPopupComponent$setData(b){var a=this;if(b.ViewBagProperties){a.PageOffset=b.ViewBagProperties.PageOffset;a.Url=a.generateUrl()}if(a.IsRegistryFilterActive){b.RootInfo={IsRegistryFilterActive:true};a.Data=b;a.Components$TemplateComponent$refresh();return}else if(b.List){var c=b.List;for(var d in c)if(c.hasOwnProperty(d)){var e=c[d].List;b.IsRegistryFilterActive=a.IsRegistryFilterActive;a.Data=a._dataTransform(e);c[d].List=a.Data.TestResultTimeline;a.Components$CommunityListManagerComponent$setData(b);a._updateHeaderFooter();a.ContainerComponent.DisclaimerComponent&&a.ContainerComponent.DisclaimerComponent.resizeBox();break}}},postProcessing:function $$WP$Clinical$Components$TRPPopupComponent$postProcessing(a){a.on("scroll","",this.stickyHeadersDelegate);$afe.jq(window).resize(this.stickyHeadersDelegate)},unbindHandlers:function $$WP$Clinical$Components$TRPPopupComponent$unbindHandlers(){$afe.jq(window).unbind("resize",this.stickyHeadersDelegate)},setFilterInpatient:function $$WP$Clinical$Components$TRPPopupComponent$setFilterInpatient(a){this.FilterInpatient=a;this.PageOffset=0},updateSearchString:function updateSearchString(b){var a=this;a.PageOffset=0;a.resetUrl(a.generateUrl());a.setSearch(b)},_stickyHeaders:function $$WP$Clinical$Components$TRPPopupComponent$_stickyHeaders(){var e=".abbrev_header",d=".TRPTop > .content";for(var b=$afe.select(".StickyHeaderBlock"),g=$afe.select(d).scrollTop(),k=$afe.select(d).outerHeight(),l=$afe.select(".TestResultsHeader").outerHeight(true),m=$afe.select(e).first().outerHeight(),a=0;a<b.length;a++){var f=b[a].offsetTop,h=b.eq(a),j=h.outerHeight(true);if(this._relativeSectionPosition(g,k,f,j,m-1)===this.PositionEnum.VISIBLE){var i=h.children(e),c=Math.max(0,g-f-l)-1,n=j-i.outerHeight(true)+1;c=Math.min(c,n);i.css("top",c+"px")}}},_relativeSectionPosition:function $$WP$Clinical$Components$TRPPopupComponent$_relativeSectionPosition(a,d,c,e,b){return c>a+d-b?this.PositionEnum.BELOW:c+e<a-b?this.PositionEnum.ABOVE:this.PositionEnum.VISIBLE},setBaseUrl:function $$WP$Clinical$Components$TRPPopupComponent$setBaseUrl(a){this._baseUrl=a;this.Url=this.generateUrl()},generateUrl:function $$WP$Clinical$Components$TRPPopupComponent$generateUrl(){var a=this;return a.IsRegistryFilterActive?a._baseUrl:a._baseUrl+"&enableAutoRender=false&filterInpatient="+a.FilterInpatient+"&pageOffset="+a.PageOffset},_updateHeaderFooter:function $$WP$Clinical$Components$TRPPopupComponent$_updateHeaderFooter(){var a=this;a.Components$CommunityListManagerComponent$_updateHeaderFooter({FilterInpatient:a.ContainerComponent.ListComponent.FilterInpatient,HasSearch:!$$WPUtil.IsNullOrEmpty(a.SearchString),IsRegistryFilterActive:a.IsRegistryFilterActive})},_resultsPopupComponentClick:function $$WP$Clinical$Components$TRPPopupComponent$_resultsPopupComponentClick(c){var f="data-index",e=".TRPContent > .content",d="selected",b=this,a,g;switch(c.dataId){case"loadmore":b.Url=b.generateUrl();b.ContainerComponent.ListComponent.addNextPage();break;case"testresult":a=c.$target.closest(".TRPComponentHeader");if(a&&a.length===1){if(a.hasClass(d)){$afe.select(e).focus();return}var h=a.safeAttr(f);b._showSelectedTestResult(h)}break;case"selectda":a=c.$target.closest(".TRPComponentAbbrev");if(a&&a.length===1){if(a.hasClass(d)){$afe.select(e).focus();return}g=a.safeAttr(f);b._showSelectedComponentGraph(g)}}return false},_resultsPopupComponentKeyup:function $$WP$Clinical$Components$TRPPopupComponent$_resultsPopupComponentKeyup(a){if(a.keyCode===13&&(a.dataId==="testresult"||a.dataId==="selectda")){this._resultsPopupComponentClick(a);return false}return true}};$$WP.Clinical.TestResultsPOC.Components.TRPPopupComponent.extend("Components.CommunityListManagerComponent")
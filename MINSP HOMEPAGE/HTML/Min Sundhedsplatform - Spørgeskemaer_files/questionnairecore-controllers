var __extends,Epic;(function(n){var t;(function(n){var t;(function(n){var t;(function(t){var i=function(){function t(t,f,e,o,s){var h=this;h.questionsController=i;h.conditionalQueue=[];h.ready=r;h.jumpedBack=u;h.isSavingOnBack=u;h.isHistoryModified=u;h.isContextDisplayTextGenerated=u;h.canAutoAdvance=u;h.lqfId=t;h.eptDAT=s;h.domElements=f;h.uiCallbacks=o;h.allowedActions=new n.AllowedActions;e&&(e.validate()?(h.workflowInformation=e,h.workflowInformation.displaySettings||(h.workflowInformation.displaySettings=new n.DisplaySettings),h.workflowInformation.workflowSettings||(h.workflowInformation.workflowSettings=new n.WorkflowSettings),h.workflowInformation.workflowCallbacks||(h.workflowInformation.workflowCallbacks=new n.WorkflowCallbacks),n.Utility.IsPrintPreview=h.workflowInformation.displaySettings.isPrintPreview):h.performCallbackToHandler(n.QuestionnaireAction.Error,i,n.QuestionnaireError.InvalidContextInformation));h.addEventHandlers()}var f="",h=".back",e="POST",c="cancelworkflow",s="previousstep",l="popstate",o="click",u=!1,r=!0,i=null;return t.prototype.isReady=function(){var n=this;return n.questionsController&&n.questionsController.callPendingConditionalCallbacks&&n.questionsController.callPendingConditionalCallbacks(),n.ready},t.prototype.saveOnBrowserBack=function(){var t=this,f;t.isSavingOnBack=r;f=i;t.isHistoryModified=u;t.questionsController?(f=t.questionsController.getCoreModelsWithAnswers(),t.save(t.hqaId,f)):t.performCallbackToHandler(n.QuestionnaireAction.BackQuestionnaire,t.hqaId)},t.prototype.destroy=function(){var n=this;n.domElements.$backButton.off(o);n.domElements.$cancelButton.off(o);n.domElements.$saveButton.off(o);n.domElements.$continueButton.off(o);n.afterViewLoad();n.setInteractiveElements(r);n.domElements.$questionnaireHost.empty();n.domElements.$postText.empty();$$WPUtil.IsNullOrEmpty(n.domElements.$customQuestionnaireText)||n.domElements.$customQuestionnaireText.empty();WP&&WP.Events&&WP.Events.cancelBeforeUnload();n.workflowInformation.displaySettings.modifyHistory&&($afe.jq(window).off(l,$.proxy(n.saveOnBrowserBack,n)),n.isHistoryModified&&(history.back(),n.isHistoryModified=u));n.isDestroyed=r},t.prototype.destroyQuestionsController=function(){this.questionsController&&this.questionsController.destroy()},t.prototype.addEventHandlers=function(){var n=this;if(n.addButtonClickEventHandlers(),n.workflowInformation.displaySettings.modifyHistory)$afe.jq(window).on(l,$.proxy(n.saveOnBrowserBack,n))},t.prototype.addButtonClickEventHandlers=function(){var t=this,i=t;t.domElements.$continueButton.off(o).click(function(){i.clickContinueButton()});n.Utility.hideButton(t.domElements.$continueButton);t.domElements.$backButton.off(o).click(function(){i.clickBackButton()});n.Utility.hideButton(t.domElements.$backButton.addClass(s));t.domElements.$saveButton.off(o).click(function(){i.clickSaveButton()});n.Utility.hideButton(t.domElements.$saveButton);t.domElements.$cancelButton.off(o).click($.proxy(function(n){this.clickCancelButton(n)},t));n.Utility.hideButton(t.domElements.$cancelButton.addClass(c))},t.prototype.clickContinueButton=function(){var t=this,r;(t.allowedActions.Advance||t.allowedActions.Submit)&&(n.Utility.isDisplayingSummary()?(t.showLoading(),n.Utility.isCatType()?t.performCallbackToHandler(n.QuestionnaireAction.SubmitQuestionnaire):t.submit(t.hqaId)):n.Utility.isDisplayingInterruption()?t.advance(t.hqaId,i):(r=t.questionsController.getCoreModelsWithAnswers(),t.advance(t.hqaId,r,t.eptDAT)))},t.prototype.clickBackButton=function(){var t=this,i;t.allowedActions.Back||t.allowedActions.BackOverride?n.Utility.isDisplayingSummary()||n.Utility.isDisplayingInterruption()?t.back(t.hqaId):n.Utility.isDisplayingSavedPage()?(t.addButtonClickEventHandlers(),t.start()):t.allowedActions.Back?(i=t.questionsController.getCoreModelsWithAnswers(),t.back(t.hqaId,i)):(t.isSavingOnBack=r,i=t.questionsController.getCoreModelsWithAnswers(),t.save(t.hqaId,i)):$$WP.Utilities.UI.IsMobile&&n.UtilityMobile.handleBackClick()},t.prototype.clickSaveButton=function(){var t=this,i;t.allowedActions.Save&&(n.Utility.isDisplayingSummary()||n.Utility.isDisplayingInterruption()?t.save(t.hqaId):(i=t.questionsController.getCoreModelsWithAnswers(),t.save(t.hqaId,i)))},t.prototype.clickCancelButton=function(r){var o="inlinedelete",f="continue",u=this,e=u,h=u.getOverridableStringNamespace();u.allowedActions.Cancel&&(u.callingApp===n.CallingApplication.Hyperspace||n.Utility.isDisplayingInterruption()&&n.Utility.shouldStopQuestionnaire()?u.cancel():(u.setUpPageForCancelPopup(),$$WPUtil.confirmFormSubmission(r.target,$$WP.Strings.get(n.QuestionnaireStringKeys.CancelPopupPrompt,t.questionnaireMyChartNamespace),i,function(n,t){t===$$WP.Components.TOOLBARIDENTIFIER+f?e.cancel():t===$$WP.Components.TOOLBARIDENTIFIER+"save"?e.clickSaveButton():e.setUpPageAfterCancelPopup()},u.allowedActions.Save?[new $$WPComp.ComplexObjects.Button($$WP.Strings.get(n.QuestionnaireStringKeys.CancelPopupContinue,t.questionnaireMyChartNamespace),i,o,f),new $$WPComp.ComplexObjects.Button($$WP.Strings.get(n.QuestionnaireStringKeys.CancelPopupSave,t.questionnaireMyChartNamespace),i,"finishlater","save"),new $$WPComp.ComplexObjects.Button($$WP.Strings.get(n.QuestionnaireStringKeys.CancelPopupGoBack,t.questionnaireMyChartNamespace),i,s,"cancel")]:[new $$WPComp.ComplexObjects.Button($$WP.Strings.get(n.QuestionnaireStringKeys.CancelPopupContinue,t.questionnaireMyChartNamespace),i,o,f),new $$WPComp.ComplexObjects.Button($$WP.Strings.get(n.QuestionnaireStringKeys.CancelPopupGoBack,t.questionnaireMyChartNamespace),i,s,"cancel")])))},t.prototype.setUpPageForCancelPopup=function(){this.setInteractiveElements(u);this.domElements.$backButton.removeClass(s)},t.prototype.setUpPageAfterCancelPopup=function(){this.setInteractiveElements(r);this.domElements.$backButton.addClass(s);$$WP.FormValidation.checkIfFormIsValid(this.domElements.$form,r)},t.prototype.performCallbackToHandler=function(t,i,r){var u=this;u.workflowInformation&&u.workflowInformation.handler?(u.destroy(),u.workflowInformation.handler.questionnaireCallback(t,i,r,u)):n.Utility.showError()},t.prototype.handleError=function(){this.workflowInformation?this.performCallbackToHandler(n.QuestionnaireAction.Error,i,n.QuestionnaireError.WebServerError):n.Utility.showError()},t.prototype.getBackUrl=function(t){var i=this;i.performActionOnServer(n.QuestionnaireAction.GetBackUrl,e,$$WPUtil.postify({status:t,sourceActivity:i.workflowInformation.sourceActivity,qnrCtx:{contextType:i.workflowInformation.contextType,contextIdentifier:i.workflowInformation.contextIdentifier}}),n.ContentType.formUrlEncoded)},t.prototype.start=function(){var t=this,u;t.workflowInformation?(t.workflowInformation.displaySettings.modifyHistory&&(history.pushState(i,i),t.isHistoryModified=r),t.workflowInformation.displaySettings.showBottomBackButton||(u=$afe.select(h),u&&!u.hasClass("hidden")&&n.Utility.hideElement(u)),t.performActionOnServer(n.QuestionnaireAction.LaunchQuestionnaire,e,$$WPUtil.postify({qnrCtx:{contextType:t.workflowInformation.contextType,contextIdentifier:t.workflowInformation.contextIdentifier},lqfId:t.lqfId,settings:{hideSummaryPage:t.workflowInformation.workflowSettings.hideSummaryPage,wipeProgressTrail:t.workflowInformation.workflowSettings.wipeProgressTrail,defaultAnswersFromDAT:t.workflowInformation.workflowSettings.defaultAnswersFromDAT,isPrintPreview:t.workflowInformation.displaySettings.isPrintPreview}}),n.ContentType.formUrlEncoded)):t.performActionOnServer(n.QuestionnaireAction.LaunchQuestionnaire,e)},t.prototype.advance=function(n,t,i){var r=this,u;r.questionsController&&r.questionsController.callPendingConditionalCallbacks&&r.questionsController.callPendingConditionalCallbacks();r.ready?r.advanceCore(n,t,i):u=setTimeout($.proxy(function(){this.advanceCore(n,t,i)},r),500)},t.prototype.advanceCore=function(t,i,r){var f=this;f.ready&&!f.domElements.$continueButton.hasClass("disabled")&&(n.Utility.markFormAsValid(f.domElements.$form,f.domElements.$continueButton),i=n.Utility.removeDisabledQuestionsFromArray(i),f.destroyQuestionsController(),f.ready=u,f.performActionOnServer(n.QuestionnaireAction.AdvanceQuestionnaire,e,$$WPUtil.postify({coreQuestions:i,hqaId:t,eptDAT:r,subpage:f.subpage,settings:{hideSummaryPage:f.workflowInformation.workflowSettings.hideSummaryPage}}),n.ContentType.formUrlEncoded))},t.prototype.save=function(n,t){if(this.ready)this.saveCore(n,t);else var i=setTimeout($.proxy(function(){this.saveCore(n,t)},this),500)},t.prototype.saveCore=function(t,i){var r=this;r.ready&&(n.Utility.markFormAsValid(r.domElements.$form,r.domElements.$continueButton),i=n.Utility.removeDisabledQuestionsFromArray(i),r.destroyQuestionsController(),r.ready=u,r.performActionOnServer(n.QuestionnaireAction.SaveQuestionnaire,e,$$WPUtil.postify({coreQuestions:i,hqaId:t,subpage:r.subpage}),n.ContentType.formUrlEncoded))},t.prototype.back=function(n,t){if(this.ready)this.backCore(n,t);else var i=setTimeout($.proxy(function(){this.backCore(n,t)},this),500)},t.prototype.backCore=function(t,i){var r=this;r.ready&&(n.Utility.markFormAsValid(r.domElements.$form,r.domElements.$continueButton),i=n.Utility.removeDisabledQuestionsFromArray(i),r.destroyQuestionsController(),r.ready=u,r.performActionOnServer(n.QuestionnaireAction.BackQuestionnaire,e,$$WPUtil.postify({coreQuestions:i,hqaId:t,subpage:r.subpage}),n.ContentType.formUrlEncoded))},t.prototype.jumpBack=function(t,i,r){this.performActionOnServer(n.QuestionnaireAction.JumpToQuestion,e,$$WPUtil.postify({questionToFocus:t,lqfId:i,hqaId:r}),n.ContentType.formUrlEncoded)},t.prototype.submit=function(t){var i=this;i.workflowInformation&&i.workflowInformation.displaySettings.suppressSubmission?i.performCallbackToHandler(n.QuestionnaireAction.SubmitQuestionnaire,i.hqaId):i.performActionOnServer(n.QuestionnaireAction.SubmitQuestionnaire,e,$$WPUtil.postify({hqaId:t}),n.ContentType.formUrlEncoded)},t.prototype.cancel=function(){var t=this;n.Utility.markFormAsValid(t.domElements.$form,t.domElements.$continueButton);t.destroyQuestionsController();t.performActionOnServer(n.QuestionnaireAction.CancelQuestionnaire,e,$$WPUtil.postify({hqaId:t.hqaId}),n.ContentType.formUrlEncoded)},t.prototype.showLoading=function(){var t=this,r;t.setInteractiveElements(u);t.uiCallbacks&&t.uiCallbacks.showLoadingCallback?t.uiCallbacks.showLoadingCallback(t.domElements):(r=i,t.uiCallbacks&&(r=t.uiCallbacks.defaultSettings),n.Ui.defaultShowLoadingCallback(t.domElements,r))},t.prototype.beforeViewLoad=function(t){var r=this,u;r.uiCallbacks&&r.uiCallbacks.beforeViewLoadCallback?r.uiCallbacks.beforeViewLoadCallback(r.domElements,t):(u=i,r.uiCallbacks&&(u=r.uiCallbacks.defaultSettings),n.Ui.defaultBeforeViewLoadCallback(r.domElements,u,t))},t.prototype.afterViewLoad=function(t){var r=this,u;t===void 0&&(t=i);r.uiCallbacks&&r.uiCallbacks.afterViewLoadCallback?r.uiCallbacks.afterViewLoadCallback(r.domElements):(u=i,r.uiCallbacks&&(u=r.uiCallbacks.defaultSettings),n.Ui.defaultAfterViewLoadCallback(r.domElements,u,t))},t.prototype.performActionOnServer=function(e,o,s,h){var c=this,v=c,a,l;(s===void 0&&(s=i),h===void 0&&(h=n.ContentType.formUrlEncoded),t.actionIsValidEndpoint(e)&&(!s||o!=="GET"))&&(a=500,l=0,e!==n.QuestionnaireAction.EvaluateQuestionConditions?(c.beforeViewLoad(e===n.QuestionnaireAction.JumpToQuestion),c.setInteractiveElements(u)):c.workflowInformation&&c.workflowInformation.workflowCallbacks&&c.workflowInformation.workflowCallbacks.beforeQuestionConditions&&c.workflowInformation.workflowCallbacks.beforeQuestionConditions(),$.ajax({url:t.getUrl(n.QuestionnaireAction[e]),type:o,data:s,contentType:h,beforeSend:$.proxy(function(){l=setTimeout($.proxy(function(){var t=this;l=0;e===n.QuestionnaireAction.CancelQuestionnaire&&$$WP.Utilities.UI.IsMobile&&n.Utility.isAskFromContactOrMessage()||(t.domElements.$loadingSpinner&&t.domElements.$loadingSpinner.fadeIn(),t.uiCallbacks&&t.uiCallbacks.showLoadingCallback&&t.uiCallbacks.showLoadingCallback(t.domElements,e))},this),a)},c),success:$.proxy(function(t){var u=this,i=u;e==n.QuestionnaireAction.GetBackUrl?t.BackUrl&&(window.location.href=makeLink(t.BackUrl)):e===n.QuestionnaireAction.EvaluateQuestionConditions?u.updateQuestions(t,function(){var n,t;i.ready=r;i.workflowInformation&&i.workflowInformation.workflowCallbacks&&i.workflowInformation.workflowCallbacks.afterQuestionConditions&&i.workflowInformation.workflowCallbacks.afterQuestionConditions();i.conditionalQueue.length!==0&&(n=i.conditionalQueue.shift(),i.conditionalQueue.length!==0&&(i.conditionalQueue=[],n=f),t=i.questionsController.getCoreModelsWithAnswers(r),i.questionConditionCallbackCore(i.hqaId,n,t))}):u.processServerResponse(e,t);l?(clearTimeout(l),l=0):u.domElements.$loadingSpinner&&u.domElements.$loadingSpinner.fadeOut();u.uiCallbacks&&u.uiCallbacks.hideLoadingCallback&&u.uiCallbacks.hideLoadingCallback(u.domElements,e)},c),error:function(){v.handleError()}}))},t.prototype.processServerResponse=function(t,i){var s="outerHTML",u=this,e,o;if(!u.isDestroyed){if(typeof i=="string"){i!==f?n.Utility.showError():u.handleEmptyServerResponse(t);return}i&&(u.hqaId=i.HqaId,u.callingApp=i.CallingApp,u.workflowInformation&&u.workflowInformation.displaySettings?(i.ShouldDisplayQuestionnaireName=u.workflowInformation.displaySettings.shouldDisplayQuestionnaireName&&!n.Utility.IsPrintPreview,n.Utility.IsPrintPreview&&$afe.select(".title .header").text(i.QuestionnaireName),u.workflowInformation.displaySettings.disableUnsavedChangesPopup||n.Utility.setDisplayUnsavedChangesPopup(i)):(i.ShouldDisplayQuestionnaireName=r,n.Utility.setDisplayUnsavedChangesPopup(i)),u.callingApp===n.CallingApplication.Welcome&&((n.Utility.isSummaryPage(i)||n.Utility.isQuestionsPage(i))&&i.IsPostTextSmartText&&(e=dangerou$.parseHtml(i.PostText),e.find("img").attr("src",function(n,t){return t?makeLink(t):t}),i.PostText=e.prop(s)),n.Utility.isQuestionsPage(i)&&i.IsPreTextSmartText&&(o=dangerou$.parseHtml(i.PreText),o.find("img").attr("src",function(n,t){return t?makeLink(t):t}),i.PreText=o.prop(s))),t===n.QuestionnaireAction.LaunchQuestionnaire&&(u.isRTL=i.IsRTL),n.Utility.isQuestionsPage(i)?u.handleQuestionsPage(t,i):n.Utility.isInterruptionPage(i)?u.handleInterruptionPage(i):n.Utility.isSummaryPage(i)?u.handleSummaryPage(t,i):n.Utility.isSaveQuestionnairePage(i)?u.handleSaveQuestionnairePage(i):u.handleNoQuestionsPage(i))}},t.prototype.handleQuestionsPage=function(e,o){var s=this,h,c,l,v,a,y,p,w;if(s.updatePostText(o.PostText,o.IsPostTextSmartText),s.subpage=o.Subpage,s.canAutoAdvance=o.CanAutoAdvance,s.isRTL)for(l=0,v=o.QuestionsList;l<v.length;l++)if(h=v[l],(h.ResponseType===4||h.ResponseType===6)&&h.ShowAsSlider&&h.SliderOptions)h.SliderOptions.IsRTL=r;else if(h.GroupQuestions)for(a=0,y=h.GroupQuestions;a<y.length;a++)c=y[a],(c.ResponseType===4||c.ResponseType===6)&&c.ShowAsSlider&&c.SliderOptions&&(c.SliderOptions.IsRTL=r);if(s.callingApp===n.CallingApplication.Welcome?o.Type===n.QuestionnaireType.CAT?o.PreText&&(o.PreText+=" "):(o.GenericPreText=$$WP.Strings.getForTemplate(n.QuestionnaireStringKeys.PreText,t.questionnaireWelcomeNamespace),o.GenericPreText&&o.GenericPreText!==f||(o.GenericPreText=$$WP.Strings.getForTemplate(n.QuestionnaireStringKeys.PreText,t.questionnaireNamespace))):o.GenericPreText=$$WP.Strings.getForTemplate(n.QuestionnaireStringKeys.PreText,t.questionnaireNamespace),o.QuestionnaireMetadata!==i&&(s.questionnaireMetadata=o.QuestionnaireMetadata),o.Status===n.QuestionnaireStatus.Jumped){if(e===n.QuestionnaireAction.JumpToQuestion&&s.workflowInformation&&s.workflowInformation.workflowCallbacks.afterJumpingToQuestion&&s.workflowInformation.workflowCallbacks.afterJumpingToQuestion())return;s.jumpedBack=r;s.questionToFocus=o.LqlID}else s.jumpedBack=u,s.questionToFocus=f;s.populateAllowedActions(o.AllowedActions);s.workflowInformation.displaySettings.alwaysEnableBackButton&&o.Type!==n.QuestionnaireType.CAT&&!s.jumpedBack&&(s.allowedActions.BackOverride=r);s.renderPartialView(n.Utility.getHtml(o));o.QuestionsList&&o.QuestionsList.length>0&&(s.questionsController=new $$WP.Questions.QuestionsController($afe.select("#qnr-questions-container"),o.QuestionsList,f,$.proxy(s.questionConditionCallback,s),s.hqaId,s.workflowInformation.displaySettings.allowIframes),o.Type===n.QuestionnaireType.CAT&&o.PreText&&(p={PreText:o.PreText,IsPreTextSmartText:o.IsPreTextSmartText},w=$afe.renderTemplate($$WP.Templates.Questionnaire.CatPreText,p,f),s.domElements.$questionnaireHost.find(".question.customList legend").prepend(w)));o.AnyTriggers&&s.questionConditionCallback();s.afterRenderPartialView()},t.prototype.handleInterruptionPage=function(r){var e=this;if(e.domElements.$postText.empty(),e.callingApp===n.CallingApplication.Hyperspace&&r.Message===n.QuestionnaireStringKeys.Locked){e.performCallbackToHandler(n.QuestionnaireAction.Error,e.hqaId,n.QuestionnaireError.QuestionnaireLocked);return}if(e.callingApp===n.CallingApplication.Welcome){e.performCallbackToHandler(n.QuestionnaireAction.Interruption);return}r.KeyedString=$$WP.Strings.getNamespace(t.questionnaireNamespace).getKeyedString("InterruptionMessage",r.Message);e.jumpedBack=u;e.questionToFocus=f;e.questionsController=i;e.populateAllowedActions(r.AllowedActions);e.renderPartialView(n.Utility.getHtml(r));e.afterRenderPartialView()},t.prototype.handleSummaryPage=function(e,o){var s=this,h;if(s.workflowInformation&&s.workflowInformation.workflowSettings.hideSummaryPage||o.SkipReviewPageAndSubmit){s.performCallbackToHandler(e,o.HqaId);return}h=s.getOverridableStringNamespace();s.updatePostText(o.PostText,o.IsPostTextSmartText);s.jumpedBack=u;s.questionToFocus=f;s.questionsController=i;s.populateAllowedActions(o.AllowedActions);o.HideSummaryPrompt=s.workflowInformation.displaySettings.hideSummaryPrompt;o.QuestionnaireMetadata!==i&&(s.questionnaireMetadata=o.QuestionnaireMetadata);o.AllowedActions.Submit?(o.SummaryPrompt=$$WP.Strings.get(n.QuestionnaireStringKeys.SummaryPrompt,h),o.SummaryPromptScreenReader=$$WP.Strings.get(n.QuestionnaireStringKeys.SummaryPromptScreenReader,h)):(o.SummaryPrompt=$$WP.Strings.get(n.QuestionnaireStringKeys.SummaryPromptReadOnlySubmitted,h),o.SummaryPromptScreenReader=$$WP.Strings.get(n.QuestionnaireStringKeys.SummaryPromptReadOnlySubmitted,h));o.DrawButtonTop=$$WP.Strings.get(n.QuestionnaireStringKeys.SubmitButtonTop,t.questionnaireNamespace)!==f;o.SubmittedDate&&(o.Mnemonics={SubmittedDate:{Value:o.SubmittedDate}});(o.IsQuestionnaireCompleted||o.Type===n.QuestionnaireType.CAT)&&o.SummaryItems.forEach(function(n){n.IsResponseViewOnly=r;n.GroupQuestionViewModels!==i&&n.GroupQuestionViewModels.length>0&&n.GroupQuestionViewModels.forEach(function(n){return n.IsResponseViewOnly=r})});n.Utility.modifySliderQuestions(o,s.isRTL);n.Utility.modifyScoringQuestions(o,s.isRTL);s.renderPartialView(n.Utility.getHtml(o));s.setUpSummaryPageHandlers(o.DrawButtonTop);s.afterRenderPartialView()},t.prototype.handleSaveQuestionnairePage=function(t){var r=this;if(r.domElements.$postText.empty(),r.jumpedBack=u,r.questionToFocus=f,r.questionsController=i,r.callingApp!==n.CallingApplication.Welcome){if(r.isSavingOnBack){r.performCallbackToHandler(n.QuestionnaireAction.BackQuestionnaire,r.hqaId);return}if(r.workflowInformation.displaySettings.callBackOnSave){r.performCallbackToHandler(n.QuestionnaireAction.SaveQuestionnaire,r.hqaId);return}r.populateAllowedActions(t.AllowedActions);t.Mnemonics={NumDays:{Value:t.ExpireDays},ExpDate:{Value:t.ExpireDate}};r.renderPartialView(n.Utility.getHtml(t));r.afterRenderPartialView()}},t.prototype.handleNoQuestionsPage=function(t){var i=this;if(i.callingApp===n.CallingApplication.Hyperspace){i.performCallbackToHandler(n.QuestionnaireAction.Error,f,n.QuestionnaireError.NoQuestions);return}i.populateAllowedActions(t.AllowedActions);i.renderPartialView(n.Utility.getHtml(t));i.afterRenderPartialView()},t.prototype.updateQuestions=function(t,i){var u=this;this.questionsController.updateQuestions(t.QuestionsToUpdate,function(){n.Ui.updateRequiredLegend(u.domElements,r);$afe.jq(document).trigger("resetDrawingOffset");$afe.jq(window).trigger("resetSliderOffset");$afe.jq(window).trigger("resetFollowUpQuestionsStyling");$$WP.FormValidation.checkIfFormIsValid(u.domElements.$form,r);i&&typeof i=="function"&&i()})},t.prototype.setUpSummaryPageHandlers=function(n){var r="click keypress",t=$afe.select("#qnr-summary-table .clickable"),f;t.on("mouseenter",function(){$(this).addClass("hover")}).on("mouseleave",function(){$(this).removeClass("hover")});for(var e=function(n){var t=$afe.jq(n);t.find(".edit-question-icon img").safeAttr("src",makeStaticImageLink("edit_pencil.svg"));t.on(r,$.proxy(function(n){(n.type===o||n.type==="keypress"&&(n.keyCode===13||n.which===32))&&this.jumpBack(t.data("question-id"),t.data("questionnaire-id"),this.hqaId)},s))},s=this,i=0,u=t.toArray();i<u.length;i++)f=u[i],e(f);t.find("a").on(r,function(n){n.stopImmediatePropagation()});n&&$afe.select("#submitbuttontop").click($.proxy(function(){this.clickContinueButton()},this))},t.prototype.renderPartialView=function(t){var i=this;typeof t=="string"?dangerou$.setHtml(i.domElements.$questionnaireHost,t):(i.domElements.$questionnaireHost.empty(),i.callingApp===n.CallingApplication.Welcome&&$$WP.Utilities.UI.SandboxHtml(t,i.workflowInformation.displaySettings.allowIframes),i.domElements.$questionnaireHost.safePrepend(t))},t.prototype.afterRenderPartialView=function(){$$WP.Utilities.UI.OnUIFrameworkLoaded($.proxy(function(){var t=this,e=t,i,u,f;if(t.questionToFocus&&(i=$afe.select("[data-lql='"+t.questionToFocus+"']")),t.setInteractiveElements(r),t.showOrHideButtons(),t.showOrHideCustomQuestionnaireMessage(),t.afterViewLoad(i),t.questionToFocus&&(u=$afe.select("html,body"),f=i.offset().top,u.animate({scrollTop:f-150},500),i.is(".collapsible")&&i.find("[data-collapsible-button]").trigger(o)),t.canAutoAdvance&&$afe.select('input[type="radio"]').not("[disableAutoAdvance='true']").click(function(n){$afe.jq(n.target).prop("checked")&&e.autoAdvance()}),n.Utility.isDisplayingSummary()){$afe.select(".qnr-scoring-graphical").each(function(){var s="flex-start",r="px)",u="transform",h="flex-end",f="align-items",i=this,n=$afe.jq(i).find(".ScoreIndicator"),e=$afe.jq(i).find(".IndNum"),c=e.width(),o=$afe.jq(i).find('[class*="ScoreGradient"]'),t=0;n.position().left+e.position().left<o.position().left&&(t=$afe.jq(i).find(".IndImg").outerWidth()/2,n.data("left")==="auto"?(n.css(f,h),n.css(u,"translateX(100%) translateX(-"+t+r)):(n.css(f,s),n.css(u,"translateX(-"+t+r)));n.position().left+e.position().left+c>o.position().left+o.width()&&(t=$afe.jq(i).find(".IndImg").outerWidth()/2,n.data("left")==="auto"?(n.css(f,s),n.css(u,"translateX("+t+r)):(n.css(f,h),n.css(u,"translateX(-100%) translateX("+t+r)))});$afe.jq(window).on("resize.questions",$.proxy(function(){n.Utility.modifySliderBallLocations(this.domElements.$questionnaireHost);n.Utility.modifySliderAnswerLocations(this.domElements.$questionnaireHost)},t))}t.callingApp===n.CallingApplication.Hyperspace&&$afe.select("#footer").css("display","block");t.ready=r},this))},t.prototype.handleEmptyServerResponse=function(t){t===n.QuestionnaireAction.LaunchQuestionnaire||t===n.QuestionnaireAction.AdvanceQuestionnaire||t===n.QuestionnaireAction.BackQuestionnaire||t===n.QuestionnaireAction.JumpToQuestion?this.performCallbackToHandler(n.QuestionnaireAction.Error,i,n.QuestionnaireError.WebServerError):(t===n.QuestionnaireAction.CancelQuestionnaire||t===n.QuestionnaireAction.SubmitQuestionnaire)&&this.performCallbackToHandler(t,this.hqaId)},t.prototype.showOrHideButtons=function(){var t=this,i=$afe.select(h);t.showOrHideBack();t.showOrHideContinue();t.showOrHideSave();t.showOrHideCancel();n.Utility.isDisplayingSavedPage()||n.Utility.shouldStopQuestionnaire()&&!n.Utility.isDisplayingInterruption()?t.showMainBackButton():t.workflowInformation.displaySettings.showBottomBackButton&&!i.hasClass("hidden")&&n.Utility.showElement($afe.select(h))},t.prototype.showOrHideBack=function(){var i=this,f=i.getOverridableStringNamespace(),r,u;i.allowedActions.Back||i.allowedActions.BackOverride?(n.Utility.isDisplayingSavedPage()?(r=$$WP.Strings.get(n.QuestionnaireStringKeys.BackToQuestionnaire,t.questionnaireNamespace),i.domElements.$backButton.val(r)):(u=$$WP.Strings.get(n.QuestionnaireStringKeys.Back,f),i.domElements.$backButton.val(u)),n.Utility.showButton(i.domElements.$backButton)):n.Utility.hideButton(i.domElements.$backButton)},t.prototype.showOrHideContinue=function(){var t=this,i=t.getOverridableStringNamespace(),r,u,f,e;t.allowedActions.Advance||t.allowedActions.Submit?(n.Utility.showButton(t.domElements.$continueButton),t.allowedActions.Submit?(r=$$WP.Strings.get(n.QuestionnaireStringKeys.Submit,i),t.domElements.$continueButton.val(r)):t.jumpedBack?(u=$$WP.Strings.get(n.QuestionnaireStringKeys.JumpToPreview,i),t.domElements.$continueButton.val(u)):n.Utility.isDisplayingSummary()?(f=$$WP.Strings.get(n.QuestionnaireStringKeys.Finish,i),t.domElements.$continueButton.val(f)):(e=$$WP.Strings.get(n.QuestionnaireStringKeys.Advance,i),t.domElements.$continueButton.val(e))):n.Utility.hideButton(t.domElements.$continueButton)},t.prototype.showOrHideSave=function(){this.allowedActions.Save?n.Utility.showButton(this.domElements.$saveButton):n.Utility.hideButton(this.domElements.$saveButton)},t.prototype.showOrHideCancel=function(){this.allowedActions.Cancel?n.Utility.showButton(this.domElements.$cancelButton.addClass(c)):n.Utility.hideButton(this.domElements.$cancelButton.removeClass(c))},t.prototype.showMainBackButton=function(){var i=this,r;if(i.callingApp===n.CallingApplication.Hyperspace){var u=n.QuestionnaireUrls.questionnaireListNew,e=$$WPUtil.queryString("filterdat"),o=$$WPUtil.queryString("showallseries");e&&(u=addQueryStringToUrl(u,"filterDAT",e));o&&(u=addQueryStringToUrl(u,"showAllSeries",o));n.Utility.modifyMainBackButton(u,n.QuestionnaireStringKeys.BackToQuestionnaireList,t.questionnaireMyChartNamespace)}else i.workflowInformation.contextType===n.QuestionnaireContextType.AdvanceCarePlanning?n.Utility.modifyMainBackButton(n.QuestionnaireUrls.acpPage,n.QuestionnaireStringKeys.BackToACP,t.questionnaireMyChartNamespace):document.location.toString().toLowerCase().indexOf(n.QuestionnaireUrls.askFromContact.toLowerCase())>-1&&(document.location.toString().toLowerCase().indexOf(n.QuestionnaireUrls.askFromAppointment.toLowerCase())>-1||document.location.toString().toLowerCase().indexOf(n.QuestionnaireUrls.askFromVisitDetail.toLowerCase())>-1||i.workflowInformation.sourceActivity==n.SourceActivity.AppointmentDetails)?(r=f,r=i.workflowInformation.sourceActivity>0?n.QuestionnaireUrls.apptBase+$$WPUtil.queryString("csn"):$$WP.Utilities.UI.IsMobile?n.QuestionnaireUrls.mobileClosePage:n.QuestionnaireUrls.echeckin+"&csn="+$$WPUtil.queryString("csn"),n.Utility.modifyMainBackButton(r,n.QuestionnaireStringKeys.BackToApptDetails,t.questionnaireMyChartNamespace)):document.location.toString().toLowerCase().indexOf(n.QuestionnaireUrls.askFromContact.toLowerCase())>-1||document.location.toString().toLowerCase().indexOf(n.QuestionnaireUrls.askFromECheckIn.toLowerCase())>-1||i.workflowInformation.sourceActivity==n.SourceActivity.AppointmentDetails?(r=f,r=i.workflowInformation.sourceActivity>0?n.QuestionnaireUrls.echeckinDotNet+$$WPUtil.queryString("csn"):n.QuestionnaireUrls.echeckin,n.Utility.modifyMainBackButton(r,n.QuestionnaireStringKeys.BackToEcheckIn,t.questionnaireMyChartNamespace)):document.location.toString().toLowerCase().indexOf(n.QuestionnaireUrls.askFromMessage.toLowerCase())>-1?n.Utility.modifyMainBackButton($$WP.Utilities.UI.IsMobile?n.QuestionnaireUrls.mobileClosePage:n.QuestionnaireUrls.msgBase+encodeURIComponent(i.workflowInformation.contextIdentifier),n.QuestionnaireStringKeys.BackToMessage,t.questionnaireMyChartNamespace):document.location.toString().toLowerCase().indexOf(n.QuestionnaireUrls.questionnaireListNew.toLowerCase())>-1?n.Utility.modifyMainBackButton(n.QuestionnaireUrls.questionnaireListNew,n.QuestionnaireStringKeys.BackToQuestionnaireList,t.questionnaireMyChartNamespace):document.location.toString().toLowerCase().indexOf(n.QuestionnaireUrls.askFromPatInitiated.toLowerCase())>-1?n.Utility.modifyMainBackButton(n.QuestionnaireUrls.questionnaireListOld,n.QuestionnaireStringKeys.BackToQuestionnaireList,t.questionnaireMyChartNamespace):document.location.toString().toLowerCase().indexOf(n.QuestionnaireUrls.askFromSeries.toLowerCase())>-1&&($$WP.Utilities.UI.IsMobile?n.Utility.modifyMainBackButton(n.QuestionnaireUrls.mobileClosePage,n.QuestionnaireStringKeys.BackToHomeScreen,t.questionnaireMyChartNamespace):n.Utility.showButton($afe.select(h).removeAttr("style").removeAttr("aria-hidden")))},t.prototype.showOrHideCustomQuestionnaireMessage=function(){var i="#context_metadata_text",t=this;t.workflowInformation&&t.workflowInformation.displaySettings&&(t.workflowInformation.displaySettings.showCustomQuestionnaireText?($$WPUtil.IsNullOrEmpty(t.domElements.$customQuestionnaireText)&&!t.isContextDisplayTextGenerated&&(t.workflowInformation.contextType===n.QuestionnaireContextType.Contact?t.domElements.$customQuestionnaireText=n.Utility.getApptDescription(t.questionnaireMetadata):t.workflowInformation.contextType===n.QuestionnaireContextType.Message?t.domElements.$customQuestionnaireText=n.Utility.getMessageDescription(t.questionnaireMetadata):t.workflowInformation.contextType===n.QuestionnaireContextType.Series&&(t.domElements.$customQuestionnaireText=n.Utility.getSeriesDescription(t.questionnaireMetadata))),t.isContextDisplayTextGenerated=r,t.domElements.$questionnaireHost.find(i).safeAppend(t.domElements.$customQuestionnaireText)):t.domElements.$questionnaireHost.find(i).remove())},t.prototype.questionConditionCallback=function(n){var t=this,i;(n===void 0&&(n=f),t.questionsController&&!t.canAutoAdvance)&&(t.ready?(i=t.questionsController.getCoreModelsWithAnswers(r),t.questionConditionCallbackCore(t.hqaId,n,i)):t.conditionalQueue.indexOf(n)===-1&&t.conditionalQueue.push(n))},t.prototype.questionConditionCallbackCore=function(t,i,r){var f=this;!f.ready||n.Utility.isDisplayingSummary()||n.Utility.isDisplayingInterruption()||n.Utility.shouldStopQuestionnaire()||(f.ready=u,f.performActionOnServer(n.QuestionnaireAction.EvaluateQuestionConditions,e,$$WPUtil.postify({hqaId:t,coreQuestions:r,lqlId:i,subpage:f.subpage}),n.ContentType.formUrlEncoded))},t.prototype.setInteractiveElements=function(t){var r=this,u;r.uiCallbacks&&r.uiCallbacks.setInteractiveElementsCallback?r.uiCallbacks.setInteractiveElementsCallback(r.domElements,t):(u=i,r.uiCallbacks&&(u=r.uiCallbacks.defaultSettings),n.Ui.defaultSetInteractiveElementsCallback(r.domElements,t,u))},t.prototype.populateAllowedActions=function(n){this.allowedActions=n},t.actionIsValidEndpoint=function(t){return t===n.QuestionnaireAction.LaunchQuestionnaire||t===n.QuestionnaireAction.AdvanceQuestionnaire||t===n.QuestionnaireAction.BackQuestionnaire||t===n.QuestionnaireAction.SaveQuestionnaire||t===n.QuestionnaireAction.SubmitQuestionnaire||t===n.QuestionnaireAction.ClearQuestionnaireState||t===n.QuestionnaireAction.CancelQuestionnaire||t===n.QuestionnaireAction.EvaluateQuestionConditions||t===n.QuestionnaireAction.JumpToQuestion||t===n.QuestionnaireAction.GetBackUrl?r:u},t.getUrl=function(n){return makeLink("Questionnaire/MyChartQuestionnaire/"+n)},t.prototype.getOverridableStringNamespace=function(){return this.workflowInformation&&this.workflowInformation.displaySettings.StringNamespace?this.workflowInformation.displaySettings.StringNamespace:t.questionnaireNamespace},t.prototype.updatePostText=function(n,t){this.domElements.$postText.empty();t?dangerou$.setHtml(this.domElements.$postText,n):this.domElements.$postText.text(n)},t.prototype.autoAdvance=function(){this.canAutoAdvance&&this.allowedActions.Advance&&!$$WP.IsAccessibilityOn&&this.clickContinueButton()},t.questionnaireNamespace="Questionnaire",t.questionnaireMyChartNamespace="Questionnaire.MyChart",t.questionnaireWelcomeNamespace="Questionnaire.Welcome",t}();t.QuestionnaireController=i})(t=n.MyChart||(n.MyChart={}))})(t=n.Questionnaire||(n.Questionnaire={}))})(t=n.PatientEngagement||(n.PatientEngagement={}))})(Epic||(Epic={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function t(){}var i="#required-legend",r="fast";return t.getDomElementsForQuestionnaireView=function(n){return n===void 0&&(n=""),{$host:$afe.select("#refresh-area"+n),$form:$afe.select("#qnr-form"+n),$questionnaireHost:$afe.select("#qnr-container"+n),$backButton:$afe.select("#previous-step"+n),$continueButton:$afe.select("#next-step"+n),$saveButton:$afe.select("#save-workflow"+n),$cancelButton:$afe.select("#cancel-workflow"+n),$loadingSpinner:$afe.select("#qnr-spinner"+n),$postText:$afe.select("#qnr-posttext"+n)}},t.defaultBeforeViewLoadCallback=function(n,t,i,u){u||n.$host.fadeTo(r,.3);i||(!t||t.scrollToTop)&&$afe.select("html, body").animate({scrollTop:0},"slow")},t.defaultAfterViewLoadCallback=function(u,f,e){var h="no-outline-on-focus",s="tabindex",o;e===void 0&&(e=null);o=u.$questionnaireHost;o.find(i).addClass("required");t.addImages(u.$questionnaireHost);t.updateRequiredLegend(u);$$WP.Utilities.UI.IsMobile&&u.$form.find(".formbuttons.qnr-actions:not(.topbuttons)").prepend(u.$continueButton);u.$loadingSpinner&&u.$loadingSpinner.fadeOut();u.$host.fadeTo(r,1);n.Utility.waitForImagesToLoad(u.$questionnaireHost);$$WP.Utilities.UI&&$$WP.Utilities.UI.MatchColumnHeights();f&&!f.scrollToTop||e||$$WP.ApplicationContext!==78||$afe.select("#content-grouper").scrollTop(0);e?($$WPUtil.IsNullOrEmpty(e.safeAttr(s))&&e.safeAttr(s,"-1").addClass(h),e.focus()):($$WPUtil.IsNullOrEmpty(o.safeAttr(s))&&o.safeAttr(s,"-1").addClass(h),this.focusWithoutScroll(o[0]));$afe.jq(window).trigger("resetDrawingOffset")},t.focusWithoutScroll=function(n){var t=window.scrollX,i=window.scrollY;n.focus();window.scrollTo(t,i)},t.defaultSetInteractiveElementsCallback=function(n,t){var i="pointer-events",r="disabled",u="input, label, select, textarea";t?(n.$host.find(u).prop(r,!1),$afe.select(".back a").css(i,"")):(n.$host.find(u).prop(r,!0),$afe.select(".back a").css(i,"none"))},t.defaultShowLoadingCallback=function(n){n.$host.fadeTo(r,.3);n.$loadingSpinner&&n.$loadingSpinner.fadeIn()},t.updateRequiredLegend=function(t,r){r===void 0&&(r=!1);var u=t.$questionnaireHost,f=0;$$WP.Utilities.UI.IsMobile||(f=u.find(".required").filter(":visible").length,f===0?n.Utility.hideElement(u.find(i),r?250:0):n.Utility.showElement(u.find(i),r?250:0))},t.addImages=function(t){t.find(".interrupticon_warn").attr("src",makeStaticImageLink(n.QuestionnaireImageKeys.Yield));t.find(".interrupticon_stop").attr("src",makeStaticImageLink(n.QuestionnaireImageKeys.Stop));t.find(".noquestions").attr("src",makeStaticImageLink(n.QuestionnaireImageKeys.Warning))},t.getQuestionnaireTitleElement=function(){return $afe.select("#qnr-container .qnr-prompt, #qnr-container .qnr-summary-title").first()},t}();n.Ui=t})(t=n.Questionnaire||(n.Questionnaire={}))})(t=n.PatientEngagement||(n.PatientEngagement={}))}(Epic||(Epic={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t;(function(n){var t;(function(n){var r=null,i=!1,t=!0,u=function(){function u(){}var w="Questionnaire.MyChart",b="right",k=".answertext",d=".answerrow",s="invisible",h="left",l="top",f="px",c=".slider-answer",a="rtl",v="vert",y=".sliderball",p=".slidersection",o="true",g="btnHidden",e="";return u.isQuestionsPage=function(n){return n.QuestionsList?t:i},u.isSummaryPage=function(n){return n.SummaryItems?t:i},u.isInterruptionPage=function(n){return n.Message?t:i},u.isSaveQuestionnairePage=function(n){return n.ExpireDays!==undefined?t:i},u.getHtml=function(n){if(typeof n!="string"){var t=void 0;if(n)t=n.QuestionsList||n.Questions?$afe.renderTemplate($$WP.Templates.Questionnaire.Questionnaire,n,e):n.SummaryItems?$afe.renderTemplate($$WP.Templates.Questionnaire.Summary,n,e):n.Message?$afe.renderTemplate($$WP.Templates.Questionnaire.Interruption,n,e):n.ExpireDays!==undefined?$afe.renderTemplate($$WP.Templates.Questionnaire.SavedQuestionnaire,n,e):$afe.renderTemplate($$WP.Templates.Questionnaire.NoQuestions,n,e);else return;return t}return n},u.showElement=function(n,t){t===void 0&&(t=0);n.show(t)},u.hideElement=function(n,t){t===void 0&&(t=0);n.hide(t)},u.showButton=function(n){u.showElement(n);n.removeClass(g)},u.hideButton=function(n){u.hideElement(n);n.addClass(g)},u.isDisplayingSummary=function(){var n=$afe.select("#is-qnr-summary").val();return n&&n.toString()===o},u.isDisplayingInterruption=function(){var n=$afe.select("#is-qnr-interruption").val();return n&&n.toString()===o},u.isJumpedBack=function(){var n=$afe.select("#is-jumped-back").val();return n&&n.toString()===o},u.shouldStopQuestionnaire=function(){var n=$afe.select("#should-stop-qnr").val();return n&&n.toString()===o},u.isCatType=function(){var n=$afe.select("#is-cat").val();return n&&n.toString()===o},u.isDisplayingSavedPage=function(){var n=$afe.select("#is-qnr-saved").val();return n&&n.toString()===o},u.setDisplayUnsavedChangesPopup=function(n){WP&&WP.Events&&(u.isQuestionsPage(n)?WP.Events.beforeUnload():WP.Events.cancelBeforeUnload())},u.isAskFromContactOrMessage=function(){var t=document.location.toString().toLowerCase();return t.indexOf(n.QuestionnaireUrls.askFromContact.toLowerCase())>-1||t.indexOf(n.QuestionnaireUrls.askFromMessage.toLowerCase())>-1},u.modifyMainBackButton=function(n,t,r){var f=$afe.select(".back a"),s=makeLink(n),o;if(f.safeAttr("href",s),o=f.attr("onclick"),(o||e).trim().length>0&&o.indexOf("TryRedirect")>-1)f.removeAttr("onclick").on("click",function(){return $$WPUtil.TryRedirect(s),i});$$WP.Strings.setDisplayText($afe.select(".back a"),t,r);u.showButton($afe.select(".back").removeAttr("style").removeAttr("aria-hidden"));$$WP.Utilities.UI.IsMobile&&$afe.select(".back").addClass("qnr_back_to_context")},u.removeDisabledQuestionsFromArray=function(n){var r=[],u=0,t;if(n)for(t=0;t<n.length;t++)if(n[t].IsEnabled){if(r[u]=n[t],n[t].GroupQuestions){for(var f=[],e=0,i=0;i<n[t].GroupQuestions.length;i++)n[t].GroupQuestions[i].IsEnabled&&(f[e]=n[t].GroupQuestions[i],e++);r[u].GroupQuestions=f}u++}return r},u.waitForImagesToLoad=function(n,f,e){var s,o,h;for(f===void 0&&(f=r),e===void 0&&(e=i),s=t,e=e||u.isDisplayingSummary(),f=f||n.find(".qnr-summary-question-answer .image.qnr-summary-drawing-thumb, .answerimage, img"),o=0;o<f.length;o++)f[o].complete||(s=i);$$WP.Utilities.UI.MatchColumnHeights();s===i?h=setTimeout(function(){u.waitForImagesToLoad(n,f,e)},500):e&&(u.modifySliderBallLocations(n),u.modifySliderAnswerLocations(n))},u.modifySliderBallLocations=function(n){n.find(p).each(function(){var t,e,n,o,p,b,k,d,g,nt,tt,it,rt,ut,ft,r,w,et,u,i;t=$afe.jq(this);e=t.find(".slider");n=t.find(y);nt=n.safeAttr("value");it=n.safeAttr("min");ut=n.safeAttr("max");tt=$$WP.I18N.parseNumber(nt);rt=$$WP.I18N.parseNumber(it);ft=$$WP.I18N.parseNumber(ut);w=t.hasClass(v);et=t.hasClass(a);r=$$WP.Questions.Utilities.calculateSliderBallPercent(tt,rt,ft,w,et);r===1?t.parent(c).addClass("maxanswer"):r===0&&t.parent(c).addClass("minanswer");w?(o=e.css("height"),b=+o.substr(0,o.indexOf(f)),k=n.outerHeight()-n.innerHeight(),i=0,u=b-k,n.css(l,r*(u-i)+i+f)):(p=e.css("width"),d=+p.substr(0,p.indexOf(f)),g=n.outerWidth()-n.innerWidth(),i=0,u=d-g,n.css(h,r*(u-i)+i+f));n.removeClass(s)})},u.modifySliderAnswerLocations=function(n){$$WP.ApplicationContext===78||$$WP.Utilities.UI.IsMobile?u.modifyAnswerTextAndImageLocations(n):(u.modifyAnswerTextLocations(n),u.modifyAnswerImgLocations(n))},u.modifyAnswerTextLocations=function(n){n.find(c).each(function(){var n,t,i,g,nt,r,e,o,c,w;(n=$afe.jq(this),g=n.find(p),nt=n.find(d),t=nt.find(k),i=n.find(y),t.length===1&&i.length===1)&&(r=g.hasClass(a),n.hasClass(v)?(e=void 0,o=void 0,e=t.height(),o=u.findVerticalAnsCssOffset(n,i,e),t.css(l,o+f)):(c=void 0,w=void 0,c=t.width(),w=u.findHorizontalAnsCssOffset(n,i,c,r),t.css(r?b:h,w+f)),t.removeClass(s))})},u.modifyAnswerImgLocations=function(n){n.find(c).each(function(){var n,t,k,i,r,e,o,c,w;(n=$afe.jq(this),k=n.find(p),t=n.find(".answerrow > .answerimage"),i=n.find(y),t.length===1&&i.length===1)&&(r=k.hasClass(a),n.hasClass(v)?(e=void 0,o=void 0,e=t.height(),o=u.findVerticalAnsCssOffset(n,i,e),t.css(l,o+f)):(c=void 0,w=void 0,c=t.width(),w=u.findHorizontalAnsCssOffset(n,i,c,r),t.css(r?b:h,w+f)),t.removeClass(s))})},u.modifyAnswerTextAndImageLocations=function(n){n.find(c).each(function(){var nt="padding-top",n,tt,t,i,r,it,e,c,l,o,w,g;(n=$afe.jq(this),it=n.find(p),e=n.find(d),t=e.find(k),i=e.find(".answerimage"),tt=e.find(".answerImageAndText"),r=n.find(y),r.length===1)&&(c=it.hasClass(a),n.hasClass(v)?(l=void 0,o=void 0,l=t.height()+i.height(),o=u.findVerticalAnsCssOffset(n,r,l),i.length!==1?t.css(nt,o+f):tt.css(nt,o+f)):(w=void 0,g=void 0,w=t.width(),g=u.findHorizontalAnsCssOffset(n,r,w,c),t.css(c?b:h,g+f)),t.removeClass(s),i.removeClass(s))})},u.findHorizontalAnsCssOffset=function(n,t,i,r){var f,u;return f=n.width(),u=parseFloat(t.css(h))||0,r&&(u=f-u-(t.outerWidth()-t.innerWidth())),u=(u+(u+t.outerWidth()-t.innerWidth()))/2-i/2,u+i>f?u=f-i:u<0&&(u=0),u},u.findVerticalAnsCssOffset=function(n,t,i){var u,r;return u=n.height(),r=parseFloat(t.css(l))||0,r=(r+(r+t.outerHeight()-t.innerHeight()))/2-i/2,r+i>u?r=u-i:r<0&&(r=0),r},u.modifySliderQuestions=function(n,i){var f=$$WP.Utilities.UI.IsMobile||$$WP.ApplicationContext===78,e=WP.DOM.Browser.isIE,r=WP.DOM.Browser.isSafari;n.SummaryItems.forEach(function(n){var s=" isSafari",h="browserNoAuto",c=n.QuestionViewModel,o;n.Answer&&c.ShowAsSlider?(o=c.SliderOptions,i&&(o.IsRTL=t),u.addSliderScreenReaderTextToQuestion(n,o),f&&!o.DisplayVertically&&n.Type===6&&u.changeHorizontalSliderToVertical(n,o),o.DisplayVertically&&(e||r)&&(o.ClassName=h,r&&(o.ClassName+=s)),u.modifyMinAndMaxToProperFormat(n,o)):n.GroupQuestionViewModels&&n.GroupQuestionViewModels.forEach(function(n){var c=n.QuestionViewModel,o;n.Answer&&c.ShowAsSlider&&(o=c.SliderOptions,i&&(o.IsRTL=t),u.addSliderScreenReaderTextToQuestion(n,o),f&&!o.DisplayVertically&&n.Type===6&&u.changeHorizontalSliderToVertical(n,o),o.DisplayVertically&&(e||r)&&(o.ClassName=h,r&&(o.ClassName+=s)),u.modifyMinAndMaxToProperFormat(n,o))})})},u.modifyScoringQuestions=function(n,i){var f,r,u;if(i)for(r=0,u=n.ScoringQuestions;r<u.length;r++)f=u[r],f.IsRTL=t},u.changeHorizontalSliderToVertical=function(n,i){n.QuestionViewModel.DisplayStyle="VERTSLIDER";i.DisplayVertically=t},u.addSliderScreenReaderTextToQuestion=function(t,i){var r="Questionnaire",c="@MYCHART@ANSVAL@",l="@MYCHART@MAXLABEL@",u="@MYCHART@MAX@",a="@MYCHART@MINLABEL@",f="@MYCHART@MIN@",e,o,s,h;t.Type===4?(s=$$WP.I18N.formatNumber(i.Min,t.QuestionViewModel.Precision),$$WP.Strings.addMnemonic(f,s),$$WP.Strings.addMnemonic(a,i.MinLabel),e=s.toString()!==i.MinLabel.toString(),h=$$WP.I18N.formatNumber(i.Max,t.QuestionViewModel.Precision),$$WP.Strings.addMnemonic(u,h),$$WP.Strings.addMnemonic(l,i.MaxLabel),o=h.toString()!==i.MaxLabel.toString()):($$WP.Strings.addMnemonic(f,i.MinLabel),$$WP.Strings.addMnemonic(u,i.MaxLabel));$$WP.Strings.addMnemonic(c,t.Answer);t.ScreenReaderText=e&&o?$$WP.Strings.getForTemplate(n.QuestionnaireStringKeys.SliderAnswerBothLabels,r):e?$$WP.Strings.getForTemplate(n.QuestionnaireStringKeys.SliderAnswerMinLabel,r):o?$$WP.Strings.getForTemplate(n.QuestionnaireStringKeys.SliderAnswerMaxLabel,r):$$WP.Strings.getForTemplate(n.QuestionnaireStringKeys.SliderAnswerNoLabels,r);$$WP.Strings.removeMnemonic(f);$$WP.Strings.removeMnemonic(a);$$WP.Strings.removeMnemonic(u);$$WP.Strings.removeMnemonic(l);$$WP.Strings.removeMnemonic(c)},u.modifyMinAndMaxToProperFormat=function(n,t){n.Type===4&&(t.Min=$$WP.I18N.formatNumber(t.Min,n.QuestionViewModel.Precision),t.Max=$$WP.I18N.formatNumber(t.Max,n.QuestionViewModel.Precision))},u.markFormAsValid=function(n,t){var i="disabled";n.removeAttr("data-invalid");t.removeAttr(i);t.removeClass(i);t.removeAttr("aria-disabled")},u.showError=function(){window.location.href=makeLink("500.aspx")},u.buildApptDescriptionObject=function(t,i){return $$WPUtil.IsNullOrEmpty(i)&&(i=w),$$WPUtil.IsNullOrEmpty(t)?void 0:{QuestionnaireNamespace:i,TextKey:n.QuestionnaireStringKeys.ApptDescriptionWithProviderAndDate,TextKeyScreenReader:n.QuestionnaireStringKeys.ApptDescriptionWithProviderAndDateScreenReader,Mnemonics:{Provider:{Value:t.ApptData.ProvidersString},ApptDate:{Value:t.ApptData.TimeISO}}}},u.buildMessageDescriptionObject=function(t,i){return $$WPUtil.IsNullOrEmpty(i)&&(i=w),$$WPUtil.IsNullOrEmpty(t)?void 0:{QuestionnaireNamespace:i,TextKey:n.QuestionnaireStringKeys.MessageDescriptionWithSenderAndDate,TextKeyScreenReader:n.QuestionnaireStringKeys.MessageDescriptionWithSenderAndDateScreenReader,Mnemonics:{MsgSender:{Value:t.MsgData.MsgSender},MsgDate:{Value:t.MsgData.MsgDateISO}}}},u.buildSeriesDescriptionObject=function(t,i){var l,a,f,o,s,r,u,h,c=0;if($$WPUtil.IsNullOrEmpty(i)&&(i=w),!$$WPUtil.IsNullOrEmpty(t))return l=t.SeriesData.SeriesName,a=t.SeriesData.IsSeriesForSurgery,a&&(f=t.SeriesData.SurgeryData.Provider,o=t.SeriesData.SurgeryData.ProcedureName,s=t.SeriesData.SurgeryData.ProcedureDateISO,c=t.SeriesData.SurgeryData.Laterality,h=e,c!==0&&(h=$$WP.Strings.getForTemplate("LateralityCategory_"+c,i)),$$WPUtil.IsNullOrEmpty(o)&&(o=$$WP.Strings.getForTemplate("SeriesSurgeryProcedureDefault",i),h=e),$$WPUtil.IsNullOrEmpty(f)||$$WPUtil.IsNullOrEmpty(s)?$$WPUtil.IsNullOrEmpty(s)?$$WPUtil.IsNullOrEmpty(f)||(r=n.QuestionnaireStringKeys.SeriesSurgeryDescriptionWithProcedureAndProvider,u=n.QuestionnaireStringKeys.SeriesSurgeryDescriptionWithProcedureAndProviderScreenReader):(r=n.QuestionnaireStringKeys.SeriesSurgeryDescriptionWithProcedureAndDate,u=n.QuestionnaireStringKeys.SeriesSurgeryDescriptionWithProcedureAndDateScreenReader):(r=n.QuestionnaireStringKeys.SeriesSurgeryDescriptionWithProviderProcedureAndDate,u=n.QuestionnaireStringKeys.SeriesSurgeryDescriptionWithProviderProcedureAndDateScreenReader)),$$WPUtil.IsNullOrEmpty(r)&&(r=n.QuestionnaireStringKeys.SeriesDescription,u=n.QuestionnaireStringKeys.SeriesDescriptionScreenReader),{QuestionnaireNamespace:i,TextKey:r,TextKeyScreenReader:u,Mnemonics:{SeriesName:{Value:l},ProcedureName:{Value:o},Provider:{Value:f},ProcedureDate:{Value:s},Laterality:{Value:h}}}},u.getApptDescription=function(n){var t;return t=this.buildApptDescriptionObject(n),$$WPUtil.IsNullOrEmpty(t)?r:$afe.renderTemplate($$WP.Templates.Questionnaire.QuestionnaireContextDescription,t,e)},u.getMessageDescription=function(n){var t;return t=this.buildMessageDescriptionObject(n),$$WPUtil.IsNullOrEmpty(t)?r:$afe.renderTemplate($$WP.Templates.Questionnaire.QuestionnaireContextDescription,t,e)},u.getSeriesDescription=function(n){var t;return t=this.buildSeriesDescriptionObject(n),$$WPUtil.IsNullOrEmpty(t)?r:$afe.renderTemplate($$WP.Templates.Questionnaire.QuestionnaireContextDescription,t,e)},u}(),f;n.Utility=u;f=function(t){function i(){return t!==r&&t.apply(this,arguments)||this}return __extends(i,t),i.handleBackClick=function(){u.isAskFromContactOrMessage()?document.location.href=makeLink(n.QuestionnaireUrls.mobileClosePage):document.location.toString().toLowerCase().indexOf(n.QuestionnaireUrls.questionnaireListNew.toLowerCase())>-1?location.reload():document.location.href=makeLink(n.QuestionnaireUrls.mobileClosePage)},i}(u);n.UtilityMobile=f;document.Epic$PatientAccess$preventQuestionnaireRefresh=function(){return $afe.select("#divQnrQuestionnaire:not(:visible)").length>0?i:t};document.Epic$Host$onbeforesecure=function(){var n=document.getElementById("save-workflow"),i=document.getElementById("previous-step"),r;return n&&(n.click(),i&&(r=setTimeout(function(){i.click()},5e3))),t}})(t=n.Questionnaire||(n.Questionnaire={}))})(t=n.PatientEngagement||(n.PatientEngagement={}))}(Epic||(Epic={}))
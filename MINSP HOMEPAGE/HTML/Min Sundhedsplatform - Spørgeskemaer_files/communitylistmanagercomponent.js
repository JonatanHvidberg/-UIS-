$$WP.Components.CommunityListManagerComponent=function(c){var a=this;a.ListSelector=a.ListSelector||"ul";a.ListElementSelector=a.ListElementSelector||"li";a.Components$TemplateComponent(c);a._autoAddAfterWait=true;a.SerializedIndex=a.SerializedIndex||"";a._compareFunction=$.proxy(a._compareFunction,a);var b=$afe.select("ul#proxies").find("li.selected"),d=new RegExp(makeLink("showfile.asp.key=").replace("/","/")+"[0-9]+","gi");a.UserPhoto=(d.exec(b.html())||[makeStaticLink("images/ProxySilhouette.png")])[0];a.PhotoColor=(b.safeAttr("class")||"").match(/\bcolor\d\b/i);a.PhotoColor=a.PhotoColor&&a.PhotoColor.length>0?a.PhotoColor[0]:"color1"};$$WP.Components.CommunityListManagerComponent.prototype={SearchString:"",CanSearch:false,CanSort:false,SortBy:"PrimaryDate",SortDescending:true,Filter:"None",RenderedData:[],SerializedIndex:"",HasLoadedData:false,NeverAutoFocus:false,Class:"CommunityListManager",DataFromMultipleSources:true,CurrentOrgHasAllHidden:false,ContainerComponent:$$WP.Containers.CommunityListManagerContainer.prototype,_getNextPage:function(){var e="undefined",a=this,b,d=[],c;if(a.HasMoreData===false||typeof a.HasMoreData===e){for(c in a.UnusedRecords)if(a.UnusedRecords[c].length>0){d=d.concat(a.UnusedRecords[c]);a.OldestRenderedDate=new Date(Math.min(a.OldestRenderedDate,a.UnusedRecords[c][a.UnusedRecords[c].length-1].PrimaryDate))}return d}for(;;){b=null;for(c in a.UnusedRecords){b=b||c;if(a.UnusedRecords[c].length>0)if(a.UnusedRecords[b].length===0||a.UnusedRecords[c][0].PrimaryDate>a.UnusedRecords[b][0].PrimaryDate)b=c}if(typeof a.UnusedRecords[b]===e||a.UnusedRecords[b].length===0)return d;a.OldestRenderedDate=new Date(Math.min(a.OldestRenderedDate,a.UnusedRecords[b][0].PrimaryDate));d.push(a.UnusedRecords[b].shift());if(a.UnusedRecords[b].length===0&&a.Organizations[b].HasMoreData===true)return d}},_updateHeaderFooter:function(b){var a=this,c,d=false,e=0;if(a.Organizations)for(c in a.Organizations)if(a.Organizations[c].OrganizationId===c){e++;if(e>1){d=true;break}}b=$$WPUtil.mergeObjects(b,{OldestRenderedDate:a.OldestRenderedDate?formatDate(a.OldestRenderedDate):null,AllDataDisplayed:!a.HasMoreData,HasMoreData:a.HasMoreData,SearchString:a.SearchString,Filter:a.Filter,SortBy:a.SortBy,SortDescending:a.SortDescending,ListCount:a.RenderedData.length,HasLoadedData:a.HasLoadedData,HasMultipleOrganizations:d,CurrentOrgHasAllHidden:a.CurrentOrgHasAllHidden,SkippedSomeResults:a.Data.SkippedSomeResults},false,true);b.ViewBagProperties=a.Data.ViewBagProperties;a.ContainerComponent.HeaderComponent.ListData=b;a.ContainerComponent.FooterComponent.ListData=b;a.ContainerComponent.HeaderComponent.refresh();a.ContainerComponent.FooterComponent.refresh()},addNextPage:function(j){var e=true,a=this;if(a._waiting){a._autoAddAfterWait=e;a._userInitiatedAutoAdd=e;a.ContainerComponent.FooterComponent.CommunicationsIndicator.show(a.ContainerComponent.FooterComponent.$container);return}a.ContainerComponent.FooterComponent.show();a.ContainerComponent.FooterComponent.CommunicationsIndicator.hide();var d=e,b=a._getNextPage(),f=(!j||a._userInitiatedAutoAdd===e)&&a.NeverAutoFocus!==e,h,i;a._userInitiatedAutoAdd=false;b.sort(a._compareFunction);if(b.length===0){a._updateHeaderFooter();if(a.RenderedData.length>0)return;d=false}else{d=a.SortBy==="PrimaryDate"&&a.SortDescending&&!a.$container.hasClass("nodata")&&a.RenderedData.length>0;d=d&&b[0].PrimaryDate<=a.RenderedData[a.RenderedData.length-1].PrimaryDate}a.RenderedData.length===0&&b.length>0&&a.show();if(!d){if(b.length===0)f=false;else i=b[0].Id;a.RenderedData=a.RenderedData.concat(b);a.refresh();if(f)for(var g=0;g<a.RenderedData.length;g++)if(a.RenderedData[g].Id===i){h=g;break}}else{var c=dangerou$.parseHtml(a._getListHtml(b));a.SearchString&&a.SearchString.length>0&&$$WPUtil.highlightNodeText(c.get(0),a.SearchString);a.RenderedData=a.RenderedData.concat(b);if(c.get(0).tagName.toLowerCase()!=="ul")c=c.find("ul").first();c=c.children("li");$$WPUtil.removePopupListener(a.$content);a.$content.find("ul").first().safeAppend(c);a.$content.trigger("resize");$$WPUtil.addPopupListener(a.$content);a.applyFilters();if(f)h=c.first().safeAttr("data-index")}a._updateHeaderFooter();b.length>0&&a.load();f&&a.focusOn(h)},focusOn:function(b){var a=this.$container.find("ul").children("li").get(b);if(document.activeElement===a){a.blur();window.setTimeout(this._focusOnCallback,200,a)}else{a.focus();document.activeElement!==a&&window.setTimeout(this._focusOnCallback,200,a)}},_focusOnCallback:function(a){a&&a.focus()},_getListHtml:function(c,b){var a=this;if(!c&&a.RenderedData.length===0)return"";var d=0,e;if(c)d=a.RenderedData.length;b=$$WPUtil.mergeObjects(b||{},{List:c||a.RenderedData,UserPhoto:a.UserPhoto,ListOffset:d,PhotoColor:a.PhotoColor,ComponentNumber:a.ComponentNumber},false,true);return a.template(b).trim()},refresh:function(){var a=this;a.RenderedData.sort(a._compareFunction);a.html(a._getListHtml());a.applyFilters()},_compareFunction:function(g,h,d,f){var i="PrimaryDate";d=d||this.SortBy;f=f||this.SortDescending;var a,b,c,e=d.split(".");c=function(a,c){for(var b=0;b<c.length;b++)a=a[c[b]];return a};if(f===true){a=c(h,e);b=c(g,e)}else{a=c(g,e);b=c(h,e)}if(a===b||b-a===0)return d!==i?this._compareFunction(g,h,i,true):0;switch(typeof a){case"string":return b.toLowerCase()<a.toLowerCase()?1:-1;default:return a-b}},load:function(c){var d="listload",f="searchString=",a=this,e=a.RenderedData.length===0,b;c=c||"";if(a.SerializedIndex!==""&&a.HasMoreData===false){a._waiting=true;b=a.Url+f+encodeURIComponent(a.SearchString)+"&serializedIndex=ALLITEMSDISPLAYED&oldestRenderedDate=";b+=encodeURIComponent(a.OldestRenderedDate.toISOString())+"&"+c;a.__lastLoad=a.Components$TemplateComponent$load(b,e,d);return}a._waiting===true&&a.cancelRequest(d,a.__lastLoad);if(a.Url.indexOf("?")===-1)a.Url+="?";else if(a.Url[a.Url.length-1]!=="&")a.Url+="&";a._waiting=true;b=a.Url+f+encodeURIComponent(a.SearchString)+"&serializedIndex="+encodeURIComponent(a.SerializedIndex)+"&oldestRenderedDate=";b+=encodeURIComponent(a.OldestRenderedDate.toISOString())+"&"+c;a.__lastLoad=a.Components$TemplateComponent$load(b,e,d)},setData:function(c){var g=true,e=false,a=this;if(c==="ALLITEMSDISPLAYED"){a._waiting=e;return}a.Data=c;if(typeof a.Data.ViewBagProperties!=="undefined")for(var j in a.Data.ViewBagProperties)a.Data[j]=a.Data.ViewBagProperties[j];a.SerializedIndex=c.SerializedIndex||"";a.CanSearch=c.CanSearch||e;a.CanSort=c.CanSort||e;a.ErrorState=a.ErrorState||{};var b,h,i,d,f;if(c.List){a.HasLoadedData=g;a.Organizations=a.Organizations||c.Organizations||[];if(!a.EverHadErrorState)for(b in a.UnusedRecords)a.ErrorState[b]=a.Organizations[b]?a.Organizations[b].HasMoreData:g;for(b in c.List){a.ErrorState[b]=e;a.Organizations[b]=c.Organizations[b];a.Organizations[b].HasMoreData=c.List[b].HasMoreData;f=c.List[b].List;for(h=f.length-1;h>-1;h--){d=f[h];d.PrimaryDate=new Date(d.PrimaryDate);d.Organization=d.Organization||a.Organizations[b];d.Id=encodeURIComponent(d.Id);d.CommunityIdUrlEncoded=encodeURIComponent(d.CommunityId)}i=i||c.List[b].HasMoreData;if(a.UnusedRecords[b])a.UnusedRecords[b]=a.UnusedRecords[b].concat(f);else a.UnusedRecords[b]=f}a.HasMoreData=i;if(!a.EverHadErrorState)for(b in a.UnusedRecords)if(a.UnusedRecords[b].ErrorState){a.EverHadErrorState=g;break}a._waiting=e;a._autoAddAfterWait=a.Data.AutoRenderThisSet||a._autoAddAfterWait;a.Data.List=[];if(a._autoAddAfterWait){a._autoAddAfterWait=e;a.addNextPage(g);return}}else{a.clearModel();a.refresh()}},setSort:function(b,a){this.SortBy=b;this.SortDescending=a;this.refresh()},setSearch:function(a){if(a===this.SearchString)return;this.SearchString=a;this.reload()},setFilter:function(b){var a=this;if(b===a.Filter)return;a.Filter=b;switch(b.split("~")[0]){case"None":case"organization":a.applyFilters();return;default:a.reload();return}},applyFilters:function(m){var c="hidden",a=this,l=a,i=0,h,e,k,j=0,f,g,b,d;h=a.$content.find("ul");k=m?h.length:1;for(e=0;e<k;e++){g=$afe.jq(h[e]).children("li");for(f=0;f<g.length;f++){b=$afe.jq(g[f]);d=parseInt(b.safeAttr("data-index"),10);if(isNaN(d))d=j;if(l.shouldBeFiltered(l.RenderedData[d])){if(!b.hasClass(c)){i++;b.addClass(c)}}else if(b.hasClass(c)){i--;b.removeClass(c)}j++}}a.CurrentOrgHasAllHidden=a.RenderedData&&a.RenderedData.length>0&&a.$content.find("li.hidden").length===a.RenderedData.length;a.$content.trigger("resize",{forceShrink:i>0})},shouldBeFiltered:function(c){var a=this;a.Filter=a.Filter||"";var b=a.Filter.split("~");return b[0]==="organization"?a.hasSourceOrg(c,b[1])?false:true:false},hasSourceOrg:function(a,c){if(a.Organization.OrganizationId===c)return true;if(a.OrganizationLinks)for(var d,b=0;b<a.OrganizationLinks.length;b++){d=a.OrganizationLinks[b];if(d.OrganizationId===c)return true}return false},reload:function(){this.clearModel();this.load();this._autoAddAfterWait=true},resetUrl:function(a){if(this.Url===a)return;this.Url=a;this.reload()},clearModel:function(){var a=this;a.SerializedIndex="";a.UnusedRecords={};a.RenderedData=[];a.OldestRenderedDate=new Date;a.HasLoadedData=false;a.HasMoreData=false;a.hide();a.$content.trigger("resize",{forceShrink:true});a._updateHeaderFooter()},html:function(c,b){var a=this;a.Components$TemplateComponent$html(c,b);a.SearchString&&a.SearchString.length>0&&$$WPUtil.highlightNodeText(a.$content.get(0),a.SearchString)}};$$WP.Components.CommunityListManagerComponent.extend("Components.TemplateComponent")
(function ClassDefinition(){var o=".rejected",n="#filter-Dates",m="#filter-DocType",l="defaultDateFilter",k="defaultDocTypeFilter",f="viewdocument",p="loadingHeart",e="matchColumnHeights",g="height",j="keypress",b="hidden",a=false,c=null,i="#showRejected",h=".loadMore",d=true,t=25,r=13,u=9;$$WP.Utilities.guaranteeExistence($$WP,"Documents.ViewDocument.Controllers");var v=$$WP.Documents.ViewDocument.Controllers,s=$$WP.Documents.ViewDocument.Models,q=function DocumentWidgetController(b){var c=".ClickableHeader",a=this;a.proxify("_displayDocs","_displayError","_clickDoc","getDocs","_loadDocs","_registerHandlers","_hideWidget","_filterDocumentsByDate","_filterDocumentsByType","_buildFilters","_printDoc","_detectPrint","_sort","_sortByDate","_sortByType","_toggleShowRejected","_loadMore","_applyFilters");a.OverrideStrings=b.StringOverrides;a.Activity=b.Activity;a.IsMobile=$afe.select("html").hasClass("mobile");a.DocWidgetDiv=$afe.select("#viewdocumentwidget");if(a.IsMobile)b.TemplateMode="List";if(b.TemplateMode==="List"){a.Template=$$WP.Templates.Documents.ViewDocument.DocumentList;a.ReadDocsFromSubLists=d}else if(b.TemplateMode==="Grid"){a.Template=$$WP.Templates.Documents.ViewDocument.DocumentGrid;a.ReadDocsFromSubLists=d}else{a.TemplateMode="Table";a.Template=$$WP.Templates.Documents.ViewDocument.DocumentTable;a.currentSort="docDate";var f=$afe.renderTemplate($$WP.Templates.Documents.ViewDocument.DocumentTableHeader);$afe.select("#docwidgetheaders").safeAppend(f);var e=$afe.renderTemplate($$WP.Templates.Documents.ViewDocument.DocumentTableFooter);$afe.select("#docwidgetfooters").safeAppend(e);$afe.select(c).click(a,a._sort);$afe.select(h).click(a,a._loadMore);var g=a._sort;$afe.select(c).keypress(a,a._sort);$afe.select(i).click(a,a._toggleShowRejected)}a.DocWidgetModel=new s.DocumentWidgetModel(b);a._setTitle();a.getDocs(d)};q.prototype={DocWidgetModel:c,DocWidgetDiv:c,IsMobile:a,ReadDocsFromSubLists:a,SortDirection:1,_setTitle:function _setTitle(){var a="#documentwidgettitle";if(this.OverrideStrings.Title)$afe.select(a).text(this.OverrideStrings.Title);else $afe.select(a).addClass(b)},_clickDoc:function(b){var d=this,f,c,e;if(!b)return a;if(b.type===j&b.keyCode!==r){b.keyCode===u&&d.next().focus();return a}if(b.currentTarget){f=$afe.jq(b.currentTarget);e=parseInt(f.safeAttr("data-index"),10)}if(isNaN(e))return a;$clickedElement=$afe.jq(b.currentTarget);$clickedElement.removeClass("New");c=d.getClickedDocument(e,$clickedElement);if(c.DownloadOnly)c.AllowPreview=a;if(d.IsMobile)c._sendDownloadUrl();else c.openAsPopup();d._registerHandlers();return a},getClickedDocument:function getClickedDocument(b,c){var a=this;return!a.ReadDocsFromSubLists?a.DocWidgetModel.DocumentList.Documents[b]:c.hasClass("accepted")?a.DocWidgetModel.DocumentList.AcceptedDocuments[b]:c.hasClass("pending")?a.DocWidgetModel.DocumentList.PendingDocuments[b]:c.hasClass("rejected")?a.DocWidgetModel.DocumentList.RejectedDocuments[b]:a.DocWidgetModel.DocumentList.Documents[b]},getDocs:function getDocs(b){var a=this;a.initialLoad=b;if(b)a.DocWidgetModel.DocumentList=c;url=makeLink("Documents/ViewDocument/Load");$.ajax({url:url,data:{activity:a.Activity,docType:encodeURIComponent(a.DocWidgetModel.SelectedDocType),initialLoad:b},cache:d,type:"POST",success:a._loadDocs,error:a._displayError})},_loadDocs:function _loadDocs(e){var c=this;e.Documents.length==0&&$afe.select(h).addClass(b);if(e.Documents.length<t)c.allLoaded=d;c.documentCache=e.Documents;if(c.initialLoad){c.initialLoad=a;c.DocWidgetModel.setDocumentList(e.Documents);c._buildFilters();c._displayDocs();c.getDocs()}},_displayDocs:function _displayDocs(){var a=this;$(".documents").removeClass(b);a.DocWidgetDiv.empty();a.DocWidgetDiv.css(g,"100rem");$afe.jq(window).trigger(e);a._applyFilters();$showDeclined=$afe.select("#showDeclined");a.DocWidgetModel.DocumentList.populateSubLists();if(a.DocWidgetModel.HasRejectedDocuments)$showDeclined.removeClass(b);else $showDeclined.addClass(b);a.currentSort=="docType"&&a.DocWidgetModel.DocumentList.Documents.sort(a._sortByType);a.currentSort=="docDate"&&a.DocWidgetModel.DocumentList.Documents.sort(a._sortByDate);Handlebars.registerHelper("showBadge",function(b,d,c,a){return b||d||c?a.fn(this):a.inverse(this)});var c=$afe.renderTemplate(a.Template,a.DocWidgetModel.DocumentList);a.DocWidgetDiv.removeClass(p);a.DocWidgetDiv.safeAppend(c);if(a.DocWidgetModel.DocumentList.NoDocumentsData){a.DocWidgetModel.HideWidgetIfEmpty&&a.DocWidgetDiv.addClass(b);a._hideHeaders()}a.TemplateMode==="Table"&&a._handleRejectedTextPopups();$(".documents:has(.document.filtered)").addClass(b);$afe.select(i).length>0&&a._toggleShowRejected();a._registerHandlers();setTimeout(function(a){a.css(g,"auto");$afe.jq(window).trigger(e)}(a.DocWidgetDiv),1e3)},_filterDocumentsByDate:function _filterDocumentsByDate(b){var a=b.currentTarget.value;if(a===$$WP.Strings.getNamespace(f).getString(k)||a===$$WP.Strings.getNamespace(f).getString(l))this.DocWidgetModel.SelectedDate=c;else this.DocWidgetModel.SelectedDate=a;this._displayDocs()},_filterDocumentsByType:function _filterDocumentsByType(b){var a=b.currentTarget.value;if(a===$$WP.Strings.getNamespace(f).getString(k)||a===$$WP.Strings.getNamespace(f).getString(l))this.DocWidgetModel.SelectedDocType=c;else this.DocWidgetModel.SelectedDocType=a;this._displayDocs()},_applyFilters:function _applyFilters(){var b=this;for(var f=0;f<b.DocWidgetModel.DocumentList.Documents.length;f++){var e=b.DocWidgetModel.DocumentList.Documents[f],h=a,g=a;if(e.DocType!==b.DocWidgetModel.SelectedDocType&&b.DocWidgetModel.SelectedDocType!==c)h=d;if(e.Date!==b.DocWidgetModel.SelectedDate&&b.DocWidgetModel.SelectedDate!==c)g=d;if(g||h)e.Filtered=d;else e.Filtered=a}},_displayError:function _displayError(){var a=this;$afe.select(p).remove();a.DocWidgetModel.DocumentList=new s.DocumentListModel({},{},{},{});a.DocWidgetModel.DocumentList.Error=d;a._hideHeaders();var b=$afe.renderTemplate(a.Template,a.DocWidgetModel.DocumentList);a.DocWidgetDiv.safeAppend(b);$afe.jq(window).trigger(e)},_registerHandlers:function _registerHandlers(){var c="change",b=".document",d="click",e=".printIcon",a=this;$afe.select(e).off(d);$afe.select(b).off(d);$afe.select(".header").off(d);$afe.select(b).off(j);$afe.select(e).click(a,a._printDoc);$afe.select(m).off(c);$afe.select(n).off(c);$afe.select(m).on(c,a._filterDocumentsByType);$afe.select(n).on(c,a._filterDocumentsByDate);$afe.select(b).click(a,a._clickDoc);$afe.select(".SingleDocument").keypress(a,a._clickDoc);$afe.select(b).keypress(a,function(a){a.keyCode===r&&this.click()});window.onkeydown=a._detectPrint},_detectPrint:function _detectPrint(b){if(b.ctrlKey&&b.keyCode===80)if($afe.select(".Popup").length>0){this._printDoc();event.preventDefault();return a}},_hideWidget:function _hideWidget(){this.DocWidgetDiv.safeAttr("display","none")},_buildFilters:function _buildFilters(){var j="display:none",i="disabled",c="true",h="selected",a="option",b=this,d=$afe.select(n);d.empty();var e=$afe.jq(document.createElement(a));e.text("Date");e.safeAttr(h,c);e.safeAttr(i,c);e.safeAttr("style",j);d.safeAppend(e);var r=$afe.jq(document.createElement(a));r.text($$WP.Strings.getNamespace(f).getString(l));d.safeAppend(r);for(var p=0;p<b.DocWidgetModel.DocumentDates.length;p++){option=dangerou$.parseHtml("<option>"+b.DocWidgetModel.DocumentDates[p]+"</option>");d.safeAppend(option)}b.DocWidgetModel.SelectedDate&&d.val(b.DocWidgetModel.SelectedDate);var o=$afe.select(m);o.empty();var g=$afe.jq(document.createElement(a));g.text("Document Type");g.safeAttr(h,c);g.safeAttr(i,c);g.safeAttr("style",j);o.safeAppend(g);var t=$afe.jq(document.createElement(a));t.text($$WP.Strings.getNamespace(f).getString(k));o.safeAppend(t);b.DocWidgetModel.DocumentTypes.sort(function(a,b){return a.toLowerCase().localeCompare(b.toLowerCase())});for(var q=0;q<b.DocWidgetModel.DocumentTypes.length;q++){var s=$afe.jq(document.createElement(a));s.text(b.DocWidgetModel.DocumentTypes[q]);o.safeAppend(s)}b.DocWidgetModel.SelectedDocType&&d.val(b.DocWidgetModel.SelectedDocType)},_handleRejectedTextPopups:function _handleRejectedTextPopups(){for(var b=$afe.select(o),a=0;a<b.length;a++)$afe.jq(b[a]).find(".Status").css("overflow","visible")},_printDoc:function _printDoc(){var k="min-height",b="inherit",j="padding",i="width",f="printFrame",r,n,h,d,e,m,p,l;h=document.getElementById(f);if(!h){h=document.createElement("iframe");d=$afe.jq(h);d.safeAttr("name",f);d.safeAttr("id",f);d.prop(i,"0");d.prop(g,"0");d.prop("src","about:blank");$afe.jq(document.body).safeAppend(d);d.contents().find("head").safeAppend($afe.jq(document.createElement("title")));d.load(function(){var b=document.getElementById(f);b.contentWindow.focus();if(WP.DOM.Browser.isIE)b.contentWindow.document.execCommand("print",a,c);else b.contentWindow.print()})}d=$afe.jq(h);m=d.contents().find("head");m.find("title").text($afe.select(".titlebar span")[0].innerHTML);e=d.contents().find("body");n=$afe.select(".esigned");if(n.length>0){dangerou$.setHtml(e,n[0].innerHTML);l=$afe.select(".downloadIcon");if(l)l=l.safeAttr("href");$.ajax({url:makeLink("Documents/ViewDocument/SecureAuditEsignPrint"),data:{dcsIDURL:l,accessType:2},type:"POST"})}else dangerou$.setHtml(e,$afe.select("#section-to-print")[0].outerHTML.replace("method=view","method=print"));images=e.find("img");for(var o=0;o<images.length;o++){var q=$afe.jq(images[o]);q.css("max-width","7in")}e.find("._headerContent").css(j,b).css(i,b).css(k,b);e.find("._mainContent").css(j,b).css(i,b).css(k,b);e.find("._footerContent").css(j,b).css(i,b).css(k,b);e.find("canvas").css("background-color","#eee").css("border","1px #ccc solid");p=navigator.userAgent.toLowerCase().indexOf("safari/")>-1&&navigator.userAgent.toLowerCase().indexOf("chrome/")===-1;if(p)setTimeout(function(){h.contentWindow.document.write(m[0].outerHTML+e[0].outerHTML);h.contentWindow.document.close()},200);else{h.contentWindow.document.write(m[0].outerHTML+e[0].outerHTML);h.contentWindow.document.close()}return a},_sort:function _sort(f){var c="descending",b="ascending",d=this;if(f.type===j&f.keyCode!==r){f.keyCode===9&&d.next().focus();return a}var e=$afe.jq(f.currentTarget),g=d.currentSort;d.currentSort=f.currentTarget.id;if(g!==d.currentSort){d.SortDirection=1;$afe.select("#"+g).removeClass(b);$afe.select("#"+g).removeClass(c);e.addClass(c)}else{d.SortDirection=d.SortDirection*-1;if(e.hasClass(b)){e.addClass(c);e.removeClass(b)}else{e.addClass(b);e.removeClass(c)}}d._displayDocs()},_sortByType:function _sortByType(a,b){var c=a.DocType,d=b.DocType;if(a.Rejected||a.PendingApproval)c=a.DocDesc;if(b.Rejected||b.PendingApproval)d=b.DocDesc;return c.toLowerCase()>d.toLowerCase()?1*this.SortDirection:-1*this.SortDirection},_sortByDate:function _sortByDate(a,b){return a.DateRaw>b.DateRaw?-1*this.SortDirection:a.DateRaw<b.DateRaw?1*this.SortDirection:a.DateRaw===b.DateRaw?this._sortByType(a,b):void 0},_loadMore:function _loadMore(){var d=this;d.DocWidgetModel.SelectedDocType=c;d.DocWidgetModel.SelectedDate=c;d.DocWidgetModel.setDocumentList(d.documentCache);d._buildFilters();d._displayDocs();if(!d.allLoaded){d.initialLoad=a;d.getDocs()}else $afe.select(h).addClass(b)},_toggleShowRejected:function _toggleShowRejected(){var a=$afe.select(i)[0];if(a.checked){$afe.select(o).removeClass(b);setTimeout(function(){$afe.jq(window).trigger(e)},2e3)}else{$afe.select(o).addClass(b);$afe.jq(window).trigger(e)}},_hideHeaders:function _hideHeaders(){$afe.select("#documentTableHeader").hide()}};$$WP.Documents.ViewDocument.Controllers.DocumentWidgetController=q;q.extend($$WP.Controllers.Controller,"WP$Documents$ViewDocuments$Controllers$DocumentWidgetController")})()
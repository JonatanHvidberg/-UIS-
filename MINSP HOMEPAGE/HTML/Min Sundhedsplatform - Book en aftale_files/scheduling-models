function expandSection(n){var t=$afe.select("#"+n),i=$afe.select("[data-expand-button="+n+"]"),u=i.safeAttr("data-scroll-into-view"),r=null;i.safeAttr("aria-expanded",!0);i.safeAttr("data-expand-state","expanded");u&&(r=function(){var n=t[0].getBoundingClientRect(),i=n.bottom,r=i-window.innerHeight;r>0&&t[0].scrollIntoView(!1)});t.slideDown({progress:r})}function collapseSection(n){var t;$afe.select("#"+n).slideUp();t=$afe.select("[data-expand-button="+n+"]");t.safeAttr("aria-expanded",!1);t.safeAttr("data-expand-state","collapsed")}function toggleSection(n){$afe.select("#"+n).is(":hidden")?expandSection(n):collapseSection(n)}var debug_clickedModel;$$WP.$body=$$WP.$body||$afe.select("body"),function(){var u="[data-model-id]",i='"]',f='[data-view-binder-id="',e="data-view-binder-id",t="data-model-id",n=null,o=$$WP.Common.Model,s=$$WP.Common.ModelCollection,r=function(n,t){var i=this,r;for(i.WP$Controllers$Controller(),n=n||[],t=t||[],i.proxify("_onDomEventWrapper","_onPropertyChangedWrapper"),i.ViewBinderId=c++,i._eventNames=n.join(" "),i._boundModels={},i._modelId2listenerId={},i._propertyNames={},r=0;r<t.length;r++)i._propertyNames[t[r]]=!0;i.setBindingRoot($$WP.$body)},h={ViewBinderId:n,_eventNames:n,_propertyNames:n,_$bindingRoot:n,_boundModels:n,_modelId2listenerId:n,bindModel:function(n){var t=this,i;t._boundModels[n.ModelId]||(t._boundModels[n.ModelId]=!0,i=n.addPropertyListener("",t._onPropertyChangedWrapper),t._modelId2listenerId[n.ModelId]=i)},bindAllModels:function(n){for(var t=0;t<n.length;t++)this.bindModel(n[t])},bind:function(n,i){this.bindModel(n);i.safeAttr(t,n.ModelId);i.safeAttr(e,this.ViewBinderId)},unbindModel:function(n){var t=this;t._boundModels[n.ModelId]&&(delete t._boundModels[n.ModelId],n.removePropertyListener(t._modelId2listenerId[n.ModelId]),t.unbindElement(t.getBoundElements(n,t._$bindingRoot)))},unbindElement:function(n){n.removeAttr(t);n.removeAttr(e)},getBoundElements:function(n,t){var r;return t=t||this._$bindingRoot,r=f+this.ViewBinderId+i,typeof n!="undefined"&&(r+='[data-model-id="'+n.ModelId+i),t.find(r)},getBoundModels:function(){var i,r,n;for(r={},i=this.getBoundElements(),n=0;n<i.length;n++)r[$afe.jq(i.get(n)).safeAttr(t)]=!0;return s.modelIdSet2Array(r)},setBindingRoot:function(t){var r=this,u;u=f+r.ViewBinderId+i;r._$bindingRoot!==n&&r._$bindingRoot.off(r._eventNames,u,r._onDomEventWrapper);r._$bindingRoot=t;r._$bindingRoot.on(r._eventNames,u,r._onDomEventWrapper)},syncModelsToDOM:function(){for(var t=this.getBoundModels(),n=0;n<t.length;n++)this._onSyncModelToDOM(t[n])},_onDomEventWrapper:function(r,u){var f,e,s;f=$afe.jq(r.target).closest('[data-model-id][data-view-binder-id="'+this.ViewBinderId+i);s=f.safeAttr(t);e=o.getInstance(s);(e!==n||s==="-1")&&this._onDomEvent(e,f,r,u)},_onPropertyChangedWrapper:function(n){this._propertyNames[n.propertyName]&&this._onPropertyChanged(n.model,n)},_onPropertyChanged:function(){throw"[ViewBinder] Subclass did not implement the virtual method _onPropertyChanged";},_onSyncModelToDOM:function(){throw"[ViewBinder] Subclass did not implement the virtual method _onSyncModelToDOM";},_onDomEvent:function(){throw"[ViewBinder] Subclass did not implement the virtual method _onDomEvent";}},c=0,l=function(i){var f,e,r;i.ctrlKey&&$$WP.Debug.IsEnabled&&(f=$afe.jq(i.target).closest(u),e=f.safeAttr(t),r=o.getInstance(e),r!==n&&(debug_clickedModel=r,$$WP.Debug.log("(Ctrl+Click on bound model) Global variable debug_clickedModel set to point at model #"+r.ModelId+" : "+r._constructor._className)))};if(r.prototype=h,$$WP.Common=$$WP.Common||{},$$WP.Common.ViewBinder=r,r.extend($$WP.Controllers.Controller,"WP$Common$ViewBinder"),$$WP.Debug.IsEnabled)$$WP.$body.on("click",u,l)}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var r="aria-selected",n="selected",t="aria-pressed",i=function(n,t,i,r){var u=this,e=["click"],f;for(Array.isArray(r)||(r=[r]),f=0;f<r.length;f++)e.push(r[f]);u.WP$Common$ViewBinder(e,[n]);u._statePropertyName=n;u._selected=t;u._unselected=i},u={_statePropertyName:null,_selected:null,_unselected:null,_onPropertyChanged:function(n,t){var i=this;t.from===i._selected?i._setBoundElementUnselected(n):t.to===i._selected&&i._setBoundElementSelected(n)},_onSyncModelToDOM:function(n){var t=this;n[t._statePropertyName]===t._selected?t._setBoundElementSelected(n):t._setBoundElementUnselected(n)},_setBoundElementSelected:function(i){var u=this.getBoundElements(i);u.safeAttr(t)?u.addClass(n).safeAttr(t,"true"):u.addClass(n).safeAttr(r,"true")},_setBoundElementUnselected:function(i){var u=this.getBoundElements(i);u.safeAttr(t)?u.removeClass(n).safeAttr(t,"false"):u.removeClass(n).safeAttr(r,"false")},_onDomEvent:function(n,t,i){var r=this,u;u=n[r._statePropertyName];u===r._selected?n.setProperty(r._statePropertyName,r._unselected):u===r._unselected&&n.setProperty(r._statePropertyName,r._selected);i.preventDefault()}};i.prototype=u;$$WP.Common=$$WP.Common||{};$$WP.Common.SelectableViewBinder=i;i.extend($$WP.Common.ViewBinder,"WP$Common$SelectableViewBinder")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var t=null,i="WprId",r=$$WP.Common.ModelCollection,n=function(n){this.WP$Common$Model(n);this.WprId||this.WprId===0||$$WP.Debug.logError("A MyChart user was created from a raw object that did not contain a WPR ID: "+JSON.stringify(n))},u={s_dataMembers:[i,"FullName","EptId"],WprId:t,FullName:t,EptId:t,IsSelf:!1,Selected:!0},f=function(r,u){var e,o,f,s;if(s=[],Array.isArray(r))for(e=0;e<r.length;e++)(o=r[e],typeof o=="object"&&typeof o.WprId!="undefined")&&(f=u.getFromIndex(i,o.WprId),f===t&&(f=new n(o),f.IsSelf=e===0,u.add(f)),s.push(f));return s},e=function(){return new r(o,s)},o=[{propertyNames:i,storeAs:"single"}],s=[];n.prototype=u;n.convertRawMyChartUsers=f;n.createMyChartUsersCollection=e;$$WP.Common=$$WP.Common||{};$$WP.Common.MyChartUser=n;n.extend($$WP.Common.Model,"WP$Common$MyChartUser")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert});$$WPUtil.guaranteeExistence($$WP,"Community.Components");$$WP.Community.Components.CommunityPopupComponent=function(n,t){this.Components$TemplateComponent(n);this.template=t!=null?t:$$WP.Templates.Community.CommunityPopup};$$WP.Community.Components.CommunityPopupComponent.extend("Components.TemplateComponent"),function(){var st="#proxyConsentAlert",li="'] .fullyLinked",ai="[data-org-top-id='",vi="#ceSpotlight",ht="div#community_container",ti="div#loading",yi='div.formcontents input[type="button"]',p="Community.Manage",ct="'] .orgBottomRow",lt="[data-org-bottom-id='",pi=".skeleton",wi="Community/Shared/GetUpdatedCommunityLink",ii="tab_topic_linked",bi="inside.asp",at="url",ri="span#redirectURL",ki="#oAuthUnLink",vt="from",di="Community/Shared/DeclineOrganizationConsent",gi="UnlinkingMessage",it="true",rt="aria-disabled",ut="disabled",ft=".ajaxspinner",h="#alertSpan",ui="empty",nr="#OrgIdHiddenSpan",g="resize",tr="#challengeQuestions",ir="input change focusout",yt="#AnswerField",pt="blur change",wt="#ChallengeQuestion",bt="#verifyAnswer",kt="contentpopup",fi="transitionend transitionEnd",et=".loadingExt",a="loaded",dt=".loadingContainer",ei="CEbigloading",rr=".loadingExt ",oi="popupResize",r="hidden",nt="#externalLoadingIndicator",gt=".loadingStatus",e="Community.Shared",w="ConnectingMessage",ur="no organization ID found",b="id",si="#searchResultsPoliteRegion",t=!0,c="json",o="POST",hi="close",k="loading",ot=".organizationSearchIcon",v="1",tt="showDXROrgInMO",n=!1,f="",i=null,y="#orgSearch",fr="#show_consent",u="click",ni={Login:1,Manage:2},d={Home:0,MyChart:1,Fhir:2,Dxr:3},s={Link:1,Unlink:2,NotMe:3,Signup:4,LinkFHIRFirstTime:5,LinkFHIRAgain:6,UnlinkFHIR:7},er={CeOptOut:1},l={CE:"CE",LinkedOrg:"LinkedOrg",FHIR:"FHIR",UnknownEpic:"UnknownEpic"},ci=function(n,t){var i=this,r;if(i.WP$Controllers$Controller(),i.proxify("_successGetOrganizationList","_errorGetOrganizationList","_getOrganizationList","clickLink","_loadConfirm","clickChildOrgs","clickUnlink","clickLoginBottomButtons","clickSignup","clickVerifyAnswer","clickNotMe","clickCancel","_successVerifyAccount","showSuccessAndDisposePopup","disposePopup","clickUpdateFHIR","clickConfirmUpdateFHIR","clickLinkFHIR","connectFHIR","_successGetFhirRedirectUrl","clickUnlinkFHIR","clickConfirmUnlinkFHIR","continueFHIRQueryString","_successUpdateFHIRAccount","giveConsent","_errorGiveConsent","_successGiveConsent","clickConsentLink","autoQuery","_errorAutoQuery","_successAutoQuery","loadDetail","_successLoadDetail","_completeUpdate","_completeUnlink","_displayError","_displayErrorPopup","_successClickConnectEpic","_successGetChildrenOrganizations","renderChildOrgList","CreateLinkToOrganization","organizationSearchOnInput","_displayAndHighlightSearchResults","_organizationSearchSuccessOrError","_renderKnownOrganizations","_renderNearbyOrganizations","_renderLinkedOrganizations","_renderManagePageContent","_renderLoginPageContent","_renderStaticManagePageContent","_tryRenderManagePageContent","_buildActivityIconModel","_getKnownCEOrganizations","_getLinkedOrganizations","_filterLinkedOrganizations","_getAutoQueryCount","_displayLoadingPopup","removeQueryStringFromBrowser","closeWebView","handleMobileBackButton","clickConnectEpic","continueCELinking","_successContinueCELinking","_errorContinueCELinking","toLinkedTab","toDiscoverTab"),t)i._isIntegrated=t;else{switch(n){case"Login":i._Mode=ni.Login;i._renderLoginPageContent();break;case"Manage":i._Mode=ni.Manage;i._renderStaticManagePageContent();i._getOrganizationList();i._linkedFhirOrgId=decodeURIComponent($$WPUtil.queryString("linkedFhirOrgId"));i._userClickedOrgId=i._linkedFhirOrgId}r=$afe.select("#community_container");r.on(u,"input.org-link",i.clickLink);r.on(u,"a.childorg-link",i.clickChildOrgs);r.on(u,"input.org-unlink",i.clickUnlink);r.on(u,"input.fhir-unlink",i.clickUnlinkFHIR);r.on(u,"input.fhir-update",i.clickUpdateFHIR);r.on(u,".org-signup.button",i.clickSignup);r.on(u,"#consent_button",i.giveConsent);r.on(u,fr,i.clickConsentLink);r.on(u,"#continueButton",i.clickLoginBottomButtons);r.on(u,"#goToManageButton",i.clickLoginBottomButtons);r.on("input",y,i.organizationSearchOnInput);r.on(u,".connectFHIR",i.clickLinkFHIR);r.on(u,".connectUnknownEpic",i.clickConnectEpic);r.on(u,"#clear-search-button",i.clearCurrentSearch);r.on(u,"#toLinked",i.toLinkedTab);r.on(u,"#toDiscover",i.toDiscoverTab);r.on("touchend",y,i.scrollToSearchForMobile);r.on("touchstart",i.unFocusSearchInput)}},or={_Mode:0,_popupComponent:i,_userClickedOrgId:f,_userClickedOrgName:f,_linkedFhirOrgId:i,_userClickedAction:0,_orgListObj:i,_autoQueryListObj:i,_spotlightOrganizations:i,_callback:i,_isIntegrated:n,_isConsentNeeded:n,_searchQueryMostRecentRequest:0,_searchQueryLastDisplayedRequest:0,_searchQuery:f,_mostRecentSearchResults:i,_ceOptOut:n,clickChildOrgs:function(n){var i,t;n&&(t=$afe.jq(n.currentTarget),i=t.data("orgid"),this._userClickedOrgId=t.data("parentorgid"),this._userClickedOrgName=t.data("orgname"),this.getChildrenOrganizationList(i))},organizationSearchOnInput:function(r){var u=this,e,f=r.target.value;u._searchQuery!==f&&(e=$$WPUtil.queryString(tt)===v,u._searchQueryMostRecentRequest++,u._searchQuery=f,f.length>0?($afe.select(ot).addClass(k),$afe.select(ot).removeClass(hi),$.ajax({url:makeLink("Community/Shared/SearchOrganizations"),type:o,cache:n,data:{query:f,showDXROrgInMO:e},dataType:c,error:u._organizationSearchSuccessOrError.bind(u,u._searchQueryMostRecentRequest,{error:t}),success:u._organizationSearchSuccessOrError.bind(u,u._searchQueryMostRecentRequest)})):u._organizationSearchSuccessOrError(u._searchQueryMostRecentRequest,i))},_organizationSearchSuccessOrError:function(n,t){var i=this;(i._mostRecentSearchResults=t,n<i._searchQueryLastDisplayedRequest)||(i._searchQueryLastDisplayedRequest=n,n===i._searchQueryMostRecentRequest&&($afe.select(ot).removeClass(k),i._searchQuery?$afe.select(ot).addClass(hi):$afe.select(ot).removeClass(hi),$afe.select(si).empty(),t&&$afe.select(si).append($afe.renderTemplate($$WP.Templates.Community.OrganizationSearchResultsPoliteRegion,t))),i._displayAndHighlightSearchResults())},_displayAndHighlightSearchResults:function(){var s="#spotlight",o="#searchResultsNormalRegion",u=this,h=u._searchQuery,f=u._mostRecentSearchResults,i,r,e;if(f){if(!f.error)for(e=0;e<f.Results.length;e++)i=f.Results[e],i.EpicStatus?(i.Type=l.UnknownEpic,i.ShowCEOptOutErrorMsg=u._ceOptOut):i.Type=l.FHIR,u._orgListObj[i.OrganizationId]&&(r=u._orgListObj[i.OrganizationId],u._orgListObj[i.OrganizationId].Accept?(i.Type=l.LinkedOrg,i.ShowCEOptOutErrorMsg=n):u._orgListObj[i.OrganizationId].LinkType===d.MyChart&&(i.Type=l.CE,i.HasChildOrgs=r.HasChildOrgs,i.CELocationId=i.ChildId,i.LinkType=r.LinkType,i.LastEncounterDetail=r.LastEncounterDetail,i.IsDisabled=r.IsDisabled,i.TermsAndConditionsUrl=r.TermsAndConditionsUrl,i.ProxyTermsAndConditionsUrl=r.ProxyTermsAndConditionsUrl,i.FromSearch=t,i.ShowCEOptOutErrorMsg=n,r.RelatedOrganizations&&r.RelatedOrganizations.ChildrenOrganaizationList&&(i.RelatedOrganizations={},i.RelatedOrganizations.ChildrenOrganaizationList=[{OrganizationName:r.OrganizationName,LogoUrl:r.LogoUrl}].concat(r.RelatedOrganizations.ChildrenOrganaizationList),i.RelatedOrganizations.ChildrenOrganaizationList=i.RelatedOrganizations.ChildrenOrganaizationList.filter(u._hasDifferentName.bind(u,i))))),i.uniqueId=u._getUniqueNumber();$afe.select(o).empty();$afe.select(o).append($afe.renderTemplate($$WP.Templates.Community.OrganizationSearchResults,f));$afe.select(s).hide();u._highlightSearchResults(h)}else $afe.select(s).show(),$afe.select(si).empty(),$afe.select(o).empty()},_hasDifferentName:function(n,t){return n.OrganizationName!==t.OrganizationName},_highlightSearchResults:function(n){var t=n.toLowerCase().split(/\W+/g).filter(function(n){return n.length});$afe.select("#searchResults .organizationName, #searchResults .popupOrganizationChildName, #searchResults .popupOrganizationLocation").each(function(n,i){for(var o=i.innerText,c=o.toLowerCase(),u=[],s,e,h,l,r=0;r<t.length;r++)for(s=t[r],e=c.indexOf(s);e!==-1;)u.push({start:e,end:e+s.length}),e=c.indexOf(s,e+1);for(u.sort(function(n,t){return n.start-t.start}),r=0;r<u.length-1;)u[r+1].start<=u[r].end?(u[r].end=Math.max(u[r].end,u[r+1].end),u.splice(r+1,1)):r++;if(u.length>0)for(i.innerHTML=f,i.appendChild(document.createTextNode(o.substring(0,u[0].start))),r=0;r<u.length;r++)h=document.createElement("span"),h.className="hilite",h.innerText=o.substring(u[r].start,u[r].end),i.appendChild(h),l=r<u.length-1?u[r+1].start:o.length,i.appendChild(document.createTextNode(o.substring(u[r].end,l)))})},clickLink:function(n){var t=$afe.jq(n.target).data(b);t?this.CreateLinkToOrganization(t):$$WP.Debug.logError(ur)},CreateLinkToOrganization:function(t,i,r,u){var f=this;f._callback={Success:i,Failure:r,NotMyAccount:u};f._userClickedOrgId=t;f._userClickedAction=s.Link;f._displayLoadingPopup($$WP.Strings.get(w,e));$.ajax({url:makeLink("Community/Shared/AcceptOrganizationConsent"),type:o,cache:n,data:{organizationId:t,controllerType:f._Mode},dataType:c,error:f._displayError,success:f._loadConfirm})},_loadConfirm:function(n){var u=this,f,o;if(n.Success)if(n.OrgLink!==undefined&&n.OrgLink!==i&&(u._isIntegrated||(u._orgListObj[u._userClickedOrgId]=n.OrgLink,u._orgListObj[u._userClickedOrgId].IsLast=u._userClickedOrgId===u.getLastOrganizationId())),n.Data!==undefined&&n.Data!==i){f=n.Data.ValidationData.Questions;o={Questions:f,Organization:n.Data.Organization};$afe.select(gt).text($$WP.Strings.get(w,e));$afe.select(nt).removeClass(r);$afe.jq(window).trigger(oi);$afe.select(rr).addClass(ei);$afe.select(dt).addClass(a);$afe.select(et).removeClass(k).addClass(a).on(fi,$.proxy(u.showChallengeQuestionContent,u,o))}else u._completeUpdate({Success:t,OrgLink:n.OrgLink});else u._displayError()},showChallengeQuestionContent:function(i){var f=this,h,o,s;$afe.select(nt).addClass(r);f.disposePopup(n);h=new $$WP.Community.Components.CommunityPopupComponent({IsClosable:t,SupressTitle:n,TitleText:$$WP.Strings.get("ChallengeQuestionPopupTitle",e)});f._popupComponent=h;$$WPUtil.quickPopup(h,{Size:$$WPContain.Popup.SizeEnum.MEDIUM,Class:kt,positioningFunction:$$WPContain.Positions.InsideCentered,HasBackButton:n});f._popupComponent.setData(i);$afe.select(bt).on(u,f.clickVerifyAnswer);$afe.select("#notMe").on(u,f.clickNotMe);$afe.select("#cancelVerify").on(u,f.clickCancel);if(o=$afe.select(wt),i&&i.Questions&&i.Questions.length>1){o.on("focus",$$WP.Utilities.UI.FocusGhostableInput);o.on(pt,$$WP.Utilities.UI.BlurGhostableInput)}o.on(pt,f.enableOrDisableVerifyButton);s=$afe.select(yt);s.on("focus",$$WP.Utilities.UI.FocusGhostableInput);s.on(pt,$$WP.Utilities.UI.BlurGhostableInput);s.on(ir,f.enableOrDisableVerifyButton);$afe.select(tr).removeClass(r);f._popupComponent.ContainerComponent.setFocus();f._popupComponent.$container.trigger(g)},clickVerifyAnswer:function(t){var s,l,i,u;t&&(s=$afe.select(nr),l=s.safeAttr("value"),i=$afe.select(wt).val(),u=$afe.select(yt).val(),i===ui&&u===f?($afe.select(h).text($$WP.Strings.get("NoQuestionAnswer",e)),$afe.select(h).removeClass(r)):i===ui?($afe.select(h).text($$WP.Strings.get("NoQuestion",e)),$afe.select(h).removeClass(r)):u===f?($afe.select(h).text($$WP.Strings.get("NoAnswer",e)),$afe.select(h).removeClass(r)):($afe.select(h).addClass(r),$afe.select(ft).removeClass(r),$.ajax({url:makeLink("Community/Shared/ConfirmOrganizationLink"),type:o,cache:n,data:{organizationId:l,identifier:i,answer:u,controllerType:this._Mode},dataType:c,error:this._displayErrorPopup,success:this._successVerifyAccount})))},_successVerifyAccount:function(i){var u=this,f;$afe.select(ft).addClass(r);i.Success?(u._isIntegrated||(u._orgListObj[u._userClickedOrgId]=i.OrgLink,u._orgListObj[u._userClickedOrgId].IsLast=u._userClickedOrgId===u.getLastOrganizationId()),i.Disabled?u._isIntegrated?u._displayErrorPopup():($afe.select(h).text($$WP.Strings.get("MaxAttemptHit",e)),$afe.select(h).removeClass(r),$afe.select(h).focus(),$afe.select(bt).prop(ut,t).safeAttr(rt,it),f=u._orgListObj[u._userClickedOrgId],f.IsDisabled=t,u._renderSingleCEOrgBottom(f),$afe.select(wt).off(pt,u.enableOrDisableVerifyButton),$afe.select(yt).off(ir,u.enableOrDisableVerifyButton)):i.AnswerIsCorrect?($afe.select(h).addClass(r),u.disposePopup(n),u._displayLoadingPopup($$WP.Strings.get(w,e)),u._completeUpdate({Success:t,OrgLink:i.OrgLink})):($afe.select(h).text($$WP.Strings.get("IncorrectAnswer",e)),$afe.select(h).removeClass(r),$afe.select(h).focus())):u._displayErrorPopup()},clickNotMe:function(t){var i,u;t&&(this._userClickedAction=s.NotMe,i=$afe.select(nr),u=i.safeAttr("value"),$afe.select(ft).removeClass(r),$.ajax({url:makeLink("Community/Shared/InvalidateOrganizationLink"),type:o,cache:n,data:{organizationId:u},dataType:c,error:this._displayErrorPopup,success:this._completeUpdate}))},clickCancel:function(t){t&&(this._callback=i,this.disposePopup(n))},clickUnlink:function(t){var i=this,r=$afe.jq(t.target).data(b);r?(i._userClickedOrgId=r,i._userClickedAction=s.Unlink,i._displayLoadingPopup($$WP.Strings.get(gi,e)),$.ajax({url:makeLink(di),type:o,cache:n,data:{organizationId:r},dataType:c,error:i._displayError,success:i._completeUnlink})):$$WP.Debug.logError(ur)},clickUpdateFHIR:function(i){var f=this,c,h,l,a,o;if(i&&i.target){c=$afe.jq(i.target);h=c.data(b);l={Organization:f._orgListObj[h],IsUpdate:t};f._userClickedAction=s.LinkFHIRAgain;f._userClickedOrgId=h;a={SupressTitle:n,IsClosable:t,TitleText:$$WP.Strings.get("UpdateFHIRAccountTitle",e)};o=new $$WP.Community.Components.CommunityPopupComponent(a);f._popupComponent=o;$$WPUtil.quickPopup(o,{Size:$$WPContain.Popup.SizeEnum.MEDIUM,Class:kt,positioningFunction:$$WPContain.Positions.InsideCentered,HasBackButton:n});f._popupComponent.setData(l);$afe.select("#oAuthDescription").removeClass(r);$afe.select("#connectFHIR").on(u,f.clickConfirmUpdateFHIR);$afe.select("#cancelFHIR").on(u,f.clickCancel);f._popupComponent.$container.trigger(g);o.ContainerComponent.setFocus()}},clickConfirmUpdateFHIR:function(i){var r=this,u;i&&i.target&&(r.disposePopup(n),u=r._orgListObj[r._userClickedOrgId].OrganizationId,r.connectFHIR(u,t))},clickLinkFHIR:function(t){var i;t&&t.target&&(i=t.target.dataset.id,this.connectFHIR(i,n))},connectFHIR:function(t,i){var r=this,u;r._displayLoadingPopup($$WP.Strings.get(w,e));u=!$$WP.Utilities.UI.IsMobile||$$WPUtil.queryString(tt)===v;$.ajax({url:makeLink("Community/Shared/AcceptFHIRConsent"),type:o,cache:n,data:{encryptedOrgId:t,controllerType:r._Mode,showDXR:u,fromActivity:$$WPUtil.queryString(vt),isUpdate:i},dataType:c,error:r._displayError,success:r._successGetFhirRedirectUrl})},_successGetFhirRedirectUrl:function(n){n.Success?window.top.location=n.RedirectURL:this._displayError()},clickUnlinkFHIR:function(i){var f=this,o,h,c,l;if(i){c=$afe.jq(i.target).data(b);f._userClickedOrgId=c;f._userClickedAction=s.UnlinkFHIR;o={};o.SupressTitle=n;o.IsClosable=t;o.TitleText=$$WP.Strings.get("UnlinkFHIRAccountTitle",e);h=new $$WP.Community.Components.CommunityPopupComponent(o);f._popupComponent=h;$$WPUtil.quickPopup(h,{Size:$$WPContain.Popup.SizeEnum.MEDIUM,Class:kt,positioningFunction:$$WPContain.Positions.InsideCentered,HasBackButton:n});l={Organization:f._orgListObj[c]};f._popupComponent.setData(l);$afe.select(ki).removeClass(r);$afe.select("#unlinkFHIR").on(u,f.clickConfirmUnlinkFHIR);$afe.select("#cancelFHIRAgain").on(u,f.clickCancel);f._popupComponent.$container.trigger(g);h.ContainerComponent.setFocus()}},clickConfirmUnlinkFHIR:function(t){var u=this;t&&(u._popupComponent!==i&&($afe.select(ki).addClass(r),$afe.select(gt).text($$WP.Strings.get(gi,e)),$afe.select(rr).addClass(ei),$afe.select(nt).removeClass(r)),$$WP.CommunityUtilities.clearCommunityLinksSessionStatus(),$.ajax({url:makeLink(di),type:o,cache:n,data:{organizationId:u._userClickedOrgId},dataType:c,error:u._displayError,success:u._completeUnlink}))},clickLoginBottomButtons:function(t){var i,r,u,f;t&&t.target&&(i=$afe.jq(t.target).safeAttr(b),r=i==="goToManageButton",u=$afe.select("#dontShowAgain"),f=u.prop("checked"),$.ajax({url:makeLink("Community/Login/FinishOrganizationLinking"),type:o,cache:n,data:{askLater:!f,goToManagePage:r},dataType:c,error:this._handleLoginAjaxResponse,success:this._handleLoginAjaxResponse}))},_handleLoginAjaxResponse:function(n){var t;t=n&&n.redirectURL?n.redirectURL:$afe.select(ri).data(at)?$afe.select(ri).data(at):makeLink(bi);$$WP.Utilities.UI.IsMobile&&(t+=t.indexOf("?")===-1?"?nextstep=false":"&nextstep=false",n&&!n.goToManagePage&&(t+="&moworkflow=completeandclose"));$$WP.Utilities.TryRedirect(t)},clickSignup:function(n){var r=this,e,u;n&&(e=$afe.jq(n.target).data(b),r._userClickedOrgId=e,r._userClickedAction=s.Signup,u=r._orgListObj[e],u.IncompleteH2GSetup||$$WP.Utilities.UI.IsMobile||WP.DOM.Browser.isMobile?$$WP.CommunityUtilities.ShowSignUpNotAllowedMessage(u):(r.addLinkedTabToQueryParams(),$$WP.CommunityUtilities.openDeepLink(f,u,{},$$WP.CommunityUtilities.openDeepLinkType.InPopup,i,i,f,t)))},addLinkedTabToQueryParams:function(){var n;$$WPUtil.queryString("tab")!=="linked"&&window.history!==undefined&&window.history.replaceState!==undefined&&(n=window.location.search,n.indexOf("?")!==-1?window.history.replaceState({},document.title,n+"&tab=linked"):window.history.replaceState({},document.title,n+"?tab=linked"));$$WPUtil.parseQueryString(window.location.search)},clickConnectEpic:function(t){var i=this,r,s=!$$WP.Utilities.UI.IsMobile||$$WPUtil.queryString(tt)===v,u;if(!t||!t.currentTarget||!t.currentTarget.dataset){i._displayErrorPopup();return}t.currentTarget.dataset.id&&t.currentTarget.dataset.id!==f?(r=t.currentTarget.dataset.child,r===f&&(r=t.currentTarget.dataset.id),u=t.currentTarget.dataset.orgname,i._displayLoadingPopup($$WP.Strings.get(w,e)),$.ajax({url:makeLink("Community/Shared/InitiateCELinkNew"),type:o,cache:n,data:{externalOrgID:r,showDXR:s,externalOrgName:u},dataType:c,error:i._displayError,success:i._successClickConnectEpic})):i._displayErrorPopup()},_successClickConnectEpic:function(n){var i,r,u,f;n.Success===t?(this.disposePopup(),i=n.RedirectURL,r=n.Token,u=n.LocalHSI,f=i+"home/logout?postloginmode=linkauth&token="+r+"&hsi="+u,window.top.location=makeLink(f)):this._displayError()},continueCELinking:function(){var u=this,i,r;i=$$WPUtil.queryString("token1");r=$$WPUtil.queryString("token2");i===f||r===f?u._errorContinueCELinking(t):(i=decodeURIComponent(i),r=decodeURIComponent(r),u._displayLoadingPopup($$WP.Strings.get(w,e)),$.ajax({url:makeLink("Community/Manage/AutoLinkH2G"),type:o,cache:n,data:{token1:i,token2:r},dataType:c,error:u._errorContinueCELinking,success:u._successContinueCELinking}))},_successContinueCELinking:function(n){var r=this;n!==i&&n.Success?(r.removeQueryStringFromBrowser(),r.showSuccessAndDisposePopup(),r._userClickedOrgId=n.OrgID,r._orgListObj[r._userClickedOrgId]=n.OrgLink,n.OrgLink.successLinked=t,r.renderOrganizationList(),showTabbedSection(ii)):r._errorContinueCELinking(f,n)},_errorContinueCELinking:function(n,i){this.removeQueryStringFromBrowser();n===t?this._displayErrorPopup(i):this._displayError(i)},autoQuery:function(t){var r;r=this;t!==undefined&&t!==f&&t!==i&&$.ajax({url:makeLink(wi),type:o,cache:n,data:{controllerType:r._Mode,organizationId:t},dataType:c,error:r._errorAutoQuery.bind(this,t),success:r._successAutoQuery.bind(this,t)})},_errorAutoQuery:function(n){$afe.select(pi).first().remove();delete this._autoQueryListObj[n]},_successAutoQuery:function(n,i){var u=this,r;i.Success?(r=i.OrgLink,r.uniqueId=u._getUniqueNumber(),r.StartExpanded=t,r.Type=l.CE,u._orgListObj[r.OrganizationId]=r,delete u._autoQueryListObj[r.OrganizationId],u._getKnownCEOrganizations().length===1?u._renderKnownOrganizations():$afe.select(pi).first().replaceWith($afe.renderTemplate($$WP.Templates.Community.DiscoverableOrganizationTop,r))):u._errorAutoQuery(n)},loadDetail:function(t){var r;r=this;t!==undefined&&t!==f&&t!==i&&$.ajax({url:makeLink(wi),type:o,cache:n,data:{controllerType:r._Mode,organizationId:t},dataType:c,success:r._successLoadDetail})},_successLoadDetail:function(n){var r,t,i;n.Success&&(r=this._orgListObj,t=n.OrgLink,r[t.OrganizationId]=t,i=$afe.select(lt+t.OrganizationId+ct),i.empty(),i.append($afe.renderTemplate($$WP.Templates.Community.CEOrgBottom,t)))},_successCallback:function(n){var t=this;t._callback&&t._callback.Success&&t._callback.Success(n);t._callback=i},_failureCallback:function(){var n=this;n._callback&&n._callback.Failure&&n._callback.Failure();n._callback=i},_notMyAccountCallback:function(){var n=this;n._callback&&n._callback.NotMyAccount&&n._callback.NotMyAccount();n._callback=i},continueFHIRQueryString:function(){var t=this,i=$$WPUtil.queryString("fhirupdated")===it;t._linkedFhirOrgId&&!i&&(t._displayLoadingPopup($$WP.Strings.get(w,e)),t.updateQueryString(),$.ajax({url:makeLink("Community/Shared/UpdateFHIROrganization"),type:o,cache:n,data:{organizationId:t._linkedFhirOrgId},dataType:c,error:t._displayError,success:t._successUpdateFHIRAccount}))},_successUpdateFHIRAccount:function(n){var i=this;n.Success?(n.IsFromNewOrg?(i._userClickedAction=s.LinkFHIRFirstTime,n.FhirOrg.successLinked=t):(i._userClickedAction=s.LinkFHIRAgain,n.FhirOrg.successUpdateFHIR=t),i.showSuccessAndDisposePopup(),i._orgListObj[i._userClickedOrgId]=n.FhirOrg,i.renderOrganizationList()):i._displayError()},updateQueryString:function(){var n;window.history!==undefined&&window.history.replaceState!==undefined&&(n=window.location.search,n.indexOf("?")!==-1?window.history.replaceState({},document.title,n+"&fhirupdated=true"):window.history.replaceState({},document.title,n+"?fhirupdated=true"));$$WPUtil.parseQueryString(window.location.search)},_completeUpdate:function(n){var i=this;$afe.select(ft).addClass(r);n.Success?(i.showSuccessAndDisposePopup(),i._isIntegrated?i._userClickedAction===s.NotMe?i._notMyAccountCallback():i._successCallback(n.OrgLink):i._userClickedAction===s.NotMe?(i._orgListObj[i._userClickedOrgId].IsDisabled=t,i._renderSingleCEOrgBottom(i._orgListObj[i._userClickedOrgId])):(i._orgListObj[n.OrgLink.OrganizationId]=n.OrgLink,i._renderJustLinkedOrganization(n.OrgLink.OrganizationId),i._renderLinkedOrganizations())):i._displayError()},_completeUnlink:function(t){var i=this;$afe.select(ft).addClass(r);t.Success?(i.showSuccessAndDisposePopup(),i._orgListObj[i._userClickedOrgId].UserActionStatus=i._userClickedAction===s.UnlinkFHIR?s.UnlinkFHIR:s.Unlink,i._orgListObj[i._userClickedOrgId].Accept=n,$afe.select("#orgsLinked>[data-id='"+i._userClickedOrgId+"']").empty().append($afe.renderTemplate($$WP.Templates.Community.RecentUnlinkedCEOrg,i._orgListObj[i._userClickedOrgId])),i._renderKnownOrganizations(),i.clearCurrentSearch()):i._displayError()},clearCurrentSearch:function(n){$afe.select(y).val(f);$afe.select(y).trigger("input");n&&n.target.id==="clear-search-button"&&$(y).focus()},_displayError:function(n){var i="loadingerror",u=$afe.select(nt),t=$afe.select(et);if(u.hasClass(a)||(u.removeClass(r),$afe.jq(window).trigger(oi),$afe.select(dt).addClass(a)),t.hasClass(a))t.addClass(i),this._displayErrorPopup(n);else t.removeClass(k).addClass(i).on(fi,$.proxy(this._displayErrorPopup,this,n))},_displayErrorPopup:function(n){var r="@MYCHART@EXTERNALORGANIZATIONNAME@",i,u,e;this.disposePopup(t);n&&n.Error&&n.Error===er.CeOptOut?($$WP.Strings.addMnemonic(r,n.ExternalOrgName,f,p),i="CeOptOutErrorText"):i="ErrorOccurredText";u={ToolbarButtons:[{Text:$$WP.Strings.get("OKButton",p),Class:"otherbutton"}],TitleText:$$WP.Strings.getForTemplate("ErrorTitle",p),Html:$$WP.Strings.get(i,p),IsClosable:t,callback:function(){}};e=new $$WPComp.ConfirmComponent(u,{Size:$$WP.Containers.Popup.SizeEnum.SMALL});$$WPUtil.quickPopup(e);$$WP.Strings.removeMnemonic(r,p)},_displayLoadingPopup:function(i,u){var e,f;$afe.select(gt).length===0&&(e={SupressTitle:t,IsClosable:n,TitleText:u},f=new $$WP.Community.Components.CommunityPopupComponent(e),this._popupComponent=f,$$WPUtil.quickPopup(f,{Size:$$WPContain.Popup.SizeEnum.SMALL,Class:kt,positioningFunction:$$WPContain.Positions.InsideCentered,HasBackButton:n}),$afe.select(gt).text(i),$afe.select(et).addClass(ei),$afe.select(nt).removeClass(r),f.$container.trigger(g))},showSuccessAndDisposePopup:function(){if(this._popupComponent!==i){$afe.select(et).addClass(k).removeClass(a);$afe.select(dt).addClass(k).removeClass(a);$afe.select(tr).addClass(r);$afe.select(nt).removeClass(r);$afe.jq(window).trigger(oi);$afe.select(dt).addClass(a);$afe.select(et).removeClass(k).addClass(a).on(fi,this.disposePopup)}},disposePopup:function(n){var t=this;t._popupComponent!==i&&(t._popupComponent.dispose(),t._popupComponent=i,t._isIntegrated&&n&&t._failureCallback())},enableOrDisableVerifyButton:function(){var i,r;i=$afe.select(wt).val();r=$afe.select(yt).val();i===ui||r===f?$afe.select(bt).prop(ut,t).safeAttr(rt,it):$afe.select(bt).prop(ut,n).safeAttr(rt,"false")},disableSubmit:function(){$afe.select(yi).prop(ut,t).safeAttr(rt,it)},enableSubmit:function(){$afe.select(yi).prop(ut,n).safeAttr(rt,"false")},getChildrenOrganizationList:function(t){$.ajax({url:makeLink("Community/Shared/LoadChildrenOrganizations"),type:o,cache:n,data:{organizationID:t},error:this._displayErrorPopup,success:this._successGetChildrenOrganizations})},_successGetChildrenOrganizations:function(n){this.renderChildOrgList(n.childrenOrgs.ChildrenOrganaizationList,n.childrenOrgs.ChildrenOrganaizationList.length)},renderChildOrgList:function(n,r){var u=this,c,e,o,s,l,a,h;c=r!==undefined&&r!==i&&r!==f&&r>0?r:0;$$WPUtil.IsNullOrEmpty(u._userClickedOrgName)?(h=u._orgListObj[u._userClickedOrgId],$$WPUtil.IsNullOrEmpty(h)||(s=h.OrganizationName)):s=u._userClickedOrgName;e={};e.SupressTitle=t;e.IsClosable=t;e.TitleText=$$WP.Strings.get("ChildOrganizationPopupTitle","Community.OrganizationList");o=new $$WP.Community.Components.CommunityPopupComponent(e,$$WP.Templates.Community.ChildOrganizationsPopup);u._popupComponent=o;l={ChildOrgList:n,Count:c,ParentOrg:s};u._popupComponent.setData(l);a=isDataTile();$$WPUtil.quickPopup(o,{Class:"Popup childOrgPopup",Size:$$WPContain.Popup.SizeEnum.MEDIUM,positioningFunction:$$WPContain.Positions.InsideNearTop,HasBackButton:a});o.ContainerComponent.setFocus();matchWrapHeight()},_getOrganizationList:function(){var t=$$WPUtil.queryString(tt)===v;$.ajax({url:makeLink("Community/Shared/LoadCommunityLinks"),type:o,cache:n,data:{controllerType:this._Mode,showDXROrgInMO:t},error:this._errorGetOrganizationList,success:this._successGetOrganizationList})},_successGetOrganizationList:function(n){var t=this;t._autoQueryListObj=n.AutoQueryList;t._isConsentNeeded=n.IsConsentNeeded;t._ceOptOut=n.CEOptOut;t._orgListObj===i||t._orgListObj===undefined||Object.keys(t._orgListObj).length===0?t._orgListObj=n.OrgList:$.extend(t._orgListObj,n.OrgList);t._spotlightOrganizations=n.Spotlight;t._tryRenderManagePageContent(n)},_errorGetOrganizationList:function(){var t,n;switch(this._Mode){case ni.Login:$afe.onDocumentReady(function(){window.location=$afe.select(ri).data(at)});break;case ni.Manage:setTimeout(function(){$afe.select(ti).hide();t=$$WP.SimpleTemplates.Span({"class":"nodata"},$$WP.Strings.get("GenericError",p));n=$afe.select(ht);n.empty();n.append(t);n.slideDown(200,function(){matchWrapHeight()})},500)}},_buildActivityIconModel:function(){var t="ActivityIconImageTitles",i="images/",r="ActivityIconTitles",n=$$WP.Strings.getNamespace(p);return[{title:n.getKeyedString(r,"0"),image:i+n.getKeyedString(t,"0").trim()},{title:n.getKeyedString(r,v),image:i+n.getKeyedString(t,v).trim()},{title:n.getKeyedString(r,"2"),image:i+n.getKeyedString(t,"2").trim()},{title:n.getKeyedString(r,"3"),image:i+n.getKeyedString(t,"3").trim()},{title:n.getKeyedString(r,"4"),image:i+n.getKeyedString(t,"4").trim()},{title:n.getKeyedString(r,"5"),image:i+n.getKeyedString(t,"5").trim()},{title:n.getKeyedString(r,"6"),image:i+n.getKeyedString(t,"6").trim()}]},_renderLoginPageContent:function(){var n=$afe.select(ht),i=this._buildActivityIconModel(),r=$afe.renderTemplate($$WP.Templates.Community.CommunityLoginView,{ActivityIcons:i,expanded:t,hideExpandCollapseButton:t});n.hide();n.empty();n.safeAppend(r);$afe.select(ti).hide();n.show()},_renderStaticManagePageContent:function(){var n=$afe.select(ht),t=this._buildActivityIconModel(),i=$afe.renderTemplate($$WP.Templates.Community.CommunityLinksView,{ActivityIcons:t,From:$$WPUtil.queryString(vt)});n.empty().safeAppend(i);$$WPUtil.queryString("tab")==="linked"&&$$WP.Utilities.UI.OnUIFrameworkLoaded($.proxy(showTabbedSection,this,ii))},_tryRenderManagePageContent:function(n){$$WP.Utilities.UI.OnUIFrameworkLoaded($.proxy(this._renderManagePageContent,this,n))},_renderManagePageContent:function(n){var i=this,u=$afe.select(ht),f,r,e;n.HasSearchableOrgs||i._getKnownCEOrganizations().length!==0||i._getAutoQueryCount()!==0||i._isConsentNeeded||i._spotlightOrganizations.length!==0||$afe.select("#noOrganizations").show();n.HasSearchableOrgs&&$afe.select("#organizationSearchContainer").show();n.H2GHasBeenViewed||(f=$afe.renderTemplate($$WP.Templates.Community.ManagePageIntroText,{ActivityIcons:i._buildActivityIconModel(),expanded:t}),$afe.select("#discover-H2G-intro-text").empty().append(f));i.renderOrganizationList();$afe.select(ti).hide();u.show();for(r in i._autoQueryListObj)i.autoQuery(i._autoQueryListObj[r].OrganizationId);for(r in i._orgListObj)i._orgListObj[r].UserActionStatus===11&&i.loadDetail(i._orgListObj[r].OrganizationId);i.updateImagePlaceholders(u);matchWrapHeight();$afe.jq(window).trigger(g);e=$$WPUtil.queryString("celink");e===v?(i._userClickedAction=s.Link,i.continueCELinking()):i.continueFHIRQueryString()},renderOrganizationList:function(){var n=this;n._renderLinkedOrganizations();n._renderKnownOrganizations();n._renderNearbyOrganizations();n._renderUpdatedSearchResultsIfNeeded();matchWrapHeight();$afe.jq(window).trigger(g);$$WP.Utilities.UI.IsMobile&&$$WP.Utilities.Mobile&&$$WP.Utilities.Mobile.Optimization.CommunityLinks()},_renderLinkedOrganizations:function(){var n=this._getLinkedOrganizations(),t=$afe.renderTemplate($$WP.Templates.Community.OrganizationList,{organizationList:n});$afe.select("#organizationList").empty().safeAppend(t)},_renderKnownOrganizations:function(){var n=this,u=n._getAutoQueryCount(),i=n._getKnownCEOrganizations(),f=n._getUniqueNumber,r;i.sort(n.sortKnownOrg);i.forEach(function(n){n.LinkType===d.MyChart?(n.Type=l.CE,n.ShowCEOptOutErrorMsg=this._ceOptOut):n.Type=l.FHIR;n.uniqueId=f();n.StartExpanded=t});r=n._isConsentNeeded;$afe.select(vi).empty().safeAppend($afe.renderTemplate($$WP.Templates.Community.UnlinkedOrganizationList,{Results:i,skeletonCount:u,isConsentNeeded:r}))},_renderNearbyOrganizations:function(){var n=this._getUniqueNumber;this._spotlightOrganizations.forEach(function(t){t.EpicStatus?(t.Type=l.UnknownEpic,t.ShowCEOptOutErrorMsg=this._ceOptOut):t.Type=l.FHIR;t.uniqueId=n()});$afe.select("#fhirSpotlight").empty().safeAppend($afe.renderTemplate($$WP.Templates.Community.NearbyOrganizationSpotlight,{Spotlight:this._spotlightOrganizations}))},_renderUpdatedSearchResultsIfNeeded:function(){var i=this._userClickedAction,t=this._userClickedOrgId,n;i===s.Link&&($afe.select(ai+t+li).show(),n=$afe.select(lt+t+ct),n.empty(),n.append($afe.renderTemplate($$WP.Templates.Community.RecentCEOrgBottom,{})))},_renderJustLinkedOrganization:function(n){var t=$afe.select(lt+n+ct);$afe.select(ai+n+li).show();t.empty();t.append($afe.renderTemplate($$WP.Templates.Community.RecentCEOrgBottom,{}))},_renderSingleCEOrgBottom:function(n){var t;t=$afe.select(lt+n.OrganizationId+ct);t.empty();t.append($afe.renderTemplate($$WP.Templates.Community.CEOrgBottom,n))},_getLinkedOrganizations:function(){var n=this._orgListObj;return Object.keys(n).map(function(t){return n[t]}).filter(this._filterLinkedOrganizations).sort(this.sortOrg)},_filterLinkedOrganizations:function(i){var r=!$$WP.Utilities.UI.IsMobile||$$WPUtil.queryString(tt)===v;return!r&&i.LinkType&&i.LinkType===d.Dxr?n:((i.LinkType===2||i.LinkType===1)&&(i.DisplayAutoRefresh=t),i.Accept)},_getKnownCEOrganizations:function(){var t=this._orgListObj,i=!$$WP.Utilities.UI.IsMobile||$$WPUtil.queryString(tt)===v;return Object.keys(t).map(function(n){return t[n]}).filter(function(t){return!i&&t.LinkType&&t.LinkType===d.Dxr?n:!t.Accept})},_getUniqueNumber:function(){function t(){return n++}var n=0;return t}(),_getAutoQueryCount:function(){var n=0;return this._autoQueryListObj&&typeof this._autoQueryListObj=="object"&&(n=Object.keys(this._autoQueryListObj).length),n},sortOrg:function(n,t){return n.LinkType!==t.LinkType&&(n.LinkType===d.Dxr||t.LinkType===d.Dxr)?n.LinkType===d.Dxr?-1:1:n.ShowSignup!==t.ShowSignup?n.ShowSignup?-1:1:0},sortKnownOrg:function(n,t){return n.ShowUnavailableMsg!==t.ShowUnavailableMsg?t.ShowUnavailableMsg?-1:1:n.ShowAccountDisabledErrorMsg!==t.ShowAccountDisabledErrorMsg?t.ShowAccountDisabledErrorMsg?-1:1:typeof n.LinkType=="number"&&typeof t.LinkType=="number"?n.LinkType-t.LinkType:0},removeQueryStringFromBrowser:function(){var n=window.location.search.substring(1);n.length&&window.history!==undefined&&window.history.pushState!==undefined&&window.history.pushState({},document.title,window.location.pathname)},giveConsent:function(){var t;this._isConsentNeeded=n;t=this;t.disableSubmit();$afe.select(fr).hide();$afe.select("#consent_loading").show();$.ajax({url:makeLink("Community/Shared/QueryCommunityLinks"),type:o,cache:n,data:{controllerType:t._Mode},error:t._errorGiveConsent,success:t._successGiveConsent})},_errorGiveConsent:function(){$(st).hide();this.enableSubmit(this);this._displayErrorPopup()},_successGiveConsent:function(n){var i=this,u,r,f,o;if(u=i,n.OrgList&&Object.keys(n.OrgList).length>0){if(i._getKnownCEOrganizations().length===0)i._orgListObj=$.extend(i._orgListObj,n.OrgList),i._renderKnownOrganizations();else{$.extend(i._orgListObj,n.OrgList);for(f in n.OrgList)r=n.OrgList[f],r.uniqueId=i._getUniqueNumber(),r.StartExpanded=t,r.Type=l.CE,i._orgListObj[f]=r,$afe.select(vi).append($afe.renderTemplate($$WP.Templates.Community.DiscoverableOrganizationTop,r))}o=i._spotlightOrganizations.filter(function(t){return n.OrgList[t.OrganizationId]===undefined});o.length<i._spotlightOrganizations.length&&(i._spotlightOrganizations=o,i._renderNearbyOrganizations());$(st).remove()}else $(st).text($$WP.Strings.get("NoOrganizationsFoundFromDemographicsSearch",e)),$(st).addClass("no-additional-orgs-found");u.enableSubmit(u)},getLastOrganizationId:function(){var t,n;return t=$afe.select("div.organization"),t.length>0&&(n=t.last().safeAttr(b)),n!==undefined&&(n=n.slice(13)),n},clickConsentLink:function(){var n;n=this;$.proxy(n.giveConsent(),n)},updateImagePlaceholders:function(n){function u(n){n.addClass("icon")}for(var t,r=$afe.jq(n).find(".org_col_logo img"),i=0;i<r.length;i++){t=$afe.jq(r[i]);t.on("load",u(t));t.safeAttr("src",t.data(at))}},handleMobileBackButton:function(){$$WPUtil.queryString("backToPrevPage")===it?$$WPUtil.queryString(vt)?$$WP.Utilities.TryRedirect(makeLink(bi)+"?mode="+$$WPUtil.queryString(vt)):window.history.back():this.closeWebView()},closeWebView:function(){$$WP.Utilities.TryRedirect(makeLink("inside.asp?moworkflow=completeandclose"))},toLinkedTab:function(){showTabbedSection(ii);window.scrollTo(0,0)},toDiscoverTab:function(){showTabbedSection("tab_topic_discover");window.scrollTo(0,0)},scrollToSearchForMobile:function(){var n=$(y)[0].getBoundingClientRect(),t=n.top;t/window.innerHeight>.33&&$("html, body").animate({scrollTop:$(y).offset().top-window.innerHeight*.2},500)},unFocusSearchInput:function(n){var t="orgSearch";n.target.id!==t&&document.activeElement.id===t&&$(y).blur()}};Handlebars.registerHelper("ifNotNullOrEmpty",function(n,t){return $$WPUtil.IsNullOrEmpty(n)?t.inverse(this):t.fn(this)});ci.prototype=or;$$WP.Community=$$WP.Community||{};$$WP.Community.CommunityController=ci;ci.extend($$WP.Controllers.Controller,"WP$Community$CommunityController")}();$afe.select("body").on("click","[data-expand-button],[data-expand-clickable-row]",function(n){var t=n.currentTarget.dataset.expandButton||n.currentTarget.dataset.expandClickableRow;toggleSection(t);n.stopPropagation()});(function(){var n={};n.AlertTypeEnum={SolutionIsOnMultipleDates:1,SolutionIsInMultipleLocations:2};$$WP.Scheduling=$$WP.Scheduling||{};$$WP.Scheduling.Alert=n})(),function(){var t=$$WP.Common.ModelCollection,n=function(n){this.WP$Common$Model(n)},i=function(){return new t};n.prototype={s_dataMembers:["AdultWorkflowEnabled","ProxyWorkflowEnabled"],AdultWorkflowEnabled:!1,ProxyWorkflowEnabled:!1};n.createAnonymousSettingsCollection=i;$$WP.Scheduling=$$WP.Scheduling||{};$$WP.Scheduling.AnonymousSettings=n;n.extend($$WP.Common.Model,"WP$Scheduling$AnonymousSettings")}(),function(){var t=!1,n=null,r="VisitTypeSource",u="VisitType",f={Default:0,StandardLqf:1,DepartmentOverrideLqf:2},i=function(n){var t=this;t.WP$Common$Model(n);t.Providers=new $$WP.Common.ModelCollection;t.TeamProviders=new $$WP.Common.ModelCollection;t.Locations=new $$WP.Common.ModelCollection;t.Lqfs=new $$WP.Common.ModelCollection;t.VisitTypeSource=f.Default},e={s_dataMembers:[u,r,"Providers","Locations","SchedulingOverride","Lqfs","OriginalVisitTypeId","IsLqfChainStopped","Orders","AddToWaitList","SearchStartDte"],VisitType:n,VisitTypeSource:n,PanelId:"",Providers:n,IsProviderAnyOptionSelected:t,Locations:n,IsLocationAnyOptionSelected:t,ProviderDepartmentPairs:[],Slot:n,SchedulingOverride:n,Lqfs:n,OriginalVisitTypeId:"",IsLqfChainStopped:t,TicketId:"",Orders:[],RescheduleDat:"",AddToWaitList:t,SearchStartDte:"",getSelectedDepartmentsCollection:function(){var n,t,i,r,u,f;for(i=new $$WP.Common.ModelCollection,r=this.Locations.toArray(),n=0;n<r.length;n++)for(u=r[n],t=0;t<u.Departments.length;t++)f=u.Departments[t],i.contains(f)||i.add(f);return i},hasALocationSelected:function(){return this.Locations.size()>0},hasAProviderSelected:function(){return this.Providers.size()>0},hasASlotSelected:function(){return!!this.Slot},setVisitTypeWithSource:function(n,t,i){this.setProperty(r,t);this.setProperty("PanelId",i);this.setProperty(u,n)},toRawRequestObject:function(){var n=this;return{VisitTypeId:!n.VisitType?"":n.VisitType.ID,PanelId:n.PanelId,RescheduleDat:n.RescheduleDat,TicketId:n.TicketId,ProviderDepartmentPairs:n.__providerDepartmentPairsToRawRequestObject(),Slot:!n.Slot?"":n.Slot.toRawObject(),OrderIds:n.__ordersToRawRequestObject(),LqfIds:!n.SchedulingOverride?[]:n.SchedulingOverride.LqfIds,OriginalVisitTypeId:n.OriginalVisitTypeId,AddToWaitList:n.AddToWaitList,SearchStartDte:n.SearchStartDte}},__providerDepartmentPairsToRawRequestObject:function(){for(var t=[],n=0;n<this.ProviderDepartmentPairs.length;n++)t.push(this.ProviderDepartmentPairs[n].toRawRequestObject());return t},__ordersToRawRequestObject:function(){for(var t=[],n=0;n<this.Orders.length;n++)t.push(this.Orders[n].ID);return t}};i.prototype=e;i.VisitTypeSourceEnum=f;$$WP.Scheduling=$$WP.Scheduling||{};$$WP.Scheduling.Appointment=i;i.extend($$WP.Common.Model,"WP$Scheduling$Appointment")}(),function(){var t=!0,n=null,r="VisitType",u=$$WP.Scheduling.Appointment,i=function(t){var i=[r];this.WP$Common$Model(t);this.Appointments=new $$WP.Common.ModelCollection(n,i);this.Appointments.add(new $$WP.Scheduling.Appointment)},f={s_dataMembers:["ReasonForVisit","Appointments","UseInsuranceForVisit","UseTeams","OnDemandReasonForVisitValue","PatientLocationId","PatientSublocationId","TopicId"],ReasonForVisit:n,Appointments:n,UseInsuranceForVisit:"",UseTeams:!1,OnDemandReasonForVisitValue:"",PatientLocationId:"",PatientSublocationId:"",TopicId:"",numAppointments:function(){return this.Appointments.size()},getAppointment:function(n){return this.Appointments.Models[n]},getFirstAppointment:function(){return this.getAppointment(this.getFirstAppointmentIndex())},getFirstAppointmentIndex:function(){var i=this.__getAppointmentSlotsArray(),u=n,t=0,r=-1;if(i.length===0)r=0;else for(i.sort($$WP.Scheduling.Slot.slotSortFunction),t=0;t<this.numAppointments();t++)u=this.getAppointment(t),i[0]===u.Slot&&(r=t);return r},getTotalLengthInMinutes:function(){var u=0,f=this.getFirstAppointment(),e=n,t=n,i=n,r=0,o=[],s=n;if(this.numAppointments()===1)!f.Slot||(u=f.Slot.LengthInMinutes);else{for(e=f.Slot.DateTimeUtc,o=this.__getAppointmentSlotsArray(),r=0;r<o.length;r++)s=o[r],t=new Date(s.DateTimeUtc.getTime()),t.setMinutes(t.getMinutes()+s.LengthInMinutes),(i===n||t>i)&&(i=t);e!==n&&i!==n&&(u=Math.floor((i-e)/6e4))}return u},areLocationsGrouped:function(){var n=this.getFirstAppointment().Locations.toArray()[0];return!n?t:!n.IsSingleDepartment},showAsMultipleVisits:function(i){var r=!1,f=n,u="",e=n;return this.numAppointments()<2?r=!1:(f=this.getAppointment(0),u=f.PanelId,$$WPUtil.IsNullOrEmpty(u)?r=t:(e=i.getFromIndex("ID",u),r=this.__showPanelAsMultipleVisits(e))),r},__showPanelAsMultipleVisits:function(n){var t=this.__getAppointmentSlotsArray(),i=n.ShowPanelAsMultipleVisits,r=$$WP.Scheduling.Slot.areAllSlotsOnTheSameDay(t);return i||!r},__getAppointmentSlotsArray:function(){for(var r=[],i=n,t=0,t=0;t<this.numAppointments();t++)i=this.getAppointment(t).Slot,!i||r.push(i);return r},allAppointmentsHaveAVisitTypeSpecified:function(){for(var n=0,i=t,n=0;n<this.numAppointments();n++)i=i&&!!this.getAppointment(n).VisitType;return i},allAppointmentsHaveALocationSelected:function(){for(var n=0,i=t,n=0;n<this.numAppointments();n++)i=i&&this.getAppointment(n).hasALocationSelected();return i},allAppointmentsHaveAProviderSelected:function(){for(var n=0,i=t,n=0;n<this.numAppointments();n++)i=i&&this.getAppointment(n).hasAProviderSelected();return i},allAppointmentsHaveASlotSelected:function(){for(var n=0,i=t,n=0;n<this.numAppointments();n++)i=i&&this.getAppointment(n).hasASlotSelected();return i},updateAppointmentsCollectionForVisitType:function(n,t,i,r){var u=this;u.Appointments.openChangeBatch();u.__populateAppointmentsCollectionFromVisitType(n,i);u.__applyWorkflowFlagsToAppointments(r);u.Appointments.closeChangeBatch()},__populateAppointmentsCollectionFromVisitType:function(t,i){var u=this,f=0,r=0,e=n,s=n,o=n;if(!!t&&t.IsPanel)for(e=t,f=e.PanelComponents.length,r=0;r<f;r++)s=e.PanelComponents[r],r===u.numAppointments()&&u.Appointments.add(new $$WP.Scheduling.Appointment),o=u.getAppointment(r),o.setVisitTypeWithSource(s,i,e.ID);else f=1,o=u.getAppointment(0),o.setVisitTypeWithSource(t,i,"");u.__trimAppointments(f)},__trimAppointments:function(n){var t=this,r=[],i=0;if(t.numAppointments()>n){for(i=n;i<t.numAppointments();i++)r.push(t.getAppointment(i));t.Appointments.removeRange(r)}},__applyWorkflowFlagsToAppointments:function(t){var r=0,i=n;if(!!t)for(r=0;r<this.numAppointments();r++){i=this.getAppointment(r);switch(t.Type){case $$WP.Scheduling.Workflow.WorkflowTypesEnum.DecisionTreeNode:i.SchedulingOverride=$$WP.Scheduling.SchedulingOverride.getDecisionTreeNodeWorkflowOverride(t.SchedulingDataPool.SchedulingOverrides,t.DecisionTreeNodeId,t.DecisionTreeNodeCsn);break;case $$WP.Scheduling.Workflow.WorkflowTypesEnum.Ticket:i.TicketId=t.TicketInfo.TicketId;i.Orders=t.TicketInfo.Orders;break;case $$WP.Scheduling.Workflow.WorkflowTypesEnum.Reschedule:i.RescheduleDat=t.OriginalAppointment.Dat}}},resetAppointmentsCollection:function(){for(var t=0,f=this.Appointments.toArray(),e=[],i=n,t=0;t<f.length;t++)i=f[t],i.setProperty(r,n),i.setProperty("VisitTypeSource",u.VisitTypeSourceEnum.Default),t>0&&e.push(i);this.Appointments.removeRange(e)},toRawRequestObject:function(){var n=this;return{Appointments:n.__appointmentsToRawRequestObject(),ReasonForVisitLine:!n.ReasonForVisit?"":n.ReasonForVisit.Id,ReasonForVisitValue:!n.ReasonForVisit?"":n.ReasonForVisit.CategoryValue,UseInsuranceForVisit:n.UseInsuranceForVisit,OnDemandReasonForVisitValue:n.OnDemandReasonForVisitValue,PatientLocationId:n.PatientLocationId,PatientSublocationId:n.PatientSublocationId,TopicId:n.TopicId}},__appointmentsToRawRequestObject:function(){for(var t=this.Appointments.toArray(),i=[],n=0;n<t.length;n++)i.push(t[n].toRawRequestObject());return i}};i.prototype=f;$$WP.Scheduling=$$WP.Scheduling||{};$$WP.Scheduling.AppointmentBuilder=i;i.extend($$WP.Common.Model,"WP$Scheduling$AppointmentBuilder")}(),function(){var n=null,i=$$WP.Common.ModelCollection,t=function(n){this.WP$Common$Model(n);this.ID||this.ID===0||$$WP.Debug.logError("A department was created from a raw object that did not contain an ID: "+JSON.stringify(n))},r={s_dataMembers:["ID","Name","Address","PhoneNumber","TimeZone","FromMinutesOffset","FromDaysOffset","ToDaysOffset","AllowRescheduleComments","AllowTeamScheduling"],ID:n,Name:n,Address:n,PhoneNumber:n,TimeZone:n,FromMinutesOffset:n,FromDaysOffset:n,ToDaysOffset:n,AllowRescheduleComments:n,AllowTeamScheduling:n},u=function(i,r){var e,u,f,o;if(o=[],Array.isArray(i))for(e=0;e<i.length;e++)(u=i[e],typeof u=="object"&&typeof u.ID!="undefined")&&(f=r.getFromIndex("ID",u.ID),f===n&&(f=new t(u),r.add(f)),o.push(f));return o},f=function(){return new i(e)},e=[{propertyNames:"ID",storeAs:"single"},{propertyNames:"LocationId",storeAs:"array"}];t.prototype=r;t.convertRawDepartments=u;t.createDepartmentsCollection=f;$$WP.Scheduling=$$WP.Scheduling||{};$$WP.Scheduling.Department=t;t.extend($$WP.Common.Model,"WP$Scheduling$Department")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var u=!0,f="Scheduling",i=!1,n=null,o="IsStandardProvider",s="NameLastFirst",r="ID",y=$$WP.Common.ModelCollection,t=function(n){var t=this;t.WP$Common$Model(n);t.ListDisplayName=v!==c.LastNameFirst||$$WP.Utilities.IsNullOrEmpty(t.NameLastFirst)?t.Name:t.NameLastFirst;t.State=h.Unselected;t.TeamOriginProviders=[]},p={s_dataMembers:[r,"Name",s,"PcpType","Specialties","Photo",o,"PhotoClass","TeamProviders","IsPCP","IsPrimaryCare","OtherOption","AnyOption","AllowedTelemedicineLocations"],ID:n,Name:n,NameLastFirst:n,ListDisplayName:n,PcpType:n,Specialties:n,Photo:n,IsStandardProvider:n,PhotoClass:n,ViewState:n,State:n,StandardDepartments:n,TeamProviders:n,IsPCP:n,IsPrimaryCare:i,TeamOriginProviders:n,OtherOption:i,AutoSelectedForHiddenStep:i,AnyOption:i,AllowedTelemedicineLocations:n},h={Selected:0,Unselected:1},c={ExternalName:1,LastNameFirst:2},w=function(e,o,s){var l,c,h,a;for(s&&(v=s),a=[],l=0;l<e.length;l++)(c=e[l],typeof c=="object"&&typeof c.ID!="undefined")&&(h=o.getFromIndex(r,c.ID),h===n&&(h=new t(c),o.add(h)),a.push(h));return h=new t({ID:-2,Name:$$WP.Strings.getNamespace(f).getString("AnyProviderHeader"),Specialties:[{Title:$$WP.Strings.getNamespace(f).getString("AnyProviderDescription")}],AnyOption:u,TeamProviders:[],IsPCP:i}),o.add(h),a.push(h),a},b=function(t){for(var u,i,e,f=0;f<t.size();f++)if(i=t.Models[f],i.TeamProviders!==n)for(u=0;u<i.TeamProviders.length;u++)e=t.getFromIndex(r,i.TeamProviders[u].ProviderId),e.TeamOriginProviders.push(i)},k=function(){return new y(ft,et)},d=function(t,f,e,o,s,h){var a=n,c=n,b=n,k=n,v=n,y=[],p={},d=[],w="",it=n;a=g();t.add(a);c=nt();f.add(c);b=l(c,u);e.add(b);k=l(c,i);e.add(k);p=tt(o,h);for(w in p)d=p[w],it=f.getFromIndex(r,w),v=$$WP.Scheduling.ProviderDepartmentPair.createProviderDepartmentPair(a,it,[],d),o.add(v);y=$$WP.Scheduling.ReasonForVisit.getRequestableRfvs(s);y.length>0&&(v=$$WP.Scheduling.ProviderDepartmentPair.createProviderDepartmentPair(a,c,[],y),o.add(v))},g=function(){return new t({ID:"-1",Name:$$WP.Strings.getNamespace(f).getString("OtherProviderHeader"),OtherOption:u,Specialties:[{TitleUtf8:$$WP.Strings.getNamespace(f).getString("OtherProviderDescription")}],IsStandardProvider:i,TeamProviders:[],IsPCP:i})},nt=function(){return new $$WP.Scheduling.Department({ID:"-1",Name:""})},l=function(n,t){var r=t?"-2":"-3",i=new $$WP.Scheduling.Location(r,"","","","",[n.ID]);return i.Departments=[n],i.OtherOption=u,i.IsSingleDepartment=!t,i},tt=function(t,i){for(var s=t.toArray(),u=0,f=n,r="",e={},o=[],u=0;u<s.length;u++)f=s[u],r=f.DepartmentId,Array.isArray(e[r])||(e[r]=[]),o=e[r],a(f.AllowedRequestReasonsForVisit,r,i,o),a(f.AllowedDirectScheduleReasonsForVisit,r,i,o);return e},a=function(t,i,r,u){for(var f=0,e=n,f=0;f<t.length;f++)e=t[f],u.indexOf(e)===-1&&$$WP.Scheduling.ReasonForVisit.isRfvRequestableInDepartment(e,i,r)&&u.push(e)},it=function(n,t){return e(n,t,"Name")},rt=function(n,t){return e(n,t,s)},ut=function(n,t){return e(n,t,"ListDisplayName")},e=function(n,t,i){return n.OtherOption?1:t.OtherOption?-1:n.AnyOption?-1:t.AnyOption?1:n.IsPCP&&!t.IsPCP?-1:t.IsPCP&&!n.IsPCP?1:n[i].toUpperCase()<t[i].toUpperCase()?-1:n[i].toUpperCase()>t[i].toUpperCase()?1:0},ft=[{propertyNames:"State",storeAs:"set"},{propertyNames:r,storeAs:"single"},{propertyNames:o,storeAs:"array"}],et=["State","ViewState"],v=n;t.prototype=p;t.convertRawProviders=w;t.createProviderCollection=k;t.StatesEnum=h;t.dereferenceIds=b;t.addOtherOption=d;t.sortProviders=it;t.sortProvidersByLastName=rt;t.sortProvidersByListDisplayName=ut;t.NameDisplayFormatEnum=c;$$WP.Scheduling=$$WP.Scheduling||{};$$WP.Scheduling.Provider=t;t.extend($$WP.Common.Model,"WP$Scheduling$Provider")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var r=!0,u="ID",f="Id",i=!1,t=null,h=$$WP.Common.ModelCollection,n=function(n,t,i,r){var u=this;u.WP$Common$Model();u.Id=n;u.Name=t;u.Address=i;u.DepartmentIds=r.slice();u.Departments=[];u.State=e.Unselected},c={Id:t,Name:t,Address:t,DepartmentIds:t,Departments:t,IsSingleDepartment:i,ViewState:t,State:t,IsAnyOption:i,OtherOption:i},e={Selected:0,Unselected:1},l=function(e,o,s){var k="Scheduling",w,c,l,h,v,y,p,a,b;if(v=[],Array.isArray(e)){for(w=0;w<e.length;w++)if(l=e[w],typeof l=="object"&&typeof l.ID!="undefined"){if(h=o.getFromIndex(f,l.ID),h===t){for(h=new n(l.ID,l.Name,l.Address,l.DepartmentIds),c=0;c<h.DepartmentIds.length;c++)y=s.getFromIndex(u,h.DepartmentIds[c]),y!==t&&h.Departments.push(y);if(h.IsSingleDepartment=i,h.Address===t)if(h.Departments.length===1)h.Address=h.Departments[0].Address;else if(h.Departments.length>1){for(b=r,c=1;c<h.Departments.length;c++)if(h.Departments[c-1].Address.toString().toLowerCase()!==h.Departments[c].Address.toString().toLowerCase()){b=i;break}b&&(h.Address=h.Departments[0].Address)}o.add(h)}v.push(h)}p=s.getIndex(u);for(a in p)h=new n("DEP^"+p[a].ID,p[a].Name,p[a].Address,[a]),h.IsSingleDepartment=r,y=s.getFromIndex(u,a),h.Departments.push(y),o.add(h);v.push(h);h=new n("-1",$$WP.Strings.getNamespace(k).getString("AnyLocationHeader"),[$$WP.Strings.getNamespace(k).getString("AnyLocationDescription")],[]);h.IsAnyOption=r;o.add(h);v.push(h)}return v},a=function(n,t){var s,l,o,h,c,e;l=t.getIndex(u);o=n.getIndex(f);h={};for(e in o)if(!o[e].IsSingleDepartment)for(s=0;s<o[e].Departments.length;s++)h[o[e].Departments[s].ID]=r;c=r;for(e in l)if(!h[e]){c=i;break}return c},v=function(){return new h(w,b)},y=function(n,i,r){var u=t;return r?o(n,i):s(n,i)},o=function(n,t){for(var r=0,i,u=t.toArray(),r=0;r<u.length;r++)if(i=u[r],!i.IsSingleDepartment&&i.Id!=="-1"&&i.Departments.indexOf(n)!==-1)return i},s=function(n,t){var i="DEP^"+n.ID;return t.getFromIndex(f,i)},p=function(n,t){return n.IsAnyOption?-1:t.IsAnyOption?1:n.Name.toUpperCase()<t.Name.toUpperCase()?-1:1},w=[{propertyNames:"State",storeAs:"set"},{propertyNames:f,storeAs:"single"}],b=["State","ViewState"];n.prototype=c;n.areAllDepartmentsGrouped=a;n.convertRawLocations=l;n.createLocationCollection=v;n.getLocationFromDepartment=y;n.getGroupedLocationThatContainsDepartment=o;n.getUngroupedLocationThatContainsDepartment=s;n.sortLocations=p;n.StatesEnum=e;$$WP.Scheduling.Location=n;n.extend($$WP.Common.Model,"WP$Scheduling$Location")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var i="State",r=$$WP.Common.ModelCollection,n=function(n,i,r,u){var f=this;f.WP$Common$Model();f.Id=n;f.Name=i;f.State=r||t.Unselected;f.SelectedByDefault=u;f.SubLocations=[]},o={Id:null,Name:null,SubLocations:r,LocationName:null,SelectedByDefault:!1,setLocationName:function(){var t=this,r=t.SubLocations.getFirstInIndex(i,n.StatesEnum.Selected);t.LocationName=r?r.Name:t.Name}},t={Selected:0,Unselected:1,SelectedUnavailable:2},u="fakelocation",f=function(){return new r(s,h)},e=function(i,r,o){var h,s,c,l=!1,a=[],v,y;if(Array.isArray(i)){if(i=i.sort(function(n,t){return n.Title>t.Title?1:n.Title<t.Title?-1:0}),o){for(h=0;h<i.length&&!l;h++)s=i[h],l=l||s.SelectedByDefault;c=new n(u,$$WP.Strings.get("SelectLocationDefault","ondemandtelehealth"),t.Unselected,!l);r.add(c);a.push(c)}for(h=0;h<i.length;h++)s=i[h],y=o?"TelehealthStateNameOverride":"TelehealthCountryNameOverride",v=$$WP.Strings.get(y+"_"+s.Number,"OnDemandTelehealth")||s.Title,c=new n(s.Number,v,t.Unselected,s.SelectedByDefault),s.SubLocations&&!o&&(c.SubLocations=f(),s.SubLocations.length>0&&e(s.SubLocations,c.SubLocations,!0)),r.add(c),a.push(c)}return a},s=[{propertyNames:i,storeAs:"set"},{propertyNames:"Id",storeAs:"single"}],h=[i];n.prototype=o;n.createTelehealthLocationCollection=f;n.convertRawTelehealthLocations=e;n.StatesEnum=t;n.FakeLocationId=u;$$WP.Scheduling.TelehealthLocation=n;n.extend($$WP.Common.Model,"WP$Scheduling$TelehealthLocation")}(),function(){var u="single",n=null,t=!1,h="Provider",c="TelehealthSelectedPlatformString",r="TelehealthSelectedPlatform",o="TelehealthLoaded",l="HadConnectionFailure",a="QuickScheduleSlotIndex",f="IsOrgSelectionComplete",s="SelectedWorkflow",v="QuickScheduleSlot",e="IsHardwareTestComplete",i=function(){this.WP$Common$Model();this.initializeSelectedPlatform()},y={s_dataMembers:["IsXOrgEnabled",e,v,s,f,a,l,o,"ShouldShowHardwareTest","ShouldShowMobileInfo",r,c,h],TelehealthLoaded:t,IsXOrgEnabled:t,IsHardwareTestComplete:t,SelectedWorkflow:n,QuickScheduleSlot:n,QuickScheduleSlotIndex:-1,NotificationSettings:n,NotificationSelection:n,ShouldSaveNotifications:t,IsOrgSelectionComplete:t,HadConnectionFailure:t,ShouldShowHardwareTest:t,ShouldShowMobileInfo:t,TelehealthSelectedPlatform:n,TelehealthSelectedPlatformString:n,AutoSelectedWorkflow:n,Provider:n,resetData:function(){var i=this;i.setProperty(e,t);i.setProperty(v,n);i.setProperty(a,-1);i.AutoSelectedWorkflow===n&&i.setProperty(s,n);i.setProperty("NotificationSelection",n);i.setProperty("ShouldSaveNotifications",n);i.setProperty(l,t);i.setProperty(f,t);i.setProperty(c,n);i.setProperty(h,n);i.initializeSelectedPlatform()},initializeSelectedPlatform:function(){WP.DOM.Browser.isMobile?this.setProperty(r,"2"):this.setProperty(r,n)},autoSelectQueueing:function(){this.setProperty(s,i.TelehealthWorkflow.Queueing);this.setProperty("AutoSelectedWorkflow",i.TelehealthWorkflow.Queueing)}},p,w;i.TelehealthWorkflow={Queueing:0,QuickSchedule:1,SlotSelection:2};p=[{propertyNames:e,storeAs:u},{propertyNames:f,storeAs:u},{propertyNames:r,storeAs:u},{propertyNames:o,storeAs:u}];w=[e,f,r,o];i.prototype=y;$$WP.Scheduling=$$WP.Scheduling||{};$$WP.Scheduling.TelehealthData=i;i.extend($$WP.Common.Model,"WP$Scheduling$TelehealthData")}(),function(){function f(n,t){return n===t?0:n<t?-1:1}var t=",",r=null,l="ondemandtelehealth",n=function(){},e={Web:"1",Mobile:"2"},a=[],o={},s,h,c;$$WP&&$$WP.Strings&&($$WP.Strings.setDefaultNamespace(l),s={Value:e.Mobile,Label:$$WP.Strings.getForTemplate("TelehealthMobileDevice"),Title:$$WP.Strings.getForTemplate("TelehealthMobileDeviceTooltip")},h={Value:e.Web,Label:$$WP.Strings.getForTemplate("TelehealthWebBrowser"),Title:$$WP.Strings.getForTemplate("TelehealthWebBrowserTooltip")},$$WP.Strings.clearDefaultNamespace(),a.push(h,s),o[e.Web]=h,o[e.Mobile]=s);n.GetPlatformString=function(n){if(n){var t=o[n];if(t)return t.Label}return""};var u={ShortestWait:"time",LowestCost:"cost",Suggested:"suggested"},p=6,v=[];$$WP&&$$WP.Strings&&($$WP.Strings.setDefaultNamespace(l),v=[{Value:u.Suggested,Label:$$WP.Strings.getForTemplate("TelehealthSuggestedLabel"),Title:$$WP.Strings.getForTemplate("TelehealthSuggestedTitle")},{Value:u.ShortestWait,Label:$$WP.Strings.getForTemplate("TelehealthShortestWaitLabel"),Title:$$WP.Strings.getForTemplate("TelehealthShortestWaitTitle")},{Value:u.LowestCost,Label:$$WP.Strings.getForTemplate("TelehealthLowestCostLabel"),Title:$$WP.Strings.getForTemplate("TelehealthLowestCostTitle")}],$$WP.Strings.clearDefaultNamespace());n.DoSortAndFilter=function(n,t){switch(t){case u.ShortestWait:n.sort(function(n,t){return f(n.GetWaitTime(),t.GetWaitTime())});break;case u.LowestCost:n.sort(function(n,t){return f(n.GetEstimatedCost(),t.GetEstimatedCost())});break;case u.Suggested:n.sort(function(n,t){var i,r;return n.IsLocal&&!t.IsLocal?-1:t.IsLocal&&!n.IsLocal?1:(i=f(n.IsUnconnected(),t.IsUnconnected()),i)?i:(r=f(n.GetWaitTimeBucket(),t.GetWaitTimeBucket()),r?r:f(n.GetEstimatedCost(),t.GetEstimatedCost()))})}return n.splice(p,n.length),n};var w=function(n,t){for(var e,f,u=n.split(";"),i=0;i<u.length;i+=1)if(f=u[i].split(":"),e=f[0].split("^")[0],e===t.Id)return f;return r},y=function(n,t){return n!==r&&(n+"|").indexOf("|"+t+"|")!==-1},b=function(n,i){for(var e,f=n.split(t),u=0;u<f.length;u++)if(e=f[u].split("^"),e[0]===i.Id)return e[1];return r};n.IsInLicensedLocation=function(n,i,u,f,e){var o,s,h,c,l;return(n===r&&(n=""),s=w(n,i),s===r)?!1:(o=s[0].split("^")[1],!e&&(o===undefined||o.length===0))?!1:u?(h=s[1],h.length===0)?!0:(c=t+h+t,l=c.indexOf(t+u.Id+t)!==-1||c.indexOf(t+u.Id+"^")!==-1,l&&f!==undefined&&!e?(o=b(h,u),y(o,f)):l):f!==undefined&&!e?y(o,f):!0};n.IsRFVEnabledForPlatformAtLocation=function(t,i,r,u,f){return(t.EnabledForQuickSchedule||n.IsInLicensedLocation(t.AllowedTelemedicineLocations,r,u,i))&&(n.IsRFVEnabledForQuickSchedule(t,i)||n.IsRFVEnabledForOnDemand(t,i,f))};n.IsRFVEnabledForPlatform=function(t,i,r){return n.IsRFVEnabledForQuickSchedule(t,i)||n.IsRFVEnabledForOnDemand(t,i,r)};n.IsRFVEnabledForQuickSchedule=function(n,t){return n&&n.EnabledForQuickSchedule&&$$WP.Scheduling.TelehealthFilters.ContainsPreferredPlatform(n.AvailablePlatformsForLocalQuickSchedule,t)};n.FilterProvidersByLocation=function(t,r,u){var e=[],o=0,f;for(i=0;i<t.length;i++)f=t[i],n.IsProviderEnabledAtLocation(f,r,u)&&(e[o]=f,o+=1);return e};n.IsProviderEnabledAtLocation=function(t,i,u){var f=t.AllowedTelemedicineLocations;return n.IsInLicensedLocation(f,i,u,r,!0)};n.IsRFVEnabledForOnDemand=function(n,t,i){return n&&n.EnabledForOnDemandVideoVisits&&(n.ExternallyAvailableForTelehealth&&i||n.InternallyAvailableForTelehealth&&$$WP.Scheduling.TelehealthFilters.ContainsPreferredPlatform(n.AvailablePlatformsForLocalOnDemand,t))};n.ContainsPreferredPlatform=function(n,i){return n?n.indexOf(t+i+t)>-1:!1};c=function(n){return n&&n.length>0};n.DoesRFVHaveAnyAvailablePlatforms=function(n){return c(n.AvailablePlatformsForLocalQuickSchedule)||c(n.AvailablePlatformsForLocalOnDemand)};n.Filters=v;n.PlatformFilters=a;n.PlatformFilterValueEnum=e;$$WP.Scheduling=$$WP.Scheduling||{};$$WP.Scheduling.TelehealthFilters=n}(),function(){var n=function(n,t,i,r){var u=this;u.WP$Common$Model();u.SendSMS=n;u.SendEmail=t;u.PhoneNumber=i;u.EmailAddress=r};n.prototype={SendSMS:!1,SendEmail:!1,PhoneNumber:null,EmailAddress:null};$$WP.Scheduling.TelehealthNotificationSelection=n;n.extend($$WP.Common.Model,"WP$Scheduling$TelehealthNotificationSelection")}(),function(){var n=!1,t=function(n,t,i,r,u,f,e){var o=this;o.WP$Common$Model();o.ShowEmailOption=n;o.ShowSMSOption=t;o.CheckSMSOption=r;o.CheckEmailOption=i;o.PhoneNumber=u;o.EmailAddress=f;o.IsPushNotificationEnabled=e},i={s_dataMembers:["ShowEmailOption","ShowSMSOption","CheckEmailOption","CheckSMSOption","EmailAddress","PhoneNumber","IsPushNotificationEnabled"],ShowEmailOption:n,ShowSMSOption:n,CheckEmailOption:n,CheckSMSOption:n,EmailAddress:null,PhoneNumber:null,IsPushNotificationEnabled:n};t.prototype=i;$$WP.Scheduling.TelehealthNotificationSettings=t;t.extend($$WP.Common.Model,"WP$Scheduling$TelehealthNotificationSettings")}(),function(){function r(n){var t;return t=Math.floor(n/60),n%=60,t+=Math.floor(n/15)*.25,n%15!=0&&(t+=.25),t}function c(n,t){var i="@MYCHART@WaitTime@",r;return $$WP.Strings.addMnemonic(i,t,f,o),r=$$WP.Strings.get(n,o),$$WP.Strings.removeMnemonic(i),r}var h="State",t=null,l="NeedsH2GConsent",a="Disabled",v="OrganizationId",o="ondemandtelehealth",f=!1,u=5,e=5,b=$$WP.Common.ModelCollection,s={Selected:0,Unselected:1,SelectedUnavailable:2,SelectionMade:3},y=function(n){return n.MaxCost||Infinity},p=function(n){return n.EstimatedWaitTime?n.EstimatedWaitTime:Infinity},w=function(t){return t.EstimatedWaitTime?n(t.EstimatedWaitTime):Infinity},n=function(n){var t;return t=Math.floor(n/e)*e,t<u?t=Math.floor((u-1)/e)*e:n%e!=0&&(t+=e),t},i=function(n){var t=this;t.WP$Common$Model(n);t.State=s.Unselected;t.CostDisplayString||(t.CostDisplayString=$$WP.Strings.get("TelehealthEstimatedCostNotAvailable",o));t.EstimatedWaitTime===0&&(t.EstimatedWaitTime=u-1);t._processWaitTime()},k={s_dataMembers:[v,"OrganizationName","LogoUrl","IsLocal","EstimatedWaitTime","CostDisplayString","AllowedLocationsString","EstimatedWaitTimeDisplayString","MaxCost","ShortestWait","Suggested","BestValue",a,"TermsAndConditionsUrl","ProxyTermsAndConditionsUrl",l,"AvailablePlatformsString"],TermsAndConditionsUrl:t,ProxyTermsAndConditionsUrl:t,NeedsH2GConsent:f,OrganizationId:t,OrganizationName:t,LogoUrl:t,IsLocal:t,EstimatedWaitTime:t,CostDisplayString:t,Disabled:f,State:t,MaxCost:t,AllowedLocationsString:"",AvailablePlatformsString:"",EstimatedWaitTimeDisplayString:t,ShortestWait:f,BestValue:f,Suggested:f,_processWaitTime:function(){var i=this;i.EstimatedWaitTime===t||i.EstimatedWaitTime===undefined?i.EstimatedWaitTimeDisplayString=$$WP.Strings.get("WaitTimeNotAvailable",o):i.EstimatedWaitTime<u?i.EstimatedWaitTimeDisplayString=c("WaitTimeSoon",i.EstimatedWaitTime):i.EstimatedWaitTime<=60?i.EstimatedWaitTimeDisplayString=c("WaitTimeMinutes",n(i.EstimatedWaitTime)):i.EstimatedWaitTime>60&&(i.EstimatedWaitTimeDisplayString=c("WaitTimeHours",r(i.EstimatedWaitTime)))},GetEstimatedCost:function(){return y(this)},GetWaitTime:function(){return p(this)},GetWaitTimeBucket:function(){return w(this)},IsUnconnected:function(){return this.NeedsH2GConsent?1:0},ConsentCaptured:function(){return!this.NeedsH2GConsent},IsInLicensedLocation:function(n,t){return $$WP.Scheduling.TelehealthFilters.IsInLicensedLocation(this.AllowedLocationsString,n,t)},ContainsPreferredPlatform:function(n){return $$WP.Scheduling.TelehealthFilters.ContainsPreferredPlatform(this.AvailablePlatformsString,n)}},d=[{propertyNames:h,storeAs:"set"},{propertyNames:v,storeAs:"single"}],g=[h,l,a],nt=[{propertyName:h,value:s.Selected,bumpToValue:s.Unselected}],tt=function(){return new b(d,g,nt)},it=function(n,t){var f=[],u,r;if(Array.isArray(n))for(r=0;r<n.length;r++)u=new i(n[r]),t.add(u),f.push(u);return f};i.prototype=k;i.createTelehealthOrganizationCollection=tt;i.convertRawTelehealthOrganizations=it;i.StatesEnum=s;i.GetOrgEstimatedCost=y;i.GetOrgWaitTimeBucket=w;i.GetOrgWaitTime=p;$$WP.Scheduling=$$WP.Scheduling||{};$$WP.Scheduling.TelehealthOrganization=i;i.extend($$WP.Common.Model,"WP$Scheduling$TelehealthOrganization");$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var t=$$WP.Debug.UnitTest.assert;u=5;t(n(0)===0,"0 minutes bucketed wrong by minutes (MIN: 5)");t(n(1)===0,"1 minutes bucketed wrong by minutes (MIN: 5)");t(n(5)===5,"5 minutes bucketed wrong by minutes (MIN: 5)");t(n(6)===10,"6 minutes bucketed wrong by minutes (MIN: 5)");t(n(10)===10,"10 minutes bucketed wrong by minutes (MIN: 5)");t(n(11)===15,"15 minutes bucketed wrong by minutes (MIN: 5)");t(n(60)===60,"60 minutes bucketed wrong by minutes (MIN: 5)");u=25;t(n(0)===20,"0 minutes bucketed wrong by minutes (MIN: 25)");t(n(1)===20,"1 minutes bucketed wrong by minutes (MIN: 25)");t(n(5)===20,"5 minutes bucketed wrong by minutes (MIN: 25)");t(n(6)===20,"6 minutes bucketed wrong by minutes (MIN: 25)");t(n(10)===20,"10 minutes bucketed wrong by minutes (MIN: 25)");t(n(11)===20,"15 minutes bucketed wrong by minutes (MIN: 25)");t(n(20)===20,"20 minutes bucketed wrong by minutes (MIN: 25)");t(n(24)===20,"24 minutes bucketed wrong by minutes (MIN: 25)");t(n(25)===25,"25 minutes bucketed wrong by minutes (MIN: 25)");t(n(60)===60,"60 minutes bucketed wrong by minutes (MIN: 25)");u=5});$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert;n(r(0)===0,"0 minutes bucketed wrong by hours");n(r(30)===.5,"30 minutes bucketed wrong by hours");n(r(60)===1,"60 minutes bucketed wrong by hours");n(r(65)===1.25,"65 minutes bucketed wrong by hours");n(r(75)===1.25,"75 minutes bucketed wrong by hours");n(r(90)===1.5,"90 minutes bucketed wrong by hours");n(r(105)===1.75,"105 minutes bucketed wrong by hours");n(r(120)===2,"120 minutes bucketed wrong by hours")})}(),function(){var n=null,i=makeLink("Scheduling/SelectRFV"),t=function(n){this.WP$BaseObject();this._organizationCollection=n},r={_organizationCollection:n,_request:n,LoadOrganizations:function(t,r,u,f){if(this.CancelRequest(),!t.ExternallyAvailableForTelehealth){f([],t);return}this._request=$.post({url:i,data:{rfvId:t.OnDemandRFV,locationId:r.Id,sublocationId:u?u.Id:"",isAvailableLocally:t.InternallyAvailableForTelehealth},cache:!1,async:!0,success:$.proxy(function(t,i,r){this._request!==n&&(this._request=n,t(r,i))},this,f,t),failure:function(){}})},CancelRequest:function(){this._request=n}};t.prototype=r;$$WP.Scheduling.TelehealthOrganizationLoader=t;t.extend($$WP.BaseObject,"WP$Scheduling$TelehealthOrganizationLoader")}(),function(){var r="array",e="State",i=!0,u=!1,n=null,s="InitiallyHidden",h="ProviderFirst",c="ReasonForVisitFirst",l="AllowProviderSelect",a="CanRequest",v="CanDirectSchedule",y="CategoryValue",o="Scheduling",b=$$WP.Common.ModelCollection,p=$$WP.Scheduling.TelehealthOrganization,t=function(n){var t=this;t.WP$Common$Model(n);t.HelpText=t.EnabledForOnDemandVideoVisits||t.EnabledForQuickSchedule?$$WP.Strings.get("OnDemandReasonForVisitDescription_"+t.OnDemandRFV,"OnDemandTelehealth"):$$WP.Strings.get("ReasonForVisitDescription_"+t.CategoryValue,o);t.State=f.Unselected;p&&t.OnDemandOrganization&&(t.OnDemandOrganization=new p(t.OnDemandOrganization))},k={s_dataMembers:["Id",y,"Title","OnDemandRFV",v,a,"CanRequestWithoutOverrides",l,"DefaultVisitTypeId",c,h,"PhotoUrl","SortOrder","EnabledForOnDemandVideoVisits","ScheduledTelemedicineVendorId","OnDemandTelemedicineVendorId","TelemedicineHardwareTestFdiId","EnabledForQuickSchedule","LineInWDF15000","TelemedicineVisitTypeId",s,"AllowedTelemedicineLocations","InternallyAvailableForTelehealth","ExternallyAvailableForTelehealth","OnDemandOrganization","AvailablePlatformsForLocalOnDemand","AvailablePlatformsForLocalQuickSchedule"],Id:n,CategoryValue:n,Title:n,IsOtherRfv:u,OnDemandRFV:n,CanDirectSchedule:n,CanRequest:n,CanRequestWithoutOverrides:n,DefaultVisitTypeId:n,DefaultVisitType:n,AllowProviderSelect:n,ReasonForVisitFirst:n,ProviderFirst:n,PhotoUrl:n,SortOrder:n,State:n,ViewState:n,HelpText:n,EnabledForOnDemandVideoVisits:n,OnDemandTelemedicineVendorId:n,ScheduledTelemedicineVendorId:n,TelemedicineHardwareTestFdiId:n,TelemedicineVisitTypeId:n,EnabledForQuickSchedule:n,AllowedTelemedicineLocations:n,LineInWDF15000:n,InitiallyHidden:n,OnDemandOrganization:n,InternallyAvailableForTelehealth:u,ExternallyAvailableForTelehealth:u,AvailablePlatformsForLocalQuickSchedule:n,AvailablePlatformsForLocalOnDemand:n},f={Selected:0,Unselected:1},d=function(i,r){var e,u,f,o;if(o=[],Array.isArray(i)){for(r.openChangeBatch(),e=0;e<i.length;e++)(u=i[e],typeof u=="object"&&typeof u.Id!="undefined")&&(f=r.getFromIndex("Id",u.Id),f===n&&(f=new t(u),r.add(f)),o.push(f));r.closeChangeBatch()}return o},g=function(n,t){for(var i,r=0;r<n.size();r++)i=n.Models[r],i.DefaultVisitType=t.getFromIndex("ID",i.DefaultVisitTypeId)},nt=function(){return new b(ft,et,ot)},w=function(n,t){return n.IsOtherRfv||$$WPUtil.IsNullOrEmpty(n.SortOrder)?1:t.IsOtherRfv||$$WPUtil.IsNullOrEmpty(t.SortOrder)?-1:n.SortOrder-t.SortOrder},tt=function(n,t){return n.EnabledForOnDemandVideoVisits!==t.EnabledForOnDemandVideoVisits?n.EnabledForOnDemandVideoVisits?-1:1:w(n,t)},it=function(n,r,f){var e,s,h,c;for(s=new $$WP.Scheduling.VisitType({ID:-1,DisplayName:"",IsTelemedicine:u,AllowProviderSelect:i,AllowedProviderDepartmentPairs:[]}),r.add(s),e=new t({Id:-1,CategoryValue:-1,Title:$$WP.Strings.get("OtherReasonForVisitTitle",o),OnDemandRFV:u,CanDirectSchedule:u,CanRequest:i,CanRequestWithoutOverrides:i,AllowProviderSelect:i,DefaultVisitTypeId:s.ID,ReasonForVisitFirst:i,ProviderFirst:i}),e.DefaultVisitType=s,e.HelpText=$$WP.Strings.get("OtherReasonForVisitDescription",o),e.IsOtherRfv=i,n.add(e),h=0;h<f.Models.length;h++)c=f.Models[h],c.CanRequest&&(c.AllowedRequestReasonsForVisit.push(e),c.AllowedRequestReasonsForVisitSet[e.Id]=i)},rt=function(t){for(var i=0,r=n,u=[],i=0;i<t.Models.length;i++)r=t.Models[i],r.CanRequestWithoutOverrides&&u.push(r);return u},ut=function(n,t,r){var f=$$WP.Scheduling.ReasonForVisitDepartmentOverride.getOverride(n,t,r);return!!f&&(f.CanRequest===u||f.CanRequest===i)?f.CanRequest===i:n.CanRequestWithoutOverrides},ft=[{propertyNames:"Id",storeAs:"single"},{propertyNames:e,storeAs:"set"},{propertyNames:y,storeAs:r},{propertyNames:v,storeAs:r},{propertyNames:a,storeAs:r},{propertyNames:l,storeAs:r},{propertyNames:c,storeAs:r},{propertyNames:h,storeAs:r},{propertyNames:s,storeAs:r}],et=[e,"ViewState"],ot=[{propertyName:e,value:f.Selected,bumpToValue:f.Unselected}];t.prototype=k;t.StatesEnum=f;t.dereferenceIds=g;t.convertRawReasonsForVisit=d;t.createReasonForVisitCollection=nt;t.sortReasons=w;t.sortReasonsForOnDemand=tt;t.addOtherOption=it;t.getRequestableRfvs=rt;t.isRfvRequestableInDepartment=ut;$$WP.Scheduling=$$WP.Scheduling||{};$$WP.Scheduling.ReasonForVisit=t;t.extend($$WP.Common.Model,"WP$Scheduling$ReasonForVisit")}(),function(){var i="Id",t=null,r="DepartmentId",u="ProviderId",f=$$WP.Common.ModelCollection,n=function(n){var t=this,i;for(t.WP$Common$Model(n),t.Id=t.ProviderId+"^"+t.DepartmentId,t.AllowedRequestReasonsForVisitSet={},i=0;i<t.AllowedRequestReasonsForVisit.length;i++)t.AllowedRequestReasonsForVisitSet[t.AllowedRequestReasonsForVisit[i]]=!0;for(t.AllowedDirectScheduleReasonsForVisitSet={},i=0;i<t.AllowedDirectScheduleReasonsForVisit.length;i++)t.AllowedDirectScheduleReasonsForVisitSet[t.AllowedDirectScheduleReasonsForVisit[i]]=!0},e={s_dataMembers:[u,r,"AllowedDirectScheduleReasonsForVisit","AllowedRequestReasonsForVisit","IsTeam","CanRequest"],Id:"",ProviderId:"",DepartmentId:"",Provider:t,Department:t,AllowedDirectScheduleReasonsForVisit:[],AllowedRequestReasonsForVisit:[],AllowedRequestReasonsForVisitSet:t,AllowedDirectScheduleReasonsForVisitSet:t,IsTeam:!1,CanRequest:!1,toRawRequestObject:function(){return{ProviderId:this.ProviderId,DepartmentId:this.DepartmentId}}},o=function(r,u){var o,f,e,s,h;if(s=[],Array.isArray(r))for(o=0;o<r.length;o++)(f=r[o],typeof f=="object")&&(h=f.ProviderId+"^"+f.DepartmentId,e=u.getFromIndex(i,h),e===t&&(e=new n(f),u.add(e)),s.push(e));return s},s=function(n,t,r,u){for(var f,e,o,s,h=0;h<n.size();h++){for(f=n.Models[h],o=f.AllowedRequestReasonsForVisit,s=f.AllowedDirectScheduleReasonsForVisit,f.AllowedRequestReasonsForVisit=[],f.AllowedDirectScheduleReasonsForVisit=[],f.Provider=t.getFromIndex("ID",f.ProviderId),f.Department=r.getFromIndex("ID",f.DepartmentId),e=0;e<o.length;e++)f.AllowedRequestReasonsForVisit[e]=u.getFromIndex(i,o[e]);for(e=0;e<s.length;e++)f.AllowedDirectScheduleReasonsForVisit[e]=u.getFromIndex(i,s[e])}},h=function(){return new f(l)},c=function(n,i,r,u){for(var e=t,o=[],s=[],f=0,f=0;f<r.length;f++)o.push(r[f].Id);for(f=0;f<u.length;f++)s.push(u[f].Id);return e=new $$WP.Scheduling.ProviderDepartmentPair({ProviderId:n.ID,DepartmentId:i.ID,AllowedDirectScheduleReasonsForVisit:o,AllowedRequestReasonsForVisit:s}),e.Provider=n,e.Department=i,e.AllowedDirectScheduleReasonsForVisit=r,e.AllowedRequestReasonsForVisit=u,e},l=[{propertyNames:i,storeAs:"single"},{propertyNames:u,storeAs:"array"},{propertyNames:r,storeAs:"array"}];n.prototype=e;n.dereferenceIds=s;n.convertRawProviderDepartmentPairs=o;n.createProviderDepartmentPairsCollection=h;n.createProviderDepartmentPair=c;$$WP.Scheduling=$$WP.Scheduling||{};$$WP.Scheduling.ProviderDepartmentPair=n;n.extend($$WP.Common.Model,"WP$Scheduling$ProviderDepartmentPair")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var i="array",r="Id",n=null,f="CanRequest",e="CanDirectSchedule",u="VisitTypeId",o="DepartmentId",s="ReasonForVisitId",h=$$WP.Common.ModelCollection,t=function(n){var t=this;t.WP$Common$Model(n);t.Id=t.ReasonForVisitId+"^"+t.DepartmentId},c={s_dataMembers:[s,o,u,e,f,u],Id:n,ReasonForVisitId:n,DepartmentId:n,VisitTypeId:n,ReasonForVisit:n,Department:n,VisitType:n,CanDirectSchedule:n,CanRequest:n},l=function(i,u){var o,f,s,h,e;if(s=[],Array.isArray(i)){for(u.openChangeBatch(),o=0;o<i.length;o++)(e=i[o],typeof e=="object")&&(h=e.ReasonForVisitId+"^"+e.DepartmentId,f=u.getFromIndex(r,h),f===n&&(f=new t(e),u.add(f)),s.push(f));u.closeChangeBatch()}return s},a=function(n,t,i,u){for(var f,e=0;e<n.size();e++)f=n.Models[e],f.ReasonForVisit=t.getFromIndex(r,f.ReasonForVisitId),f.Department=i.getFromIndex("ID",f.DepartmentId),f.VisitType=u.getFromIndex("ID",f.VisitTypeId)},v=function(){return new h(p)},y=function(n,t,i){var u=n.CategoryValue+"^"+t;return i.getFromIndex(r,u)},p=[{propertyNames:r,storeAs:"single"},{propertyNames:s,storeAs:i},{propertyNames:o,storeAs:i},{propertyNames:e,storeAs:i},{propertyNames:f,storeAs:i},{propertyNames:u,storeAs:i}];t.prototype=c;t.dereferenceIds=a;t.convertRawReasonForVisitDepartmentOverrides=l;t.createReasonForVisitDepartmentOverridesCollection=v;t.getOverride=y;$$WP.Scheduling=$$WP.Scheduling||{};$$WP.Scheduling.ReasonForVisitDepartmentOverride=t;t.extend($$WP.Common.Model,"WP$Scheduling$ReasonForVisitDepartmentOverride")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var i=!1,n=null,r="ID",u=$$WP.Common.ModelCollection,f=$$WP.Scheduling.ProviderDepartmentPair,e=$$WP.Scheduling.Appointment,t=function(n){var t=this,i,r;for(t.WP$Common$Model(n),t.IsPanel=Array.isArray(t.PanelComponentIds)&&t.PanelComponentIds.length>0,r=t.AllowedProviderDepartmentPairs,t.AllowedProviderDepartmentPairs=[],i=0;i<r.length;i++)t.AllowedProviderDepartmentPairs.push(new f(r[i]))},o={s_dataMembers:[r,"DisplayName","IsTelemedicine","AllowProviderSelect","AllowChangeProvAndLocInResched","QuestionnaireId","DecisionTreeId","SchedulingInstructions","AllowedProviderDepartmentPairs","FromMinutesOffset","FromDaysOffset","ToDaysOffset","AllowTeamScheduling","IsAdvanced","IsDummy","CustomStepBodyKey","CustomStepHeader","CustomStepContinueButtonText","ShowPanelAsMultipleVisits","PanelComponentIds"],ID:n,DisplayName:n,IsTelemedicine:n,AllowProviderSelect:n,AllowChangeProvAndLocInResched:n,QuestionnaireId:n,DecisionTreeId:n,SchedulingInstructions:n,AllowedProviderDepartmentPairs:n,FromMinutesOffset:n,FromDaysOffset:n,ToDaysOffset:n,AllowTeamScheduling:n,IsAdvanced:i,IsDummy:i,IsPanel:i,ShowPanelAsMultipleVisits:i,PanelComponents:[],PanelComponentIds:[],CustomStepBodyKey:n,CustomStepHeader:n,CustomStepContinueButtonText:n},s=function(i,u){var o,f,e,s;if(s=[],Array.isArray(i))for(o=0;o<i.length;o++)(f=i[o],typeof f=="object"&&typeof f.ID!="undefined")&&(e=u.getFromIndex(r,f.ID),e===n&&(e=new t(f),u.add(e)),s.push(e));return s},h=function(n,t,i){for(var u,f,e,s,o=0;o<n.Models.length;o++){for(f=n.Models[o],u=0;u<f.AllowedProviderDepartmentPairs.length;u++)e=f.AllowedProviderDepartmentPairs[u],e.Provider=t.getFromIndex(r,e.ProviderId),e.Department=i.getFromIndex(r,e.DepartmentId);if(f.IsPanel)for(f.PanelComponents=[],u=0;u<f.PanelComponentIds.length;u++)s=n.getFirstInIndex(r,f.PanelComponentIds[u]),f.PanelComponents.push(s)}},c=function(){return new u(v)},l=function(t,i,r){if(i.VisitTypeSource!==e.VisitTypeSourceEnum.Default||$$WPUtil.IsNullOrEmpty(t.AppointmentBuilder.ReasonForVisit)||$$WPUtil.IsNullOrEmpty(r))return i.VisitType;var f=t.ReasonForVisitDepartmentOverrides.getFromIndex("Id",t.AppointmentBuilder.ReasonForVisit.CategoryValue+"^"+r.ID),u=n;return $$WPUtil.IsNullOrEmpty(f)||(u=f.VisitType),$$WPUtil.IsNullOrEmpty(u)&&(u=i.VisitType),u},a=function(n){var t=i,r=i;return n.IsDummy?(t=!$$WPUtil.IsNullOrEmpty(n.QuestionnaireId),r=!$$WPUtil.IsNullOrEmpty(n.DecisionTreeId),t||r):i},v=[{propertyNames:r,storeAs:"single"}];t.prototype=o;t.convertRawVisitTypes=s;t.createVisitTypeCollection=c;t.getVisitTypeForDepartment=l;t.canStartSchedulingWhenEmpty=a;t.dereferenceIds=h;$$WP.Scheduling.VisitType=t;t.extend($$WP.Common.Model,"WP$Scheduling$VisitType")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var n=null,i="DepartmentId",r="VisitTypeId",u=$$WP.Common.ModelCollection,t=function(n){var t=this;t.WP$Common$Model(n);t.Id=t.VisitTypeId+"^"+t.DepartmentId},f={s_dataMembers:[r,i,"FromMinutesOffset","FromDaysOffset","ToDaysOffset","AllowTeamScheduling"],Id:n,VisitTypeId:n,DepartmentId:n,VisitType:n,Department:n,FromMinutesOffset:n,FromDaysOffset:n,ToDaysOffset:n,AllowTeamScheduling:n},e=function(i,r){var e,u,o,s,f;if(o=[],Array.isArray(i)){for(r.openChangeBatch(),e=0;e<i.length;e++)(f=i[e],typeof f=="object")&&(s=f.VisitTypeId+"^"+f.DepartmentId,u=r.getFromIndex("Id",s),u===n&&(u=new t(f),r.add(u)),o.push(u));r.closeChangeBatch()}return o},o=function(n,t,i){for(var r,u=0;u<n.size();u++)r=n.Models[u],r.VisitType=t.getFromIndex("ID",r.VisitTypeId),r.Department=i.getFromIndex("ID",r.DepartmentId)},s=function(){return new u(h)},h=[{propertyNames:"Id",storeAs:"single"},{propertyNames:r,storeAs:"array"},{propertyNames:i,storeAs:"array"}];t.prototype=f;t.dereferenceIds=o;t.convertRawVisitTypeDepartmentOverrides=e;t.createVisitTypeDepartmentOverridesCollection=s;$$WP.Scheduling=$$WP.Scheduling||{};$$WP.Scheduling.VisitTypeDepartmentOverride=t;t.extend($$WP.Common.Model,"WP$Scheduling$VisitTypeDepartmentOverride")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var u="State",i=!1,n=null,f=$$WP.Common.ModelCollection,t=function(n){var i="numeric",t=this,u,f,o;u=(new Date).getTimezoneOffset();f=new Date(Date.UTC(1841,0,1));t.WP$Common$Model(n);t.State=r.Unselected;t.DisplayDte=t.Dte;t.YearUtc&&t.MonthUtc&&(t.DateTimeUtc=new Date(Date.UTC(t.YearUtc,t.MonthUtc-1,t.DayUtc,t.HourUtc,t.MinuteUtc)),u!==t.TimeZoneOffsetInMinutes&&(t.IsTelemedicine?(o=new Date(Date.UTC(t.DateTimeUtc.getFullYear(),t.DateTimeUtc.getMonth(),t.DateTimeUtc.getDate())),t.Hour=t.DateTimeUtc.getHours(),t.Minute=t.DateTimeUtc.getMinutes(),t.StartTime=(t.Hour*60+t.Minute)*60,t.TimeString=new Date(t.DateTimeUtc).toLocaleTimeString([],{hour:i,minute:"2-digit"}),t.DisplayDte=1+Math.floor((o-f)/864e5),t.DateString=new Date(t.DateTimeUtc).toLocaleDateString([],{weekday:"long",year:i,month:"long",day:i}),t.DaysAhead=Math.abs(WP.Utils.date2dte(new Date)-WP.Utils.date2dte(t.DateTimeUtc))):t.ShowTimeZone=!0));e[t.DisplayDte]=t.DateString},h={s_dataMembers:["Dte","InternalStartTime","DisplayDte","DateTime","YearUtc","MonthUtc","DayUtc","HourUtc","MinuteUtc","ProviderId","DepartmentId","VisitTypeId","TimeString","TimeZoneMarker","TimeZoneOffsetInMinutes","ShowTimeZone","IsTelemedicine","LengthInMinutes","Hour","Minute","DaysAhead","DateString","StartTime","IsRequest"],Dte:n,InternalStartTime:n,DisplayDte:n,StartTime:n,DateTime:n,DateTimeUtc:n,YearUtc:n,MonthUtc:n,DayUtc:n,HourUtc:n,MinuteUtc:n,ProviderId:n,DepartmentId:n,VisitTypeId:n,TimeString:n,TimeZoneMarker:n,TimeZoneOffsetInMinutes:n,ShowTimeZone:i,IsTelemedicine:n,LengthInMinutes:0,Hour:n,Minute:n,State:n,DaysAhead:n,DateString:n,IsRequest:n},c=WP.Utils.date2dte(new Date),l=function(n){return new Date(1841,0,n)},e={},r={Selected:0,Unselected:1},a=function(){return new f},v=function(){return new f(k,d,g)},o=function(n,t,i,r,u,f,e,o,s){var h="^",c=o+h+(s?"1":"");switch(n){case $$WP.Scheduling.Workflow.WorkflowTypesEnum.Ticket:return"T^"+r+h+c;case $$WP.Scheduling.Workflow.WorkflowTypesEnum.Reschedule:return"R^"+i+h+c;case $$WP.Scheduling.Workflow.WorkflowTypesEnum.DecisionTreeNode:return"DT^"+u+h+f+h+e+h+c;default:return t+h+c}},y=function(t,r){var h=t.Type,s=n,c=t.RootDecisionTreeId,l=t.DecisionTreeNodeId,a=t.DecisionTreeNodeCsn,v=!r.ReasonForVisit?"":r.ReasonForVisit.Id,y=!t.OriginalAppointment?"":t.OriginalAppointment.Dat,p=!t.TicketInfo?"":t.TicketInfo.TicketId,f=[],e="",u=0;for(s=r.getAppointment(0),f=s.Lqfs.toArray(),u=0;u<f.length;u++)e=e+","+f[u].Id;return o(h,v,y,p,c,l,a,e,i)},p=function(n){return"REQ^"+n},w=function(t){var u=n,f=n,r=i;return t.length<2?r=!0:(t=t.slice().sort(s),u=t[0],f=t[t.length-1],r=u.DisplayDte===f.DisplayDte),r},b=function(t,r,u,f){var e=0,h=0,o=n,c=n,s=[],l=!0;if(t.length>1)for(e=0;e<t.length;e++)if(h=t[e],c=r.getFromIndex("ID",h.DepartmentId),o=$$WP.Scheduling.Location.getLocationFromDepartment(c,u,f),s.length===0)s.push(o);else if(s.indexOf(o)===-1){l=i;break}return l},s=function(n,t){return n.DateTimeUtc-t.DateTimeUtc},k=[{propertyNames:u,storeAs:"set"}],d=[u],g=[{propertyName:u,value:r.Selected,bumpToValue:r.Unselected}];t.prototype=h;t.Dte2Date=l;t.StatesEnum=r;t.Dte2DateString=e;t.createSlotCollection=a;t.createIndexedSlotCollection=v;t.getSlotKey=o;t.getSlotKeyForBuilder=y;t.getRequestSlotKey=p;t.todaysDte=c;t.areAllSlotsOnTheSameDay=w;t.areAllSlotsInTheSameLocation=b;t.slotSortFunction=s;$$WP.Scheduling.Slot=t;t.extend($$WP.Common.Model,"WP$Scheduling$Slot")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var f="State",t,n,r,i,e,u;t=$$WP.Debug.UnitTest.assert;n=$$WP.Scheduling.Slot;e=n.createSlotCollection();u=n.Dte2Date(64051);t(u.getFullYear()===2016&&u.getMonth()===4&&u.getDate()===13,"Slot.Dte2Date did not correctly convert 64051 back to 05/13/16");r=new n;i=new n;e.add(r);e.add(i);r.setProperty(f,n.StatesEnum.Selected);t(r.State===n.StatesEnum.Selected,"Explicitly setting state on slot0 to selected failed.");i.setProperty(f,n.StatesEnum.Selected);t(i.State===n.StatesEnum.Selected,"Explicitly setting state on slot1 to selected failed.");t(r.State===n.StatesEnum.Unselected,"Explicitly selecting slot1 failed to unselect slot0.");i.setProperty(f,n.StatesEnum.Selected);t(i.State===n.StatesEnum.Selected,"Double selecting slot1 actually unselected it.")}),function(){var r="array",u="SlotKey",f="StartTime",e="DisplayDte",o="ProviderId",n="",s=$$WP.Common.ModelCollection,i=$$WP.Scheduling.Slot,t=function(n){this.WP$Common$Model(n);this.Slots=[]},h={s_dataMembers:[],Slots:[],SlotKey:n,ProviderGroupKey:n,LocationGroupKey:n,ProviderId:n,Dte:n,DisplayDte:n,Hour:n,StartTime:n,State:null,TimeString:n,TimeZoneMarker:n,ShowTimeZone:!1,HasMultipleSlots:!1,IsRequest:null,populateWithRawSlots:function(n){var r=null,t;if(Array.isArray(n)){for(t=0;t<n.length;t++)r=new i(n[t]),this.Slots.push(r);this.__afterSlotsAdded()}},populateWithSlotsArray:function(n){Array.isArray(n)&&(this.Slots=this.Slots.concat(n),this.__afterSlotsAdded())},areAllSlotsOnTheSameDay:function(){return i.areAllSlotsOnTheSameDay(this.Slots)},areAllSlotsInTheSameLocation:function(n,t,r){return i.areAllSlotsInTheSameLocation(this.Slots,n,t,r)},__afterSlotsAdded:function(){this.__copySlotPropertiesToSolution();this.setProperty("HasMultipleSlots",this.Slots.length>1)},__copySlotPropertiesToSolution:function(){var n=this,t=n.__findFirstSlot();n.setProperty(o,t.ProviderId);n.setProperty("Dte",t.Dte);n.setProperty(e,t.DisplayDte);n.setProperty("Hour",t.Hour);n.setProperty(f,t.StartTime);n.setProperty("TimeString",t.TimeString);n.setProperty("TimeZoneMarker",t.TimeZoneMarker);n.setProperty("ShowTimeZone",t.ShowTimeZone)},__findFirstSlot:function(){var n=this.Slots.slice().sort(i.slotSortFunction);return n[0]}},c=function(){return new s(l)},l=[{propertyNames:u,storeAs:"set"},{propertyNames:[u,o],storeAs:r},{propertyNames:[u,e,"ProviderGroupKey","LocationGroupKey",f],storeAs:r},{propertyNames:["DepartmentId"],storeAs:r}];t.prototype=h;t.StatesEnum={Selected:0,Unselected:1};t.createSolutionCollection=c;$$WP.Scheduling=$$WP.Scheduling||{};$$WP.Scheduling.Solution=t;t.extend($$WP.Common.Model,"WP$Scheduling$Solution")}(),function(){var h="function",e="IsRequest",u="SlotKey",i=!0,t=null,n=!1,o="POST",r=$$WP.Scheduling.Slot,s=$$WP.Scheduling.Solution,c=function(n,t,i,r){var u="Scheduling/GetQuickScheduleSlots";r&&(u="AnonymousScheduling/GetQuickScheduleSlots");$.ajax({url:makeLink(u),type:o,data:{rfvId:n.LineInWDF15000,numSlots:t,workflowType:$$WP.Scheduling.Workflow.WorkflowTypesEnum.OnDemandTelehealth},success:i})},l=makeLink("Scheduling/GetSlots"),f=function(n){var t=this;t.WP$BaseObject();t.__solutionCollection=n;t.__sendLoadRequest=$.proxy(t.__sendLoadRequest,t)},a={__solutionCollection:{},__isWaitingForLoadResults:n,__isLoadSuccess:n,__isPatientNeedsSync:n,__flushTimeoutId:t,__searchRangeEndDte:0,__nextLoadStartDte:0,__workflow:t,__appointmentBuilder:t,__useOnFileTimePreferences:n,__slotKey:"",__loadConfigId:0,initialize:function(t,i,u,f){var e=this;e.__isWaitingForLoadResults=n;e.__isLoadSuccess=n;e.__isPatientNeedsSync=n;e.__loadConfigId++;e.__resetSolutionCollection();e.__nextLoadStartDte=t||r.todaysDte;e.__workflow=i;e.__appointmentBuilder=u;e.__useOnFileTimePreferences=f;e.__slotKey=r.getSlotKeyForBuilder(i,u)},loadNextSlots:function(t){var r=this;r.__isLoadSuccess=n;r.__hasSlotsToLoad()?r.__isWaitingForLoadResults||(r.__isWaitingForLoadResults=i,clearTimeout(r.__flushTimeoutId),r.__flushTimeoutId=setTimeout(r.__sendLoadRequest,0,r.__buildRequest(),r.__loadConfigId,t)):setTimeout(function(){t([])},0)},isLoading:function(){return this.__isWaitingForLoadResults},isLoadSuccess:function(){return this.__isLoadSuccess},isLastLoadTemporaryFail:function(){return this.__isPatientNeedsSync},getSearchRangeEndDte:function(){return this.__searchRangeEndDte},loadRequestSolutions:function(n){for(var h=0,c=0,l=t,f=t,o=t,h=0;h<n.Models.length;h++)for(o=n.Models[h],c=0;c<o.AllowedRequestReasonsForVisit.length;c++)l=new r({DepartmentId:o.DepartmentId,ProviderId:o.ProviderId,IsRequest:i}),f=new s,f.setProperty(u,r.getRequestSlotKey(o.AllowedRequestReasonsForVisit[c].Id)),f.setProperty(e,i),f.populateWithSlotsArray([l]),this.__solutionCollection.add(f)},__resetSolutionCollection:function(){for(var r=[],n=0,i=t,u=[],r=this.__solutionCollection.toArray(),n=0;n<r.length;n++)i=r[n],!i||i.IsRequest||u.push(i);this.__solutionCollection.removeRange(u)},__buildRequest:function(){var n=this;return{workflow:n.__workflow.toRawRequestObject(),appointmentBuilder:n.__appointmentBuilder.toRawRequestObject(),startDte:n.__nextLoadStartDte,useSchedulingPreferences:n.__useOnFileTimePreferences}},__sendLoadRequest:function(t,i,r){var u=this,f={};i===u.__loadConfigId&&(f={SlotLoader:u,Request:t,LoadConfigId:i,Callback:r},$.ajax({url:l,type:o,data:$$WPUtil.postify(t),cache:n,success:$.proxy(u.__onLoad,f),error:$.proxy(u.__onLoadError,f)}))},__onLoad:function(i){var l=t,r=t,o=[],a=0,c=0,f=t,v=t,y=[];if((l=this,r=l.SlotLoader,l.LoadConfigId===r.__loadConfigId)&&(r.__isWaitingForLoadResults=n,r.__isLoadSuccess=n,r.__isPatientNeedsSync=n,i)){if(o=i.Solutions,Array.isArray(o)&&(a=o.length),r.__setIsLoadSuccess(a,i.ErrorCode),r.__isLoadSuccess){if(r.__updateSearchResultDates(i.SearchRangeEndDte),a>0){for(r.__solutionCollection.openChangeBatch(),c=0;c<a;c++)f=new s(o[c]),f.setProperty(u,r.__slotKey),f.setProperty(e,n),f.populateWithRawSlots(o[c].Slots),r.__solutionCollection.add(f),y.push(f);r.__solutionCollection.closeChangeBatch()}}else r.__isPatientNeedsSync=r.__isPatientNeedsSyncError(i.ErrorCode);v=l.Callback;$.type(v)===h&&setTimeout(function(){v(y)},0)}},__setIsLoadSuccess:function(n,t){this.__isLoadSuccess=$$WPUtil.IsNullOrEmpty(t)||n>0||!!this.__solutionCollection.getFirstInIndex(u,this.__slotKey)},__isPatientNeedsSyncError:function(n){return n==="PatientNeedsSync"},__updateSearchResultDates:function(n){this.__searchRangeEndDte=n;this.__nextLoadStartDte=n+1},__onLoadError:function(){var r=t,i=t,u=t,f=[];(r=this,i=r.SlotLoader,r.LoadConfigId===i.__loadConfigId)&&(i.__isWaitingForLoadResults=n,i.__isLoadSuccess=n,i.__isPatientNeedsSync=n,u=r.Callback,$.type(u)===h&&setTimeout(function(){u(f)},0))},__hasSlotsToLoad:function(){for(var r=this.__appointmentBuilder.Appointments.toArray(),t=0;t<r.length;t++)if(r[t].ProviderDepartmentPairs.length>0)return i;return n},loadOneClickTicketSlots:function(t,u){var f,e;f=r.getSlotKey($$WP.Scheduling.Workflow.WorkflowTypesEnum.Ticket,"","",t,"","","","",i);e={SlotLoader:this,SlotKey:f,Callback:u};$.ajax({url:makeLink("Scheduling/GetOneClickTicketSlots"),type:o,data:{ticketId:t},cache:n,success:$.proxy(this.__onOneClickSlotsLoad,e)})},__onOneClickSlotsLoad:function(t){var f,c,h,o,i,r;for(f=this,o=f.SlotLoader,c=f.SlotKey,h=f.Callback,o.__solutionCollection.openChangeBatch(),i=0;i<t.length;i++)r=new s(t[i]),r.setProperty(u,c),r.setProperty(e,n),r.populateWithRawSlots(t[i].Slots),o.__solutionCollection.add(r);o.__solutionCollection.closeChangeBatch();$.isFunction(h)&&h()}};f.prototype=a;f.LoadQuickScheduleSlots=c;$$WP.Scheduling.SlotLoader=f;f.extend($$WP.BaseObject,"WP$Scheduling$SlotLoader")}(),function(){var n=null,i=$$WP.Common.ModelCollection,t=function(n){this.WP$Common$Model(n)},r={s_dataMembers:["Id","Type","Result"],Id:n,Result:n,Type:n,SchedulingOverride:n,CompletingStep:n,Reset:function(){this.Result=n;this.CompletingStep="";this.SchedulingOverride=n}},u=function(){return new i(f)},f=[{propertyNames:"Id",storeAs:"single"}];t.prototype=r;t.LqfTypeEnum={Questionnaire:1,DecisionTree:2};t.createLqfCollection=u;$$WP.Scheduling=$$WP.Scheduling||{};$$WP.Scheduling.Lqf=t;t.extend($$WP.Common.Model,"WP$Scheduling$Lqf")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var t=$$WP.Common.ModelCollection,n=function(n){this.WP$Common$Model(n)},i=function(){return new t},r=function(t,i,r){var u=new n({DecisionTreeNodeId:i,DecisionTreeNodeCsn:r});return t.add(u),u};n.prototype={s_dataMembers:["LqfIds","DecisionTreeNodeId","DecisionTreeNodeCsn","OriginalTicketId","OriginalPrcId","OriginalRfv","OriginalRfvLine"],LqfIds:[],DecisionTreeNodeId:"",DecisionTreeNodeCsn:"",OriginalTicketId:"",OriginalPrcId:"",OriginalRfv:"",OriginalRfvLine:""};n.createSchedulingOverrideCollection=i;n.getDecisionTreeNodeWorkflowOverride=r;$$WP.Scheduling=$$WP.Scheduling||{};$$WP.Scheduling.SchedulingOverride=n;n.extend($$WP.Common.Model,"WP$Scheduling$SchedulingOverride")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var i=!1,t=null,r="ActiveStatus",e="CompleteStatus",o=$$WP.Common.ModelCollection,n=function(n){this.WP$Common$Model(n)},s={s_dataMembers:["ID",e,r,"IsStacked","StackId","Type","IsReadOnly"],ID:t,CompleteStatus:t,ActiveStatus:t,IsReadOnly:i,IsHidden:i,IsStacked:i,StackId:t,Type:t},f={Incomplete:0,Complete:1,NotRequired:2},u={Inactive:0,Active:1},h=[e,r],c=function(){return new o(a,h,v)},l=function(r,e,o,s,h,c){var l,a;return l=r.getFromIndex("ID",e),l===t&&(a={ID:e,CompleteStatus:c?f.Complete:f.Incomplete,ActiveStatus:u.Inactive,IsStacked:o||i,StackId:s,IsReadOnly:c||i,Type:h},l=new n(a),r.add(l)),l},a=[{propertyNames:"ID",storeAs:"single"},{propertyNames:r,storeAs:"single"},{propertyNames:"StackId",storeAs:"array"}],v=[{propertyName:r,value:u.Active,bumpToValue:u.Inactive}];n.prototype=s;n.StepTypeEnum={ReasonForVisit:0,StandardLqf:1,Provider:2,Location:3,DepartmentLqf:4,Custom:5,Slot:6,Demographics:7,Insurance:8,Confirmation:9,Request:10,QuickSchedule:11,Stacked:12,LandingPage:13,OriginalApptInfo:14,Verification:15,TelehealthLocation:16,PlatformStep:17,TelehealthSummary:18,TelehealthOrganization:19,TelehealthAuth:20,MultiAppointment:21,Onboarding:22};n.ActiveEnum=u;n.CompleteEnum=f;n.createSchedulingStepCollection=c;n.addSchedulingStepToCollection=l;$$WP.Scheduling.SchedulingStep=n;n.extend($$WP.Common.Model,"WP$Scheduling$SchedulingStep")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var t=!1,n=null,a=$$WP.Scheduling.AppointmentBuilder,h=$$WP.Scheduling.Department,c=$$WP.Scheduling.Location,i=$$WP.Scheduling.Provider,r=$$WP.Scheduling.ProviderDepartmentPair,u=$$WP.Scheduling.ReasonForVisit,o=$$WP.Scheduling.ReasonForVisitDepartmentOverride,v=$$WP.Scheduling.Solution,y=$$WP.Scheduling.SlotLoader,s=$$WP.Scheduling.VisitType,f=$$WP.Scheduling.VisitTypeDepartmentOverride,p=$$WP.Scheduling.Lqf,w=$$WP.Scheduling.SchedulingOverride,l=$$WP.Scheduling.TelehealthLocation,b=$$WP.Scheduling.TelehealthData,k=$$WP.Scheduling.SchedulingStep,d=$$WP.Scheduling.TelehealthOrganization,g=$$WP.Scheduling.TelehealthOrganizationLoader,e=function(n){var t=this;t.AppointmentBuilder=new a;t.Providers=i.createProviderCollection();t.ReasonsForVisit=u.createReasonForVisitCollection();t.Departments=h.createDepartmentsCollection();t.ProviderDepartmentPairs=r.createProviderDepartmentPairsCollection();t.ReasonForVisitDepartmentOverrides=o.createReasonForVisitDepartmentOverridesCollection();t.Locations=c.createLocationCollection();t.VisitTypes=s.createVisitTypeCollection();t.VisitTypeDepartmentOverrides=f.createVisitTypeDepartmentOverridesCollection();t.Solutions=v.createSolutionCollection();t.SlotLoader=new y(t.Solutions);t.Lqfs=p.createLqfCollection();t.SchedulingOverrides=w.createSchedulingOverrideCollection();t.TelehealthLocations=l.createTelehealthLocationCollection();t.TelehealthData=new b;t.SchedulingSteps=k.createSchedulingStepCollection();t.TelehealthOrganizations=d.createTelehealthOrganizationCollection();t.TelehealthOrganizationLoader=new g(t.TelehealthOrganizations);typeof n=="object"&&t.populateWithRawSchedulingData(n)},nt={AppointmentBuilder:n,Providers:n,ReasonsForVisit:n,Locations:n,Departments:n,ProviderDepartmentPairs:n,ReasonForVisitDepartmentOverrides:n,VisitTypes:n,VisitTypeDepartmentOverrides:n,Solutions:n,SlotLoader:n,ShowOtherProviderOption:t,ShowOtherRfvOption:t,TelehealthLocations:n,TelehealthOrganizations:n,HomeOrganizationName:n,TelehealthOrganizationLoader:n,TelehealthData:n,Lqfs:n,SchedulingOverrides:n,SchedulingSteps:n,IsBeingRefreshed:t,IsSchedulingCompleting:t,BlockDemographicInsuranceVerification:t,prepForWorkflow:function(n,t,r,f){var e=this;t=$$WPUtil.IsNullOrEmpty(t)?e.ShowOtherProviderOption:t;r=$$WPUtil.IsNullOrEmpty(r)?e.ShowOtherRfvOption:r;f=$$WPUtil.IsNullOrEmpty(f)?!0:f;e.ShowOtherProviderOption=t;e.ShowOtherRfvOption=r;r&&u.addOtherOption(e.ReasonsForVisit,e.VisitTypes,e.ProviderDepartmentPairs);t&&i.addOtherOption(e.Providers,e.Departments,e.Locations,e.ProviderDepartmentPairs,e.ReasonsForVisit,e.ReasonForVisitDepartmentOverrides);f&&e.SlotLoader.loadRequestSolutions(e.ProviderDepartmentPairs)},prepForWorkflowAgain:function(){this.prepForWorkflow(n,n,n,t)},populateWithRawSchedulingData:function(t){var e=this,a=n;t.WorkflowSettings&&(a=t.WorkflowSettings.ProviderNameDisplayFormat);i.convertRawProviders(t.Providers,e.Providers,a);h.convertRawDepartments(t.Departments,e.Departments);u.convertRawReasonsForVisit(t.ReasonsForVisit,e.ReasonsForVisit);r.convertRawProviderDepartmentPairs(t.ProviderDepartmentPairs,e.ProviderDepartmentPairs);o.convertRawReasonForVisitDepartmentOverrides(t.ReasonForVisitDepartmentOverrides,e.ReasonForVisitDepartmentOverrides);s.convertRawVisitTypes(t.VisitTypes,e.VisitTypes);f.convertRawVisitTypeDepartmentOverrides(t.VisitTypeDepartmentOverrides,e.VisitTypeDepartmentOverrides);c.convertRawLocations(t.Locations,e.Locations,e.Departments);t.OnDemandTelehealthData&&(l.convertRawTelehealthLocations(t.OnDemandTelehealthData.TelehealthLocations,e.TelehealthLocations),e.TelehealthData.TelehealthNotificationSettings=new $$WP.Scheduling.TelehealthNotificationSettings(t.OnDemandTelehealthData.ShowEmailOption,t.OnDemandTelehealthData.ShowSMSOption,t.OnDemandTelehealthData.CheckEmailOption,t.OnDemandTelehealthData.CheckSMSOption,t.OnDemandTelehealthData.PhoneNumber,t.OnDemandTelehealthData.EmailAddress,t.OnDemandTelehealthData.IsPushNotificationEnabled),e.TelehealthData.IsXOrgEnabled=t.OnDemandTelehealthData.IsXOrgEnabled&&(!$$WP.Utilities.UI.IsMobile||t.WorkflowSettings.IsXOrgFeatureAvailableOnMobile),t.WorkflowSettings&&t.WorkflowSettings.QuickScheduleStepSettings&&t.WorkflowSettings.QuickScheduleStepSettings.Hide===!0&&e.TelehealthData.autoSelectQueueing());e.HomeOrganizationName=t.HomeOrganizationName;u.dereferenceIds(e.ReasonsForVisit,e.VisitTypes);i.dereferenceIds(e.Providers);r.dereferenceIds(e.ProviderDepartmentPairs,e.Providers,e.Departments,e.ReasonsForVisit);o.dereferenceIds(e.ReasonForVisitDepartmentOverrides,e.ReasonsForVisit,e.Departments,e.VisitTypes);s.dereferenceIds(e.VisitTypes,e.Providers,e.Departments);f.dereferenceIds(e.ReasonForVisitDepartmentOverrides,e.VisitTypes,e.Departments)},populateForTicket:function(t,i,u){var l="ID",h=this,o=0,a=n,p=n,s=[],c=n,b=n,k=n,v=n,y=n,w=n;if(c=new e(i),f.convertRawVisitTypeDepartmentOverrides(i.VisitTypeDepartmentOverrides,h.VisitTypeDepartmentOverrides),u)for(o=0;o<i.Tickets.length;o++)if(y=i.Tickets[o],y.TicketId===t.TicketId){t.AllowedProviderDepartmentPairs=y.AllowedProviderDepartmentPairs;t.VisitTypeId=y.VisitTypeId;break}if(a=c.VisitTypes.getFromIndex(l,t.VisitTypeId),t.VisitType=a,h.VisitTypes.add(a),s=t.VisitType.AllowedProviderDepartmentPairs,a.IsPanel)for(o=0;o<a.PanelComponents.length;o++)p=a.PanelComponents[o],h.VisitTypes.add(p),s=s.concat(p.AllowedProviderDepartmentPairs);for(o=0;o<s.length;o++)s[o].Id=s[o].ProviderId+"^"+s[o].DepartmentId,s[o].Provider=c.Providers.getFromIndex(l,s[o].ProviderId),s[o].Department=c.Departments.getFromIndex(l,s[o].DepartmentId),s[o].Provider.TeamProviders=[],s[o].Provider.TeamOriginProviders=[],b=h.Providers.getFromIndex(l,s[o].ProviderId),b===n&&s[o].Provider!==n&&h.Providers.add(s[o].Provider),k=h.Departments.getFromIndex(l,s[o].DepartmentId),k===n&&s[o].Department!==n&&h.Departments.add(s[o].Department),v=h.ProviderDepartmentPairs.getFromIndex("Id",s[o].Id),v===n&&(v=c.ProviderDepartmentPairs.getFromIndex("Id",s[o].Id),v=v||new r(s[o]),h.ProviderDepartmentPairs.add(v));w=c.Providers.getFromIndex(l,"-2");!w||h.Providers.add(w);h.Locations.size()===0&&h.Locations.addRange(c.Locations.Models)}};e.prototype=nt;$$WP.Scheduling=$$WP.Scheduling||{};$$WP.Scheduling.SchedulingDataPool=e;e.extend($$WP.BaseObject,"WP$Scheduling$SchedulingDataPool")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var l="Procedure",a="ExistingProvider",v="ProviderId",i=!1,r=!0,e="Id",y="IsFavorite",s="State",t=null,d=$$WP.Common.ModelCollection,f=$$WP.Scheduling.SchedulingDataPool,h=$$WP.Scheduling.Appointment,g=$$WP.Scheduling.VisitType,o={Selected:0,Unselected:1},u={Standard:0,ExistingProvider:1,NewProvider:2,Procedure:3,Ticket:4,Request:5,Reschedule:6,Repeat:7,OnDemandTelehealth:8,DecisionTreeNode:9,OnMyWay:10},c=t,n=function(n){var t=this,i;t.WP$Common$Model(n);t.State=o.Unselected;i=$$WP.Strings.getNamespace("Scheduling");t.Name=i.getString(t.Id+"Workflow");t.HelpText=i.getString(t.Id+"WorkflowHelpText");c=c||i.getString("TicketProviderNameDelimiter")},nt=[{propertyNames:s,storeAs:"set"},{propertyNames:"Type",storeAs:"array"},{propertyNames:y,storeAs:"array"},{propertyNames:e,storeAs:"single"}],tt=[s],it=[{propertyName:s,value:o.Selected,bumpToValue:o.Unselected}],rt=function(n,t){return n.ToDte===t.ToDte?0:n.ToDte<t.ToDte?-1:1},ut=function(e,o){var s=t,h=0,v="",l=t,y={},a=t;if(a=WP.Utils.dte2date(e.AvailableDte),s=new n({Id:e.TicketId,Type:u.Ticket,IsTicket:r,TicketInfo:e,ExpireDate:formatDate(WP.Utils.dte2date(e.ToDte)),AvailableDate:formatDate(a),IsCurrentlyAvailable:new Date>a,SchedulingDataPool:new f}),s.SchedulingDataPool.populateForTicket(e,o),s.SchedulingDataPool.prepForWorkflow(s,i,i),e.VisitType.AllowedProviderDepartmentPairs.length>0){for(h=0;h<e.VisitType.AllowedProviderDepartmentPairs.length;h++)l=e.VisitType.AllowedProviderDepartmentPairs[h].Provider,y[l.ID]||(v+=(h>0?c:"")+l.Name,y[l.ID]=r);e.ProviderNameString=v}return s},p=function(n,i,r){var u,f;if(r!==t)for(r.sort(rt),u=0;u<r.length;u++)f=ut(r[u],i),n.add(f)},w=function(n){var t=n.FavoriteAppointmentInfo.ReasonForVisitCategoryValue;return n.SchedulingDataPool.ReasonsForVisit.getFirstInIndex("CategoryValue",t)},ft=function(n){var t=n.FavoriteAppointmentInfo.ProviderId;return n.SchedulingDataPool.Providers.getFromIndex("ID",t)},et=function(f){var o,e,s,h,c,l;return(o=t,e=w(f),s=ft(f),h=f.SchedulingDataPool.ProviderDepartmentPairs.Models,!e||!e.CanDirectSchedule)?t:(c=r,l=i,n.doesRfvHaveMatchingProviderDepartmentPair(e,h,c,l)&&e.ReasonForVisitFirst?o=u.Procedure:f.hasProviderFirstOptions()&&s&&f.isRfvAllowedForProviderFirstInDirectScheduling(e,s)&&(o=u.ExistingProvider),o)},ot=function(i,u,e,o){var h,s,c,l;if(!$$WPUtil.IsNullOrEmpty(e))for(h=0;h<e.length;h++)(s=new n({Id:e[h].Csn,Type:t,IsFavorite:r,FavoriteAppointmentInfo:e[h],SchedulingDataPool:new f(u)}),c=et(s),c!==t)&&(s.Type=c,s.SchedulingDataPool.prepForWorkflow(s,o),i.add(s),l=w(s),s.FavoriteAppointmentInfo.HideProviderName=!l.AllowProviderSelect)},st={s_dataMembers:[e,"Type","IsTicket","TicketInfo","ExpireDate",y,"FavoriteAppointmentInfo","OriginalAppointment","SchedulingDataPool","RootDecisionTreeId","DecisionTreeNodeId","DecisionTreeNodeCsn","IsCurrentlyAvailable","AvailableDate","ExpireDateString","AvailableDateString","IsAnonymous","IsGuest","AnonymousSettings"],Id:t,Type:t,IsTicket:i,TicketInfo:t,ExpireDate:t,ExpireDateString:t,IsCurrentlyAvailable:t,AvailableDate:t,AvailableDateString:t,IsFavorite:i,FavoriteAppointmentInfo:t,OriginalAppointment:t,SchedulingDataPool:t,Name:t,HelpText:t,State:t,ShowSchedulingHubLink:i,RootDecisionTreeId:t,DecisionTreeNodeId:t,DecisionTreeNodeCsn:t,IsAnonymous:i,IsGuest:i,AnonymousSettings:t,start:function(){var n=this,t=n.SchedulingDataPool.AppointmentBuilder;switch(n.Type){case $$WP.Scheduling.Workflow.WorkflowTypesEnum.DecisionTreeNode:t.updateAppointmentsCollectionForVisitType(n.SchedulingDataPool.VisitTypes.toArray()[0],n.SchedulingDataPool.VisitTypes,h.VisitTypeSourceEnum.Default,n);break;case $$WP.Scheduling.Workflow.WorkflowTypesEnum.Ticket:t.updateAppointmentsCollectionForVisitType(n.TicketInfo.VisitType,n.SchedulingDataPool.VisitTypes,h.VisitTypeSourceEnum.Default,n);break;case $$WP.Scheduling.Workflow.WorkflowTypesEnum.Reschedule:t.updateAppointmentsCollectionForVisitType(n.SchedulingDataPool.VisitTypes.getFirstInIndex("ID",n.OriginalAppointment.VisitTypeId),n.SchedulingDataPool.VisitTypes,h.VisitTypeSourceEnum.Default,n)}},getStandardProviders:function(n){var i,u,f,t;for(u=[],i=this.SchedulingDataPool.Providers.getFromIndex("IsStandardProvider",r),t=0;t<i.length;t++)(f=i[t],!f.OtherOption||n)&&u.push(f);return u},hasProviderFirstOptions:function(){for(var u,f,t=this.getStandardProviders(i),n=0;n<t.length;n++)if(u=t[n],f=this.SchedulingDataPool.ProviderDepartmentPairs.getFromIndex(v,u.ID),$$WP.Scheduling.Workflow.hasProviderFirstOptionsProvDepPairs(f))return r;return i},hasRfvFirstOptions:function(){var t,i,u,f,e;return t=this.SchedulingDataPool.ReasonsForVisit.getFromIndex("ReasonForVisitFirst",r),i=this.SchedulingDataPool.ProviderDepartmentPairs.Models,u=r,f=r,e=n.buildReasonsForVisitNoFiltering(t,i,u,f),e.length>0},getOneClickSlots:function(){return[]},isRfvAllowedForProviderFirstInDirectScheduling:function(n,t){var u,f;if(!n.AllowProviderSelect||!n.ProviderFirst||(u=this.SchedulingDataPool.ProviderDepartmentPairs.getFromIndex(v,t.ID),!u))return i;for(f=0;f<u.length;f++)if(u[f].AllowedDirectScheduleReasonsForVisitSet[n.Id])return r;return i},toRawRequestObject:function(){var n=this;return{Type:n.Type,TicketId:!n.TicketInfo?"":n.TicketInfo.TicketId,RescheduleDat:!n.OriginalAppointment?"":n.OriginalAppointment.Dat,RootDecisionTreeId:n.RootDecisionTreeId,DecisionTreeNodeId:n.DecisionTreeNodeId,DecisionTreeNodeCsn:n.DecisionTreeNodeCsn}},getTicketExpireDateString:function(){var n=[{Name:"@MYCHART@EXPIRATIONDATE@",Value:this.ExpireDate}];return this.__getSchedulingString("TicketExpirationDate",n)},getTicketAvailableDateString:function(){var n=[{Name:"@MYCHART@AVAILABLEDATE@",Value:this.AvailableDate}];return this.__getSchedulingString("TicketAvailableDate",n)},__getSchedulingString:function(n,t){var i;return t.forEach(function(n){$$WP.Strings.addMnemonic(n.Name,n.Value)},this),i=$$WP.Strings.getForTemplate(n,"scheduling"),t.forEach(function(n){$$WP.Strings.removeMnemonic(n.Name)},this),i}},ht=function(t,e,o,s,h,c,v,y,w,b,k,g,rt){var ft,ut,ht,et,st;ft=new d(nt,tt,it);ft.openChangeBatch();switch(t){case u.Ticket:p(ft,e,o);break;case u.Reschedule:ut=new n({Id:"Reschedule",Type:u.Reschedule,SchedulingDataPool:new f(e),OriginalAppointment:ct(h)});ut.ShowSchedulingHubLink=r;ut.SchedulingDataPool.prepForWorkflow(ut,i);ft.add(ut);break;case u.DecisionTreeNode:ut=new n({Id:"DTNode",Type:u.DecisionTreeNode,SchedulingDataPool:new f(e),RootDecisionTreeId:y,DecisionTreeNodeId:w,DecisionTreeNodeCsn:b});ut.ShowSchedulingHubLink=r;ut.SchedulingDataPool.prepForWorkflow(ut,i,i,r);ft.add(ut);break;case u.OnDemandTelehealth:ut=new n({Id:"OnDemandTelehealth",Type:u.OnDemandTelehealth,SchedulingDataPool:new f(e),IsAnonymous:k,IsGuest:g,AnonymousSettings:rt});ut.SchedulingDataPool.prepForWorkflow(ut,i);ft.add(ut);break;case u.Request:ht=new n({Id:"Request",Type:u.Request,SchedulingDataPool:new f(e)});ht.SchedulingDataPool.prepForWorkflow(ht,i);ft.add(ht);break;default:et=new n({Id:a,Type:u.ExistingProvider,SchedulingDataPool:new f(e)});et.SchedulingDataPool.prepForWorkflow(et,c,v);et.hasProviderFirstOptions()&&ft.add(et);st=new n({Id:l,Type:u.Procedure,SchedulingDataPool:new f(e)});st.SchedulingDataPool.prepForWorkflow(st,c,v);st.hasRfvFirstOptions()&&ft.add(st);p(ft,e,o);ot(ft,e,s,c)}return ft.closeChangeBatch(),ft},ct=function(n){var t=n,i=new $$WP.Scheduling.Slot(n.Slot);return t.Slot=i,t},b=function(n,t,i){return!!n&&!i?n.AllowProviderSelect:!t?r:t.AllowedProviderDepartmentPairs.length===0||t.AllowProviderSelect},lt=function(n,t){var i=n.ReasonForVisit,r=t.VisitType,u=n.numAppointments()>1;return b(i,r,u)},at=function(t,i,r){var u;switch(i){case n.WorkflowTypesEnum.Ticket:u=t.getFromIndex(e,r);break;case n.WorkflowTypesEnum.ExistingProvider:u=t.getFromIndex(e,a);break;case n.WorkflowTypesEnum.Procedure:u=t.getFromIndex(e,l);break;case n.WorkflowTypesEnum.Request:u=t.getFromIndex(e,"Request");break;case n.WorkflowTypesEnum.OnDemandTelehealth:u=t.Models[0];break;case n.WorkflowTypesEnum.Reschedule:u=t.Models[0];break;case n.WorkflowTypesEnum.DecisionTreeNode:u=t.Models[0]}return u},k=function(n){return n.AllowProviderSelect&&n.ProviderFirst},vt=function(n){for(var f,t,u=0;u<n.length;u++){for(t=0;t<n[u].AllowedDirectScheduleReasonsForVisit.length;t++)if(f=n[u].AllowedDirectScheduleReasonsForVisit[t],k(f))return r;for(t=0;t<n[u].AllowedRequestReasonsForVisit.length;t++)if(f=n[u].AllowedRequestReasonsForVisit[t],k(f))return r}return i},yt=function(t,i,r,u){for(var o,f=[],e=0;e<t.length;e++)o=t[e],o.ReasonForVisitFirst&&n.shouldIncludeReasonForVisit(o,i,r,u)&&f.push(o);return f.sort($$WP.Scheduling.ReasonForVisit.sortReasons),f},pt=function(t,u,f,e){return n.isReasonForVisitEnabledForDirectOrRequest(f,e,t)?n.doesRfvHaveMatchingProviderDepartmentPair(t,u,f,e)?r:g.canStartSchedulingWhenEmpty(t.DefaultVisitType)?r:i:i},wt=function(n,t,r){var u=i;return n&&(u=u||r.CanDirectSchedule),t&&(u=u||r.CanRequest),u},bt=function(i,u,f,e){var o=0,c=t,h=r,s=i.DefaultVisitType;if(s.IsPanel){for(o=0;o<s.PanelComponents.length;o++)c=s.PanelComponents[o],h=h&&n.doesVisitTypeHaveMatchingProviderDepartmentPair(i,c,u,f,e);return h}return n.doesVisitTypeHaveMatchingProviderDepartmentPair(i,s,u,f,e)},kt=function(n,t,u,f,e){var o=0,s=t.AllowedProviderDepartmentPairs;if(s.length!==0||!n){if(f)return r}else for(o=0;o<u.length;o++)if(f&&u[o].AllowedDirectScheduleReasonsForVisitSet[n.Id]||e&&u[o].AllowedRequestReasonsForVisitSet[n.Id])return r;return i};n.prototype=st;n.WorkflowTypesEnum=u;n.createWorkflowCollection=ht;n.allowProviderSelect=b;n.allowProviderSelectForAppointment=lt;n.getWorkflowFromType=at;n.hasProviderFirstOptionsProvDepPairs=vt;n.buildReasonsForVisitNoFiltering=yt;n.shouldIncludeReasonForVisit=pt;n.isReasonForVisitEnabledForDirectOrRequest=wt;n.doesRfvHaveMatchingProviderDepartmentPair=bt;n.doesVisitTypeHaveMatchingProviderDepartmentPair=kt;n.StatesEnum=o;$$WP.Scheduling=$$WP.Scheduling||{};$$WP.Scheduling.Workflow=n;n.extend($$WP.Common.Model,"WP$Scheduling$Workflow")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var n=null,t=function(n){this.WP$Common$Model(n)},i={s_dataMembers:["TitleHtml","Department","StartTimeString","ArrivalTimeString","LengthInMinutes","Payment","DateTimeUtc","TimeZoneMarker","ShowTimeZone","DateString","VisitType","FirstInDay","LastInDay"],TitleHtml:"",Department:n,StartTimeString:n,ArrivalTimeString:"",LengthInMinutes:0,Payment:n,DateTimeUtc:n,TimeZoneMarker:n,ShowTimeZone:!1,DateString:n,VisitType:n,FirstInDay:n,LastInDay:n,populateFromSlot:function(n){var t=this;t.StartTimeString=n.TimeString;t.DateTimeUtc=n.DateTimeUtc;t.TimeZoneMarker=n.TimeZoneMarker;t.ShowTimeZone=n.ShowTimeZone;t.DateString=n.DateString},populateFromReviewResultAndSlot:function(t,i){var r=t.VisitPayment,f=t.AppointmentLength,u="";!r||$$WPUtil.IsNullOrEmpty(r.Amount)?r=n:r.IsPrepay=r.Type===3;t.ArrivalTime!==i.StartTime&&(u=t.ArrivalTimeString);this.Payment=r;this.LengthInMinutes=f;this.ArrivalTimeString=u}};t.prototype=i;$$WP.Scheduling=$$WP.Scheduling||{};$$WP.Scheduling.AppointmentViewModel=t;t.extend($$WP.Common.Model,"WP$Scheduling$AppointmentViewModel")}(),function(){var i="ID",n=null,t=!1,r=function(n){this.WP$Common$Model(n)},u={s_dataMembers:[],Appointments:[],Alerts:[],ShowAlerts:t,ShowArrivalTime:t,NumAppointmentsWithPayment:0,populateFromVisitType:function(t){var i=0,r=n,u=n;for(this.Appointments=[],i=0;i<t.PanelComponents.length;i++)r=t.PanelComponents[i],u=new $$WP.Scheduling.AppointmentViewModel({TitleHtml:HTMLEncode(r.DisplayName)}),this.Appointments.push(u)},populateFromSolution:function(r,u){var e=this,h=r.AppointmentBuilder,o=n,s=n,a=n,c=n,v=t,f=0,l=n;for(e.Appointments=[],f=0;f<h.numAppointments();f++)o=h.getAppointment(f),s=u.Slots[f],v=$$WP.Scheduling.Workflow.allowProviderSelectForAppointment(h,o),a=r.Providers.getFromIndex(i,s.ProviderId),c=r.Departments.getFromIndex(i,s.DepartmentId),l=new $$WP.Scheduling.AppointmentViewModel({TitleHtml:$$WPSchedulingUtil.ConstructAppointmentStringHtml(a,c,o.VisitType.DisplayName,v),Department:c,VisitType:o.VisitType}),l.populateFromSlot(s),e.Appointments.push(l);e.Appointments.sort($$WP.Scheduling.Slot.slotSortFunction);e.__setAppointmentSequenceProperties()},populateFromReviewResult:function(r,u){var f=this,c=r.AppointmentBuilder,a=n,e=n,o=n,v=n,l=n,y=t,s=0,h=n,p=n;for(f.Appointments=[],s=0;s<c.numAppointments();s++)a=u.Appointments[s],e=c.getAppointment(s),o=e.Slot,y=$$WP.Scheduling.Workflow.allowProviderSelectForAppointment(c,e),v=r.Providers.getFromIndex(i,o.ProviderId),l=r.Departments.getFromIndex(i,o.DepartmentId),h=new $$WP.Scheduling.AppointmentViewModel({TitleHtml:$$WPSchedulingUtil.ConstructAppointmentStringHtml(v,l,e.VisitType.DisplayName,y),Payment:p,Department:l,VisitType:e.VisitType}),h.populateFromSlot(o),h.populateFromReviewResultAndSlot(a,o),f.Appointments.push(h);f.Appointments.sort($$WP.Scheduling.Slot.slotSortFunction);f.__setAppointmentSequenceProperties();f.Alerts=f.__generateAlerts(r);f.ShowAlerts=f.Alerts.length>0;f.ShowArrivalTime=!0;f.NumAppointmentsWithPayment=f.__getNumberOfAppointmentsWithPayment()},__generateAlerts:function(t){for(var r=[],i=0,u=t.AppointmentBuilder,e=n,o=u.areLocationsGrouped(),f=[],i=0;i<u.numAppointments();i++)e=u.getAppointment(i),r.push(e.Slot);return $$WP.Scheduling.Slot.areAllSlotsOnTheSameDay(r)||f.push($$WP.Scheduling.Alert.AlertTypeEnum.SolutionIsOnMultipleDates),$$WP.Scheduling.Slot.areAllSlotsInTheSameLocation(r,t.Departments,t.Locations,o)||f.push($$WP.Scheduling.Alert.AlertTypeEnum.SolutionIsInMultipleLocations),f},__getNumberOfAppointmentsWithPayment:function(){for(var t=0,i=n,r=0,t=0;t<this.Appointments.length;t++)i=this.Appointments[t],!i.Payment||$$WPUtil.IsNullOrEmpty(i.Payment.Amount)||r++;return r},__setAppointmentSequenceProperties:function(){for(var i=0,r=n,u="",i=0;i<this.Appointments.length;i++)r=this.Appointments[i],r.LastInDay=t,r.DateString===u?r.FirstInDay=t:(r.FirstInDay=!0,i>0&&(this.Appointments[i-1].LastInDay=!0)),u=r.DateString}};r.prototype=u;$$WP.Scheduling=$$WP.Scheduling||{};$$WP.Scheduling.SolutionViewModel=r;r.extend($$WP.Common.Model,"WP$Scheduling$SolutionViewModel")}()
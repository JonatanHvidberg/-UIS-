(function(){var n=null;$$WP.Utilities.guaranteeExistence($$WP,"DecisionTrees.Controllers");var u=$$WP.DecisionTrees.Models.Questionnaire,t=Epic.PatientEngagement.Questionnaire.QuestionnaireAction,f=Epic.PatientEngagement.Questionnaire.MyChart.QuestionnaireController,e=Epic.PatientEngagement.Questionnaire.QuestionnaireWorkflowInformation,o=Epic.PatientEngagement.Questionnaire.UiCallbacks,s=Epic.PatientEngagement.Questionnaire.Ui,i=$$WP.DecisionTrees.Enums.TraversalAction,r=function(n,t,i,r,u,f,e){var o=this;o.WP$Controllers$Controller();o.$root=n;o.nodeData=t;o.afterCompleteCallback=e;o.settings=u||new $$WP.DecisionTrees.Models.TraversalSettings;o.additionalContext=f||new $$WP.DecisionTrees.Models.TraversalAdditionalContext;o.questionnaireContext=i;o.questionnaireContextIdentifier=r;o.initialize()},h={$root:n,afterCompleteCallback:n,nodeData:n,settings:n,additionalContext:n,questionnaire:n,questionnaireContext:n,questionnaireContextIdentifier:n,templateData:n,initialize:function(){var n=this;n.questionnaire=new u(n.nodeData.Questionnaire);n.templateData=n.nodeData;n.templateData.IsBackAllowed=n.settings.AllowBack;n.templateData.IsFinishLaterAllowed=n.settings.AllowFinishLater;n.templateData.IsCancelAllowed=n.settings.AllowCancel;n.render()},render:function(){var t=this,r,u,h,i,c,l,a;t.$root.safeAppend($afe.renderTemplate($$WP.Templates.DecisionTrees.QuestionnaireNode,t.templateData));r=s.getDomElementsForQuestionnaireView();u={alwaysEnableBackButton:!t.nodeData.IsFirst,shouldDisplayQuestionnaireName:!1,callBackOnSave:!0,showBottomBackButton:!$$WP.Utilities.UI.IsMobile};l=t.additionalContext.FavoriteApptDAT?t.additionalContext.FavoriteApptDAT:n;a={hideSummaryPage:!0,defaultAnswersFromDAT:l};h=new e(t,t.questionnaireContext,t.questionnaireContextIdentifier,u,n,a);i=new o;t.questionnaireContext===$$WP.DecisionTrees.Enums.TraversalSourceWorkflow.Scheduling&&(i.defaultSettings={scrollToTop:!1});c=new f(t.questionnaire.ID,r,h,i);t._suppressSpinner();c.start()},questionnaireCallback:function(r,u){var e=this,f;e.questionnaire.AnswerID=u;switch(r){case t.AdvanceQuestionnaire:f=i.Next;break;case t.BackQuestionnaire:f=i.Previous;break;case t.CancelQuestionnaire:f=i.Cancel;break;case t.SaveQuestionnaire:f=i.Save;break;case t.Error:f=i.Error}e.afterCompleteCallback!==n&&typeof e.afterCompleteCallback=="function"&&e.afterCompleteCallback(f,e.questionnaire)},_suppressSpinner:function(){$afe.select(".dt-spinner").hide()}};r.prototype=h;$$WP.DecisionTrees.Controllers.QuestionnaireNodeController=r;r.extend($$WP.Controllers.Controller,"WP$DecisionTrees$Controllers$QuestionnaireNodeController")})(),function(){var i=!1,f=".cancelworkflow",e=".continuelater",o=".previousstep",t="click",s=".nextstep",h="#question-wrapper",n=null;$$WP.Utilities.guaranteeExistence($$WP,"DecisionTrees.Controllers");var c=$$WP.Questions.QuestionsController,r=$$WP.DecisionTrees.Enums.TraversalAction,u=function(n,t,i,r){var u=this;u.WP$Controllers$Controller();u.proxify("_onPopupButtonClick","_onContinueButtonClick","_onBackButtonClick","_onFinishLaterButtonClick","_onCancelButtonClick","_onQuestionLoaded");u.$root=n;u.nodeData=t;u.afterCompleteCallback=r;u.settings=i||new $$WP.DecisionTrees.Models.TraversalSettings;u.initialize()},l={$root:n,afterCompleteCallback:n,nodeData:n,settings:!0,templateData:n,questionsController:n,initialize:function(){var n=this;n.templateData=n.nodeData;n.templateData.IsFinishLaterAllowed=n.settings.AllowFinishLater;n.templateData.IsBackAllowed=n.settings.AllowBack;n.templateData.IsCancelAllowed=n.settings.AllowCancel;n.render()},render:function(){var n=this,t;n.$root.safeAppend($afe.renderTemplate($$WP.Templates.DecisionTrees.QuestionNode,n.templateData));t=$afe.select(h);n.questionsController=new c(t,[n.nodeData.Question],n._onQuestionLoaded);n.postRender()},postRender:function(){var n=this,i;$$WP.Utilities.UI.IsMobile&&(i=n.$root.find(".formbuttons.ques-actions .nextstep"),n.$root.find(".formbuttons.ques-actions").prepend(i));n.$root.find(s).on(t,n._onContinueButtonClick);n.$root.find(o).on(t,n._onBackButtonClick);n.$root.find(e).on(t,n._onFinishLaterButtonClick);n.$root.find(f).on(t,n._onCancelButtonClick)},_onQuestionLoaded:function(){this.$root.find(h).focus()},_onContinueButtonClick:function(){return this._disableClickHandlers(),this._performCallback(r.Next,this.questionsController.getCoreModelsWithAnswers()[0]),i},_onBackButtonClick:function(){return this.settings.AllowBack?(this._disableClickHandlers(),this._performCallback(r.Previous),i):i},_onCancelButtonClick:function(){var t=this,r;return t.settings.AllowCancel?($$WP.Strings.setDefaultNamespace(t.settings.StringNamespace),r=[new $$WPComp.ComplexObjects.Button($$WP.Strings.get("DTCancelPopupDeleteResponsesButtonLabel"),n,"inlinedelete","continue"),new $$WPComp.ComplexObjects.Button($$WP.Strings.get("DTCancelPopupGoBackButtonLabel"),n,"previousstep","cancel")],t.settings.AllowFinishLater&&r.splice(1,0,new $$WPComp.ComplexObjects.Button($$WP.Strings.get("DTCancelPopupSaveResponsesButtonLabel"),n,"continuelater","saveandcontinue")),$$WPUtil.quickMessageBox($$WP.Strings.get("DTCancelPopupPrompt"),n,r,t._onPopupButtonClick),$$WP.Strings.clearDefaultNamespace(),i):i},_onFinishLaterButtonClick:function(){var n=this;return n.settings.AllowFinishLater?(n._disableClickHandlers(),n._performCallback(r.Save,n.questionsController.getCoreModelsWithAnswers()[0]),i):i},_onPopupButtonClick:function(n){n==="toolbarcontinue"?(this._disableClickHandlers(),this._performCallback(r.Cancel)):n==="toolbarsaveandcontinue"&&this._onFinishLaterButtonClick()},_performCallback:function(t,i){this.afterCompleteCallback!==n&&typeof this.afterCompleteCallback=="function"&&this.afterCompleteCallback(t,i)},_disableClickHandlers:function(){var n=this;n.$root.find(s).off(t,n._onContinueButtonClick);n.$root.find(o).off(t,n._onBackButtonClick);n.$root.find(e).off(t,n._onFinishLaterButtonClick);n.$root.find(f).off(t,n._onCancelButtonClick)}};u.prototype=l;$$WP.DecisionTrees.Controllers.QuestionNodeController=u;u.extend($$WP.Controllers.Controller,"WP$DecisionTrees$Controllers$QuestionNodeController")}(),function(){var s=".dt-spinner",r="json",u="POST",f="#dt-node-container",n=null;$$WP.Utilities.guaranteeExistence($$WP,"DecisionTrees.Controllers");var c=$$WP.DecisionTrees.Models.TreeTraversal,h=$$WP.DecisionTrees.Models.InputNode,t=$$WP.DecisionTrees.Enums.TraversalAction,e=$$WP.DecisionTrees.Enums.NodeType,l=$$WP.DecisionTrees.Controllers.QuestionNodeController,a=$$WP.DecisionTrees.Controllers.QuestionnaireNodeController,i=$$WP.DecisionTrees.Enums.TraversalStatus,o=function(t,i,r,u,f,e,o){var s=this;s.WP$Controllers$Controller();s.proxify("_onQuestionNodeCallback","_onQuestionnaireNodeCallback","_handleNextStepSuccess","_handlePreviousStepSuccess","_handleSaveStepSuccess","_handleDiscardWorkflowSuccess","_handleError");u=u!==n&&u instanceof $$WP.DecisionTrees.Models.TraversalSettings?u:new $$WP.DecisionTrees.Models.TraversalSettings;o=o!==n&&o instanceof $$WP.DecisionTrees.Models.TraversalAdditionalContext?o:new $$WP.DecisionTrees.Models.TraversalAdditionalContext;s.$root=t||$afe.select("body");s.afterCompleteCallback=e;s.settings=u;s.initialize(i,r,f,o)},v={$root:n,afterCompleteCallback:n,traversalInfo:n,currentInputNode:n,settings:n,_isActive:!0,initialize:function(n,t,i,r){var u=this;u.traversalInfo=new c({TreeID:n,SourceWorkflow:t,AdditionalContext:r,RestartTree:i});u.templateData={};u.templateData.StringNamespace=u.settings.StringNamespace;u.$root.empty().safeAppend($afe.renderTemplate($$WP.Templates.DecisionTrees.DecisionTree,u.templateData));u._nextStep()},destroy:function(){this.$root.empty();this.afterCompleteCallback=n;this._isActive=!1},render:function(){var i="#dt-banner",n=this,t;n._isActive&&(n.templateData={},n.templateData.StringNamespace=n.settings.StringNamespace,n.templateData.TreeWasLocked=n.traversalInfo.TreeWasLocked,n.$root.empty(),n.$root.safeAppend($afe.renderTemplate($$WP.Templates.DecisionTrees.DecisionTree,n.templateData)),n.traversalInfo.TreeWasLocked||(t=n.$root.find(f),n.traversalInfo.TreeWasDirty?n.$root.find(i).removeClass("hidden"):n.$root.find(i).addClass("hidden"),n._updateStrings(),n.currentInputNode.Type===e.Question?new l(t,n.currentInputNode,n.settings,n._onQuestionNodeCallback):n.currentInputNode.Type===e.Questionnaire?new a(t,n.currentInputNode,n.traversalInfo.SourceWorkflow,n.traversalInfo.TreeID,n.settings,n.traversalInfo.AdditionalContext,n._onQuestionnaireNodeCallback):$$WP.Debug.logError("Unsupported input node type encountered during tree traversal.")),n._showContent())},_updateStrings:function(){var n=this;$$WP.Strings.setDefaultNamespace(n.settings.StringNamespace);n.currentInputNode.ContinueButtonLabel=$$WP.Strings.getForTemplate("DTContinueButtonLabel");n.currentInputNode.BackButtonLabel=$$WP.Strings.getForTemplate("DTBackButtonLabel");n.currentInputNode.FinishLaterButtonLabel=$$WP.Strings.getForTemplate("DTFinishLaterButtonLabel");n.currentInputNode.CancelButtonLabel=$$WP.Strings.getForTemplate("DTCancelButtonLabel");$$WP.Strings.clearDefaultNamespace()},_nextStep:function(t){var i=this,f;i._fadeContent();f={};$$WPUtil.IsNullOrEmpty(i.traversalInfo)||(f.traversalInfo=i.traversalInfo.toRawObject());$$WPUtil.IsNullOrEmpty(i.currentInputNode)||(f.prevInputNode=i.currentInputNode.toRawObject(),f.prevInputNode.Question=n);f.question=t;$.ajax({url:makeLink("DecisionTrees/DecisionTree/NextStep"),type:u,dataType:r,data:$$WP.Utilities.postify(f),success:i._handleNextStepSuccess,error:i._handleError})},_previousStep:function(){var n=this,t;n._fadeContent();t={};n.currentInputNode.IsFirst||($$WPUtil.IsNullOrEmpty(n.traversalInfo)||(t.traversalInfo=n.traversalInfo.toRawObject()),$.ajax({url:makeLink("DecisionTrees/DecisionTree/PreviousStep"),type:u,dataType:r,data:$$WP.Utilities.postify(t),success:n._handlePreviousStepSuccess,error:n._handleError}))},_saveStep:function(t){var i=this,f;i._fadeContent();f={};$$WPUtil.IsNullOrEmpty(i.traversalInfo)||(f.traversalInfo=i.traversalInfo.toRawObject());$$WPUtil.IsNullOrEmpty(i.currentInputNode)||(f.inputNode=i.currentInputNode.toRawObject(),f.inputNode.Question=n);f.question=t;$.ajax({url:makeLink("DecisionTrees/DecisionTree/SaveStep"),type:u,dataType:r,data:$$WP.Utilities.postify(f),success:i._handleSaveStepSuccess,error:i._handleError})},_discardWorkflow:function(){var n=this,t;n._fadeContent();t={};$$WPUtil.IsNullOrEmpty(n.traversalInfo)||(t.traversalInfo=n.traversalInfo.toRawObject());$.ajax({url:makeLink("DecisionTrees/DecisionTree/DiscardWorkflow"),type:u,dataType:r,data:$$WP.Utilities.postify(t),success:n._handleDiscardWorkflowSuccess,error:n._handleError})},_handleNextStepSuccess:function(n){var t=this,u,r;u=n.NextInputNode;r=n.TraversalInfo;t.traversalInfo.IsTraversalComplete=r.IsTraversalComplete;t.traversalInfo.TreeWasDirty=r.TreeWasDirty;t.traversalInfo.TreeWasLocked=r.TreeWasLocked;t.traversalInfo.TreeAnswerID=r.TreeAnswerID;t.traversalInfo.RestartTree=!1;t.traversalInfo.TreeWasLocked?t.render():t.traversalInfo.IsTraversalComplete?t._performCallback(i.Complete,t.traversalInfo.TreeAnswerID):(t.currentInputNode=new h(u),t.settings&&t.settings.OnStepRender&&t.settings.OnStepRender(),t.render())},_handlePreviousStepSuccess:function(n){var t=this,u,r;u=n.PreviousInputNode;r=n.TraversalInfo;t.traversalInfo.IsTraversalComplete=r.IsTraversalComplete;t.traversalInfo.TreeWasDirty=r.TreeWasDirty;t.traversalInfo.TreeWasLocked=r.TreeWasLocked;t.traversalInfo.TreeAnswerID=r.TreeAnswerID;t.traversalInfo.TreeWasLocked?t.render():t.traversalInfo.IsTraversalComplete?t._performCallback(i.Complete,t.traversalInfo.TreeAnswerID):(t.currentInputNode=new h(u),t.settings&&t.settings.OnStepRender&&t.settings.OnStepRender(),t.render())},_handleSaveStepSuccess:function(n){var t=this;t.traversalInfo.TreeWasLocked=n.TraversalInfo.TreeWasLocked;t.traversalInfo.TreeWasLocked?t.render():t._performCallback(i.FinishLater,t.traversalInfo.TreeAnswerID)},_handleDiscardWorkflowSuccess:function(n){var t=this;t.traversalInfo.TreeWasLocked=n.TraversalInfo.TreeWasLocked;t.traversalInfo.TreeWasLocked?t.render():t._performCallback(i.FinishLater,t.traversalInfo.TreeAnswerID)},_handleError:function(){this._performCallback(i.Error)},_onQuestionNodeCallback:function(t,i){this._onButtonClick(t,i,n)},_onQuestionnaireNodeCallback:function(t,i){this._onButtonClick(t,n,i)},_onButtonClick:function(n,i,r){var u=this;u.currentInputNode.Type===e.Questionnaire&&(u.currentInputNode.Questionnaire=r);switch(n){case t.Next:u._nextStep(i);break;case t.Previous:u._previousStep();break;case t.Save:u._saveStep(i);break;case t.Cancel:u._discardWorkflow();break;case t.Error:u._handleError()}},_performCallback:function(t,i){var r=this;r.$root.empty();r.afterCompleteCallback!==n&&typeof r.afterCompleteCallback=="function"&&r.afterCompleteCallback(t,i)},_fadeContent:function(){this.$root.find(f).fadeTo("fast",.3);this.$root.find(s).fadeIn()},_showContent:function(){this.$root.find(s).fadeOut("slow");this.$root.find(f).fadeTo("fast",1);matchWrapHeight()}};o.prototype=v;$$WP.DecisionTrees.Controllers.DecisionTreeTraversalController=o;o.extend($$WP.Controllers.Controller,"WP$DecisionTrees$Controllers$DecisionTreeTraversalController")}()
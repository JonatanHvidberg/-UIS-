(function(){var y="continue",p="previousstep",w="data-is-editing",o="model-id",b="keypress",s="[data-function='edit-label-input']",h="click",a="[data-function='upload']",k="FileNotAcceptedPopupAnotherUploadErrorText",d="FileNotAcceptedPopupWrongExtensionErrorText",f="FileNotAcceptedPopupButtonText",e="FileNotAcceptedPopupHeaderText",t=!0,v="json",c="POST",n=null,i=!1,g="DocumentId",l;$$WP.Utilities.guaranteeExistence($$WP,"Upload.Controllers");l=function(n,t,r,u,f){var e=this,o;if(e.WP$Controllers$Controller(),e._viewContainer$=n,e._documentCollection=new $$WP.Common.ModelCollection([{propertyNames:g,storeAs:"single"}],[],[]),e._isConfigLoaded=i,e._settings=t,e._documentModelClass=u||$$WP.Upload.Models.Document,e.__afterRefreshView=f,r&&r.length>0)for(o=0;o<r.length;++o)e._documentCollection.add(new e._documentModelClass(r[o]));e.__pendingUploadFiles=[];e.proxify("_onAddButtonClicked","_onRemoveButtonClicked","_onEditButtonClicked","_uploadFile","_onFileNameEdited","__onDropFiles","__onDragEnter","__onDragLeave","_onFileNameInputKeyPressed","_onViewButtonClicked");e._getConfig();e._refreshView();e._attachEventHandlers()};l.prototype={_viewContainer$:n,_settings:n,_documentCollection:n,_documentModelClass:n,__afterRefreshView:n,_isConfigLoaded:n,_getConfig:function(){var n=this;n._settings.ConfigUrl?(n._isConfigLoaded=i,n.__isFunction(n._settings.onConfigStart)&&n._settings.onConfigStart(),$.ajax({type:c,dataType:v,data:$$WPUtil.postify(n._settings.ContextData),url:n._settings.ConfigUrl}).success($.proxy(n.__onConfigSuccess,n)).fail($.proxy(n.__onConfigFail,n))):n._isConfigLoaded=t},__onConfigSuccess:function(n){var i=this,r;if(n.Success){if(i._isConfigLoaded=t,r=new $$WP.Upload.Models.UploadConfiguration(n.Data),i._settings.AllowedExtensions=r.AllowedExtensions,i._settings.AllowedImageAndDocumentExtensions=r.AllowedImageAndDocumentExtensions,i._settings.AllowedVideoExtensions=r.AllowedVideoExtensions,i._settings.MaxAllowedImageSize=r.MaxAllowedImageSize,i._settings.MaxAllowedVideoSize=r.MaxAllowedVideoSize,i._settings.MaxFilesAllowed=r.MaxFilesAllowed,i._refreshView(),i.__isFunction(i._settings.onConfigSucess))i._settings.onConfigSucess(i._settings,n.Data)}else i.__onConfigFail(n)},__onConfigFail:function(n){this._handleCommunicationFail(u.GetConfig,n)},__pendingUploadFiles:n,_uploadFile:function(){var n=this._viewContainer$.find(".upload-input[data-function='upload-core']"),t=n.prop("files");this.__uploadFileCore(t)},__uploadFileCore:function(n){var t=this,i,u;if(t._settings.MaxFilesAllowed<t._documentCollection.Models.length+n.length){t.__isFunction(t._settings.onUploadFail)&&t._settings.onUploadFail();t._showErrorMessage("FileNotAcceptedPopupTooManyFilesErrorText",e,f);return}for(i=0;i<n.length;++i)if(u=t._settings.IsFileAceptable(n[i].name,n[i].size),u!==0){t.__isFunction(t._settings.onUploadFail)&&t._settings.onUploadFail();switch(u){case 1:t._showErrorMessage(d,e,f);break;case 2:t._showErrorMessage("FileNotAcceptedPopupLargeImageErrorText",e,f);break;case 3:t._showErrorMessage("FileNotAcceptedPopupLargeVideoErrorText",e,f)}return}if(r)t._showErrorMessage(k,e,f);else{for(i=0;i<n.length;++i)t.__pendingUploadFiles.push(n[i]);t.__flushUploadQueue()}},__flushUploadQueue:function(){var n=this,e=(n.__pendingUploadFiles||[]).length,f,u;if(e===0){r=i;n._refreshView(t);return}n.__isFunction(n._settings.onUploadStart)&&n._settings.onUploadStart();r=t;n._refreshView(t);f=n.__pendingUploadFiles.shift();u=new FormData;u.append("__file__[]",f);n._serializeContextToFormData(u,n._settings.ContextData);$.ajax({type:c,processData:i,contentType:i,data:u,url:n._settings.UploadUrl}).success($.proxy(n.__onUploadSuccess,n)).fail($.proxy(n.__onUploadFail,n))},__onUploadSuccess:function(n){var t=this,i,u,r;if(n.Success){for(r=[],u=(n.Data||[]).length,i=0;i<u;++i)r.push(new t._documentModelClass(n.Data[i]));if(t._documentCollection.addRange(r),t._refreshView(),t.__isFunction(t._settings.onUploadSuccess))t._settings.onUploadSuccess(r,n);t.__flushUploadQueue()}else t.__onUploadFail(n)},__onUploadFail:function(n){r=i;this.__pendingUploadFiles=[];this._refreshView(t);this._handleCommunicationFail(u.UploadFile,n)},_editFileName:function(n){var t=this,i=n.toRawObject()||{};i.ContextData=t._settings.ContextData;t.__isFunction(t._settings.onEditStart)&&t._settings.onEditStart();$.ajax({type:c,url:t._settings.EditUrl,data:$$WPUtil.postify(i),dataType:v}).success($.proxy(t._editFileNameSuccess,t)).fail($.proxy(t.__editFileNameFail,t))},_editFileNameSuccess:function(n){var t=this,i;if(n.Success){if(i=t._documentCollection.getFirstInIndex(g,n.Data.DocumentId),t.__isFunction(t._settings.onEditSuccess))t._settings.onEditSuccess(i,n)}else t.__editFileNameFail(n)},__editFileNameFail:function(n){this._handleCommunicationFail(u.EditFileName,n)},_deleteFile:function(n){var t=this,i=n.toRawObject()||{};i.ContextData=t._settings.ContextData;t.__isFunction(t._settings.onDeleteStart)&&t._settings.onDeleteStart();$.ajax({dataType:v,type:c,url:t._settings.DeleteUrl,data:$$WPUtil.postify(i)}).success($.proxy(t.__deleteSuccess,t,n)).fail($.proxy(t.__deleteFail,t))},__deleteSuccess:function(n,t){var i=this;if(t.Success){if(n&&(i._documentCollection.remove(n),i._refreshView(),i.__isFunction(i._settings.onDeleteSuccess)))i._settings.onDeleteSuccess(n,t)}else i.__deleteFail(t)},__deleteFail:function(n){this._handleCommunicationFail(u.DeleteFile,n)},_refreshView:function(n){var t=this,u={Configuration:t._settings,IsCurrentlyUploading:r,IsLimitReached:t._documentCollection.Models.length>=t._settings.MaxFilesAllowed,IsConfigLoading:t._isConfigLoaded===i,CanUpload:!r&&t._documentCollection.Models.length<t._settings.MaxFilesAllowed&&t._isConfigLoaded};$$WP.Strings.setDefaultNamespace(t._settings.DefaultStringNamespace);u.Documents=t._documentCollection.Models;n?t._viewContainer$.find(".upload-addFile").safeReplaceWith($afe.renderTemplate(t._settings.UploadCardTemplate,u)):t._viewContainer$.empty().safeAppend($afe.renderTemplate(t._settings.ViewTemplate,u));$$WP.Strings.clearDefaultNamespace();t._viewContainer$.find(".cardlist").trigger("cardLoad");$afe.jq(window).trigger("matchColumnHeights");$.isFunction(t.__afterRefreshView)&&t.__afterRefreshView()},_attachEventHandlers:function(){var t="[data-dragregion]",n=this;n.__isFunction(n._settings.AttachContainerEventHandlers)&&n._settings.AttachContainerEventHandlers();n.__isFunction(n._settings.AttachFileCardEventHandlers)&&n._settings.AttachFileCardEventHandlers();n._viewContainer$.on("click keypress",a,n._onAddButtonClicked);n._viewContainer$.on(h,"[data-function='remove']",n._onRemoveButtonClicked);n._viewContainer$.on(h,"[data-function='view']",n._onViewButtonClicked);n._viewContainer$.on("change","[data-function='upload-core']",n._uploadFile);n._viewContainer$.on(h,"[data-function='edit-label']",n._onEditButtonClicked);n._viewContainer$.on("blur",s,n._onFileNameEdited);n._viewContainer$.on(b,s,n._onFileNameInputKeyPressed);n._viewContainer$.on("dragover drop dragenter dragleave dragstart dragend",t,function(n){n.stopPropagation();n.preventDefault()});n._viewContainer$.on("dragover",t,function(n){n.originalEvent.dataTransfer.dropEffect="copy"});n._viewContainer$.on("drop",t,n.__onDropFiles);n._viewContainer$.on("dragover dragenter",t,n.__onDragEnter);n._viewContainer$.on("dragleave dragend",t,n.__onDragLeave)},__onDropFiles:function(n){var t=n.originalEvent.dataTransfer.files||[];this.__uploadFileCore(t)},__onDragEnter:function(){this._viewContainer$.find(a).addClass("hover")},__onDragLeave:function(){this._viewContainer$.find(a).removeClass("hover")},_onFileNameEdited:function(n){var i=$afe.jq(n.target).closest("input"),r=(i.val()||"").trim(),t=$$WP.Common.Model.getInstance(i.data(o));r.length>0&&r.length<=100&&t&&r!==t.FileDisplayName?(t.FileDisplayName=r,this._editFileName(t),this._refreshView()):(i.val(t.FileDisplayName),i.closest("[data-is-editing]").safeAttr(w,"false"))},_onFileNameInputKeyPressed:function(n){var t=n.which||n.keyCode;t===13&&(n.stopPropagation(),this._viewContainer$.find(s).trigger("blur"))},_onAddButtonClicked:function(t){var i="Upload";if(t.type!==b||t.keyCode===13){if(t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),r){new $$WPUtil.quickMessageBox($$WP.Strings.get(k,i),$$WP.Strings.get(e,i),[new $$WPComp.ComplexObjects.Button($$WP.Strings.get(f,i),n,p,y)]);return}this._viewContainer$.find("input[type='file'][data-function='upload-core']").trigger(h)}},_onRemoveButtonClicked:function(t){var i="@MYCHART@DOCUMENTNAME@",f=$afe.jq(t.target),r=$$WP.Common.Model.getInstance(f.data(o)),u;$$WP.Strings.setDefaultNamespace(this._settings.DefaultStringNamespace);$$WP.Strings.addMnemonic(i,r.FileDisplayName);u=[new $$WPComp.ComplexObjects.Button($$WP.Strings.get("DocumentRemovePopupRemoveButtonText"),n,"inlinedelete","remove"),new $$WPComp.ComplexObjects.Button($$WP.Strings.get("DocumentRemovePopupGoBackButtonText"),n,"cancel","cancel")];new $$WPUtil.quickMessageBox($$WP.Strings.get("DocumentRemovePopupDescriptionText"),$$WP.Strings.get("DocumentRemovePopupHeaderText"),u,$.proxy(this._onRemovePopupButtonClicked,this),[r]);$$WP.Strings.removeMnemonic(i);$$WP.Strings.clearDefaultNamespace()},_onRemovePopupButtonClicked:function(n,t){t===$$WPComp.TOOLBARIDENTIFIER+"remove"&&this._deleteFile(n)},_onEditButtonClicked:function(n){n.stopPropagation();n.preventDefault();var i=$afe.jq(n.target),r=$$WP.Common.Model.getInstance(i.data(o)),t=this._viewContainer$.find("[data-document-id='"+r.DocumentId+"'][data-is-editing]");t.safeAttr(w,"true");t.find(s).focus()},_onViewButtonClicked:function(t){t.stopPropagation();t.preventDefault();var f=$afe.jq(t.target),r=$$WP.Common.Model.getInstance(f.data(o)),u=new $$WP.Documents.ViewDocument.Models.DocumentModel(n,{},encodeURIComponent(r.FileReference),encodeURIComponent(r.DocumentId),r.FileDisplayName,r.FileExtensionWithoutDot);r.AllowPreview||(u.AllowPreview=i);u.openAsPopup("uploadWidget sm-autosizedpopup")},getAllDocuments:function(){return this._documentCollection.Models},getDocumentCollection:function(){return this._documentCollection},getUploadContextData:function(){var t=n;return $$WPUtil.IsNullOrEmpty(this._settings)||(t=this._settings.ContextData),t},DeleteFile:function(n){this._deleteFile(n)},RefreshView:function(n){this._refreshView(n)},_serializeContextToFormData:function(n,t){var i;if(t)for(i in t)n.append(i,t[i])},_handleCommunicationFail:function(n,r){var f=this,e=t,o="";switch(n){case u.GetConfig:e=f.__isFunction(f._settings.onConfigFail)?f._settings.onConfigFail(r):t;o="ServerErrorPopupDescriptionGetConfigFailedText";break;case u.UploadFile:e=f.__isFunction(f._settings.onUploadFail)?f._settings.onUploadFail(r):t;o="ServerErrorPopupDescriptionUploadFileFailedText";break;case u.EditFileName:e=f.__isFunction(f._settings.onEditFail)?f._settings.onEditFail(r):t;o="ServerErrorPopupDescriptionEditFileFailedText";break;case u.DeleteFile:e=f.__isFunction(f._settings.onDeleteFail)?f._settings.onDeleteFail(r):t;o="ServerErrorPopupDescriptionDeleteFileFailedText"}e!==i&&f._showErrorMessage(o,"ServerErrorPopupHeaderText","ServerErrorPopupButtonText")},_showErrorMessage:function(t,i,r){var f="@MYCHART@ALLOWEDVIDEOSIZE@",e="@MYCHART@ALLOWEDIMAGESIZE@",o="@MYCHART@ALLOWEDEXTENSIONS@",s="@MYCHART@MAXUPLOADS@",u=this;$$WP.Strings.setDefaultNamespace(u._settings.DefaultStringNamespace);$$WP.Strings.addMnemonic(s,u._settings.MaxFilesAllowed);$$WP.Strings.addMnemonic(o,u._settings.AllowedExtensions.join(", "));$$WP.Strings.addMnemonic(e,Math.floor(u._settings.MaxAllowedImageSize*10/1024)/10);$$WP.Strings.addMnemonic(f,Math.floor(u._settings.MaxAllowedVideoSize*10/1024)/10);t==d&&u._settings.AllowedExtensions.length==0&&(t="FileNotAcceptedPopupWrongExtensionErrorTextNoExtensions");new $$WPUtil.quickMessageBox($$WP.Strings.get(t),$$WP.Strings.get(i),[new $$WPComp.ComplexObjects.Button($$WP.Strings.get(r),n,p,y)]);$$WP.Strings.removeMnemonic(f);$$WP.Strings.removeMnemonic(e);$$WP.Strings.removeMnemonic(o);$$WP.Strings.removeMnemonic(s);$$WP.Strings.clearDefaultNamespace();u._refreshView()},__isFunction:function(n){return n&&typeof n=="function"}};var r=i,u={GetConfig:1,UploadFile:2,EditFileName:3,DeleteFile:4},nt=function(){return r};$$WP.Upload.Controllers.UploadController=l;$$WP.Upload.Controllers.IsCurrentlyUploading=nt;l.extend($$WP.Controllers.Controller,"$$WP$Upload$Controllers$UploadController")})(),function(){$$WP.Utilities.guaranteeExistence($$WP,"Documents.ViewDocument.Components");var n=function(n){var i="previousstep",r="viewdocument",t=this,u;if(t.template=n.Template,t.Components$TemplateComponent(t._buildSettingsBag(n)),n.IsHNOOnly){n.displayHNO();return}if(t.ToolbarButtons=[],!n.AllowPreview&&n.AllowDownload&&(u=new $$WPComp.ComplexObjects.Button($$WP.Strings.get("download",r),null,i,"downloadfile"),t.ToolbarButtons.push(u)),t.ToolbarButtons.push(new $$WPComp.ComplexObjects.Button($$WP.Strings.get("closeButtonText",r),null,i,"close")),n.WasESigned==="1"||n.WasESigned===!0){n.displayESign();return}};n.prototype={template:$$WP.Templates.Documents.ViewDocument.Document,_buildSettingsBag:function(n){var t=n.DocType;return(n.PendingApproval||n.Rejected)&&(t=n.DocDesc),{Data:n,IsClosable:!0,TitleText:t}}};$$WP.Documents.ViewDocument.Components.DocumentComponent=n;n.extend("Components.TemplateComponent")}()
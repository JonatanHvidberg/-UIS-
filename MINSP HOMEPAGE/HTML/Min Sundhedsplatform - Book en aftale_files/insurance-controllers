$$WP.Utilities.UI.Cards=function(n){var t=".cardlist.matchHeights";if(!$$WP.Utilities.UI.IsMobile){if(n.type==="load"){$afe.select(".cardlist.hoverable").each($$WP.Utilities.UI.Cards.HandleHoverable);$afe.select("body").on("cardLoad",".cardlist",$$WP.Utilities.UI.Cards.LoadCardlist).on("matchCardHeights",t,$$WP.Utilities.UI.Cards.MatchHeights)}$afe.select(t).each($$WP.Utilities.UI.Cards.MatchHeights)}};$$WP.Utilities.UI.Cards.LoadCardlist=function(){var n=$afe.jq(this);isDataTile()&&n.is(".cardlist.column_3, .cardlist.column_4")&&n.removeClass("column_3 column_4").addClass("column_2");n.hasClass("hoverable")&&$.proxy($$WP.Utilities.UI.Cards.HandleHoverable,n)();n.hasClass("matchHeights")&&$.proxy($$WP.Utilities.UI.Cards.MatchHeights,n)()};$$WP.Utilities.UI.Cards.HandleHoverable=function(){var n=".card",t="hoverable",i=$afe.jq(this);i.hasClass(t)&&i.find(n).each(function(){var i="hover",r=$afe.jq(this);if(!r.prop(t)){r.hover(function(n){n.type==="mouseenter"?$afe.jq(this).addClass(i):$afe.jq(this).removeClass(i)});r.find(".button, [data-id='additem']").on("focus blur",function(t){t.type==="focus"?$afe.jq(this).parentsUntil(n).andSelf().parent(n).addClass(i):$afe.jq(this).parentsUntil(n).andSelf().parent(n).removeClass(i)});r.prop(t,!0)}})};$$WP.Utilities.UI.Cards.MatchHeights=function(){var e="minHeight",f,r,n,i,t,u;if(!$$WP.Utilities.UI.IsMobile&&$$WP.ApplicationContext!==78&&(f=$afe.jq(this),n=f.prop("class"),n=parseInt(n.substr(n.indexOf("column_")+7)),!isNaN(n)))for(r=f.find(".card, .innercard").css(e,""),i=0;i<r.length;i+=n){for(u=r.eq(i).outerHeight(),t=1;t<n;t++)u=Math.max(u,r.eq(i+t).outerHeight());for(t=0;t<n;t++)r.eq(i+t).css(e,u)}};$$WP.Utilities.UI.Map.Support.cards=$$WP.Utilities.UI.Cards,function(){var it="#subscriberId",rt="#subscriberLastName",ut="#subscriberFirstName",ft="#groupNumber",et="#memberId",ot="form[data-id='updateCoverage'] .button.nextstep",y="continue",st="#comments",ht="input[name='isSubscriber']:checked",b="form",ct="[data-id='insuranceCards'] .insuranceCard img.selected",f="disabled",p="#payorName",e="selected",k="[data-id='insurancecard-next']",d="[data-id='insurancecard-back']",lt="[data-id='uploadFields']",w="[data-id='insuranceCards']",g="[data-id='coverageFields']",h="click",c="change",nt="#payors",tt="UpdateCoverageSubmit",u="Insurance",i=!0,l=".loadingoverlay",a=".insuranceVerification",r=null,s="ID",o="object",t=!1,vt=$$WP.Controllers.Controller,n={AddNew:1,EditNew:2,DiscardNew:3,EditExisting:4,DeleteExisting:5,RestoreDeleted:6,UploadNewCards:7,VerifyExistingCards:8},at=makeLink("Insurance/Coverages/SubmitCoverageUpdate"),v=function(i,u,f,e,h,c,l,a){var v=this,y,p;v.WP$Controllers$Controller();v.proxify("_onPayorChanged","_onNextInsuranceCardClicked","_onPreviousInsuranceCardClicked","_onIsSubscriberChanged","_onSubmit","_onSubmitSuccess","_onCancel","_onPopUpResponse","_onCoverageNotFoundErrorResponse","_onSubmitCoverageErrorResponse","_handleCustomFormValidation","_handleEscapeKeyPress");v.$root=i;v._action=u;v._id=f;v._isInpatient=a?a.IsInpatient:t;typeof e===o&&(v._data=e);typeof h===o&&(v._payors=h);$.isFunction(c)&&(v._callback=c);v._settings=typeof l===o?l||{}:{};switch(u){case n.AddNew:case n.EditNew:v._template=$$WP.Templates.Insurance.UpdateCoverage;v._fieldsTemplate=$$WP.Templates.Insurance.UpdateCoverageFields;v._insuranceCardsTemplate=$$WP.Templates.Insurance.UpdateCoverageInsuranceCards;typeof a===o&&(v._encounterCsn=a.EncounterCsn,v._encounterDepartmentId=a.EncounterDepartment,v._encounterDTE=a.EncounterDTE);u!==n.AddNew&&(v._coverage=v._data.getFromIndex(s,v._id),v._coverage===r&&v._drawCoverageNotFoundError());v._uploadControllerDataPool=new $$WP.Insurance.UploadCoverageDataPool(v._settings.UploadConfiguration,u);v._drawView();break;case n.EditExisting:case n.DeleteExisting:v._template=$$WP.Templates.Insurance.UpdateCoverage;v._fieldsTemplate=$$WP.Templates.Insurance.UpdateCoverageCommentsOnly;typeof a===o&&(v._encounterCsn=a.EncounterCsn,v._encounterDepartmentId=a.EncounterDepartment,v._encounterDTE=a.EncounterDTE);v._coverage=v._data.getFromIndex(s,v._id);v._coverage===r&&v._drawCoverageNotFoundError();v._drawView();break;case n.DiscardNew:case n.RestoreDeleted:v._coverage=v._data.getFromIndex(s,v._id);v._coverage===r&&v._drawCoverageNotFoundError();v._drawPopUp();break;case n.UploadNewCards:v._template=$$WP.Templates.Insurance.UpdateCoverage;typeof a===o&&(v._encounterCsn=a.EncounterCsn,v._encounterDepartmentId=a.EncounterDepartment,v._encounterDTE=a.EncounterDTE);v._coverage=v._data.getFromIndex(s,v._id);v._coverage===r&&v._drawCoverageNotFoundError();y=v._coverage&&v._coverage.FrontDocument;p=v._coverage&&v._coverage.BackDocument;v._uploadControllerDataPool=new $$WP.Insurance.UploadCoverageDataPool(v._settings.UploadConfiguration,u,y,p);v._drawPopUp()}},yt={$root:r,_callback:r,_action:r,_id:r,_coverage:r,_data:r,_payors:r,_template:r,_fieldsTemplate:r,_fieldsViewModel:r,_insuranceCardsTemplate:r,_settings:r,_encounterCsn:"",_encounterDepartmentId:"",_encounterDTE:"",_uploadController:r,_uploadControllerDataPool:r,_isInpatient:t,_drawView:function(){var e="UpdateCoverageSubmitTooltip",r=this,f;if(r._settings.InitializeAsLoading){r.$root.parents(a).find(l).show();return}f={Action:r._action,Coverage:r._coverage,Payors:r._payors.Models.sort(function(n,t){return n.Name.localeCompare(t.Name)}),PayorsValidationSettings:new $$WP.FormValidation.ValidationSettings({required:i}),PayorsInitiallyInvalid:t};switch(r._action){case n.AddNew:r.$root.removeClass("addItem").css("width","100%");f.CoverageHeader=$$WP.Strings.get("AddCoverageButton",u);f.SubmitText=$$WP.Strings.get(tt,u);f.SubmitTooltip=$$WP.Strings.get(e,u);break;case n.EditNew:case n.EditExisting:case n.RestoreDeleted:f.CoverageHeader=r._coverage.PayorName;f.SubmitText=$$WP.Strings.get(tt,u);f.SubmitTooltip=$$WP.Strings.get(e,u);break;case n.DeleteExisting:case n.DiscardNew:f.CoverageHeader=r._coverage.PayorName;f.SubmitText=$$WP.Strings.get("DeleteCoverageSubmit",u);f.SubmitTooltip=$$WP.Strings.get("DeleteCoverageSubmitTooltip",u)}r.$root.empty();r.$root.safeAppend($afe.renderTemplate(r._template,f));r.$root.show();switch(r._action){case n.EditNew:r._drawFieldsView(r._coverage.PayorId);break;case n.EditExisting:case n.DeleteExisting:r._drawCommentsOnlyView()}r._bindBehaviors();$$WP.FormValidation.initializeDOMSubtree(r.$root);matchWrapHeight();r._handleFocusAndScrolling()},_handleFocusAndScrolling:function(){var r="html, body",i,t;i=this.$root.find(".cardline.header.name");switch(this._action){case n.AddNew:t=i.offset().top;$$WP.Utilities.UI.IsMobile||(t-=parseInt($afe.select("#header").css("height")));$afe.select(r).animate({scrollTop:t},250);break;case n.EditExisting:case n.DeleteExisting:t=this.$root.offset().top;$$WP.Utilities.UI.IsMobile||(t-=parseInt($afe.select("#header").css("height")));$afe.select(r).animate({scrollTop:t},250)}i.focus()},_bindBehaviors:function(){var n=this;n.$root.find(nt).on(c,n._onPayorChanged);n.$root.find("form[data-id='updateCoverage']").on("submit",n._onSubmit);n.$root.find("[data-id='cancel']").on(h,n._onCancel)},_onPayorChanged:function(){var n=this,t;t=n.$root.find(nt).val();$$WP.Utilities.IsNullOrEmpty(t)?(n.$root.find(g).empty(),n.$root.find(w).empty(),n.$root.find(lt).empty()):n._drawFieldsView(t)},_drawFieldsView:function(n){var t=this;t._buildFieldsViewModel(n);t._drawCoverageFieldsControl(t._fieldsTemplate,t._fieldsViewModel);t._drawCoverageCardsControl(t._insuranceCardsTemplate,t._fieldsViewModel);t._drawUploadControl(n);$$WP.FormValidation.initializeDOMSubtree(t.$root);matchWrapHeight()},_drawCoverageFieldsControl:function(n,t){var i=this;i.$root.find(g).empty().safeAppend($afe.renderTemplate(n,t));i.$root.find("#isSubscriber input").on(c,i._onIsSubscriberChanged);i.$root.find("input[type='text']").each(function(){var n=$afe.jq(this);$$WP.Utilities.IsNullOrEmpty(n.val())||n.trigger(c)});i.$root.find("input[type='radio']:checked").trigger(c)},_drawCoverageCardsControl:function(n,t){var i=this;t.SampleCardImages&&t.SampleCardImages.length?i.$root.find(w).empty().safeAppend($afe.renderTemplate(n,t)):i.$root.find(w).empty();i.$root.find(d).on(h,i._onPreviousInsuranceCardClicked);i.$root.find(k).on(h,i._onNextInsuranceCardClicked);i.$root.find("[data-id='insuranceCards'] .insuranceCard img:first").addClass(e)},_drawUploadControl:function(t,u,f){var e=this,c,o,h;if((t==="-1"||$$WP.Utilities.IsNullOrEmpty(t)||(o=e._payors.getFromIndex(s,t)),h=e.$root.find(lt),h.empty(),e._uploadControllerDataPool.canUseUploadFeature()&&(!o||o.CanUpload))&&(e._action===n.AddNew||e._action===n.UploadNewCards)){if(c=e._action===n.UploadNewCards?{isUploadRequired:i,onActionStartCallback:e._handleCustomFormValidation,onActionFinishedCallback:e._handleCustomFormValidation,IsInpatient:e._isInpatient}:{IsInpatient:e._isInpatient},e._uploadControllerDataPool.clearDocuments(),e._uploadController=new $$WP.Insurance.UploadCoverageController(h,e._uploadControllerDataPool,c),e._uploadController.render(r,f),$$WP.Utilities.IsNullOrEmpty(u)){if(o)e._uploadController.changeContextData(o.Name);else if(t==="-1")e.$root.find(p).on("blur",$.proxy(function(){this._uploadController.changeContextData(this.$root.find(p).val())},e))}else e._uploadController.changeContextData(u);e._popup&&e.$root.find(".addItem.upload-addFile > a").first().focus()}},_handleCustomFormValidation:function(){var u=this,n;u._uploadController!==r&&(n=u.$root.find("[data-id='submit']").first(),u._uploadController.isReadyForSubmission()?(n.removeClass(f),n.prop(f,t)):(n.addClass(f),n.prop(f,i)),u._popup&&$afe.jq(window).trigger("resize"))},_onPreviousInsuranceCardClicked:function(){var t,n;t=this.$root.find(ct);n=t.prev("img");n.length&&(t.removeClass(e),n.addClass(e));this.$root.find(k).removeClass(f);n.prev("img").length||this.$root.find(d).addClass(f)},_onNextInsuranceCardClicked:function(){var t,n;t=this.$root.find(ct);n=t.next();n.length&&(t.removeClass(e),n.addClass(e));this.$root.find(d).removeClass(f);n.next().length||this.$root.find(k).addClass(f)},_buildFieldsViewModel:function(r){var u=this,e,f;r==="-1"||$$WP.Utilities.IsNullOrEmpty(r)&&u._action===n.EditNew?(f={IsProxyContext:u._settings.IsProxyContext,ShowPayorNameField:i,PayorNameValidationSettings:new $$WP.FormValidation.ValidationSettings({required:i,maxLength:192}),PayorNameInitiallyInvalid:t,ShowMemberIdField:i,MemberIdValidationSettings:new $$WP.FormValidation.ValidationSettings({required:i,maxLength:50}),MemberIdInitiallyInvalid:t,ShowGroupNumberField:i,GroupNumberValidationSettings:new $$WP.FormValidation.ValidationSettings({required:t,maxLength:18}),GroupNumberInitiallyInvalid:t,ShowSubscriberFields:i,IsSubscriberValidationSettings:new $$WP.FormValidation.ValidationSettings({required:i}),IsSubscriberInitiallyInvalid:t,ShowSubscriberFirstNameField:i,SubscriberFirstNameValidationSettings:new $$WP.FormValidation.ValidationSettings({required:i}),SubscriberFirstNameInitiallyInvalid:t,ShowSubscriberLastNameField:i,SubscriberLastNameValidationSettings:new $$WP.FormValidation.ValidationSettings({required:i}),SubscriberLastNameInitiallyInvalid:t,ShowSubscriberDateOfBirthField:i,SubscriberDateOfBirthValidationSettings:new $$WP.FormValidation.ValidationSettings({required:t,isDate:i}),SubscriberDateOfBirthInitiallyInvalid:t,ShowSubscriberIdField:i,SubscriberIdValidationSettings:new $$WP.FormValidation.ValidationSettings({required:t,maxLength:50}),SubscriberIdInitiallyInvalid:t},u._coverage&&(f.PayorName=u._coverage.PayorName,f.MemberId=u._coverage.MemberId,f.GroupNumber=u._coverage.GroupNumber,f.IsSubscriber=u._coverage.PatientIsSubscriber,f.SubscriberId=u._coverage.SubscriberId,f.SubscriberFirstName=u._coverage.SubscriberFirstName,f.SubscriberLastName=u._coverage.SubscriberLastName,$$WP.Utilities.IsNullOrEmpty(u._coverage.SubscriberDateOfBirth)||(f.SubscriberDateOfBirth=$$WP.I18N.formatPatientGivenDate(new Date((u._coverage.SubscriberDateOfBirth-47117)*864e5))))):(e=u._payors.getFromIndex(s,r),f=u._buildFieldsViewModelFromPayor(e,u._action),f.IsProxyContext=u._settings.IsProxyContext,u._coverage&&(f.MemberId=u._coverage.MemberId,f.GroupNumber=u._coverage.GroupNumber,f.IsSubscriber=u._coverage.PatientIsSubscriber,f.SubscriberId=u._coverage.SubscriberId,f.SubscriberFirstName=u._coverage.SubscriberFirstName,f.SubscriberLastName=u._coverage.SubscriberLastName,$$WP.Utilities.IsNullOrEmpty(u._coverage.SubscriberDateOfBirth)||(f.SubscriberDateOfBirth=$$WP.I18N.formatPatientGivenDate(new Date((u._coverage.SubscriberDateOfBirth-47117)*864e5)))));u._fieldsViewModel=f},_buildFieldsViewModelFromPayor:function(r,u){var e=new Date(1841,0,1),o=new Date,f;return f={ShowPayorNameField:t,ShowMemberFirstNameField:r.Fields.MemberFirstName>0,MemberFirstNameValidationSettings:new $$WP.FormValidation.ValidationSettings({required:r.Fields.MemberFirstName>1,maxLength:50}),MemberFirstNameInitiallyInvalid:t,ShowMemberLastNameField:r.Fields.MemberLastName>0,MemberLastNameValidationSettings:new $$WP.FormValidation.ValidationSettings({required:r.Fields.MemberLastName>1,maxLength:50}),MemberLastNameInitiallyInvalid:t,ShowMemberDateOfBirthField:r.Fields.MemberDateOfBirth>0,MemberDateOfBirthValidationSettings:new $$WP.FormValidation.ValidationSettings({required:r.Fields.MemberDateOfBirth>1,isDate:i,minDate:e,maxDate:o}),MemberDateOfBirthInitiallyInvalid:t,ShowMemberIdField:r.Fields.MemberId>0,MemberIdValidationSettings:new $$WP.FormValidation.ValidationSettings({required:r.Fields.MemberId>1,maxLength:50}),MemberIdInitiallyInvalid:t,ShowGroupNumberField:r.Fields.GroupNumber>0,GroupNumberValidationSettings:new $$WP.FormValidation.ValidationSettings({required:r.Fields.GroupNumber>1,maxLength:18}),GroupNumberInitiallyInvalid:t,ShowSubscriberFirstNameField:r.Fields.SubscriberFirstName>0,SubscriberFirstNameValidationSettings:new $$WP.FormValidation.ValidationSettings({required:r.Fields.SubscriberFirstName>1}),SubscriberFirstNameInitiallyInvalid:t,ShowSubscriberLastNameField:r.Fields.SubscriberLastName>0,SubscriberLastNameValidationSettings:new $$WP.FormValidation.ValidationSettings({required:r.Fields.SubscriberLastName>1}),SubscriberLastNameInitiallyInvalid:t,ShowSubscriberDateOfBirthField:r.Fields.SubscriberDateOfBirth>0,SubscriberDateOfBirthValidationSettings:new $$WP.FormValidation.ValidationSettings({required:r.Fields.SubscriberDateOfBirth>1,isDate:i,minDate:e,maxDate:o}),SubscriberDateOfBirthInitiallyInvalid:t,ShowSubscriberIdField:r.Fields.SubscriberId>0,SubscriberIdValidationSettings:new $$WP.FormValidation.ValidationSettings({required:r.Fields.SubscriberId>1,maxLength:50}),SubscriberIdInitiallyInvalid:t},u===n.AddNew&&(f.SampleCardImages=r.SampleCardImages),f.ShowSubscriberFields=f.ShowSubscriberIdField||f.ShowSubscriberFirstNameField||f.ShowSubscriberLastNameField||f.ShowSubscriberDateOfBirthField,f.IsSubscriberValidationSettings=new $$WP.FormValidation.ValidationSettings({required:f.SubscriberIdValidationSettings.required||f.SubscriberFirstNameValidationSettings.required||f.SubscriberLastNameValidationSettings.required||f.SubscriberDateOfBirthValidationSettings.required}),f.IsSubscriberInitiallyInvalid=t,f},_onIsSubscriberChanged:function(){var n,t;n=this.$root.find(b);t=this.$root.find("[data-id='subscriberInfo']");this.$root.find(ht).val()==="0"?(t.show(),$$WP.FormValidation.checkIfFormIsValid(n,i)):(t.hide(),$$WP.FormValidation.checkIfFormIsValid(n,i));matchWrapHeight()},_drawCommentsOnlyView:function(){var s="p.required",r=this,u,f,e,o;u={Coverage:r._coverage,ValidationSettings:new $$WP.FormValidation.ValidationSettings({required:r._action===n.EditExisting,maxLength:300,showCharacterCounter:i}),InitiallyInvalid:t};r.$root.find(g).empty().safeAppend($afe.renderTemplate(r._fieldsTemplate,u));u.ValidationSettings.required?r.$root.find(s).show():r.$root.find(s).hide();f=r.$root.find(st);f.val()&&f.trigger(c);$$WP.FormValidation.initializeDOMSubtree(r.$root);matchWrapHeight();$$WP.Utilities.UI.IsMobile||(e=r.$root.find("#insurancebuttons"),o=r.$root.height(),e.css("position","absolute"),e.css("bottom","0.5rem"),r.$root.height()<o&&r.$root.height(o))},_drawPopUp:function(){var s="previousstep",h="inlinesave",f=this,e,o,c;f._action===n.DiscardNew?(e=new $$WPComp.MessageComponent({Message:$$WP.Strings.getNamespace(u).getString("DiscardCoveragePrompt"),ToolbarButtons:[new $$WPComp.ComplexObjects.Button($$WP.Strings.getNamespace(u).getString("DiscardCoverageConfirmButtonLabel"),r,h,y),new $$WPComp.ComplexObjects.Button($$WP.Strings.getNamespace(u).getString("DiscardCoverageCancelButtonLabel"),r,s,"cancel")],callback:f._onPopUpResponse}),f._popup=$$WP.Utilities.quickPopup(e,o)):f._action===n.RestoreDeleted?(e=new $$WPComp.MessageComponent({Message:$$WP.Strings.getNamespace(u).getString("RestoreCoveragePrompt"),ToolbarButtons:[new $$WPComp.ComplexObjects.Button($$WP.Strings.getNamespace(u).getString("RestoreCoverageConfirmButtonLabel"),r,h,y),new $$WPComp.ComplexObjects.Button($$WP.Strings.getNamespace(u).getString("RestoreCoverageCancelButtonLabel"),r,s,"cancel")],callback:f._onPopUpResponse}),f._popup=$$WP.Utilities.quickPopup(e,o)):f._action===n.UploadNewCards&&(e=new $$WPComp.TemplateComponent({template:$$WP.Templates.Insurance.UploadPopupContainer,IsClosable:t}),c={SubmitText:$$WP.Strings.get(tt,u),SubmitTooltip:$$WP.Strings.get("UploadToCoverageSubmitTooltip",u),HeaderText:f._coverage.PayorName},e.setData(c),f.$root=e.$content,o={HasOverlay:i,positioningFunction:$$WPContain.Positions.InsideCentered,Size:$$WPContain.Popup.SizeEnum.SMALL,Class:"Popup uploadInsurancePopup"},$$WP.Utilities.UI.IsMobile&&(o.Class+=" sm-autosizedpopup"),f._popup=$$WP.Utilities.quickPopup(e,o),f._drawUploadControl("",f._coverage.PayorName,i),f._bindBehaviors(),f._handleCustomFormValidation(),$afe.jq(window).trigger("resize"),f._popup.addEventListener("keydown",f._handleEscapeKeyPress))},_handleEscapeKeyPress:function(n){n.which===27&&this._onCancel()},_onPopUpResponse:function(n){var i=this,r;n==="toolbarcontinue"&&(r={action:i._action,coverageId:i._coverage.CoverageId,index:i._coverage.Index},$.post({url:at,data:r,cache:t,success:i._onSubmitSuccess}))},_drawCoverageNotFoundError:function(){var n;n=new $$WPComp.MessageComponent({Message:$$WP.Strings.getNamespace(u).getString("CoverageNotFoundErrorPrompt"),ToolbarButtons:[new $$WPComp.ComplexObjects.Button($$WP.Strings.getNamespace(u).getString("CoverageNotFoundErrorButtonLabel"),r,"",y)],callback:this._onCoverageNotFoundErrorResponse});$$WP.Utilities.quickPopup(n)},_onCoverageNotFoundErrorResponse:function(){this._callback()},_drawSubmitCoverageError:function(){var n;n=new $$WPComp.MessageComponent({Message:$$WP.Strings.getNamespace(u).getString("SubmitCoverageErrorPrompt"),ToolbarButtons:[new $$WPComp.ComplexObjects.Button($$WP.Strings.getNamespace(u).getString("SubmitCoverageErrorButtonLabel"),r,"",y)],callback:this._onSubmitCoverageErrorResponse});$$WP.Utilities.quickPopup(n)},_onSubmitCoverageErrorResponse:function(){},_onSubmit:function(r){var u=this,f,e,o;if(r.preventDefault(),f=u.$root.find(b),$$WP.FormValidation.checkIfFormIsValid(f,t)&&(!u._uploadController||u._uploadController.isReadyForSubmission()&&!$$WP.Upload.Controllers.IsCurrentlyUploading())){u.$root.find(ot).on(h,function(){return t});u.$root.parents(a).find(l).show();switch(u._action){case n.AddNew:case n.EditNew:e={action:u._action,payorName:f.find(p).val(),memberId:f.find(et).val(),groupNumber:f.find(ft).val(),isSubscriber:f.find(ht).val(),subscriberFirstName:f.find(ut).val(),subscriberLastName:f.find(rt).val(),subscriberId:f.find(it).val(),encounterCsn:u._encounterCsn,encounterDepartmentId:u._encounterDepartmentId,encounterDTE:u._encounterDTE,frontDocument:u._getDocumentSubmission(i),backDocument:u._getDocumentSubmission(t)};u._action===n.AddNew?e.payorId=f.find(nt).val():(e.index=u._coverage.Index,e.payorId=u._coverage.PayorId);o=f.find("#subscriberDateOfBirth").val();$$WP.Utilities.IsNullOrEmpty(o)||(e.subscriberDateOfBirth=WP.Utils.date2dte(new Date(o)));break;case n.DiscardNew:e={action:u._action,index:u._coverage.Index};break;case n.EditExisting:case n.DeleteExisting:e={action:u._action,coverageId:u._coverage.CoverageId,index:u._coverage.Index,comments:f.find(st).val(),encounterCsn:u._encounterCsn,encounterDepartmentId:u._encounterDepartmentId,encounterDTE:u._encounterDTE};break;case n.UploadNewCards:e={action:u._action,coverageId:u._coverage.CoverageId,index:u._coverage.Index,encounterCsn:u._encounterCsn,encounterDepartmentId:u._encounterDepartmentId,encounterDTE:u._encounterDTE,frontDocument:u._getDocumentSubmission(i),backDocument:u._getDocumentSubmission(t)};break;default:e={}}$.post({url:at,data:e,cache:t,success:u._onSubmitSuccess})}},_onSubmitSuccess:function(n){var f="invalid",e="true",o="data-invalid",t=this,r;if(t._popup&&t._popup.dispose(),n.Success===i)t._callback();else{if(t.$root.find(ot).unbind(h),t.$root.parents(a).find(l).hide(),Array.isArray(n.Errors)&&n.Errors.length)for(r=0;r<n.Errors.length;r++)n.Errors[r]==="INVALID-MEMBER-ID"?(t.$root.find(et).safeAttr(o,e).addClass(f),t.$root.find("[data-message-display-for='memberId']").empty().safeAppend($$WP.SimpleTemplates.ValidationMessage($$WP.Strings.getNamespace(u).getString("UpdateCoverageMemberIdInvalidError")))):n.Errors[r]==="INVALID-SUBSCRIBER-ID"?(t.$root.find(it).safeAttr(o,e).addClass(f),t.$root.find("[data-message-display-for='subscriberId']").empty().safeAppend($$WP.SimpleTemplates.ValidationMessage($$WP.Strings.getNamespace(u).getString("UpdateCoverageSubscriberIdInvalidError")))):n.Errors[r]==="INVALID-GROUP-NUMBER"?(t.$root.find(ft).safeAttr(o,e).addClass(f),t.$root.find("[data-message-display-for='groupNumber']").empty().safeAppend($$WP.SimpleTemplates.ValidationMessage($$WP.Strings.getNamespace(u).getString("UpdateCoverageGroupNumberInvalidError")))):n.Errors[r]==="INVALID-SUBSCRIBER-NAME"?(t.$root.find(ut).safeAttr(o,e).addClass(f),t.$root.find(rt).safeAttr(o,e).addClass(f),t.$root.find("[data-message-display-for='subscriberLastName']").empty().safeAppend($$WP.SimpleTemplates.ValidationMessage($$WP.Strings.getNamespace(u).getString("UpdateSubscriberNameInvalidError")))):n.Errors[r]==="INVALID-PAYOR-NAME"&&(t.$root.find(p).safeAttr(o,e).addClass(f),t.$root.find("[data-message-display-for='payorName']").empty().safeAppend($$WP.SimpleTemplates.ValidationMessage($$WP.Strings.getNamespace(u).getString("UpdateCoveragePayorNameInvalidError"))));else t._drawSubmitCoverageError();$$WP.FormValidation.checkIfFormIsValid(t.$root.find(b),i)}},_getDocumentSubmission:function(n){return this._uploadController!==r?n?this._uploadController.getFrontDocId():this._uploadController.getBackDocId():r},_onCancel:function(){var t=this;(t._action===n.AddNew||t._action===n.UploadNewCards)&&t._uploadController!==r&&t._uploadController.cancelUploads();t._popup&&t._popup.dispose();t._callback()},SetPayors:function(n){var i=this;typeof n===o&&(i._payors=n,i._settings.InitializeAsLoading=t,i._drawView(),i.$root.parents(a).find(l).hide())},SetUploadConfiguration:function(n){var i=this;typeof n===o&&(i._uploadControllerDataPool=new $$WP.Insurance.UploadCoverageDataPool(n,i._action),i._settings.InitializeAsLoading=t,i._drawView(),i.$root.parents(a).find(l).hide())}},pt=function(n){var t,r,u;return t=$afe.jq(n),r=t.next(),u=t.siblings(),(t.hasClass(e)||!u.filter(".selected").length)&&(r.length?r.addClass(e):(r=t.prev(),r.length&&r.addClass(e))),u.length<2&&t.closest(w).find(".navigation").remove(),t.remove(),i};v.prototype=yt;v.imageOnError=pt;v.ActionsEnum=n;$$WP.Insurance=$$WP.Insurance||{};$$WP.Insurance.UpdateCoverageController=v;v.extend(vt,"WP$Insurance$UpdateCoverageController")}(),function(){var y="function",p=".verifyButtons",h="checked",c="slow",w="hasActions",o="hidden",e="data-coverage",l="Insurance",s=".insuranceVerification",b="#coverageVerificationSkipButton",r="click",a=".loadingoverlay",k="input[name='useInsuranceForVisitButton']:checked",d="input[name='guarantorButton']:checked",i=!0,t=null,n=!1,nt=$$WP.Controllers.Controller,f=$$WP.Insurance.UpdateCoverageController,u=$$WP.Insurance.Coverage,g=$$WP.Insurance.Payor,tt=makeLink("Insurance/Coverages/GetPayors"),it=makeLink("Insurance/Coverages/GetCoverages"),rt=makeLink("Insurance/Step/Submit"),ut=makeLink("Insurance/UploadCoverage/GetFileUploadConfiguration"),ft=makeLink("Insurance/Coverages/GetNewCoverageStatus"),et=makeLink("Insurance/Coverages/UpdateCoveragesInVerification"),ot=makeLink("GuarantorVerification/Index"),st=2e3,ht=2e3,ct=5e3,lt=15e3,v=function(t,i,r,u,f,e){var o=this;o.WP$Controllers$Controller();o.proxify("canSubmit","submit","_loadData","_loadCoverages","_onCoveragesLoad","_onGuarantorLoad","_onLoadPayors","_drawCoverageInformation","_canContinueWithSubmit","_addCoverage","_editCoverage","_deleteCoverage","_discardCoverage","_restoreCoverage","_updateGuarantorStatus","_updateSelfPayFlag","_matchHeightsAndUpdateDOMSubtree","_onSubmitSuccess","_checkOkBox","_pollForNewCoverageStatus","canSubmitInsurance","_startPollingForNewCoverageStatus","_updateNewCoverageStatus","_pollForCoveragesInVerification","_onCoveragesInVerificationUpdate","_skipVerification","_cancelExistingCoverageTimers","_showSkipVerificationButton","_showExtraVerificationInfo","_updateCoveragesInVerification","_onLoadUploadConfiguration","_uploadToCoverage","_onFlipCardClicked","_onCardViewClicked","_onVerifyImagesClicked","_onVerifySuccess","_setupViewOtherDocument");o.$root=t;o.$root.empty();o._template=$$WP.Templates.Insurance.InsuranceVerification;o._isStandAlone=i||n;o._encounterCsn=u||"";o._encounterDepartmentId=f||"";o._encounterDTE=e||"";o._initializeViewModel({Settings:r});o._loadUploadConfiguration();i&&o.render();o._loadPayors()},at={$root:t,ViewModel:t,Payors:t,_template:t,_isStandAlone:n,_encounterCsn:"",_encounterDepartmentId:"",_encounterDTE:"",_coverages:t,_hasLoadedCoverageData:n,_hasLoadedGuarantorData:n,_hasLoadedPayors:n,_verified:n,_activeUpdateCoverageController:t,_missingRequiredButton:n,_addedCoveragePollingInterval:5e3,_hasNewCoveragesToPoll:n,_newCoveragesTimer:t,_hasExistingCoveragesInRTE:n,_existingCoveragePollingTimer:t,_existingCoverageSkipButtonTimer:t,_existingCoverageExtraMessageTimer:t,_showExistingCoverageSkipButton:n,_showExistingCoverageExtraMessage:n,_lightboxContent:t,_submitPrechecked:n,_submitButtonObject:t,_useSlideDown:n,UploadConfiguration:t,_hasLoadedUploadConfig:n,_canUpload:n,_hasRendered:n,_previousScrollTop:t,render:function(n){this._initializeViewModel(n);this._loadData()},canSubmit:function(t){var r=this;return t?(r._submitPrechecked=i,r._submitButtonObject=$afe.jq(t.target),(r._submitButtonObject.hasClass("nextstep")||r._submitButtonObject.hasClass("completeworkflow"))&&!r._canContinueWithSubmit())?(t.preventDefault(),r._updateCoveragesInVerification(),n):i:i},canSubmitInsurance:function(){return(this._submitPrechecked=i,!this._canContinueWithSubmit())?(this._updateCoveragesInVerification(),n):i},submit:function(){var r=this,u;if(!r._submitPrechecked&&!r._canContinueWithSubmit()){r._updateCoveragesInVerification();return}if(u={encounterCsn:r._encounterCsn,guarantorChoice:r.ViewModel.Settings.ShowGuarantor?$afe.select(d).val():t,useInsuranceForVisit:r.ViewModel.Settings.ShowUseInsuranceForVisitQuestion?$afe.select(k).val():t,verifyCoverages:r.ViewModel.Settings.ShowInsurance},r._canPerformAction()&&r._missingRequiredButton!==i){r.$root.find(".nextstep.verify").hide();r._isStandAlone||r.$root.find(a).show();$.post({url:rt,data:u,cache:n,success:r._onSubmitSuccess});return}},_canContinueWithSubmit:function(){return this.ViewModel.Settings.ShowUseInsuranceForVisitQuestion&&$afe.select(k).val()==="0"?i:this._hasExistingCoveragesInRTE?n:this._hasNewCoveragesToPoll?n:i},_pollForCoveragesInVerification:function(){this._existingCoveragePollingTimer=setTimeout(this._updateCoveragesInVerification,ht)},_updateCoveragesInVerification:function(){var i=this;i.__existingCoveragePollingTimer=t;$.post({url:et,data:{encounterCsn:i._encounterCsn,encounterDepartmentId:i._encounterDepartmentId},cache:n,success:i._onCoveragesInVerificationUpdate,error:i._pollForCoveragesInVerification})},_onCoveragesInVerificationUpdate:function(i){var u=this;if(i.KeepPolling){if(u._hasNewCoveragesToPoll&&(u._addedCoveragePollingInterval=st),u._lightboxContent===t){u._lightboxContent=$afe.renderTemplate($$WP.Templates.Insurance.CoverageVerificationLightboxContent,{ShowSkipButton:u._showExistingCoverageSkipButton,ShowExtraInfo:u._showExistingCoverageExtraMessage});showLightBox(u._lightboxContent.html());$afe.select("#lightbox_overlay").off(r).on(r,u._cancelExistingCoverageTimers);if(u._showExistingCoverageSkipButton)$afe.select(b).on(r,u._skipVerification);i.CanSkipVerification&&u._existingCoverageSkipButtonTimer===t&&!u._showExistingCoverageSkipButton&&(u._existingCoverageSkipButtonTimer=setTimeout(u._showSkipVerificationButton,ct));u._existingCoverageExtraMessageTimer!==t||u._showExistingCoverageExtraMessage||(u._existingCoverageExtraMessageTimer=setTimeout(u._showExtraVerificationInfo,lt))}u._pollForCoveragesInVerification();return}u._enableSubmit(n)},_showSkipVerificationButton:function(){this._showExistingCoverageSkipButton=i;this._existingCoverageSkipButtonTimer=t;$afe.select("#coverageVerificationSkip").slideDown(200,adjustLightbox);var n=$afe.select(b);n.on(r,this._skipVerification)},_skipVerification:function(){this._enableSubmit(i)},_enableSubmit:function(i){var r=this;r._hasExistingCoveragesInRTE=n;r._hasNewCoveragesToPoll=n;r._newCoveragesTimer!==t&&(clearTimeout(r._newCoveragesTimer),r._newCoveragesTimer=t);r._cancelExistingCoverageTimers();hideLightbox();i&&r._allowActions();r._submitButtonObject?r._submitButtonObject.click():r.submit()},_showExtraVerificationInfo:function(){this._showExistingCoverageExtraMessage=i;this._existingCoverageExtraMessageTimer=t;$afe.select("#coverageVerificationExtraInfo").slideDown(200,adjustLightbox)},_cancelExistingCoverageTimers:function(){var n=this;n._lightboxContent=t;n._existingCoveragePollingTimer!==t&&(clearTimeout(n._existingCoveragePollingTimer),n._existingCoveragePollingTimer=t);n._existingCoverageSkipButtonTimer!==t&&(clearTimeout(n._existingCoverageSkipButtonTimer),n._existingCoverageSkipButtonTimer=t);n._existingCoverageExtraMessageTimer!==t&&(clearTimeout(n._existingCoverageExtraMessageTimer),n._existingCoverageExtraMessageTimer=t)},_initializeViewModel:function(t){var r=this;r.ViewModel=t||r.ViewModel||{};r.ViewModel.Settings=r.ViewModel.Settings||{};r.ViewModel.Settings.ShowInsurance=r.ViewModel.Settings.ShowInsurance===i;r.ViewModel.Settings.ShowGuarantor=r.ViewModel.Settings.ShowGuarantor===i;r.ViewModel.Settings.ShowUseInsuranceForVisitQuestion=r.ViewModel.Settings.ShowUseInsuranceForVisitQuestion===i;r.ViewModel.Settings.HasContinueCallback=$.isFunction(r.ViewModel.Settings.ContinueCallback);r.ViewModel.Settings.HasVerifyCallback=$.isFunction(r.ViewModel.Settings.VerifyCallback);r.ViewModel.Settings.ShowVerifyButton=!r._verified;r.ViewModel.Settings.ValidationSettings=$$WP.FormValidation.ValidationSettings.Required;r.ViewModel.Settings.InitiallyInvalid=n;r.ViewModel.Settings.hasOwnProperty("HideNavigationButtons")||(r.ViewModel.Settings.HideNavigationButtons=r._isStandAlone);r.ViewModel.Settings.ShowResponsibilityForPayment=r.ViewModel.Settings.ShowGuarantor||r.ViewModel.Settings.ShowUseInsuranceForVisitQuestion},_loadData:function(){var t=this,r;t.$root.find(s).size()===0&&(r={Settings:{IsStandAlone:t._isStandAlone,HideNavigationButtons:i,IsInpatient:t.ViewModel.Settings.IsInpatient},BeforeFirstLoad:i},t.$root.empty().safeAppend($afe.renderTemplate(t._template,r)).show());t.$root.find(a).show();t._loadCoverages();t._hasLoadedGuarantorData=n;(t.ViewModel.Settings.ShowGuarantor||t.ViewModel.Settings.ShowUseInsuranceForVisitQuestion)&&$.post({url:ot,data:{encounterCsn:t._encounterCsn,encounterDepartmentId:t._encounterDepartmentId},cache:n,success:t._onGuarantorLoad})},_loadCoverages:function(t){var i=this;i._hasLoadedCoverageData=n;i._hasRendered=n;i._useSlideDown=t;i.ViewModel.Settings.ShowInsurance&&$.post({url:it,data:{isStandAlone:i._isStandAlone,encounterCsn:i._encounterCsn,encounterDepartmentId:i._encounterDepartmentId,encounterDTE:i._encounterDTE},cache:n,success:i._onCoveragesLoad})},_onCoveragesLoad:function(n){var t=this;t._coverages=u.createCoverageCollection();u.convertRawCoverages(n.ActiveCoverages,t._coverages);u.convertRawCoverages(n.CoveragesPendingSubmission,t._coverages);u.convertRawCoverages(n.CoveragesPendingDeletion,t._coverages);u.convertRawCoverages(n.CoveragesInVerification,t._coverages);u.convertRawCoverages(n.CoveragesInReview,t._coverages);t.ViewModel.ActiveCoverages=u.convertRawCoverages(n.ActiveCoverages,u.createCoverageCollection());t.ViewModel.CoveragesPendingSubmission=u.convertRawCoverages(n.CoveragesPendingSubmission,u.createCoverageCollection());t.ViewModel.CoveragesPendingSubmission=t.ViewModel.CoveragesPendingSubmission.concat(u.convertRawCoverages(n.CoveragesPendingDeletion,u.createCoverageCollection()));t.ViewModel.CoveragesInVerification=u.convertRawCoverages(n.CoveragesInVerification,u.createCoverageCollection());t.ViewModel.CoveragesInReview=u.convertRawCoverages(n.CoveragesInReview,u.createCoverageCollection());t.ViewModel.IsProxyContext=n.IsProxyContext;$.extend(t.ViewModel.Settings,n.Settings);t._hasExistingCoveragesInRTE=n.HasExistingCoveragesInRTE;t._hasLoadedCoverageData=i;(t.ViewModel.Settings.ShowGuarantor||t.ViewModel.Settings.ShowUseInsuranceForVisitQuestion)&&!t._hasLoadedGuarantorData||(t._drawView(t._useSlideDown),t._allowActions(),t._hasRendered=i);n.CoveragesInVerification&&n.CoveragesInVerification.length>0&&(t._hasNewCoveragesToPoll=i,t._startPollingForNewCoverageStatus())},_onGuarantorLoad:function(t){var r=this;r.ViewModel.Guarantor=t;r.ViewModel.Settings.ShowResponsibilityForPayment=r.ViewModel.Settings.ShowGuarantor||r.ViewModel.Settings.ShowUseInsuranceForVisitQuestion&&r.ViewModel.Guarantor.AllowSelfPay;r._missingRequiredButton=r.ViewModel.Settings.ShowGuarantor&&r.ViewModel.Guarantor.Name&&(!r.ViewModel.Guarantor.SelectedValue||r.ViewModel.Guarantor.SelectedValue.length===0);r._hasLoadedGuarantorData=i;(!r.ViewModel.Settings.ShowInsurance||r._hasLoadedCoverageData)&&(r._drawView(n),r._allowActions(),r._hasRendered=i)},_loadPayors:function(){this._hasLoadedPayors=n;$.post({url:tt,data:{},cache:n,success:this._onLoadPayors})},_onLoadPayors:function(n){var r=this,u;u=g.createPayorCollection();g.convertRawPayors(n.Payors,u);r.Payors=u;r._hasLoadedPayors=i;r._activeUpdateCoverageController!==t&&r._activeUpdateCoverageController.SetPayors(r.Payors)},_drawView:function(n){var t=this,i,r;Handlebars.registerHelper("drawCoverageInformation",t._drawCoverageInformation);t.$root.empty().safeAppend($afe.renderTemplate(t._template,t.ViewModel)).show();t._drawCardPreviews();t.$root.find(a).hide();t._showOrHideSelfPay(n);t._showOrHideInsurance(n);i=t.ViewModel.Settings.IsInpatient?$$WP.Strings.get("SelfPayHelpTextAdmission",l):$$WP.Strings.get("SelfPayHelpText",l);r=new $$WP.UI.InfoBubble($$WP.UI.InfoBubble.SimpleInfoBubble(i));$afe.select("#SelfPayHelpBubble").empty().safeAppend($afe.renderTemplate($$WP.Templates.UI.InfoBubble,r));t._bindBehaviors(t.ViewModel);t._isStandAlone&&t.$root.find("h2.header").focus();t._previousScrollTop&&($$WPUtil.setScrollTop(t._previousScrollTop),t._previousScrollTop=0);$$WP.FormValidation.initializeDOMSubtree(t.$root)},_drawCardPreviews:function(){var n=this,t,i;if(n._canUpload&&n._coverages&&n._coverages.Models)for(i=0;i<n._coverages.Models.length;i++)t=n._coverages.Models[i],t.FrontDocument&&t.FrontDocument.drawImage(),t.BackDocument&&t.BackDocument.drawImage()},_bindBehaviors:function(n){var i="#insuranceok",t=this;t.$root.find("[data-id='addCoverage']").on(r,t._addCoverage);t.$root.find("[data-action='edit']").on(r,t._editCoverage);t.$root.find("[data-action='delete']").on(r,t._deleteCoverage);t.$root.find("[data-action='discard']").on(r,t._discardCoverage);t.$root.find("[data-action='restore']").on(r,t._restoreCoverage);t.$root.find("[data-action='updateGuarantorStatus']").on(r,t._updateGuarantorStatus);t.$root.find("[data-action='updateSelfPayFlag']").on(r,t._updateSelfPayFlag);t.$root.find("[data-action='uploadToCoverage']").on(r,t._uploadToCoverage);t.$root.find("[data-action='flipcard']").on(r,t._onFlipCardClicked);t.$root.find(".cardflipper").on(r,t._onCardViewClicked);t.$root.find(".cardflipper .previewcard").on("keypress",t._onCardViewKeypress);t.$root.find("[data-action='verify-images']").on(r,t._onVerifyImagesClicked);if(n.Settings.HasContinueCallback||t.ViewModel.Settings.HasVerifyCallback)t.$root.find("[data-id='buttonNext']").on(r,t.submit);if(t.$root.find(i).size()>0)t.$root.find(i).on(r,t._checkOkBox)},_onCardViewKeypress:function(n){(n.which===13||n.which===32)&&($afe.jq(this).click(),n.preventDefault())},_onCardViewClicked:function(n){var r=this,u,f,t,i;(n.preventDefault(),u=n.currentTarget.getAttribute(e),u)&&(f=parseInt($afe.jq(n.target).closest(".previewcard").safeAttr("data-index")),f===0?(i=r._coverages.getFromIndex("ID",u),t=i.FrontDocument):f===1&&(i=r._coverages.getFromIndex("ID",u),t=i.BackDocument),t&&(t.openAsPopup(r.UploadConfiguration.NoAcordex),t.IsImageFileType()&&t.HasNoPreview&&t.drawImage(),i.FrontDocument&&i.BackDocument&&r._setupViewOtherDocument(i,f)))},_setupViewOtherDocument:function(n,t){var u,i,e,f;u=$afe.jq(document.createElement("img"));u.safeAttr("src",makeStaticLink("images/insurance/flipcard-linkcolor.svg"));u.addClass("flipIconLink");i=$afe.jq(document.createElement("a"));i.safeAttr("href","#");i.safeAttr("title",$$WP.Strings.get("FlipCardTooltip",l));i.safeAppend(u);i.on(r,$.proxy(function(){$afe.select(".coverageViewDocument a.cancelworkflow").click();t===0?(e=1,f=n.BackDocument):t===1&&(e=0,f=n.FrontDocument);f&&f.openAsPopup(this.UploadConfiguration.NoAcordex);this._setupViewOtherDocument(n,e)},this));$afe.select(".coverageViewDocument .options").safePrepend(i)},_onVerifyImagesClicked:function(t){var i=this,u=t.currentTarget.getAttribute(e),o=i._coverages.getFromIndex("ID",u),s=makeLink("Insurance/Coverages/SubmitCoverageUpdate"),r;i._previousScrollTop=$$WPUtil.getScrollTop();r={action:f.ActionsEnum.VerifyExistingCards,coverageId:o.CoverageId,encounterCsn:i._encounterCsn,encounterDepartmentId:i._encounterDepartmentId,encounterDTE:i._encounterDTE};$.post({url:s,data:r,cache:n,success:i._onVerifySuccess})},_onVerifySuccess:function(n){n.Success===i?(this.$root.find("[data-coverage-verification='"+n.CoverageId+"']").removeClass(o),this.$root.find("[data-coverage-expiring='"+n.CoverageId+"']").remove()):this._loadCoverages()},_onFlipCardClicked:function(n){var u="aria-hidden",f="tabindex",t,i,r;n.preventDefault();r=$afe.jq(n.currentTarget).closest(".coverageDocumentView").find(".cardflip-container");r.toggleClass("flip");i=r.find(".cardback");t=r.find(".cardfront");r.hasClass("flip")?(i.safeAttr(f,"0"),i.removeAttr(u),t.removeAttr(f),t.safeAttr(u,"true"),WP.DOM.Browser.isIE&&(i.css("backface-visibility","visible"),t.css("transform","rotateY(180deg)"))):(i.removeAttr(f),i.safeAttr(u,"true"),t.safeAttr(f,"0"),t.removeAttr(u),WP.DOM.Browser.isIE&&(i.removeAttr("style"),t.removeAttr("style")))},_drawCoverageInformation:function(n,t,i){var u="Active",r;return r={},r.Coverage=n,r.DetailsUrl=makeLink("inside.asp?mode=benefitdetail&cvgId="+encodeURIComponent(n.CoverageId)),r.Type=t,t!=="Verifying"&&(r.HasDetailsButton=this._isStandAlone&&i.CanViewDetails&&!$$WP.Utilities.IsNullOrEmpty(n.CoverageId),r.HasEditButton=i.CanUpdate&&(n.Status===0||n.Status===1||n.Status===2||t===u),r.HasDeleteButton=i.CanUpdate&&(n.Status===0||t===u),r.HasDiscardButton=i.CanUpdate&&n.Status===1,r.HasRestoreButton=i.CanUpdate&&(n.Status===2||n.Status===3),r.HasUploadButton=i.CanUpdate&&(n.Status===0||n.Status===2||t===u)&&n.CoverageType===1&&this._canUpload),r.HasButtons=r.HasDetailsButton||r.HasEditButton||r.HasDeleteButton||r.HasDiscardButton||r.HasRestoreButton||r.HasUploadButton,new Handlebars.SafeString($afe.renderTemplate($$WP.Templates.Insurance.CoverageInformation,r).get(0).outerHTML)},_loadUploadConfiguration:function(){this._hasLoadedUploadConfig=n;$.post({url:ut,data:{},cache:n,success:this._onLoadUploadConfiguration})},_onLoadUploadConfiguration:function(n){var r=this;r._hasLoadedUploadConfig=i;n.CanUpload&&(r.UploadConfiguration=new $$WP.Upload.Models.UploadConfiguration(n.Data),r.UploadConfiguration.NoAcordex=n.NoAcordex,r._canUpload=i,r._activeUpdateCoverageController!==t&&r._activeUpdateCoverageController.SetUploadConfiguration(r.UploadConfiguration),r._hasRendered&&(r._drawView(r._useSlideDown),r._allowActions()))},_addCoverage:function(i){var r=this,u,e,o;(r._previousScrollTop=$$WPUtil.getScrollTop(),i.preventDefault(),r._verified=n,r._canPerformAction())&&($.isFunction(r.ViewModel.Settings.ChangeCallback)&&r.ViewModel.Settings.ChangeCallback(),$afe.select("#addCoverageContainer").show(),$afe.select("#addCoverageButton").hide(),u=$afe.select("#addCoverageCard"),o={EncounterCsn:r._encounterCsn,EncounterDepartment:r._encounterDepartmentId,EncounterDTE:r._encounterDTE,IsInpatient:r.ViewModel.Settings.IsInpatient},e=new f(u,f.ActionsEnum.AddNew,t,r._coverages,r.Payors,r._loadCoverages,{InitializeAsLoading:!r._hasLoadedPayors,IsProxyContext:r.ViewModel.IsProxyContext,UploadConfiguration:r.UploadConfiguration},o),r._preventActions(e))},_editCoverage:function(t){var i=this,r,o,u,s,h;(i._previousScrollTop=$$WPUtil.getScrollTop(),t.preventDefault(),i._verified=n,i._canPerformAction())&&(r=$afe.jq(t.currentTarget).safeAttr(e),u=$afe.jq(t.currentTarget).closest(".card"),u.removeClass(w),o=r.indexOf("NEW^")>-1?f.ActionsEnum.EditNew:f.ActionsEnum.EditExisting,$.isFunction(i.ViewModel.Settings.ChangeCallback)&&i.ViewModel.Settings.ChangeCallback(),h={EncounterCsn:i._encounterCsn,EncounterDepartment:i._encounterDepartmentId,EncounterDTE:i._encounterDTE,IsInpatient:i.ViewModel.Settings.IsInpatient},s=new f(u,o,r,i._coverages,i.Payors,i._loadCoverages,{InitializeAsLoading:!i._hasLoadedPayors,IsProxyContext:i.ViewModel.IsProxyContext,UploadConfiguration:i.UploadConfiguration},h),i._preventActions(s))},_uploadToCoverage:function(t){var i=this,r,u,s,h,o;(i._previousScrollTop=$$WPUtil.getScrollTop(),t.preventDefault(),i._verified=n,i._canPerformAction())&&(r=$afe.jq(t.currentTarget).safeAttr(e),u=f.ActionsEnum.UploadNewCards,$.isFunction(i.ViewModel.Settings.ChangeCallback)&&i.ViewModel.Settings.ChangeCallback(),o={EncounterCsn:i._encounterCsn,EncounterDepartment:i._encounterDepartmentId,EncounterDTE:i._encounterDTE,IsInpatient:i.ViewModel.Settings.IsInpatient},h=new f(s,u,r,i._coverages,i.Payors,i._loadCoverages,{InitializeAsLoading:!i._hasLoadedPayors,IsProxyContext:i.ViewModel.IsProxyContext,UploadConfiguration:i.UploadConfiguration},o))},_deleteCoverage:function(i){var r=this,u,o,s;(r._previousScrollTop=$$WPUtil.getScrollTop(),i.preventDefault(),r._verified=n,r._canPerformAction())&&($.isFunction(r.ViewModel.Settings.ChangeCallback)&&r.ViewModel.Settings.ChangeCallback(),u=$afe.jq(i.currentTarget).closest(".card"),u.removeClass(w),s={EncounterCsn:r._encounterCsn,EncounterDepartment:r._encounterDepartmentId,EncounterDTE:r._encounterDTE,IsInpatient:r.ViewModel.Settings.IsInpatient},o=new f(u,f.ActionsEnum.DeleteExisting,$afe.jq(i.currentTarget).safeAttr(e),r._coverages,r.Payors,r._loadCoverages,t,s),r._preventActions(o))},_discardCoverage:function(i){var r=this,o,u;(i.preventDefault(),r._verified=n,r._canPerformAction())&&($.isFunction(r.ViewModel.Settings.ChangeCallback)&&r.ViewModel.Settings.ChangeCallback(),u={IsInpatient:r.ViewModel.Settings.IsInpatient},o=new f(r.$root,f.ActionsEnum.DiscardNew,$afe.jq(i.currentTarget).safeAttr(e),r._coverages,r.Payors,r._loadCoverages,t,u))},_restoreCoverage:function(i){var r=this,o,u;(i.preventDefault(),r._verified=n,r._canPerformAction())&&($.isFunction(r.ViewModel.Settings.ChangeCallback)&&r.ViewModel.Settings.ChangeCallback(),u={IsInpatient:r.ViewModel.Settings.IsInpatient},o=new f(r.$root,f.ActionsEnum.RestoreDeleted,$afe.jq(i.currentTarget).safeAttr(e),r._coverages,r.Payors,r._loadCoverages,t,u))},_updateGuarantorStatus:function(){var i="#messageOnNo",t=this;t.ViewModel.Guarantor.SelectedValue=t.$root.find(d).val()||"";t.ViewModel.Guarantor.SelectedValue==="0"?t.$root.find(i).removeClass(o):t.$root.find(i).addClass(o);t._showOrHideSelfPay();t._showOrHideInsurance();t._missingRequiredButton&&(t._missingRequiredButton=n,t._canPerformAction()&&t._allowActions())},_updateSelfPayFlag:function(){var n=this;n.ViewModel.Guarantor.UseInsuranceForVisit=n.$root.find("input[name='useInsuranceForVisitButton']:visible:checked").val()||"";n._showOrHideInsurance(i);$.isFunction(n.ViewModel.Settings.ChangeCallback)&&n.ViewModel.Settings.ChangeCallback()},_showOrHideSelfPay:function(n){var i=".selfPay",t=this;t.ViewModel.Guarantor&&t.ViewModel.Guarantor.AllowSelfPayOnlyIfVerified&&(t.ViewModel.Guarantor.SelectedValue==="1"?n?t.$root.find(i).slideDown(c):t.$root.find(i).show():n?t.$root.find(i).slideUp(c):t.$root.find(i).hide())},_showOrHideInsurance:function(n){var i=".vb_navigation",t=this;t.ViewModel.Settings.ShowInsurance&&(t.ViewModel.Settings.ShowUseInsuranceForVisitQuestion&&(t.ViewModel.Guarantor.AllowSelfPay||t.ViewModel.Guarantor.AllowSelfPayOnlyIfVerified)&&(!t.ViewModel.Guarantor.AllowSelfPayOnlyIfVerified||t.ViewModel.Guarantor.SelectedValue==="1")&&!$afe.select("#UseInsuranceButton").prop(h)?(t._activeUpdateCoverageController&&t._activeUpdateCoverageController._onCancel(),$afe.select(s).slideUp(c,t._matchHeightsAndUpdateDOMSubtree),$afe.select(i).removeClass("show").addClass(o)):(n?$afe.select(s).slideDown(c,t._matchHeightsAndUpdateDOMSubtree):($afe.select(s).show(),t._matchHeightsAndUpdateDOMSubtree()),t.$root.find(".cardlist").trigger("cardLoad"),$afe.select(i).removeClass(o).addClass("show")))},_matchHeightsAndUpdateDOMSubtree:function(){$$WP.FormValidation.initializeDOMSubtree(this.$root.find(s));matchWrapHeight()},_onSubmitSuccess:function(){var n=this;n.ViewModel.Settings.HasContinueCallback&&n.ViewModel.Settings.ContinueCallback();n.ViewModel.Settings.HasVerifyCallback&&(n.ViewModel.Settings.VerifyCallback(),n._verified=i)},_canPerformAction:function(){return $$WP.Utilities.IsNullOrEmpty(this._activeUpdateCoverageController)},_preventActions:function(n){var r="pointer-events",i="none",t=this;t._activeUpdateCoverageController=n;t.$root.find(".button").css("display",i);t._activeUpdateCoverageController.$root.find(".button").css("display","inline-block");t.$root.find(p).hide();t.$root.find(".insurance_card_actions").css(r,i);t.$root.find(".card.addItem").css(r,i);t.$root.find("a.bannerLink").css(r,i);typeof t.ViewModel.Settings.PreventActionsCallback===y&&t.ViewModel.Settings.PreventActionsCallback()},_allowActions:function(){var n=this;n._activeUpdateCoverageController=t;n.$root.find(p).show();typeof n.ViewModel.Settings.AllowActionsCallback===y&&n.ViewModel.Settings.AllowActionsCallback()},_checkOkBox:function(){var n="p.buttoncheck";this.$root.find(n).hasClass(h)?this.$root.find(n).removeClass(h):this.$root.find(n).addClass(h)},_startPollingForNewCoverageStatus:function(){var n=this;n._newCoveragesTimer===t&&(n._newCoveragesTimer=setTimeout(n._pollForNewCoverageStatus,n._addedCoveragePollingInterval))},_pollForNewCoverageStatus:function(){var r=this;if(r._newCoveragesTimer=t,!r._hasNewCoveragesToPoll){r._updateNewCoverageStatus({LoadCoverages:i,KeepPolling:n});return}$.post({url:ft,data:{},cache:n,success:r._updateNewCoverageStatus,error:r._startPollingForNewCoverageStatus})},_updateNewCoverageStatus:function(n){var t=this;if(t._hasNewCoveragesToPoll=n.KeepPolling,!t._canPerformAction()||n.KeepPolling){t._startPollingForNewCoverageStatus();return}if(n.LoadCoverages){t._loadCoverages(i);return}}};v.prototype=at;$$WP.Insurance=$$WP.Insurance||{};$$WP.Insurance.CoveragesController=v;v.extend(nt,"WP$Insurance$CoveragesController")}(),function(){var u="span.uploadLabel",t="function",i="pointer-events",n=null,f=makeLink("Insurance/UploadCoverage/CancelUploads"),r=function(n,t,i){var r=this;r.WP$Controllers$Controller();r.proxify("changeContextData","_onActionStart","_onActionSuccess","_onActionFail");r._settings=i||{};r.$root=n;r.DataPool=t;r.DataPool.CoreFrontUploadConfig.onUploadStart=r.DataPool.CoreFrontUploadConfig.onDeleteStart=r.DataPool.CoreFrontUploadConfig.onEditStart=r._onActionStart;r.DataPool.CoreBackUploadConfig.onUploadStart=r.DataPool.CoreBackUploadConfig.onDeleteStart=r.DataPool.CoreBackUploadConfig.onEditStart=r._onActionStart;r.DataPool.CoreFrontUploadConfig.onUploadSuccess=r.DataPool.CoreFrontUploadConfig.onDeleteSuccess=r.DataPool.CoreFrontUploadConfig.onEditSuccess=r._onActionSuccess;r.DataPool.CoreBackUploadConfig.onUploadSuccess=r.DataPool.CoreBackUploadConfig.onDeleteSuccess=r.DataPool.CoreBackUploadConfig.onEditSuccess=r._onActionSuccess;r.DataPool.CoreFrontUploadConfig.onUploadFail=r.DataPool.CoreFrontUploadConfig.onDeleteFail=r.DataPool.CoreFrontUploadConfig.onEditFail=r._onActionFail;r.DataPool.CoreBackUploadConfig.onUploadFail=r.DataPool.CoreBackUploadConfig.onDeleteFail=r.DataPool.CoreBackUploadConfig.onEditFail=r._onActionFail};r.prototype={$root:n,DataPool:n,_coreFrontUploadController:n,_coreBackUploadController:n,_settings:n,changeContextData:function(n){this.DataPool.editContextData(n)},render:function(n,t){var i=this,r;r=n?n:{UploadRequired:i._settings.isUploadRequired};i.$root.empty().safeAppend($afe.renderTemplate($$WP.Templates.Insurance.UploadContainer,r));i._coreFrontUploadController=new $$WP.Upload.Controllers.UploadController(i.$root.find("#frontUploadControl"),i.DataPool.CoreFrontUploadConfig,i.DataPool.FrontControllerDocuments);i._coreBackUploadController=new $$WP.Upload.Controllers.UploadController(i.$root.find("#backUploadControl"),i.DataPool.CoreBackUploadConfig,i.DataPool.BackControllerDocuments);t||i._showPopupInstructions()},_showPopupInstructions:function(){var n="Insurance",r=this.$root.find("#insuranceUploadHelpText"),t,i;t=this._settings&&this._settings.IsInpatient?$$WP.Strings.get("AddInsuranceImagesHelpTextInfoBubbleHospital",n):$$WP.Strings.get("AddInsuranceImagesHelpTextInfoBubble",n);i=new $$WP.UI.InfoBubble($$WP.UI.InfoBubble.SimpleInfoBubble(t));r.empty().safeAppend($afe.renderTemplate($$WP.Templates.UI.InfoBubble,i))},isReadyForSubmission:function(){return this._settings.isUploadRequired?this._getDocIdsHelper().length>0:!0},getDocIds:function(){return this._getDocIdsHelper()},getFrontDocId:function(){return this.DataPool.FrontControllerDocuments&&this.DataPool.FrontControllerDocuments.length===1?this.DataPool.FrontControllerDocuments[0].DocumentId:n},getBackDocId:function(){return this.DataPool.BackControllerDocuments&&this.DataPool.BackControllerDocuments.length===1?this.DataPool.BackControllerDocuments[0].DocumentId:n},cancelUploads:function(){var n=this._getDocIdsHelper();n&&n.length>0&&$.ajax({type:"POST",dataType:"json",data:$$WPUtil.postify({documentIds:n}),url:f})},_getDocIdsHelper:function(){for(var t=this.DataPool.getDocuments(),i=[],n=0;n<t.length;++n)i.push(t[n].DocumentId);return i},_onActionStart:function(){this.$root.css(i,"none");typeof this._settings.onActionStartCallback===t&&this._settings.onActionStartCallback()},_onActionFail:function(){var n=this;n.$root.css(i,"");n.$root.find(u).focus();typeof n._settings.onActionFinishedCallback===t&&n._settings.onActionFinishedCallback()},_onActionSuccess:function(){var n=this,r=n._coreFrontUploadController.getAllDocuments(),f=n._coreBackUploadController.getAllDocuments();n.DataPool.FrontControllerDocuments=n._syncDocsHelper(r);n.DataPool.BackControllerDocuments=n._syncDocsHelper(f);n.$root.css(i,"");n.$root.find(u).focus();typeof n._settings.onActionFinishedCallback===t&&n._settings.onActionFinishedCallback()},_syncDocsHelper:function(n){for(var t=0,i=[],t=0;t<n.length;++t)i.push(n[t].toRawObject());return i}};$$WP.Insurance=$$WP.Insurance||{};$$WP.Insurance.UploadCoverageController=r;r.extend($$WP.Controllers.Controller,"WP$Insurance$UploadCoverageController")}(),function(){var e=".rejected",o="#filter-Dates",s="#filter-DocType",h="defaultDateFilter",c="defaultDocTypeFilter",u="viewdocument",b="loadingHeart",f="matchColumnHeights",l="height",a="keypress",t="hidden",n=!1,i=null,v="#showRejected",y=".loadMore",r=!0,d=25,p=13,g=9;$$WP.Utilities.guaranteeExistence($$WP,"Documents.ViewDocument.Controllers");var nt=$$WP.Documents.ViewDocument.Controllers,k=$$WP.Documents.ViewDocument.Models,w=function(n){var i=".ClickableHeader",t=this,u,f,e;t.proxify("_displayDocs","_displayError","_clickDoc","getDocs","_loadDocs","_registerHandlers","_hideWidget","_filterDocumentsByDate","_filterDocumentsByType","_buildFilters","_printDoc","_detectPrint","_sort","_sortByDate","_sortByType","_toggleShowRejected","_loadMore","_applyFilters");t.OverrideStrings=n.StringOverrides;t.Activity=n.Activity;t.IsMobile=$afe.select("html").hasClass("mobile");t.DocWidgetDiv=$afe.select("#viewdocumentwidget");t.IsMobile&&(n.TemplateMode="List");n.TemplateMode==="List"?(t.Template=$$WP.Templates.Documents.ViewDocument.DocumentList,t.ReadDocsFromSubLists=r):n.TemplateMode==="Grid"?(t.Template=$$WP.Templates.Documents.ViewDocument.DocumentGrid,t.ReadDocsFromSubLists=r):(t.TemplateMode="Table",t.Template=$$WP.Templates.Documents.ViewDocument.DocumentTable,t.currentSort="docDate",u=$afe.renderTemplate($$WP.Templates.Documents.ViewDocument.DocumentTableHeader),$afe.select("#docwidgetheaders").safeAppend(u),f=$afe.renderTemplate($$WP.Templates.Documents.ViewDocument.DocumentTableFooter),$afe.select("#docwidgetfooters").safeAppend(f),$afe.select(i).click(t,t._sort),$afe.select(y).click(t,t._loadMore),e=t._sort,$afe.select(i).keypress(t,t._sort),$afe.select(v).click(t,t._toggleShowRejected));t.DocWidgetModel=new k.DocumentWidgetModel(n);t._setTitle();t.getDocs(r)};w.prototype={DocWidgetModel:i,DocWidgetDiv:i,IsMobile:n,ReadDocsFromSubLists:n,SortDirection:1,_setTitle:function(){var n="#documentwidgettitle";this.OverrideStrings.Title?$afe.select(n).text(this.OverrideStrings.Title):$afe.select(n).addClass(t)},_clickDoc:function(t){var r=this,f,i,u;return t?t.type===a&t.keyCode!==p?(t.keyCode===g&&r.next().focus(),n):(t.currentTarget&&(f=$afe.jq(t.currentTarget),u=parseInt(f.safeAttr("data-index"),10)),isNaN(u))?n:($clickedElement=$afe.jq(t.currentTarget),$clickedElement.removeClass("New"),i=r.getClickedDocument(u,$clickedElement),i.DownloadOnly&&(i.AllowPreview=n),r.IsMobile?i._sendDownloadUrl():i.openAsPopup(),r._registerHandlers(),n):n},getClickedDocument:function(n,t){var i=this;return i.ReadDocsFromSubLists?t.hasClass("accepted")?i.DocWidgetModel.DocumentList.AcceptedDocuments[n]:t.hasClass("pending")?i.DocWidgetModel.DocumentList.PendingDocuments[n]:t.hasClass("rejected")?i.DocWidgetModel.DocumentList.RejectedDocuments[n]:i.DocWidgetModel.DocumentList.Documents[n]:i.DocWidgetModel.DocumentList.Documents[n]},getDocs:function(n){var t=this;t.initialLoad=n;n&&(t.DocWidgetModel.DocumentList=i);url=makeLink("Documents/ViewDocument/Load");$.ajax({url:url,data:{activity:t.Activity,docType:encodeURIComponent(t.DocWidgetModel.SelectedDocType),initialLoad:n},cache:r,type:"POST",success:t._loadDocs,error:t._displayError})},_loadDocs:function(i){var u=this;i.Documents.length==0&&$afe.select(y).addClass(t);i.Documents.length<d&&(u.allLoaded=r);u.documentCache=i.Documents;u.initialLoad&&(u.initialLoad=n,u.DocWidgetModel.setDocumentList(i.Documents),u._buildFilters(),u._displayDocs(),u.getDocs())},_displayDocs:function(){var n=this,i;$(".documents").removeClass(t);n.DocWidgetDiv.empty();n.DocWidgetDiv.css(l,"100rem");$afe.jq(window).trigger(f);n._applyFilters();$showDeclined=$afe.select("#showDeclined");n.DocWidgetModel.DocumentList.populateSubLists();n.DocWidgetModel.HasRejectedDocuments?$showDeclined.removeClass(t):$showDeclined.addClass(t);n.currentSort=="docType"&&n.DocWidgetModel.DocumentList.Documents.sort(n._sortByType);n.currentSort=="docDate"&&n.DocWidgetModel.DocumentList.Documents.sort(n._sortByDate);Handlebars.registerHelper("showBadge",function(n,t,i,r){return n||t||i?r.fn(this):r.inverse(this)});i=$afe.renderTemplate(n.Template,n.DocWidgetModel.DocumentList);n.DocWidgetDiv.removeClass(b);n.DocWidgetDiv.safeAppend(i);n.DocWidgetModel.DocumentList.NoDocumentsData&&(n.DocWidgetModel.HideWidgetIfEmpty&&n.DocWidgetDiv.addClass(t),n._hideHeaders());n.TemplateMode==="Table"&&n._handleRejectedTextPopups();$(".documents:has(.document.filtered)").addClass(t);$afe.select(v).length>0&&n._toggleShowRejected();n._registerHandlers();setTimeout(function(n){n.css(l,"auto");$afe.jq(window).trigger(f)}(n.DocWidgetDiv),1e3)},_filterDocumentsByDate:function(n){var t=n.currentTarget.value;this.DocWidgetModel.SelectedDate=t===$$WP.Strings.getNamespace(u).getString(c)||t===$$WP.Strings.getNamespace(u).getString(h)?i:t;this._displayDocs()},_filterDocumentsByType:function(n){var t=n.currentTarget.value;this.DocWidgetModel.SelectedDocType=t===$$WP.Strings.getNamespace(u).getString(c)||t===$$WP.Strings.getNamespace(u).getString(h)?i:t;this._displayDocs()},_applyFilters:function(){for(var t=this,u=0;u<t.DocWidgetModel.DocumentList.Documents.length;u++){var f=t.DocWidgetModel.DocumentList.Documents[u],e=n,o=n;f.DocType!==t.DocWidgetModel.SelectedDocType&&t.DocWidgetModel.SelectedDocType!==i&&(e=r);f.Date!==t.DocWidgetModel.SelectedDate&&t.DocWidgetModel.SelectedDate!==i&&(o=r);f.Filtered=o||e?r:n}},_displayError:function(){var n=this,t;$afe.select(b).remove();n.DocWidgetModel.DocumentList=new k.DocumentListModel({},{},{},{});n.DocWidgetModel.DocumentList.Error=r;n._hideHeaders();t=$afe.renderTemplate(n.Template,n.DocWidgetModel.DocumentList);n.DocWidgetDiv.safeAppend(t);$afe.jq(window).trigger(f)},_registerHandlers:function(){var t="change",i=".document",r="click",u=".printIcon",n=this;$afe.select(u).off(r);$afe.select(i).off(r);$afe.select(".header").off(r);$afe.select(i).off(a);$afe.select(u).click(n,n._printDoc);$afe.select(s).off(t);$afe.select(o).off(t);$afe.select(s).on(t,n._filterDocumentsByType);$afe.select(o).on(t,n._filterDocumentsByDate);$afe.select(i).click(n,n._clickDoc);$afe.select(".SingleDocument").keypress(n,n._clickDoc);$afe.select(i).keypress(n,function(n){n.keyCode===p&&this.click()});window.onkeydown=n._detectPrint},_detectPrint:function(t){if(t.ctrlKey&&t.keyCode===80&&$afe.select(".Popup").length>0)return this._printDoc(),event.preventDefault(),n},_hideWidget:function(){this.DocWidgetDiv.safeAttr("display","none")},_buildFilters:function(){var b="display:none",k="disabled",l="true",d="selected",f="option",n=this,t=$afe.select(o),i,y,a,e,r,p,v,w;for(t.empty(),i=$afe.jq(document.createElement(f)),i.text("Date"),i.safeAttr(d,l),i.safeAttr(k,l),i.safeAttr("style",b),t.safeAppend(i),y=$afe.jq(document.createElement(f)),y.text($$WP.Strings.getNamespace(u).getString(h)),t.safeAppend(y),a=0;a<n.DocWidgetModel.DocumentDates.length;a++)option=dangerou$.parseHtml("<option>"+n.DocWidgetModel.DocumentDates[a]+"<\/option>"),t.safeAppend(option);for(n.DocWidgetModel.SelectedDate&&t.val(n.DocWidgetModel.SelectedDate),e=$afe.select(s),e.empty(),r=$afe.jq(document.createElement(f)),r.text("Document Type"),r.safeAttr(d,l),r.safeAttr(k,l),r.safeAttr("style",b),e.safeAppend(r),p=$afe.jq(document.createElement(f)),p.text($$WP.Strings.getNamespace(u).getString(c)),e.safeAppend(p),n.DocWidgetModel.DocumentTypes.sort(function(n,t){return n.toLowerCase().localeCompare(t.toLowerCase())}),v=0;v<n.DocWidgetModel.DocumentTypes.length;v++)w=$afe.jq(document.createElement(f)),w.text(n.DocWidgetModel.DocumentTypes[v]),e.safeAppend(w);n.DocWidgetModel.SelectedDocType&&t.val(n.DocWidgetModel.SelectedDocType)},_handleRejectedTextPopups:function(){for(var t=$afe.select(e),n=0;n<t.length;n++)$afe.jq(t[n]).find(".Status").css("overflow","visible")},_printDoc:function(){var a="min-height",u="inherit",v="padding",o="width",s="printFrame",y,f,t,r,h,p,e,c,w;for(f=document.getElementById(s),f||(f=document.createElement("iframe"),t=$afe.jq(f),t.safeAttr("name",s),t.safeAttr("id",s),t.prop(o,"0"),t.prop(l,"0"),t.prop("src","about:blank"),$afe.jq(document.body).safeAppend(t),t.contents().find("head").safeAppend($afe.jq(document.createElement("title"))),t.load(function(){var t=document.getElementById(s);t.contentWindow.focus();WP.DOM.Browser.isIE?t.contentWindow.document.execCommand("print",n,i):t.contentWindow.print()})),t=$afe.jq(f),h=t.contents().find("head"),h.find("title").text($afe.select(".titlebar span")[0].innerHTML),r=t.contents().find("body"),y=$afe.select(".esigned"),y.length>0?(dangerou$.setHtml(r,y[0].innerHTML),e=$afe.select(".downloadIcon"),e&&(e=e.safeAttr("href")),$.ajax({url:makeLink("Documents/ViewDocument/SecureAuditEsignPrint"),data:{dcsIDURL:e,accessType:2},type:"POST"})):dangerou$.setHtml(r,$afe.select("#section-to-print")[0].outerHTML.replace("method=view","method=print")),images=r.find("img"),c=0;c<images.length;c++)w=$afe.jq(images[c]),w.css("max-width","7in");return r.find("._headerContent").css(v,u).css(o,u).css(a,u),r.find("._mainContent").css(v,u).css(o,u).css(a,u),r.find("._footerContent").css(v,u).css(o,u).css(a,u),r.find("canvas").css("background-color","#eee").css("border","1px #ccc solid"),p=navigator.userAgent.toLowerCase().indexOf("safari/")>-1&&navigator.userAgent.toLowerCase().indexOf("chrome/")===-1,p?setTimeout(function(){f.contentWindow.document.write(h[0].outerHTML+r[0].outerHTML);f.contentWindow.document.close()},200):(f.contentWindow.document.write(h[0].outerHTML+r[0].outerHTML),f.contentWindow.document.close()),n},_sort:function(t){var u="descending",f="ascending",i=this,r,e;if(t.type===a&t.keyCode!==p)return t.keyCode===9&&i.next().focus(),n;r=$afe.jq(t.currentTarget);e=i.currentSort;i.currentSort=t.currentTarget.id;e!==i.currentSort?(i.SortDirection=1,$afe.select("#"+e).removeClass(f),$afe.select("#"+e).removeClass(u),r.addClass(u)):(i.SortDirection=i.SortDirection*-1,r.hasClass(f)?(r.addClass(u),r.removeClass(f)):(r.addClass(f),r.removeClass(u)));i._displayDocs()},_sortByType:function(n,t){var i=n.DocType,r=t.DocType;return(n.Rejected||n.PendingApproval)&&(i=n.DocDesc),(t.Rejected||t.PendingApproval)&&(r=t.DocDesc),i.toLowerCase()>r.toLowerCase()?1*this.SortDirection:-1*this.SortDirection},_sortByDate:function(n,t){return n.DateRaw>t.DateRaw?-1*this.SortDirection:n.DateRaw<t.DateRaw?1*this.SortDirection:n.DateRaw===t.DateRaw?this._sortByType(n,t):void 0},_loadMore:function(){var r=this;r.DocWidgetModel.SelectedDocType=i;r.DocWidgetModel.SelectedDate=i;r.DocWidgetModel.setDocumentList(r.documentCache);r._buildFilters();r._displayDocs();r.allLoaded?$afe.select(y).addClass(t):(r.initialLoad=n,r.getDocs())},_toggleShowRejected:function(){var n=$afe.select(v)[0];n.checked?($afe.select(e).removeClass(t),setTimeout(function(){$afe.jq(window).trigger(f)},2e3)):($afe.select(e).addClass(t),$afe.jq(window).trigger(f))},_hideHeaders:function(){$afe.select("#documentTableHeader").hide()}};$$WP.Documents.ViewDocument.Controllers.DocumentWidgetController=w;w.extend($$WP.Controllers.Controller,"WP$Documents$ViewDocuments$Controllers$DocumentWidgetController")}();var debug_clickedModel;$$WP.$body=$$WP.$body||$afe.select("body"),function(){var u="[data-model-id]",i='"]',f='[data-view-binder-id="',e="data-view-binder-id",t="data-model-id",n=null,o=$$WP.Common.Model,s=$$WP.Common.ModelCollection,r=function(n,t){var i=this,r;for(i.WP$Controllers$Controller(),n=n||[],t=t||[],i.proxify("_onDomEventWrapper","_onPropertyChangedWrapper"),i.ViewBinderId=c++,i._eventNames=n.join(" "),i._boundModels={},i._modelId2listenerId={},i._propertyNames={},r=0;r<t.length;r++)i._propertyNames[t[r]]=!0;i.setBindingRoot($$WP.$body)},h={ViewBinderId:n,_eventNames:n,_propertyNames:n,_$bindingRoot:n,_boundModels:n,_modelId2listenerId:n,bindModel:function(n){var t=this,i;t._boundModels[n.ModelId]||(t._boundModels[n.ModelId]=!0,i=n.addPropertyListener("",t._onPropertyChangedWrapper),t._modelId2listenerId[n.ModelId]=i)},bindAllModels:function(n){for(var t=0;t<n.length;t++)this.bindModel(n[t])},bind:function(n,i){this.bindModel(n);i.safeAttr(t,n.ModelId);i.safeAttr(e,this.ViewBinderId)},unbindModel:function(n){var t=this;t._boundModels[n.ModelId]&&(delete t._boundModels[n.ModelId],n.removePropertyListener(t._modelId2listenerId[n.ModelId]),t.unbindElement(t.getBoundElements(n,t._$bindingRoot)))},unbindElement:function(n){n.removeAttr(t);n.removeAttr(e)},getBoundElements:function(n,t){var r;return t=t||this._$bindingRoot,r=f+this.ViewBinderId+i,typeof n!="undefined"&&(r+='[data-model-id="'+n.ModelId+i),t.find(r)},getBoundModels:function(){var i,r,n;for(r={},i=this.getBoundElements(),n=0;n<i.length;n++)r[$afe.jq(i.get(n)).safeAttr(t)]=!0;return s.modelIdSet2Array(r)},setBindingRoot:function(t){var r=this,u;u=f+r.ViewBinderId+i;r._$bindingRoot!==n&&r._$bindingRoot.off(r._eventNames,u,r._onDomEventWrapper);r._$bindingRoot=t;r._$bindingRoot.on(r._eventNames,u,r._onDomEventWrapper)},syncModelsToDOM:function(){for(var t=this.getBoundModels(),n=0;n<t.length;n++)this._onSyncModelToDOM(t[n])},_onDomEventWrapper:function(r,u){var f,e,s;f=$afe.jq(r.target).closest('[data-model-id][data-view-binder-id="'+this.ViewBinderId+i);s=f.safeAttr(t);e=o.getInstance(s);(e!==n||s==="-1")&&this._onDomEvent(e,f,r,u)},_onPropertyChangedWrapper:function(n){this._propertyNames[n.propertyName]&&this._onPropertyChanged(n.model,n)},_onPropertyChanged:function(){throw"[ViewBinder] Subclass did not implement the virtual method _onPropertyChanged";},_onSyncModelToDOM:function(){throw"[ViewBinder] Subclass did not implement the virtual method _onSyncModelToDOM";},_onDomEvent:function(){throw"[ViewBinder] Subclass did not implement the virtual method _onDomEvent";}},c=0,l=function(i){var f,e,r;i.ctrlKey&&$$WP.Debug.IsEnabled&&(f=$afe.jq(i.target).closest(u),e=f.safeAttr(t),r=o.getInstance(e),r!==n&&(debug_clickedModel=r,$$WP.Debug.log("(Ctrl+Click on bound model) Global variable debug_clickedModel set to point at model #"+r.ModelId+" : "+r._constructor._className)))};if(r.prototype=h,$$WP.Common=$$WP.Common||{},$$WP.Common.ViewBinder=r,r.extend($$WP.Controllers.Controller,"WP$Common$ViewBinder"),$$WP.Debug.IsEnabled)$$WP.$body.on("click",u,l)}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var n="hover",i="mouseleave",r="mouseenter",t;$$WP.Common=$$WP.Common||{};t=function(n){var t=this;t.WP$Common$ViewBinder([r,i,"focus","blur"],[n]);t._statePropertyName=n;t._hovered=!0;t._unhovered=!1};t.prototype={_statePropertyName:null,_hovered:null,_unhovered:null,_onPropertyChanged:function(t,i){var r=this;i.to===r._unhovered?r.getBoundElements(t).removeClass(n):i.to===r._hovered&&r.getBoundElements(t).addClass(n)},_onSyncModelToDOM:function(t){var i=this;t[i._statePropertyName]===i._hovered?i.getBoundElements(t).addClass(n):i.getBoundElements(t).removeClass(n)},_onDomEvent:function(n,t,u){var f=this,o,e,s;o=n[f._statePropertyName];u.type===r||u.type==="focusin"?e=f._hovered:u.type===i?e=f._unhovered:u.type==="focusout"&&(s=u.relatedTarget,t.has(s).length===0&&(e=f._unhovered));o!==e&&n.setProperty(f._statePropertyName,e);u.preventDefault()}};$$WP.Common.HoverViewBinder=t;t.extend($$WP.Common.ViewBinder,"WP$Common$HoverViewBinder")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var u="PopupVisible",n=null,f=$$WP.Common.ModelCollection,r=n,i=n,e=[{propertyNames:u,storeAs:"set"}],o=[u],t=function(t){var u=this;u.WP$Common$Model(t);r===n&&(r=new f(e,o));i===n&&(i=new $$WP.UI.InfoBubbleViewBinder);$$WPUtil.IsNullOrEmpty(u.AnchorText)&&$$WPUtil.IsNullOrEmpty(u.Image)&&$$WP.Debug.logError("InfoBubble requested with neither an image nor a text anchor.",!0);$$WPUtil.IsNullOrEmpty(u.BubbleText)&&$$WP.Debug.logError("InfoBubble requested without any text for the popup.",!0);u.PopupVisible=!1;r.add(u);i.bindModel(u)},s=function(n,i){return new t({BubbleText:n,DisableHtmlEncoding:i,Image:"images/info.png"})},h=function(n,i,r){return new t({AnchorText:n,BubbleText:i,DisableHtmlEncoding:r})},c={s_dataMembers:["AnchorText","BubbleText","BubbleTitle","DisableHtmlEncoding","Image"],AnchorText:n,BubbleText:n,BubbleTitle:n,DisableHtmlEncoding:n,Image:n,PopupVisible:n,ViewBinderId:function(){return i.ViewBinderId}};t.prototype=c;t.SimpleInfoBubble=s;t.SimpleTextInfoBubble=h;$$WP.UI=$$WP.UI||{};$$WP.UI.InfoBubble=t;t.extend($$WP.Common.Model,"WP$UI$InfoBubble")}(),function(){var t="aria-hidden",i=".infoBubblePopup",r=".infoBubbleTarget",n=function(){this.WP$Common$HoverViewBinder("PopupVisible")};n.prototype={_onPropertyChanged:function(n,t){var i=this;t.from===i._hovered?i.hidePopup(i.getBoundElements(n)):t.to===i._hovered&&i.showPopup(i.getBoundElements(n));i.WP$Common$HoverViewBinder$_onPropertyChanged(n,t)},_onSyncModelToDOM:function(n){var t=this;t.WP$Common$HoverViewBinder$_onSyncModelToDOM(n);n[t._statePropertyName]===t._hovered?t.showPopup(t.getBoundElements(n)):t.hidePopup(t.getBoundElements(n))},_onDomEvent:function(n,t,i){this.WP$Common$HoverViewBinder$_onDomEvent(n,t,i)},showPopup:function(n){var s="data-ispositioned",u,e,o,f;o=n.find(r);f=n.find(i);n.safeAttr(s)!=="1"&&(u=$$WPUtil.positionElementNear(o,f),e=o.offset(),u.top-=e.top,u.left-=e.left,f.css({left:u.left+"px",top:u.top+"px"}),n.safeAttr(s,"1"));f.safeAttr(t,!1)},hidePopup:function(n){var u,f;u=n.find(i);f=n.find(r);u.safeAttr(t,!0)}};$$WP.UI=$$WP.UI||{};$$WP.UI.InfoBubbleViewBinder=n;n.extend($$WP.Common.HoverViewBinder,"WP$UI$InfoBubbleViewBinder")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var i="ModelId",t="function",n=null,u=Handlebars.template,r=$$WP.Templates=$$WP.Templates||{};r=r.UI=r.UI||{};r.InfoBubble=u({compiler:[7,">= 4.0.0"],main:function(r,u,f,e,o){var h="if",c,s;return'<div class="infoBubbleWrapper" data-model-id="'+r.escapeExpression((s=(s=f.ModelId||(u!=n?u.ModelId:u))!=n?s:f.helperMissing,typeof s===t?s.call(u!=n?u:r.nullContext||{},{name:i,hash:{},data:o}):s))+'" data-view-binder-id="'+r.escapeExpression((s=(s=f.ViewBinderId||(u!=n?u.ViewBinderId:u))!=n?s:f.helperMissing,typeof s===t?s.call(u!=n?u:r.nullContext||{},{name:"ViewBinderId",hash:{},data:o}):s))+'">'+((c=f[h].call(u!=n?u:r.nullContext||{},u!=n?u.Image:u,{name:h,hash:{},fn:r.program(1,o,0),inverse:r.program(3,o,0),data:o}))!=n?c:"")+'<div class="infoBubblePopup extraWide" id="infoBubble_'+r.escapeExpression((s=(s=f.ModelId||(u!=n?u.ModelId:u))!=n?s:f.helperMissing,typeof s===t?s.call(u!=n?u:r.nullContext||{},{name:i,hash:{},data:o}):s))+'" role="tooltip" aria-hidden="true">'+((c=f[h].call(u!=n?u:r.nullContext||{},u!=n?u.BubbleTitle:u,{name:h,hash:{},fn:r.program(5,o,0),inverse:r.noop,data:o}))!=n?c:"")+'<div class="infoBubbleBody" id="infoBubble_'+r.escapeExpression((s=(s=f.ModelId||(u!=n?u.ModelId:u))!=n?s:f.helperMissing,typeof s===t?s.call(u!=n?u:r.nullContext||{},{name:i,hash:{},data:o}):s))+'_body">'+((c=f[h].call(u!=n?u:r.nullContext||{},u!=n?u.DisableHtmlEncoding:u,{name:h,hash:{},fn:r.program(7,o,0),inverse:r.program(9,o,0),data:o}))!=n?c:"")+"<\/div><\/div><\/div>"},"1":function(r,u,f,e,o){var s;return'<button class="infoBubbleTarget asIcon" tabindex="0" type="button" aria-label="'+r.escapeExpression((f.getDisplayString||u&&u.getDisplayString||f.helperMissing).call(u!=n?u:r.nullContext||{},"MoreInformation","UI.InfoBubble",{name:"getDisplayString",hash:{},data:o}))+'" aria-describedby="infoBubble_'+r.escapeExpression((s=(s=f.ModelId||(u!=n?u.ModelId:u))!=n?s:f.helperMissing,typeof s===t?s.call(u!=n?u:r.nullContext||{},{name:i,hash:{},data:o}):s))+'" style="background-image: url(\''+r.escapeExpression((f.makeStaticLink||u&&u.makeStaticLink||f.helperMissing).call(u!=n?u:r.nullContext||{},u!=n?u.Image:u,{name:"makeStaticLink",hash:{},data:o}))+"');\" />"},"3":function(r,u,f,e,o){var s;return'<button class="infoBubbleTarget" tabindex="0" type="button" aria-describedby="infoBubble_'+r.escapeExpression((s=(s=f.ModelId||(u!=n?u.ModelId:u))!=n?s:f.helperMissing,typeof s===t?s.call(u!=n?u:r.nullContext||{},{name:i,hash:{},data:o}):s))+'">'+r.escapeExpression((s=(s=f.AnchorText||(u!=n?u.AnchorText:u))!=n?s:f.helperMissing,typeof s===t?s.call(u!=n?u:r.nullContext||{},{name:"AnchorText",hash:{},data:o}):s))+"<\/button>"},"5":function(r,u,f,e,o){var s;return'<div class="header small" id="infoBubble_'+r.escapeExpression((s=(s=f.ModelId||(u!=n?u.ModelId:u))!=n?s:f.helperMissing,typeof s===t?s.call(u!=n?u:r.nullContext||{},{name:i,hash:{},data:o}):s))+'_header"><span>'+r.escapeExpression((s=(s=f.BubbleTitle||(u!=n?u.BubbleTitle:u))!=n?s:f.helperMissing,typeof s===t?s.call(u!=n?u:r.nullContext||{},{name:"BubbleTitle",hash:{},data:o}):s))+'<\/span><span class="clearlabel srPause">.<\/span><\/div>'},"7":function(t,i,r,u,f){return t.escapeExpression((r.raw||i&&i.raw||r.helperMissing).call(i!=n?i:t.nullContext||{},i!=n?i.BubbleText:i,{name:"raw",hash:{},data:f}))},"9":function(i,r,u,f,e){var o;return i.escapeExpression((o=(o=u.BubbleText||(r!=n?r.BubbleText:r))!=n?o:u.helperMissing,typeof o===t?o.call(r!=n?r:i.nullContext||{},{name:"BubbleText",hash:{},data:e}):o))},useData:!0})}()
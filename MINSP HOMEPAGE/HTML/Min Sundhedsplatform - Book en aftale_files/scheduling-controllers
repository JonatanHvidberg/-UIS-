$$WP.Scheduling.Utilities=$$WP.Scheduling.Utilities||{};$$WPSchedulingUtil=$$WP.Scheduling.Utilities;$$WPSchedulingUtil.ScrollToTopOfPage=function(){$$WP.Utilities.UI.IsSmallScreen()?$$WPUtil.SmoothScrollToElementWithOffset($$WPUtil.ScrollableBody(),$afe.select("a[name='maintop']"),24,300):$$WPUtil.SmoothScrollToElement($$WPUtil.ScrollableBody(),$afe.select("#main"),300)};$$WPSchedulingUtil.RemoveDuplicateElementsFromArray=function(n){for(var t=0,i=null,r=[],t=0;t<n.length;t++)i=n[t],r.indexOf(i)===-1&&r.push(i);return r};$$WPSchedulingUtil.IsValueInAllArrays=function(n,t){for(var i=0,r=[],i=0;i<t.length;i++)if(r=t[i],r.indexOf(n)===-1)return!1;return!0};$$WPSchedulingUtil.GetIntersectionOfArrays=function(n){for(var t=0,i=[],u=[],r=null,i=n.shift(),t=0;t<i.length;t++)r=i[t],$$WPSchedulingUtil.IsValueInAllArrays(r,n)&&u.push(r);return u};$$WPSchedulingUtil.GetUnionOfArrays=function(n){for(var i=0,t=0,r=[],u=[],i=0;i<n.length;i++)for(r=n[i],t=0;t<r.length;t++)u.indexOf(r[t])===-1&&u.push(r[t]);return u};$$WPSchedulingUtil.DoAllArraysContainTheSameValues=function(n){var t=$$WPSchedulingUtil.GetUnionOfArrays(n),i=$$WPSchedulingUtil.GetIntersectionOfArrays(n);return t.length>0&&t.length===i.length};$$WPSchedulingUtil.ConstructAppointmentStringHtml=function(n,t,i,r){var f="@MYCHART@PROVIDER@",o="",e="",u=$$WP.Strings.getNamespace("Scheduling");return u.addMnemonics({"@MYCHART@DEPARTMENT@":{Value:t.Name,EncodingType:$$WP.Strings.EncodingTypes.HTML},"@MYCHART@REASONFORVISIT@":{Value:i,EncodingType:$$WP.Strings.EncodingTypes.HTML}}),r?(u.addMnemonic(f,n.Name,$$WP.Strings.EncodingTypes.HTML),e="ConfirmProviderRfv"):(u.addMnemonic(f,"",$$WP.Strings.EncodingTypes.HTML),e="ConfirmRfv"),o=u.getString(e),u.removeMnemonic(f),u.removeMnemonic("@MYCHART@DEPARTMENT@"),u.removeMnemonic("@MYCHART@REASONFORVISIT@"),o};$$WPSchedulingUtil.BuildProvidersFiltered=function(n,t,i,r,u,f,e,o){for(var h=null,c=null,s=0,a=[],l=[],v={},y=!1,p=!1,s=0;s<f.length;s++)v[f[s].ID]=!0;if(u.AllowedProviderDepartmentPairs.length!==0||u.IsAdvanced)for(e=u.AllowedProviderDepartmentPairs,s=0;s<e.length;s++)h=e[s],i||t&&!v[h.DepartmentId]||l.push(h);else for(s=0;s<e.length;s++)h=e[s],(!t||v[h.DepartmentId])&&(n&&!i&&h.AllowedDirectScheduleReasonsForVisitSet[r.Id]||n&&h.AllowedRequestReasonsForVisitSet[r.Id]||!n)&&l.push(h);for(s=0;s<l.length;s++)c=l[s].Provider,y=a.indexOf(c)!==-1,p=o||!c.OtherOption,!y&&p&&a.push(c);return a};$$WPSchedulingUtil.GetMinutesAndHoursFromMinutes=function(n){var i="",r="",t=$$WP.Strings.getNamespace("Scheduling"),u=Math.floor(n/60),f=n%60;return!n||n<=0?"":(t.addMnemonics({"@MYCHART@HOURS@":{Value:u,EncodingType:$$WP.Strings.EncodingTypes.HTML},"@MYCHART@MINUTES@":{Value:f,EncodingType:$$WP.Strings.EncodingTypes.HTML}}),r=$$WPSchedulingUtil.GetDurationStringResourceName(u,f),i=t.getString(r),t.removeMnemonic("@MYCHART@HOURS@"),t.removeMnemonic("@MYCHART@MINUTES@"),i)};$$WPSchedulingUtil.GetDurationStringResourceName=function(n,t){return n>1?t>0?"DurationHoursAndMinutes":"DurationHours":n===1?t>0?"DurationHourAndMinutes":"DurationOneHour":"DurationMinutes"};Handlebars.registerHelper("durationInHoursAndMinutes",$$WPSchedulingUtil.GetMinutesAndHoursFromMinutes),function(){var n=function(){this.__collectionEventListeners=[];this.__collectionPropertyEventListeners=[];this.__modelPropertyEventListeners=[]},t={__collectionEventListeners:[],__collectionPropertyEventListeners:[],__modelPropertyEventListeners:[],addCollectionEventListener:function(n,t,i,r){var u=n.addCollectionEventListener(t,i,r),f={Collection:n,EventName:t,ListenerId:u};this.__collectionEventListeners.push(f)},addCollectionPropertyListener:function(n,t,i,r){var u=n.addPropertyListener(t,i,r),f={Collection:n,PropertyName:t,ListenerId:u};this.__collectionPropertyEventListeners.push(f)},addModelPropertyListener:function(n,t,i,r){var u=n.addPropertyListener(t,i,r),f={Model:n,PropertyName:t,ListenerId:u};this.__modelPropertyEventListeners.push(f)},removeAllListeners:function(){for(var i=this,t=null,n=0,n=0;n<i.__collectionEventListeners.length;n++)t=i.__collectionEventListeners[n],t.Collection.removeCollectionEventListener(t.EventName,t.ListenerId);for(i.__collectionEventListeners=[],n=0;n<i.__collectionPropertyEventListeners.length;n++)t=i.__collectionPropertyEventListeners[n],t.Collection.removePropertyListener(t.PropertyName,t.ListenerId);for(i.__collectionPropertyEventListeners=[],n=0;n<i.__modelPropertyEventListeners.length;n++)t=i.__modelPropertyEventListeners[n],t.Model.removePropertyListener(t.ListenerId);i.__modelPropertyEventListeners=[]}};n.prototype=t;$$WP.Scheduling.EventManager=n}(),function(){var e="horizontal",o="vertical",s=".daytimetable input.clearradio",h="UI.TimePreferenceWidget",u=!0,n=null,t=!1,i=function(n,u,f,e,o,s,h,c,v){var y=this;if($$WP.Utilities.IsNullOrEmpty(timePreferenceConfig)){$$WP.Debug.logError("There is no timePreferenceConfig loaded on the page yet. put @Html.Raw(MyChartWebSettings.TimePreferenceConfig.GetScriptTag()) on page.",t);return}y._Id=a++;y.$root=n;y._orientation=v||r.Horizontal;y.OnFilePreferences=l(o);y._generateStrings(o,s);$$WP.Utilities.IsNullOrEmpty(e)&&(e=i.LabelValueEnum.AllAvailable);y.proxify("_onToggleButtonClick");y.$root.on("click",".togglebutton.clearradio.preferencetype",y._onToggleButtonClick);y._viewModel=y._generateViewModel(timePreferenceConfig,u);y.$root.safeAppend($afe.renderTemplate($$WP.Templates.UI.TimePreferenceWidget,y._viewModel));y._updateClassesOnRoot();y._markSelected(e,h,c);$$WP.Utilities.UI.IsMobile&&$$WP.Utilities.Mobile.Optimization.Tables();y._bindChangeFunction(f)},c={$root:n,OnFilePreferences:n,PreferredDaysString:n,PreferredTimesString:n,_viewModel:n,_Id:n,_orientation:n,_generateViewModel:function(i,f){var l=this,e,a,p,c,s,b,g,o,y,v,nt,k,w,d="";if(!Array.isArray(i.Days))return n;for(p=0,b=[],s={},g=[],c=[],e=0;e<i.Days.length;e++)if(i.Days[e].Ranges.length>0){for(b.push({Display:i.Days[e].Display,DayOfWeek:i.Days[e].DayOfWeek,RangeOption:[]}),c.push({}),c[p].DayDisplay=i.Days[e].Display,c[p].DayIndex=i.Days[e].DayOfWeek,a=0;a<i.Days[e].Ranges.length;a++)c[p][i.Days[e].Ranges[a].Element]=u,s.hasOwnProperty(i.Days[e].Ranges[a].Element)||(s[i.Days[e].Ranges[a].Element]=i.Days[e].Ranges[a]);p++}if(v={},f!==n)for(v={},e=0;e<f.length;e++)v[f[e].RangeElement]=v[f[e].RangeElement]||[t,t,t,t,t,t,t],v[f[e].RangeElement][f[e].DayIndex]=u;for(o in s){for(y={Display:s[o].Display,Abbrev:s[o].Abbrev,DaysOption:[]},k=$$WP.Strings.getNamespace(h),e=0;e<c.length;e++)nt=f!==n&&Array.isArray(v[o])?v[o][c[e].DayIndex]:t,c[e][o]?(k.addMnemonics({"@MYCHART@DAY@":{Value:c[e].DayDisplay,EncodingType:$$WP.Strings.EncodingTypes.None},"@MYCHART@TIMERANGE@":{Value:s[o].Display,EncodingType:$$WP.Strings.EncodingTypes.None}}),d=s[o].MessageOverride,d===""&&(d=s[o].Display),w={Showing:u,DayIndex:c[e].DayIndex,Value:c[e].DayDisplay+" "+s[o].Display,BeginTime:s[o].BeginTime,EndTime:s[o].EndTime,RangeElement:o,Selected:nt,OptionTitle:k.getString("OptionTitle"),MessageRangeString:d},y.DaysOption.push(w),$$WP.Utilities.UI.IsMobile||l._orientation!==r.Vertical||(w.Abbrev=y.Abbrev,w.Display=y.Display,b[e].RangeOption.push(w)),k.clearMnemonics()):y.DaysOption.push({Showing:t});g.push(y)}return{TitleLine:b,RangeLines:g,Id:l._Id,hasOnFilePreferences:l.OnFilePreferences!==n,DaysString:l.PreferredDaysString,TimesString:l.PreferredTimesString,Vertical:l._orientation===r.Vertical,Horizontal:l._orientation===r.Horizontal}},_generateStrings:function(n,t){var s="NoPreferredTime",e=this,u,i,c,o,f,r;if(u=$$WP.Strings.getNamespace(h),n.Days.length===0)e.PreferredDaysString=u.getString("NoPreferredDay");else for(e.PreferredDaysString=t[n.Days[0]-1],i=1;i<n.Days.length;i++)e.PreferredDaysString+=", "+t[n.Days[i]-1];if(n.Times.length===0)o=[u.getString(s)];else{for(f=[],i=0;i<n.Times.length;i++)r={startVal:n.Times[i][0],endVal:n.Times[i][1],startText:n.TimeStrings[i][0],endText:n.TimeStrings[i][1]},f.push(r);for(f.sort(function(n,t){return n.startVal-t.startVal}),o=[],i=0;i<f.length;i++)r=f[i],c=r.startVal===0?u.getString(s):r.startText,c+=r.endVal===86400?" - "+u.getString(s):" - "+r.endText,o.push(c)}e.PreferredTimesString=o.join(", ")},_bindChangeFunction:function(n){var i;(i=this.$root,$.isFunction(n))&&this.$root.find("input.clearradio, input.radio").change(function(){n(i.find(".timepreferencewidget input[type='checkbox']:checked"),i.find(".timepreferencewidget input.clearradio.preferencetype:checked"),t,i.find(s).index(this))})},_onToggleButtonClick:function(n){var t,i;if($afe.jq(n.target).is("input.togglebutton"))t=n.target;else return;i=$afe.jq(t).val();this._markSelected(i,u);$afe.jq(t).trigger("change")},_markSelected:function(t,i,r){var a="_daytimetable",v=".timeTable #",o="hidden",y=".preference",e=this,h,c,l;h=e.$root.find("input.clearradio.preferencetype[value="+t+"]");$$WP.Utilities.UI.ToggleButtonClick(h[0],n,1);l=h.get(0).value;l===f.AllAvailable&&(e.$root.find(y).addClass(o),e.$root.find(v+e._Id+a).addClass(o));l===f.OnFile&&(e.$root.find(y).removeClass(o),e.$root.find(v+e._Id+a).addClass(o));l===f.Other&&(e.$root.find(y).addClass(o),e.$root.find(v+e._Id+a).removeClass(o));h.prop("checked",u);$.isNumeric(r)&&r>=0&&(c=$afe.jq(e.$root.find(s).get(r)));!$$WP.Utilities.IsNullOrEmpty(c)&&c.is("[type=checkbox]")&&i?c.focus():i&&h.focus();$$WP.Utilities.UI.MatchColumnHeights()},_updateClassesOnRoot:function(){this.$root.removeClass(o).removeClass(e);this.$root.addClass(this._getClassForCurrentOrientation())},_getClassForCurrentOrientation:function(){return this._orientation===r.Horizontal?e:o}},f={AllAvailable:"1",OnFile:"2",Other:"3"},r={Horizontal:"1",Vertical:"2"},l=function(t){var u,r,i;if(t.Days.length===0&&t.Times.length===0)return n;if(u=Array([],[],[],[],[],[],[]),r=[],t.Times.length===0)r.push([0,24]);else for(i=0;i<t.Times.length;i++)r.push([Math.round(t.Times[i][0]/36)/100,Math.round(t.Times[i][1]/36)/100]);if(t.Days.length===0)for(i=0;i<7;i++)u[i]=r;else for(i=0;i<t.Days.length;i++)u[t.Days[i]-1]=r;return u},a=0;i.prototype=c;i.LabelValueEnum=f;i.OrientationEnum=r;i.extend($$WP.Controllers.Controller,"WP$Utilities$UI$TimePreferenceWidgetController");$$WP.Utilities.UI.TimePreferenceWidgetController=i}();$$WP.Utilities.UI.Cards=function(n){var t=".cardlist.matchHeights";if(!$$WP.Utilities.UI.IsMobile){if(n.type==="load"){$afe.select(".cardlist.hoverable").each($$WP.Utilities.UI.Cards.HandleHoverable);$afe.select("body").on("cardLoad",".cardlist",$$WP.Utilities.UI.Cards.LoadCardlist).on("matchCardHeights",t,$$WP.Utilities.UI.Cards.MatchHeights)}$afe.select(t).each($$WP.Utilities.UI.Cards.MatchHeights)}};$$WP.Utilities.UI.Cards.LoadCardlist=function(){var n=$afe.jq(this);isDataTile()&&n.is(".cardlist.column_3, .cardlist.column_4")&&n.removeClass("column_3 column_4").addClass("column_2");n.hasClass("hoverable")&&$.proxy($$WP.Utilities.UI.Cards.HandleHoverable,n)();n.hasClass("matchHeights")&&$.proxy($$WP.Utilities.UI.Cards.MatchHeights,n)()};$$WP.Utilities.UI.Cards.HandleHoverable=function(){var n=".card",t="hoverable",i=$afe.jq(this);i.hasClass(t)&&i.find(n).each(function(){var i="hover",r=$afe.jq(this);if(!r.prop(t)){r.hover(function(n){n.type==="mouseenter"?$afe.jq(this).addClass(i):$afe.jq(this).removeClass(i)});r.find(".button, [data-id='additem']").on("focus blur",function(t){t.type==="focus"?$afe.jq(this).parentsUntil(n).andSelf().parent(n).addClass(i):$afe.jq(this).parentsUntil(n).andSelf().parent(n).removeClass(i)});r.prop(t,!0)}})};$$WP.Utilities.UI.Cards.MatchHeights=function(){var e="minHeight",f,r,n,i,t,u;if(!$$WP.Utilities.UI.IsMobile&&$$WP.ApplicationContext!==78&&(f=$afe.jq(this),n=f.prop("class"),n=parseInt(n.substr(n.indexOf("column_")+7)),!isNaN(n)))for(r=f.find(".card, .innercard").css(e,""),i=0;i<r.length;i+=n){for(u=r.eq(i).outerHeight(),t=1;t<n;t++)u=Math.max(u,r.eq(i+t).outerHeight());for(t=0;t<n;t++)r.eq(i+t).css(e,u)}};$$WP.Utilities.UI.Map.Support.cards=$$WP.Utilities.UI.Cards,function(){var t="px",n="hidden",u=".readless",i=".readmore",r=null,f=function(n,t,u,f){var e=this;e.WP$Controllers$Controller();e.$container=n;typeof u!="undefined"&&u!==r&&(e._maxHeight=u);t!==r&&t!==undefined&&e.$container.empty().safeAppend($afe.renderTemplate($$WP.Templates.Visits.PatientInstruction,{PatientInstructionsHTML:t}));e._afterTransitionCallback=f;e.proxify("_collpseOrExpand","_setupInstructionDiv","_afterTransition","_fitTablesInsideContainer");e.$container.on("click",i,e._collpseOrExpand);e.$container.on("click",".readless a",e._collpseOrExpand);$afe.jq(window).on("resize",e._setupInstructionDiv);$afe.jq(window).on("resize",e._fitTablesInsideContainer);e.$container.on("transitionend webkitTransitionEnd oTransitionEnd",e._afterTransition);e._setupInstructionDiv();e._fitTablesInsideContainer()};f.prototype={$container:r,_state:0,_maxHeight:300,_afterTransitionCallback:r,_afterTransition:function(){typeof this._afterTransitionCallback=="function"&&this._afterTransitionCallback();$$WP.Utilities.UI.MatchColumnHeights()},_setupInstructionDiv:function(){var r=this,f,e;r.$container.contentHeight()>r._maxHeight&&(f=r.$container.find(i),e=r.$container.find(u),f.hasClass(n)&&e.hasClass(n)?(r._state=0,r._setTabIndexForLinksInside(-1),r.$container.height(r._maxHeight+t),f.removeClass(n)):e.hasClass(n)||(r._state=1,r._setTabIndexForLinksInside(0),r.$container.height(""),r.$container.height(r.$container.contentHeight()+t)))},_fitTablesInsideContainer:function(){var r="word-break",n,t,i,u;for(i=this.$container.find(".fmtConv table"),u=this.$container.width(),n=0;n<i.length;n++)t=$afe.jq(i[n]),t.css(r,""),t.width()>u&&t.css(r,"break-all")},_setTabIndexForLinksInside:function(n){this.$container.find(".instructionContent a").safeAttr("tabindex",n)},_collpseOrExpand:function(){var r=this,f;r._state===0?(r._state=1,r._setTabIndexForLinksInside(0),r.$container.find(i).addClass(n),r.$container.find(u).removeClass(n),r.$container.height(r.$container.contentHeight()+t)):(r._state=0,r._setTabIndexForLinksInside(-1),r.$container.find(i).removeClass(n),r.$container.find(u).addClass(n),r.$container.height(r._maxHeight+t),f=$afe.select("#header").contentHeight(),$$WPUtil.SmoothScrollToElementWithOffset($$WPUtil.ScrollableBody(),r.$container,f,300))}};$$WPUtil.guaranteeExistence($$WP,"Visits.PatientInstructionController");$$WP.Visits.PatientInstructionController=f;f.extend($$WP.Controllers.Controller,"WP$PatientInstructionController$Controller")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var r="ID",n=null,i=!0,t=!1,u=function(n,r,u,f,s,h,c,l,a){var v=this,y;for(v.WP$Controllers$Controller(),v.SchedulingStringsNamespace=v.SchedulingStringsNamespace||$$WP.Strings.getNamespace("Scheduling"),v.Id=o++,v.$root=n,v.Data=r,v.template=h||$$WP.dudFunction,v.collapsedTemplate=c||h,v._defaultStepSettings=new e(s),v.stepSettings=Object.create(v._defaultStepSettings),v.Active=t,v._isStacked=l||t,v._onErrorCallback=a,v.SkipAfterRenderRefocus=t,u=u||[],v.allowedIds={},y=0;y<u.length;y++)v.allowedIds[u[y]]=i;for(v.allowedIds.size=u.length,f=f||[],v.preselectedIds={},y=0;y<f.length;y++)v.preselectedIds[f[y]]=i;v.preselectedIds.size=f.length},s={SchedulingStringsNamespace:n,Id:n,$root:n,allowedIds:n,preselectedIds:n,_defaultStepSettings:n,stepSettings:n,Data:n,ViewBinder:n,ViewModel:n,template:n,collapsedTemplate:n,_firstRender:i,Active:t,SkipAfterRenderRefocus:t,_renderHidden:i,_isStacked:t,_onErrorCallback:n,_timerId:n,filterByAllowedIds:function(n,t,i){var u,f,e;if(f=n||[],t=t||r,this.allowedIds.size>0){for(e=[],u=0;u<n.length;u++)this.allowedIds[n[u][t]]&&e.push(n[u]);e.length>0?f=e:i&&(f=[])}else if(i)return[];return f},filterIdArrayByAllowedIds:function(n){var r,i,t;if(r=n||[],this.allowedIds.size>0){for(i=[],t=0;t<n.length;t++)this.allowedIds[n[t]]&&i.push(n[t]);i.length>0&&(r=i)}return r},getModelsToPreSelect:function(n,t){return n&&n.length===1?n:this.getPreSelectedModelsOnly(n,t)},getPreSelectedModelsOnly:function(n,t){if(n=n||[],t=t||r,this.preselectedIds.size===0)return[];for(var u=[],i=0;i<n.length;i++)this.preselectedIds[n[i][t]]&&u.push(n[i]);return u},hasPreselectedIds:function(){return this.preselectedIds.size>0},isModelPreselected:function(n){return this.preselectedIds[n]},shouldRenderHidden:function(){return this.stepSettings.Hide||this.stepSettings.HideIfOne&&this.ViewModel.Count===1},shouldRenderCollapsed:function(){var n=this;return n.stepSettings.Collapse||n.stepSettings.CollapseIfOne&&n.ViewModel.Count===1||n.renderCollapsed},scrollToStep:function(){f=f||$afe.select("html,body");f.animate({scrollTop:this.$root.offset().top-$afe.select("#header").height()},600)},show:function(){this._renderHidden=t;this.$root.show();this.updateStep()},hide:function(n){var t=this,r=t.$root.height();r>0&&t.$root.css({"min-height":r});t.$root.hide();t._renderHidden=i;n!==undefined&&t.setComplete(n)},getComplete:function(){return this.Data.SchedulingSteps.getFromIndex(r,this.Id).CompleteStatus},setComplete:function(n){this.Data.SchedulingSteps.getFromIndex(r,this.Id).setProperty("CompleteStatus",n)},resetStepSettings:function(){this.stepSettings=Object.create(this._defaultStepSettings)},updateStep:function(){var n=this;clearTimeout(n._timerId);n._timerId=setTimeout($.proxy(n._updateStepImmediately,n),0)},_updateStepImmediately:function(){var o="readonly",r=this,s,h,u,f,e;if(r.resetStepSettings(),r.arePrerequisitesComplete()?(r.updateViewModel(),r.ViewModel=r.ViewModel||{}):r.ViewModel={StepShouldBeActive:t},r.ViewModel.StepShouldBeActive&&!r._renderHidden){if(r.Active||(r.$root.show(),r.Active=i),r._firstRender&&(r.beforeFirstRender(),r._firstRender=t,!r.Active))return;if(r.beforeRender(),!r.Active||!r._isStepOrStackActive())return;if(s=r.shouldRenderHidden(),h=r.shouldRenderCollapsed(),s)r.$root.hide(),r.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.NotRequired);else{if(r.ViewModel.Count===0&&$.isFunction(r._onErrorCallback)){r.showError(r.ViewModel);return}r._isStacked||(e=r.$root.find(":focus"),u=e.safeAttr("data-model-id"),$$WP.Utilities.IsNullOrEmpty(u)&&(f=e.safeAttr("id")),r.$root.empty());r.$root.show();r.ViewBinder!==n&&(r.ViewModel.ViewBinderId=r.ViewBinder.ViewBinderId);h?(r.$root.safeAppend($afe.renderTemplate(r.collapsedTemplate,r.ViewModel)),r.$root.css({"min-height":""})):(r._isStacked||r.$root.safeAppend($afe.renderTemplate(r.template,r.ViewModel)),r.$root.css({"min-height":""}),r.stepSettings.ReadOnly?r.$root.addClass(o):r.$root.removeClass(o),r.ViewBinder!==n&&r.ViewBinder.syncModelsToDOM());r.afterRender();r.SkipAfterRenderRefocus||($$WP.Utilities.IsNullOrEmpty(u)?$$WP.Utilities.IsNullOrEmpty(f)||r.$root.find("#"+f).focus():r.$root.find("[data-model-id='"+u+"']").focus());r.SkipAfterRenderRefocus=t}}else r.inactivate()},showError:function(n){$.isFunction(this._onErrorCallback)&&(WP.Events.cancelBeforeUnload(),this._onErrorCallback(n))},_isStepOrStackActive:function(){var u=this,e=n,f=n,o=n;return!!u.Data&&!!u.Data.SchedulingSteps&&!$$WPUtil.IsNullOrEmpty(u.Id)&&(e=u.Data.SchedulingSteps.getFromIndex(r,u.Id),e.StackId!==""&&(f=u.Data.SchedulingSteps.getFromIndex(r,e.StackId)),!f||f.StackId===""||(o=u.Data.SchedulingSteps.getFromIndex(r,f.StackId)),e.ActiveStatus===0&&(!f||f.ActiveStatus===0)&&(!o||o.ActiveStatus===0))?t:i},inactivate:function(){var n=this;n.Active&&(n._isStacked||n.$root.empty(),n.$root.hide(),n.Active=t,n.afterInactivated())},arePrerequisitesComplete:function(){return i},updateViewModel:function(){$$WP.Debug.logError(this._constructor.name+" did not override the virtual updateViewModel method from StepController.")},beforeFirstRender:function(){},beforeRender:function(){},afterRender:function(){$$WP.Utilities.UI.MatchColumnHeights()},afterInactivated:function(){},setViewBinder:function(n){this.ViewBinder=n;n.setBindingRoot(this.$root)},dispose:function(){this.inactivate();this.$root.empty()}},e=function(n){var t=this;$.type(n)==="object"&&(t.ReadOnly=n.ReadOnly,t.Hide=n.Hide,t.HideIfOne=n.HideIfOne,t.Collapse=n.Collapse,t.CollapseIfOne=n.CollapseIfOne)},f,o;e.prototype={ReadOnly:t,Hide:t,HideIfOne:t,Collapse:t,CollapseIfOne:t};f=n;o=0;u.prototype=s;u.StepSettings=e;u.$scrollable=f;u.extend($$WP.Controllers.Controller,"WP$Scheduling$StepController");$$WP.Scheduling.StepController=u;$$WP.dudFunction=$$WP.dudFunction||function(){}}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var n=function(n,t,i,r,u,f,e,o,s){var h=this;h.WP$Scheduling$StepController(n,t,i,r,u,f,e,o,s);h.__viewStatePropertyName="ViewState-Step"+h.Id;h.__eventManager=new $$WP.Scheduling.EventManager},t={__eventManager:null,_appointment:null,__viewStatePropertyName:"",linkAppointment:function(n){var t=this;t._appointment!==n&&(t.__eventManager.removeAllListeners(),t.__attachAppointmentListeners(n,t.__eventManager),t._appointment=n)},__attachAppointmentListeners:function(){$$WP.Debug.logError(this._constructor.name+" did not override the virtual __attachAppointmentListeners method from SingleAppointmentStepController.")},dispose:function(){this.__eventManager.removeAllListeners();this.WP$Scheduling$StepController$dispose()},updateViewModel:function(){var n=this;n.ViewModel={IsStacked:n.__isStacked(),IsFirstInStack:n.__isFirstInStack(),PositionInStack:n.__indexInStack()+1,StackLength:n.__stackLength()}},__indexInStack:function(){for(var i=this.Data.SchedulingSteps.getFromIndex("ID",this.Id),t=this.__getVisibleStackSteps(),n=0,n=0;n<t.length;n++)if(t[n]===i)return n},__stackLength:function(){return this.__getVisibleStackSteps().length},__isStacked:function(){return this.__getVisibleStackSteps().length>1},__isFirstInStack:function(){return this.__indexInStack()===0},__getVisibleStackSteps:function(){for(var u=this.Data.SchedulingSteps.getFromIndex("ID",this.Id),i=this.Data.SchedulingSteps.getFromIndex("StackId",u.StackId),r=[],n=null,t=0,t=0;t<i.length;t++)n=i[t],n.IsHidden||n.StackId===""||r.push(n);return r}};n.prototype=t;$$WP.Scheduling=$$WP.Scheduling||{};$$WP.Scheduling.SingleAppointmentStepController=n;n.extend($$WP.Scheduling.StepController,"WP$Scheduling$SingleAppointmentStepController")}(),function(){var t=!0,u="State",s="ReasonForVisit",i=!1,r=null,f=$$WP.Scheduling.ReasonForVisit,e=$$WP.Scheduling.TelehealthLocation,c=$$WP.Scheduling.Appointment,l=$$WP.Common.SelectableViewBinder,o=$$WP.Scheduling.TelehealthFilters,n={NoFiltering:0,FilterOnSelectedProviders:1,Request:2,OnDemandTelehealth:3},h=function(t,e,o,h,c,a,v,y){var w="ViewState",p=this;p.WP$Scheduling$StepController(t,e,o,[h],c,$$WP.Templates.Scheduling.ReasonForVisitStep,r,i,v);p.proxify("updateStep","_onReasonForVisitChanged","_onAncillaryDataChanged","_onViewModelChanged");p._mode=a||n.NoFiltering;p._stopSchedulingCallback=v;p._defaultToNoRFVs=y;p._appointment=p.Data.AppointmentBuilder.getFirstAppointment();p.setViewBinder(new l(w,f.StatesEnum.Selected,f.StatesEnum.Unselected));p.Data.ReasonsForVisit.addPropertyListener(w,p._onViewModelChanged);p.Data.AppointmentBuilder.addPropertyListener(s,p._onReasonForVisitChanged);p.Data.ReasonsForVisit.addCollectionEventListener("add",p._onAncillaryDataChanged);switch(p._mode){case n.FilterOnSelectedProviders:p._appointment.Providers.addCollectionEventListener("add",p._onAncillaryDataChanged);p._appointment.Providers.addCollectionEventListener("remove",p._onAncillaryDataChanged);break;case n.OnDemandTelehealth:p.Data.TelehealthLocations.addPropertyListener(u,p._onAncillaryDataChanged)}},a={_appointment:r,_mode:r,_stopSchedulingCallback:r,_defaultToNoRFVs:i,updateViewModel:function(){var r=this,f=r._getAvailableReasonsForVisit(),s,h;if(r._setViewModelSelectedStates(f),s=i,h=r._mode===n.OnDemandTelehealth,h){f.sort($$WP.Scheduling.ReasonForVisit.sortReasonsForOnDemand);var c=r.Data.TelehealthLocations.getFirstInIndex(u,e.StatesEnum.Selected),l=c.SubLocations.getFirstInIndex(u,e.StatesEnum.Selected),a=o.FilterProvidersByLocation(r.Data.Providers.Models,c,l);s=a.length<1}else f.sort($$WP.Scheduling.ReasonForVisit.sortReasons);r.ViewModel={ReasonsForVisit:f,Count:f.length,StepShouldBeActive:t,IsOnDemandTelehealth:h,HasNoLicensedTelehealthProviders:s}},_getAvailableReasonsForVisit:function(){var t=this,i;switch(t._mode){case n.NoFiltering:i=t._getUnfilteredReasonsForVisit();break;case n.FilterOnSelectedProviders:i=t._getReasonsForVisitFilterOnProvider();break;case n.Request:i=t._getUnfilteredReasonsForVisit();break;case n.OnDemandTelehealth:i=t._getReasonsForVisitTelehealth()}return t.filterByAllowedIds(i,"Id",t._defaultToNoRFVs)},arePrerequisitesComplete:function(){switch(this._mode){case n.OnDemandTelehealth:return this._isTelehealthLocationSelected();case n.FilterOnSelectedProviders:return this._appointment.Providers.size()>0;default:return t}},beforeFirstRender:function(){var t=this,i=[],u=t.ViewModel.ReasonsForVisit,r;i=t._mode===n.OnDemandTelehealth?t.getPreSelectedModelsOnly(u,"Id"):t.getModelsToPreSelect(u,"Id");i.length>0&&(r=i[0],$$WPUtil.IsNullOrEmpty(r)||t.Data.AppointmentBuilder.setProperty(s,r))},beforeRender:function(){var r=this;$$WPUtil.IsNullOrEmpty(r.Data.AppointmentBuilder.ReasonForVisit)?(r.stepSettings.Hide=i,r.stepSettings.HideIfOne=i,r.stepSettings.Collapse=i,r.stepSettings.CollapseIfOne=i,r.stepSettings.ReadOnly=i):r._mode===n.OnDemandTelehealth&&r.ViewModel.ReasonsForVisit.length===1&&(r.stepSettings.ReadOnly=t)},afterRender:function(){$$WP.Utilities.UI.MatchColumnHeights();this.$root.find("h2.header").focus()},_onViewModelChanged:function(n){var t,i;for(t in n){i=n[t].model||$$WP.Common.Model.getInstance(t);switch(n[t].to){case f.StatesEnum.Selected:this.Data.AppointmentBuilder.setProperty(s,i);break;case f.StatesEnum.Unselected:this.Data.AppointmentBuilder.ReasonForVisit===i&&this.Data.AppointmentBuilder.setProperty(s,r)}}},_onReasonForVisitChanged:function(){var n=this,t=n.Data.AppointmentBuilder.ReasonForVisit;t!==r?(n.Data.AppointmentBuilder.updateAppointmentsCollectionForVisitType(t.DefaultVisitType,n.Data.VisitTypes,c.VisitTypeSourceEnum.Default),n.Data.TelehealthData&&n.Data.TelehealthData.resetData()):n.Data.AppointmentBuilder.resetAppointmentsCollection();n._updateStepStatus();n._setViewModelSelectedStates(n._getAvailableReasonsForVisit());n.ViewBinder.syncModelsToDOM()},_onAncillaryDataChanged:function(){this._isSelectedReasonForVisitValid()||this.Data.AppointmentBuilder.setProperty(s,r);this.updateStep()},_isSelectedReasonForVisitValid:function(){var n,u,r;for(u=this.Data.AppointmentBuilder.ReasonForVisit,r=this._getAvailableReasonsForVisit(),n=0;n<r.length;n++)if(r[n]===u)return t;return i},_updateStepStatus:function(){var n=this,t=n.Data.AppointmentBuilder.ReasonForVisit;t!==r?n.shouldRenderHidden()?n.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.NotRequired):n.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Complete):n.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete)},_setViewModelSelectedStates:function(n){for(var i,r=this.Data.AppointmentBuilder.ReasonForVisit,t=0;t<n.length;t++)i=n[t],i.ViewState=i===r?f.StatesEnum.Selected:f.StatesEnum.Unselected},_getUnfilteredReasonsForVisit:function(){var n,i,r,u;return n=this.Data.ReasonsForVisit.toArray(),i=this.Data.ProviderDepartmentPairs.toArray(),r=t,u=t,$$WP.Scheduling.Workflow.buildReasonsForVisitNoFiltering(n,i,r,u)},_getReasonsForVisitFilterOnProvider:function(){var n,i,r,c,h,e,u,o,f,a,l,s;for(o={},h=this._appointment.Providers.toArray(),e=this.Data.ReasonsForVisit.toArray(),n=0;n<h.length;n++)for(a=h[n],l=this.Data.ProviderDepartmentPairs.getFromIndex("ProviderId",a.ID),i=0;i<l.length;i++){for(f=l[i],r=0;r<f.AllowedDirectScheduleReasonsForVisit.length;r++)o[f.AllowedDirectScheduleReasonsForVisit[r].Id]=t;for(r=0;r<f.AllowedRequestReasonsForVisit.length;r++)o[f.AllowedRequestReasonsForVisit[r].Id]=t}for(n=0;n<e.length;n++)if(u=e[n],s=u.DefaultVisitType.AllowedProviderDepartmentPairs,Array.isArray(s)&&s.length>0)for(i=0;i<s.length;i++)if(f=s[i],h.indexOf(f.Provider)>-1){o[u.Id]=t;break}for(c=[],n=0;n<e.length;n++)u=e[n],u.ProviderFirst&&u.AllowProviderSelect&&o[u.Id]&&c.push(u);return c},_getReasonsForVisitTelehealth:function(){var f=this,h,a,v,n,s,c,l,w,y,p;if(a=[],s=f.Data.TelehealthLocations.getFirstInIndex(u,e.StatesEnum.Selected),s===r)return[];for(c=s.SubLocations.getFirstInIndex(u,e.StatesEnum.Selected),v=f.Data.ReasonsForVisit.toArray(),h=0;h<v.length;h++)(n=v[h],l=$$WP.Utilities.UI.IsMobile?$$WP.Scheduling.TelehealthFilters.IsInLicensedLocation(n.AllowedTelemedicineLocations,s,c,o.PlatformFilterValueEnum.Mobile):$$WP.Scheduling.TelehealthFilters.IsInLicensedLocation(n.AllowedTelemedicineLocations,s,c),w=l&&n.ExternallyAvailableForTelehealth&&f.Data.TelehealthData.IsXOrgEnabled||o.DoesRFVHaveAnyAvailablePlatforms(n)&&(!$$WP.Utilities.UI.IsMobile||o.IsRFVEnabledForPlatform(n,o.PlatformFilterValueEnum.Mobile,f.Data.TelehealthData.IsXOrgEnabled)),y=o.FilterProvidersByLocation(f.Data.Providers.Models,s,c),p=f.Data.TelehealthData.AutoSelectedWorkflow!==$$WP.Scheduling.TelehealthData.TelehealthWorkflow.Queueing&&n.EnabledForQuickSchedule&&y.length>0,l||p)&&(n.EnabledForOnDemandVideoVisits=l?t:i,a.push(n));return a},_isTelehealthLocationSelected:function(){var n,r;return(n=this.Data.TelehealthLocations.getFirstInIndex(u,e.StatesEnum.Selected),!n)?i:(r=n.SubLocations.getFirstInIndex(u,e.StatesEnum.Selected),r?t:n.SubLocations.size()===0?t:i)}};h.prototype=a;h.ModesEnum=n;$$WP.Scheduling.ReasonForVisitStepController=h;h.extend($$WP.Scheduling.StepController,"WP$Scheduling$ReasonForVisitStepController")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var v=".loadingoverlay",s="ID",y=".dt-main-container",e="Id",h="Scheduling",p="Scheduling/GetStandardSchedulingData",r="",i=!0,t=!1,n=null,a="remove",c="ReasonForVisit",w=$$WP.Scheduling.VisitType,f=$$WP.Scheduling.Lqf,k=$$WP.Scheduling.SchedulingOverride,o=$$WP.Scheduling.Appointment,b=Epic.PatientEngagement.Questionnaire.Ui,l=function(n,t,i,r,f){var e=this,o;e.WP$Scheduling$StepController(n,t);e.proxify("updateStep","_onQuestionnaireAnswersEvaluated","_onAncillaryDataChanged","decisionTreeCallback","decisionTreeStepOnRenderCallback","questionnaireOnRenderCallback","_onResetLqfClicked","_onLqfDataChanged","_onResetClientStateLoadCompleted","__onAppointmentsChanged");e._mode=i||u.Standard;e._workflow=f;e._ticketInfo=f.TicketInfo;e._originalAppointmentInfo=f.OriginalAppointment;e._favoriteAppointmentInfo=f.FavoriteAppointmentInfo;e._stopSchedulingCallback=r;e.__eventManager=new $$WP.Scheduling.EventManager;switch(e._mode){case u.Standard:e.Data.AppointmentBuilder.addPropertyListener(c,e._onAncillaryDataChanged);break;case u.DepartmentOverride:for(e.Data.AppointmentBuilder.addPropertyListener(c,e._onAncillaryDataChanged),o=0;o<e.Data.SchedulingSteps.Models.length;o++)e.Data.SchedulingSteps.Models[o].Type===$$WP.Scheduling.SchedulingStep.StepTypeEnum.StandardLqf&&(e._prerequisiteStep=e.Data.SchedulingSteps.Models[o])}e.Data.AppointmentBuilder.Appointments.addCollectionEventListener("add",e.__onAppointmentsChanged);e.Data.AppointmentBuilder.Appointments.addCollectionEventListener(a,e.__onAppointmentsChanged);e.__onAppointmentsChanged();e.$root.on("click","#reset-lqf",e._onResetLqfClicked)},d={__eventManager:n,_mode:n,renderCollapsed:n,_stopSchedulingCallback:n,_workflow:n,_ticketInfo:n,_originalAppointmentInfo:n,_favoriteAppointmentInfo:n,_pendingResult:n,_questionnaireController:n,_questionnaireControllerLqfId:n,_decisionTreeController:n,_decisionTreeLqfId:n,_dataWasReloaded:t,_lqfWasFiled:t,_lastSelectedRfv:n,_lastSelectedDep:n,_prerequisiteStep:n,_isReloading:t,updateViewModel:function(){var n=this,r=n._getCurrentLqf();n.ViewModel={StepShouldBeActive:i,Count:0,LqfId:r.LqfId,LqfType:r.LqfType,stepId:n.Id};$$WPUtil.IsNullOrEmpty(n.ViewModel.LqfId)?n._lqfWasFiled?(n.stepSettings.Hide=t,n.renderCollapsed=i):(n.stepSettings.Hide=i,n.renderCollapsed=t):(n.stepSettings.Hide=t,n.renderCollapsed=t)},arePrerequisitesComplete:function(){var n=this,t=n.Data.AppointmentBuilder.allAppointmentsHaveAVisitTypeSpecified(),i=n.Data.AppointmentBuilder.allAppointmentsHaveALocationSelected();switch(n._mode){case u.Standard:return t&&!n._isReloading;case u.DepartmentOverride:return t&&i&&n._isPrerequisiteStepComplete()&&!n._isReloading}},_isPrerequisiteStepComplete:function(){return this._prerequisiteStep?this._prerequisiteStep.CompleteStatus!==$$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete:i},beforeFirstRender:function(){this._updateStepStatus()},beforeRender:function(){var n=this;switch(n.ViewModel.LqfType){case f.LqfTypeEnum.Questionnaire:n.template=$$WP.Templates.Scheduling.Questionnaire;n.collapsedTemplate=$$WP.Templates.Scheduling.QuestionnaireCollapsed;break;case f.LqfTypeEnum.DecisionTree:n.template=$$WP.Templates.Scheduling.DecisionTree;n.collapsedTemplate=$$WP.Templates.Scheduling.QuestionnaireCollapsed}},afterRender:function(){var n=this,t=n.ViewModel.LqfId;switch(n.ViewModel.LqfType){case f.LqfTypeEnum.Questionnaire:n._showQuestionnaire(t);break;case f.LqfTypeEnum.DecisionTree:n._showDecisionTree(t)}n.$root.find("h2.header").focus();$$WP.Utilities.UI.MatchColumnHeights()},_updateStepStatus:function(){var n=this;n.arePrerequisitesComplete()&&$$WPUtil.IsNullOrEmpty(n._getCurrentLqf().LqfId)?n._lqfWasFiled?n.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Complete):n.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.NotRequired):n.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete)},__onAppointmentsChanged:function(){var t=this,r=0,i=n;for(t.__eventManager.removeAllListeners(),r=0;r<t.Data.AppointmentBuilder.numAppointments();r++)i=t.Data.AppointmentBuilder.getAppointment(r),t.__eventManager.addCollectionEventListener(i.Lqfs,"add",t._onLqfDataChanged),t.__eventManager.addCollectionEventListener(i.Lqfs,a,t._onLqfDataChanged),t._mode===u.DepartmentOverride&&(t.__eventManager.addCollectionEventListener(i.Locations,"add",t._onAncillaryDataChanged),t.__eventManager.addCollectionEventListener(i.Locations,a,t._onAncillaryDataChanged))},_onAncillaryDataChanged:function(){var n=this;switch(n._mode){case u.Standard:n._resetClientStateIfRfvChanged();break;case u.DepartmentOverride:n._resetClientStateIfRfvChanged();n._resetClientStateIfDepChanged()}n._updateStepStatus();(n.getComplete()===$$WP.Scheduling.SchedulingStep.CompleteEnum.NotRequired||n.getComplete()===$$WP.Scheduling.SchedulingStep.CompleteEnum.Complete)&&n._removeOldContent();n.updateStep()},_removeOldContent:function(){var n=this;$$WPUtil.IsNullOrEmpty(n._questionnaireController)||n._removeQuestionnaire();$$WPUtil.IsNullOrEmpty(n._decisionTreeController)||n._removeDecisionTree()},_removeQuestionnaire:function(){this._questionnaireController.destroy();this._questionnaireController=n;this._questionnaireControllerLqfId=r},_removeDecisionTree:function(){this._decisionTreeController.destroy();this._decisionTreeController=n;this._decisionTreeLqfId=r},_onLqfDataChanged:function(){this._updateStepStatus();this.updateStep()},_onResetLqfClicked:function(){this._canResetLqfInline()?this._resetClientState():($$WP.Utilities.IsMobile||WP.Events.cancelBeforeUnload(),location.reload())},_canResetLqfInline:function(){var r=0,f=n,u=[];for(f=this.Data.AppointmentBuilder.getFirstAppointment(),u=f.Lqfs.toArray(),r=0;r<u.length;r++)if(u[r].CompletingStep!==this.Id)return t;return i},_resetClientStateIfRfvChanged:function(){var n=this,t=n.Data.AppointmentBuilder.ReasonForVisit;!$$WPUtil.IsNullOrEmpty(t)&&($$WPUtil.IsNullOrEmpty(n._lastSelectedRfv)||t.Id!==n._lastSelectedRfv.Id)&&n._resetClientState();n._lastSelectedRfv=t},_resetClientStateIfDepChanged:function(){var n=this,i,t,r;r=n.Data.AppointmentBuilder.getFirstAppointment();i=r.Locations.toArray()[0];!i||(t=i.Departments[0]);!t||n._lastSelectedDep&&t.ID===n._lastSelectedDep.ID||n._resetClientState();n._lastSelectedDep=t},_resetClientState:function(){var n=this;n._lqfWasFiled&&(n._isReloading=i,n._lqfWasFiled=t,n._resetLqfStatuses(),n._resetVisitType(),n._dataWasReloaded?(n._dataWasReloaded=t,$.post({url:makeLink(p),data:{workflowTypeString:r,isFirstLoad:i},cache:t,success:n._onResetClientStateLoadCompleted})):$.post({url:makeLink("Scheduling/ResetQuestionnaires"),cache:t,success:n._onResetClientStateLoadCompleted}))},_onResetClientStateLoadCompleted:function(n){this._isReloading=t;$$WPUtil.IsNullOrEmpty(n)||this._onDataLoaded(n);this.updateStep()},_resetLqfStatuses:function(){for(var i=n,r=n,u=0,f=0,e=[],u=0;u<this.Data.AppointmentBuilder.numAppointments();u++){for(i=this.Data.AppointmentBuilder.getAppointment(u),i.Lqfs.openChangeBatch(),e=i.Lqfs.toArray().slice(),f=0;f<e.length;f++)r=e[f],r.CompletingStep===this.Id&&(r.Reset(),i.Lqfs.remove(r));i.SchedulingOverride=n;i.IsLqfChainStopped=t;i.Lqfs.closeChangeBatch()}},_resetVisitType:function(){var t=this,i=n,u=n;$$WPUtil.IsNullOrEmpty(t._ticketInfo)?(i=t.Data.AppointmentBuilder.ReasonForVisit,!i||(u=i.DefaultVisitType)):u=t._ticketInfo.VisitType;t.Data.AppointmentBuilder.updateAppointmentsCollectionForVisitType(u,t.Data.VisitTypes,o.VisitTypeSourceEnum.Default,t._workflow);t.__setOriginalVisitTypeIdOnAllAppointments(r)},decisionTreeCallback:function(n){n===$$WP.DecisionTrees.Enums.TraversalStatus.Error?this._showErrorAndExit():this._evaluateLqfAnswers(this._decisionTreeLqfId,f.LqfTypeEnum.DecisionTree)},decisionTreeStepOnRenderCallback:function(){this.scrollToStep()},questionnaireCallback:function(n,t,i){$$WPUtil.IsNullOrEmpty(i)?this._evaluateLqfAnswers(this._questionnaireControllerLqfId,f.LqfTypeEnum.Questionnaire):this._showErrorAndExit()},questionnaireOnRenderCallback:function(n){b.defaultAfterViewLoadCallback(n);this.scrollToStep()},_showErrorAndExit:function(){var t;this._stopSchedulingCallback!==n&&(t={LqfInstructions:$$WP.Strings.get("ScheduleErrorMessage",h)},this._stopSchedulingCallback(t))},_evaluateLqfAnswers:function(r,u){var o=this,a=n,v=n,p=n,s=n,g={},h=n,w=[],b=[],c=0,l=n,d=n;for(o._lqfWasFiled=i,a=o.Data.AppointmentBuilder.getFirstAppointment(),v=o.__getVisitTypeOrPanelFromAppointment(a),h=o.Data.Lqfs.getFromIndex(e,r),$$WPUtil.IsNullOrEmpty(h)&&(g={Id:r,Type:u},h=new f(g),o.Data.Lqfs.add(h)),b=a.Lqfs.toArray(),c=0;c<b.length;c++)w.push(b[c].Id);w.push(r);s=new k({LqfIds:w,OriginalPrcId:v.ID});$$WPUtil.IsNullOrEmpty(o._ticketInfo)?(p=o.Data.AppointmentBuilder.ReasonForVisit,s.OriginalRfv=p.CategoryValue,s.OriginalRfvLine=p.Id):s.OriginalTicketId=o._ticketInfo.TicketId;o.Data.SchedulingOverrides.add(s);o.__setOriginalVisitTypeIdOnAllAppointments(v.ID);h.SchedulingOverride=s;switch(h.Type){case f.LqfTypeEnum.Questionnaire:$afe.select("#qnr-spinner"+o.Id).show();break;case f.LqfTypeEnum.DecisionTree:l=$afe.jq(document.createElement("div"));l.addClass("dt-spinner");d=$afe.jq(document.createElement("div"));d.addClass("loadingHeart");l.safeAppend(d);$afe.select(y).safeAppend(l)}$afe.select("#refresh-area"+o.Id).hide();$.post({url:makeLink("Scheduling/EvaluateQuestionnaireAnswers"),data:{schedulingOverridesString:JSON.stringify(s)},cache:t,success:o._onQuestionnaireAnswersEvaluated,traditional:i})},__setOriginalVisitTypeIdOnAllAppointments:function(t){for(var i=0,r=n,i=0;i<this.Data.AppointmentBuilder.numAppointments();i++)r=this.Data.AppointmentBuilder.getAppointment(i),r.setProperty("OriginalVisitTypeId",t)},__getVisitTypeOrPanelFromAppointment:function(n){return $$WPUtil.IsNullOrEmpty(n.PanelId)?n.VisitType:this.Data.VisitTypes.getFromIndex(s,n.PanelId)},_onQuestionnaireAnswersEvaluated:function(u){var f=this,s,o,c;$.type(u)!=="object"?(f.$root.find(v).hide(),s=new $$WPComp.MessageComponent({TitleText:$$WP.Strings.get("ErrorTitle",h),Message:$$WP.Strings.get("QuestionnaireEvaluationErrorMessage",h),ToolbarButtons:[new $$WPComp.ComplexObjects.Button($$WP.Strings.get("RequestErrorButtonLabel",h),n,"cancelworkflow",r)]}),$$WPUtil.quickPopup(s)):u.ReloadDynamicData?(f._pendingResult=u,o=f.Data.Lqfs.getFromIndex(e,u.LqfId),$$WPUtil.IsNullOrEmpty(o)||(c=o.SchedulingOverride),$.post({url:makeLink(p),data:{workflowTypeString:r,schedulingOverridesString:JSON.stringify(c)},cache:t,success:$.proxy(f._onDataLoaded,f)}),f._dataWasReloaded=i):(f._handleResult(u),f.updateStep())},_onDataLoaded:function(t){var r=this,o=n,s=n,u=0,f=n,h=[];for(o=r.Data.AppointmentBuilder.ReasonForVisit,h=r.__getAppointmentSelections(),r.Data.Providers.openChangeBatch(),r.Data.ReasonsForVisit.openChangeBatch(),r.Data.Departments.openChangeBatch(),r.Data.ProviderDepartmentPairs.openChangeBatch(),r.Data.ReasonForVisitDepartmentOverrides.openChangeBatch(),r.Data.Locations.openChangeBatch(),r.Data.VisitTypes.openChangeBatch(),r.Data.VisitTypeDepartmentOverrides.openChangeBatch(),r.Data.Solutions.openChangeBatch(),r.Data.AppointmentBuilder.Appointments.openChangeBatch(),u=0;u<r.Data.AppointmentBuilder.numAppointments();u++)f=r.Data.AppointmentBuilder.getAppointment(u),f.Providers.openChangeBatch(),f.Locations.openChangeBatch();for(r.Data.SchedulingSteps.openChangeBatch(),r.Data.Providers.empty(),r.Data.ReasonsForVisit.empty(),r.Data.Departments.empty(),r.Data.ProviderDepartmentPairs.empty(),r.Data.ReasonForVisitDepartmentOverrides.empty(),r.Data.Locations.empty(),r.Data.VisitTypes.empty(),r.Data.VisitTypeDepartmentOverrides.empty(),$$WPUtil.IsNullOrEmpty(r._ticketInfo)?r.Data.populateWithRawSchedulingData(t):r.Data.populateForTicket(r._ticketInfo,t,i),r.Data.prepForWorkflowAgain(),r.__reapplyAppointmentSelections(h),$$WPUtil.IsNullOrEmpty(o)||(s=r.Data.ReasonsForVisit.getFirstInIndex(e,o.Id),$$WPUtil.IsNullOrEmpty(s)?r.Data.AppointmentBuilder.setProperty(c,n):r.Data.AppointmentBuilder.setProperty(c,s)),r.Data.Providers.closeChangeBatch(),r.Data.ReasonsForVisit.closeChangeBatch(),r.Data.Departments.closeChangeBatch(),r.Data.ProviderDepartmentPairs.closeChangeBatch(),r.Data.ReasonForVisitDepartmentOverrides.closeChangeBatch(),r.Data.Locations.closeChangeBatch(),r.Data.VisitTypes.closeChangeBatch(),r.Data.VisitTypeDepartmentOverrides.closeChangeBatch(),r.Data.Solutions.closeChangeBatch(),r.Data.AppointmentBuilder.Appointments.closeChangeBatch(),u=0;u<r.Data.AppointmentBuilder.numAppointments();u++)f=r.Data.AppointmentBuilder.getAppointment(u),f.Providers.closeChangeBatch(),f.Locations.closeChangeBatch();r.Data.SchedulingSteps.closeChangeBatch();r.__areSelectionsStillPresent(o,h)||r._showErrorAndExit();$$WPUtil.IsNullOrEmpty(r._pendingResult)||(r._handleResult(r._pendingResult),r._pendingResult=n);r._onAncillaryDataChanged()},__getAppointmentSelections:function(){for(var r=[],t=0,i=n,t=0;t<this.Data.AppointmentBuilder.numAppointments();t++)i=this.Data.AppointmentBuilder.getAppointment(t),r.push({VisitType:i.VisitType,Providers:i.Providers.toArray().slice(),Locations:i.Locations.toArray().slice()});return r},__reapplyAppointmentSelections:function(t){for(var o=this,i=n,h=n,c=n,l=[],a=n,v=[],y=n,f=0,u=0,f=0;f<o.Data.AppointmentBuilder.numAppointments();f++){for(i=o.Data.AppointmentBuilder.getAppointment(f),h=t[f].VisitType,l=t[f].Providers,v=t[f].Locations,!h||(c=o.Data.VisitTypes.getFirstInIndex(s,h.ID),c?i.setVisitTypeWithSource(c,i.VisitTypeSource,i.PanelId):i.setVisitTypeWithSource(n,i.VisitTypeSource,r)),i.Providers.empty(),u=0;u<l.length;u++)a=o.Data.Providers.getFirstInIndex(s,l[u].ID),!a||i.Providers.add(a);for(i.Locations.empty(),u=0;u<v.length;u++)y=o.Data.Locations.getFirstInIndex(e,v[u].Id),!y||i.Locations.add(y)}},__areSelectionsStillPresent:function(r,u){var c=n,l=[],a=[],e={},o=[],s=[],f=0,h=n;if(c=this.Data.AppointmentBuilder.ReasonForVisit,!!r&&!c)return t;for(f=0;f<this.Data.AppointmentBuilder.numAppointments();f++)if(h=this.Data.AppointmentBuilder.getAppointment(f),l=h.Providers.toArray(),a=h.Locations.toArray(),e=u[f],e?(o=e.Providers,s=e.Locations):(o=[],s=[]),o.length>0&&l.length===0||s.length>0&&a.length===0)return t;return i},_handleResult:function(t){var i=this,f=n,r=n,l={},a=n,h=0,c=n;for($$WPUtil.IsNullOrEmpty(t.VisitTypeId)||(f=i.Data.VisitTypes.getFirstInIndex(s,t.VisitTypeId),!f||(a=i._mode===u.DepartmentOverride?o.VisitTypeSourceEnum.DepartmentOverrideLqf:o.VisitTypeSourceEnum.StandardLqf,i.Data.AppointmentBuilder.updateAppointmentsCollectionForVisitType(f,i.Data.VisitTypes,a,i._workflow))),t.StopLqfChain&&i.__stopLqfChainForAllAppoinments(),r=i.Data.Lqfs.getFromIndex(e,t.LqfId),r.Result=t,r.CompletingStep=i.Id,h=0;h<i.Data.AppointmentBuilder.numAppointments();h++)c=i.Data.AppointmentBuilder.getAppointment(h),c.Lqfs.add(r),c.SchedulingOverride=r.SchedulingOverride;i.__setOriginalVisitTypeIdOnAllAppointments(r.SchedulingOverride.OriginalPrcId);i.$root.find(v).hide();t.StopScheduling?i._stopSchedulingCallback!==n&&(f=i._getCurrentVisitType(),l={VisitTypeInstructions:f.SchedulingInstructions,LqfInstructions:t.Instructions},i._stopSchedulingCallback(l)):i.__canWorkflowHandleCurrentAppointmentCount()||i._showErrorAndExit()},__stopLqfChainForAllAppoinments:function(){for(var t=0,r=n,t=0;t<this.Data.AppointmentBuilder.numAppointments();t++)r=this.Data.AppointmentBuilder.getAppointment(t),r.IsLqfChainStopped=i},__canWorkflowHandleCurrentAppointmentCount:function(){switch(this._workflow.Type){case $$WP.Scheduling.Workflow.WorkflowTypesEnum.ExistingProvider:return this.Data.AppointmentBuilder.numAppointments()===1;default:return i}},_getCurrentVisitType:function(){var t=this,r={},i=n;i=t.Data.AppointmentBuilder.getFirstAppointment();switch(t._mode){case u.Standard:return t.__getVisitTypeOrPanelFromAppointment(i);case u.DepartmentOverride:return r=t._getCurrentLqf(),w.getVisitTypeForDepartment(t.Data,i,r.Department)}},_showQuestionnaire:function(u){var f=this,o,e,s,h;o=b.getDomElementsForQuestionnaireView(f.Id);e=new Epic.PatientEngagement.Questionnaire.WorkflowSettings;e.hideSummaryPage=i;e.defaultAnswersFromDAT=$$WPUtil.IsNullOrEmpty(f._favoriteAppointmentInfo)?r:f._favoriteAppointmentInfo.Dat;s=new Epic.PatientEngagement.Questionnaire.QuestionnaireWorkflowInformation(f,Epic.PatientEngagement.Questionnaire.QuestionnaireContextType.Scheduling,r,{shouldDisplayQuestionnaireName:t,showBottomBackButton:i},n,e);h={afterViewLoadCallback:f.questionnaireOnRenderCallback,defaultSettings:{scrollToTop:t}};f._questionnaireControllerLqfId=u;f._questionnaireController=new Epic.PatientEngagement.Questionnaire.MyChart.QuestionnaireController(f._questionnaireControllerLqfId,o,s,h);f._questionnaireController.start()},_showDecisionTree:function(n){var i=this,u,f,e,o;o=i._getCurrentVisitType();e=i.$root.find(y);u=new $$WP.DecisionTrees.Models.TraversalSettings({AllowBack:t,AllowFinishLater:t,AllowCancel:t,OnStepRender:i.decisionTreeStepOnRenderCallback});f=new $$WP.DecisionTrees.Models.TraversalAdditionalContext({VisitTypeID:o.ID,TicketID:$$WPUtil.IsNullOrEmpty(i._ticketInfo)?r:i._ticketInfo.TicketId,OriginalApptDAT:$$WPUtil.IsNullOrEmpty(i._originalAppointmentInfo)?r:i._originalAppointmentInfo.Dat,FavoriteApptDAT:$$WPUtil.IsNullOrEmpty(i._favoriteAppointmentInfo)?r:i._favoriteAppointmentInfo.Dat,OrdersString:i.__generateOrdersStringForAllAppointments()});i._decisionTreeLqfId=n;i._decisionTreeController=new $$WP.DecisionTrees.Controllers.DecisionTreeTraversalController(e,n,$$WP.DecisionTrees.Enums.TraversalSourceWorkflow.Scheduling,u,r,i.decisionTreeCallback,f)},__generateOrdersStringForAllAppointments:function(){for(var f=n,i=0,u=0,t=r,i=0;i<this.Data.AppointmentBuilder.numAppointments();i++)for(f=this.Data.AppointmentBuilder.getAppointment(i),u=0;u<f.Orders.length;u++)t!==r&&(t=t+"^"),t=t+f.Orders[u].ID;return t},_getCurrentLqf:function(){var t=this,r,f,i,s,e,h,n;if(n=t.Data.AppointmentBuilder.getFirstAppointment(),!n.IsLqfChainStopped&&t.arePrerequisitesComplete())switch(t._mode){case u.Standard:if(n.VisitTypeSource!==o.VisitTypeSourceEnum.DepartmentOverrideLqf)return s=t.__getVisitTypeOrPanelFromAppointment(n),t._getCurrentLqfFromVisitType(s);break;case u.DepartmentOverride:for(f=n.getSelectedDepartmentsCollection().toArray(),i=0;i<f.length;i++)if(h=f[i],e=w.getVisitTypeForDepartment(t.Data,n,h),(e!==n.VisitType||n.VisitTypeSource===o.VisitTypeSourceEnum.DepartmentOverrideLqf)&&(r=t._getCurrentLqfFromVisitType(e),!$$WPUtil.IsNullOrEmpty(r.LqfId)))return r}return{}},_getCurrentLqfFromVisitType:function(n,t){var i,r;return $$WPUtil.IsNullOrEmpty(n.QuestionnaireId)||this._wasAlreadyAnswered(n.QuestionnaireId)?$$WPUtil.IsNullOrEmpty(n.DecisionTreeId)||this._wasAlreadyAnswered(n.DecisionTreeId)||(i=n.DecisionTreeId,r=f.LqfTypeEnum.DecisionTree):(i=n.QuestionnaireId,r=f.LqfTypeEnum.Questionnaire),{LqfId:i,LqfType:r,Department:t}},_wasAlreadyAnswered:function(i){var r=n,u=this.Data.Lqfs.getFromIndex(e,i);return $$WPUtil.IsNullOrEmpty(u)?t:(r=this.Data.AppointmentBuilder.getFirstAppointment(),r.Lqfs.contains(u))}},u={Standard:1,DepartmentOverride:2};l.prototype=d;l.ModesEnum=u;$$WP.Scheduling.LqfStepController=l;l.extend($$WP.Scheduling.StepController,"WP$Scheduling$LqfStepController")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var n=function(n,t){var i=this;i.WP$Scheduling$StepController(n,t);i.proxify("__onConfirmClick","__onAppointmentsChanged","__onAncillaryDataChanged");i.__eventManager=new $$WP.Scheduling.EventManager;i.Data.AppointmentBuilder.addPropertyListener("ReasonForVisit",i.__onAncillaryDataChanged);i.Data.AppointmentBuilder.Appointments.addCollectionEventListener("add",i.__onAppointmentsChanged);i.Data.AppointmentBuilder.Appointments.addCollectionEventListener("remove",i.__onAppointmentsChanged);i.__onAppointmentsChanged();i.$root.on("click","[data-id='panelconfirm']",i.__onConfirmClick)},t={__eventManager:null,updateViewModel:function(){var n=this;n.__isFirstAppointmentPartOfAPanel()?(n.ViewModel={StepShouldBeActive:!0,Count:1,SolutionViewModel:n.__getSolutionViewModel()},n.stepSettings.Hide=!1,n.template=$$WP.Templates.Scheduling.OnboardingPanelStep):(n.ViewModel={},n.stepSettings.Hide=!0)},__getSolutionViewModel:function(){var n=new $$WP.Scheduling.SolutionViewModel,t=this.Data.VisitTypes.getFirstInIndex("ID",this.__getFirstAppointmentPanelId());return n.populateFromVisitType(t),n},afterRender:function(){$$WP.Utilities.UI.MatchColumnHeights();this.$root.find("h2").focus()},__onConfirmClick:function(){this.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.NotRequired)},__onAppointmentsChanged:function(){var n=this,t=0,i=null;for(n.__eventManager.removeAllListeners(),t=0;t<n.Data.AppointmentBuilder.numAppointments();t++)i=n.Data.AppointmentBuilder.getAppointment(t),n.__eventManager.addModelPropertyListener(i,"VisitType",n.__onAncillaryDataChanged)},__onAncillaryDataChanged:function(){this.__updateStepStatus()},__updateStepStatus:function(){this.__isFirstAppointmentPartOfAPanel()?this.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete):this.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.NotRequired)},__isFirstAppointmentPartOfAPanel:function(){return!$$WPUtil.IsNullOrEmpty(this.__getFirstAppointmentPanelId())},__getFirstAppointmentPanelId:function(){return this.Data.AppointmentBuilder.getFirstAppointment().PanelId}};n.prototype=t;$$WP.Scheduling.OnboardingStepController=n;n.extend($$WP.Scheduling.StepController,"WP$Scheduling$OnboardingStepController")}(),function(){var u=!0,i=!1,t="State",e="select.selectSubLocation",o="select.selectLocation",r=null,n=$$WP.Scheduling.TelehealthLocation,h=$$WP.Scheduling.ReasonForVisit,c=$$WP.Common.SelectableViewBinder,s={PromptForLocation:0,LocationDetected:1,CouldNotDetectLocation:2,SelectionMade:3,ManualEntry:4},f=function(i,u){var f=this;f.WP$Scheduling$StepController(i,u,r,r,r,$$WP.Templates.Scheduling.OnDemandTelehealth.PatientLocationStep);f.proxify("updateStep","_onLocationStateChanged","_onCardFocus","_onCardBlur","_onClick","_onLocationSelect","_onSubLocationSelect");f.$root.on("click",f._onClick);f.$root.on("change",o,f._onLocationSelect);f.$root.on("change",e,f._onSubLocationSelect);f.setViewBinder(new c(t,n.StatesEnum.Selected,n.StatesEnum.Unselected));f.Data.TelehealthLocations.addPropertyListener(t,f._onLocationStateChanged);f.$root.on("focus",".card",f._onCardFocus);f.$root.on("blur",".card",f._onCardBlur)},l={_mode:r,_prerequisiteSteps:r,_selectionMade:i,_selectedPrimaryIndex:-1,_selectedSubIndex:-1,_viewMode:s.PromptForLocation,_idPrefix:"",_firstRender:u,updateViewModel:function(){var t=this,r,f,e,o;t._firstRender&&(t._firstRender=i,t.Data.TelehealthData.setProperty("TelehealthLoaded",u));r=t._buildTelehealthLocationArray();e=t._selectedPrimaryIndex;e===-1&&t._findSelectedLocationIndex();f=t._buildTelehealthSubLocationArray();o=t._selectedSubIndex;o===-1&&t._findSelectedSubLocationIndex();t._idPrefix="PatientLocationStep_"+(t.Id||"");t.ViewModel={TelehealthLocations:r,TelehealthSubLocations:f,StepShouldBeActive:r.length>0,IdPrefix:t._idPrefix,SelectedPrimaryIndex:t._selectedPrimaryIndex,SelectedSubIndex:t._selectedSubIndex,AlreadyComplete:t.getComplete()===$$WP.Scheduling.SchedulingStep.CompleteEnum.Complete,ViewMode:t._viewMode,ValidationGroup:new $$WP.FormValidation.ValidationGroup({}),SubLocationValidation:new $$WP.FormValidation.ValidationSettings({required:u,nullValue:n.FakeLocationId})}},beforeRender:function(){var f=this,e=f.Data.TelehealthLocations.Models,o;if(e&&e.length===1&&(o=e[0].SubLocations.Models,o&&o.length===1)){e[0].setProperty(t,n.StatesEnum.Selected);o[0].setProperty(t,n.StatesEnum.Selected);f.stepSettings.ReadOnly=u;return}f.Data.TelehealthLocations.getFirstInIndex(t,n.StatesEnum.Selected)===r&&(f.stepSettings.Hide=i,f.stepSettings.HideIfOne=i,f.stepSettings.Collapse=i,f.stepSettings.CollapseIfOne=i,f.stepSettings.ReadOnly=i)},afterRender:function(){var t=this,i=t.Data.TelehealthLocations.Models[t._selectedPrimaryIndex];t._selectedSubIndex!==-1&&i&&i.SubLocations.Models[t._selectedSubIndex]&&i.SubLocations.Models[t._selectedSubIndex].Id===n.FakeLocationId&&$$WP.FormValidation.addValidationError(t.$root.find(".selectSubLocation"));$$WP.Utilities.UI.MatchColumnHeights()},_buildTelehealthLocationArray:function(){for(var t=[],n=0;n<this.Data.TelehealthLocations.size();n++)t.push(this.Data.TelehealthLocations.Models[n]);return t},_buildTelehealthSubLocationArray:function(){var t=this.Data.TelehealthLocations.Models[this._selectedPrimaryIndex],i,n;if(!t)return[];for(i=[],n=0;n<t.SubLocations.size();n++)i.push(t.SubLocations.Models[n]);return i},_onClick:function(n){var r=$afe.jq(n.target).data("id"),t,i;if(typeof r!="undefined"&&!$afe.jq(n.target).hasClass("disabled")){t=$afe.jq(n.target).data("id").split("-");i=t[0];switch(i){case"confirm":this._selectCurrentLocation();this.updateStep()}}},_selectCurrentLocation:function(){var u=this._findSelectedLocationIndex(),i=this.Data.TelehealthLocations.Models[u],f=this._findSelectedSubLocationIndex(),r=i.SubLocations.Models[f];r&&r.setProperty(t,n.StatesEnum.Selected);i.setProperty(t,n.StatesEnum.Selected)},_onLocationSelect:function(){this._findSelectedLocationIndex();this.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete);this.updateStep()},_findSelectedLocationIndex:function(){var r=this,f,e,s,u,h;if(e=r.Data.TelehealthLocations.getFirstInIndex(t,n.StatesEnum.Selected),e&&e.setProperty(t,n.StatesEnum.Unselected),s=r.$root.find(o)[0],s)f=s.selectedIndex;else for(u=0;u<r.Data.TelehealthLocations.size();u++)if(h=r.Data.TelehealthLocations.Models[u],h.SelectedByDefault){f=u;break}return r._selectionMade=i,r._selectedPrimaryIndex=f,f},_onSubLocationSelect:function(){this._findSelectedSubLocationIndex();this.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete);this.updateStep()},_findSelectedSubLocationIndex:function(){var i=this,r,f,h,s,c,o;if(f=i.Data.TelehealthLocations.Models[i._selectedPrimaryIndex],!f)return-1;s=f.SubLocations.getFirstInIndex(t,n.StatesEnum.Selected);s&&s.setProperty(t,n.StatesEnum.Unselected);r=-1;try{c=i.$root.find(e)[0];r=c.selectedIndex}catch(l){for(o=0;o<f.SubLocations.size();o++)if(h=f.SubLocations.Models[o],h.SelectedByDefault){r=o;break}}return i._selectionMade=u,i._selectedSubIndex=r,r},_onLocationStateChanged:function(){var e="selectionmade",i=this,u,f;i.Data.TelehealthData.resetData();u=i.Data.AppointmentBuilder.ReasonForVisit;u!==r&&u.setProperty(t,h.StatesEnum.Unselected);i._isFullLocationSelected()?(f=i.Data.TelehealthLocations.getFirstInIndex(t,n.StatesEnum.Selected),f&&f.setLocationName(),i.$root.addClass(e),WP&&WP.DOM&&WP.DOM.Browser&&!WP.DOM.Browser.isMobile&&(i._viewMode=s.SelectionMade),i.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Complete)):(i.$root.removeClass(e),i.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete))},_isFullLocationSelected:function(){var r=this.Data.TelehealthLocations.getFirstInIndex(t,n.StatesEnum.Selected),u;return r?(u=r.SubLocations.getFirstInIndex(t,n.StatesEnum.Selected),!!u||r.SubLocations.size()===0):i},_onCardFocus:function(){this.$root.addClass("active")},_onCardBlur:function(){this.$root.removeClass("active")}};f.prototype=l;$$WP.Scheduling.OnDemandTelehealth=$$WP.Scheduling.OnDemandTelehealth||{};$$WP.Scheduling.OnDemandTelehealth.PatientLocationStepController=f;f.extend($$WP.Scheduling.StepController,"WP$Scheduling$OnDemandTelehealth$PatientLocationStepController")}(),function(){function l(t,i,f,e){if(i===r||f===r||typeof t!=typeof i)return n;if(t===r)return u;var o=f(i),s=f(t),h=o<s;return o===s?e.hasTie=u:h&&(e.hasTie=n),h}var c="IsOrgSelectionComplete",o=".card",i="State",u=!0,n=!1,r=null,a=$$WP.Common.Model,v=$$WP.Common.SelectableViewBinder,t=$$WP.Scheduling.TelehealthOrganization,s=$$WP.Scheduling.TelehealthData,f=$$WP.Scheduling.TelehealthLocation,e=$$WP.Scheduling.TelehealthFilters,h=function(n,u){var f=this;f.WP$Scheduling$StepController(n,u,r,r,r,$$WP.Templates.Scheduling.OnDemandTelehealth.OrganizationStep);f.proxify("updateStep","_onOrganizationStateChanged","_onCardFocus","_onCardBlur","updateOrgs","clearModel","_orgChooseCallbackSuccess","_onFilterSelect","_dataUpdated");f.setViewBinder(new v(i,t.StatesEnum.Selected,t.StatesEnum.Unselected));f.Data.TelehealthOrganizations.addPropertyListener(i,f._onOrganizationStateChanged);f.Data.TelehealthLocations.addPropertyListener(i,f.updateStep);f.Data.TelehealthData.addPropertyListener("",f._dataUpdated);f.$root.on("click","input.togglebutton",f._onFilterSelect);f.Data.AppointmentBuilder.addPropertyListener("ReasonForVisit",f.updateOrgs);f.Data.ReasonsForVisit.addCollectionEventListener("add",f.clearModel);f.Data.ReasonsForVisit.addCollectionEventListener("remove",f.clearModel);f.Data.TelehealthOrganizations.addCollectionEventListener("add",f.updateStep);f.Data.TelehealthOrganizations.addCollectionEventListener("remove",f.updateStep);f.$root.on("focus",o,f._onCardFocus);f.$root.on("blur",o,f._onCardBlur)},y={_mode:r,_prerequisiteSteps:r,_selectionMade:n,_selectedIndex:0,_isLoading:n,_selectedFilter:r,updateViewModel:function(){var o=this,v=o.Data.AppointmentBuilder.ReasonForVisit,y=o.Data.TelehealthLocations.getFirstInIndex(i,f.StatesEnum.Selected),h,a,c,l;if(o._selectedFilter=o._selectedFilter||e.Filters[0].Value,h=o._buildTelehealthOrganizationArray(o._selectedFilter),a=o.Data.TelehealthOrganizations.getFirstInIndex(i,t.StatesEnum.Selected),!o.Data.TelehealthData.IsXOrgEnabled){o._orgNotRequired(h);return}if(o.Data.AppointmentBuilder.getAppointment(0).Slot&&o.Data.TelehealthData.QuickScheduleSlot===r){o.Data.TelehealthData.QuickScheduleSlot=o.Data.AppointmentBuilder.getAppointment(0).Slot;o._orgNotRequired(h);return}if(v===r){o.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete);o.ViewModel={StepShouldBeActive:n};return}if(h.length===1&&h[0].IsLocal||!v.ExternallyAvailableForTelehealth||o.Data.TelehealthData.SelectedWorkflow===s.TelehealthWorkflow.QuickSchedule||y&&y.Id!=="233")o._orgNotRequired(h);else if(o.Data.TelehealthData.SelectedWorkflow===r)o.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete),o.ViewModel={StepShouldBeActive:n};else if(a&&!a.ConsentCaptured())o.$root.hide();else{for(o.Data.TelehealthOrganizations.openChangeBatch(),c=0;c<h.length;c++)l=h[c],l.State===t.StatesEnum.Selected&&l.setProperty(i,t.StatesEnum.SelectedUnavailable);for(o.ViewModel={StepShouldBeActive:u,Count:h.length,TelehealthOrganizations:h,Filter:o._selectedFilter,Filters:e.Filters,SelectedIndex:"",SelectedValue:"",HadConnectionFailure:o.Data.TelehealthData.HadConnectionFailure,ViewMode:o._viewMode,IsLoading:o._isLoading},c=0;c<h.length;c++)l=h[c],l.State===t.StatesEnum.SelectedUnavailable&&l.setProperty(i,t.StatesEnum.Selected);o.Data.TelehealthOrganizations.closeChangeBatch()}},_orgNotRequired:function(r){var f=this,e;f.Data.TelehealthData.setProperty(c,u);f.ViewModel={StepShouldBeActive:n};e=f._getLocalOrgIndex(r);e>-1&&r[e].setProperty(i,t.StatesEnum.Selected);f.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.NotRequired)},_onFilterSelect:function(n){var t=n.target.value;t&&this._selectedFilter!==t&&(this._selectedFilter=t,this._showFilter(t,u))},_showFilter:function(n,u){var f=this,o=f._buildTelehealthOrganizationArray(n),s=f.Data.TelehealthOrganizations.getFirstInIndex(i,t.StatesEnum.Selected),h,e;s===r||$.inArray(o,s)||(s.State=t.StatesEnum.Unselected,f.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete));f.ViewModel.Count=o.length;f.ViewModel.TelehealthOrganizations=o;f.ViewModel.Filter=n;h=$afe.renderTemplate($$WP.Templates.Scheduling.OnDemandTelehealth.OrganizationList,f.ViewModel);e=f.$root.find(".telehealthContainer > div");u?e.fadeOut("fast",$.proxy(f._replaceOrgList,f,e,h)):(e.safeReplaceWith(h),f._fixCards())},_replaceOrgList:function(n,t){t.hide();n.safeReplaceWith(t);this._fixCards();t.fadeIn("fast")},_fixCards:function(){var n=this;n.$root.find(".cardlist.matchHeights").each(function(){$$WP.Utilities.UI.Cards.MatchHeights.apply(this,arguments)});n.ViewBinder.bindAllModels(n.ViewModel.TelehealthOrganizations);n.ViewBinder.syncModelsToDOM()},_getLocalOrgIndex:function(n){if(n.length===1)return 0;for(var t=0;t<n.length;t++)if(n[t].IsLocal)return t;return-1},beforeRender:function(){var f=this,e=f.ViewModel.TelehealthOrganizations;e.length===1&&e[0].IsLocal?(e[0].setProperty(i,t.StatesEnum.Selected),f.stepSettings.ReadOnly=u):f.Data.TelehealthOrganizations.getFirstInIndex(i,t.StatesEnum.Selected)===r&&(f.stepSettings.Hide=n,f.stepSettings.HideIfOne=n,f.stepSettings.Collapse=n,f.stepSettings.CollapseIfOne=n,f.stepSettings.ReadOnly=n)},afterRender:function(){var r=this,u;r._showFilter(r._selectedFilter,n);u=r.Data.TelehealthOrganizations.getFirstInIndex(i,t.StatesEnum.Selected);u&&!u.ConsentCaptured()&&r.$root.hide();r.$root.find("h2.header").focus()},updateOrgs:function(){var n=this,t=n.Data.AppointmentBuilder.ReasonForVisit;t===r?n.clearModel():(n._isLoading=n._loadOrgs(),n.updateStep())},clearModel:function(){this._isLoading=n;this.Data.TelehealthOrganizationLoader.CancelRequest()},_loadOrgs:function(){var t=this,o=t.Data.AppointmentBuilder.ReasonForVisit,r=t.Data.TelehealthLocations.getFirstInIndex(i,f.StatesEnum.Selected),e;return r&&(e=r.SubLocations.getFirstInIndex(i,f.StatesEnum.Selected)),t.Data.TelehealthOrganizations.openChangeBatch(),t.Data.TelehealthOrganizations.empty(),t.Data.TelehealthOrganizations.closeChangeBatch(),o&&r&&(e||r.SubLocations.size()===0)?(t.Data.TelehealthOrganizationLoader.LoadOrganizations(o,r,e,t._orgChooseCallbackSuccess),u):n},_orgChooseCallbackSuccess:function(n,t){var i=this,r,u,f;(i.clearModel(),r=i.Data.AppointmentBuilder.ReasonForVisit,r&&r===t)&&(u=i.Data.TelehealthOrganizations.Models.length,i._processRelevantOrganizations(n,r),f=i.Data.TelehealthOrganizations.Models.length,u===0&&f===0&&i.updateStep())},_processRelevantOrganizations:function(n,t){var i=this;i.Data.TelehealthOrganizations.openChangeBatch();i.Data.TelehealthOrganizations.empty();$$WP.Scheduling.TelehealthOrganization.convertRawTelehealthOrganizations(n,i.Data.TelehealthOrganizations);t.OnDemandOrganization&&i.Data.TelehealthOrganizations.add(t.OnDemandOrganization);i._findNotableOrganizations(i.Data.TelehealthOrganizations.Models);i.Data.TelehealthOrganizations.closeChangeBatch()},_findNotableOrganizations:function(i){for(var f,h=r,e=r,o=r,c={hasTie:n},a={hasTie:n},s=0;s<i.length;s++)f=i[s],f.IsLocal&&(h=f),f.BestValue&&(f.BestValue=n),f.ShortestWait&&(f.ShortestWait=n),l(e,f,t.GetOrgEstimatedCost,c)&&(e=f),l(o,f,t.GetOrgWaitTimeBucket,a)&&(o=f);return e&&!c.hasTie&&(e.BestValue=u),o&&!a.hasTie&&(o.ShortestWait=u),{localOrg:h,smallestCostOrg:e,shortestWaitOrg:o}},_dataUpdated:function(n){var r=this,u;switch(n.propertyName){case"TelehealthLoaded":r.Data.TelehealthData.IsXOrgEnabled||r.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.NotRequired);break;case"TelehealthSelectedPlatform":u=r.Data.TelehealthOrganizations.getFirstInIndex(i,t.StatesEnum.Selected);u&&u.setProperty(i,t.StatesEnum.Unselected);r.updateStep();break;case"SelectedWorkflow":r.Data.TelehealthData.SelectedWorkflow!==s.TelehealthWorkflow.Queueing?r.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.NotRequired):r.Data.TelehealthData.IsXOrgEnabled&&r.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete);r.updateStep()}},_onOrganizationStateChanged:function(r){var u=this,e=u.Data.TelehealthOrganizations.getFromIndex(i,t.StatesEnum.Selected),o=u.Data.TelehealthOrganizations.getFromIndex(i,t.StatesEnum.SelectedUnavailable),f;e.size>0||o.size>0?(u.$root.addClass("selectionmade"),$afe.select(".content").trigger("resize"),u.Data.TelehealthData.setProperty(c,n),u.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete),u.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Complete),u.updateStep(),f=u.Data.TelehealthOrganizations.getFirstInIndex(i,t.StatesEnum.Selected),f.IsUnconnected()&&u.$root.hide()):(u.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete),u.updateStep());u._updateCardStatus(r)},_updateCardStatus:function(n){var f="selected",r,e,s,u,i;for(r in n)(e=a.getInstance(r),i=n[r],i.to!==i.from)&&(s=this.ViewBinder.getBoundElements(e),u=s.closest(o),i.to===t.StatesEnum.Selected?u.addClass(f):i.from===t.StatesEnum.Selected&&u.removeClass(f))},_buildTelehealthOrganizationArray:function(n){var r=this,h=[],u=r.Data.TelehealthLocations.getFirstInIndex(i,f.StatesEnum.Selected),c,l,o,t;for(u&&(c=u.SubLocations.getFirstInIndex(i,f.StatesEnum.Selected)),l=r.Data.TelehealthData.TelehealthSelectedPlatform,o=0;o<r.Data.TelehealthOrganizations.size();o++)(t=r.Data.TelehealthOrganizations.Models[o],t)&&t.ContainsPreferredPlatform(l)&&(r.Data.TelehealthData.SelectedWorkflow===s.TelehealthWorkflow.Queueing&&u&&t.IsLocal&&!e.IsInLicensedLocation(t.AllowedLocationsString,u,c)||h.push(t));return e.DoSortAndFilter(h,n)},_onCardFocus:function(){this.$root.addClass("active")},_onCardBlur:function(){this.$root.removeClass("active")}};h.prototype=y;$$WP.Scheduling.OnDemandTelehealth=$$WP.Scheduling.OnDemandTelehealth||{};$$WP.Scheduling.OnDemandTelehealth.OrganizationStepController=h;h.extend($$WP.Scheduling.StepController,"WP$Scheduling$OnDemandTelehealth$OrganizationStepController")}(),function(){var o="Disabled",s="IsOrgSelectionComplete",f=".loadingoverlay",r=!0,i=!1,h="NeedsH2GConsent",n="State",u=null,l=$$WP.Scheduling.ReasonForVisit,t=$$WP.Scheduling.TelehealthOrganization,c=$$WP.Scheduling.TelehealthLocation,a=$$WP.Scheduling.TelehealthData,e=function(t,i){var r=this;r.WP$Scheduling$StepController(t,i,u,u,u,$$WP.Templates.Scheduling.OnDemandTelehealth.OrganizationAuthStep);r.proxify("updateStep","_onOrgStateChanged","_onCardFocus","_onCardBlur","_onClick","_onConsentChanged","_tryEstablishLinkSuccess","_dataUpdated");r.$root.on("click",r._onClick);r.Data.TelehealthOrganizations.addPropertyListener(n,r._onOrgStateChanged);r.Data.TelehealthOrganizations.addPropertyListener(h,r._onConsentChanged);r.Data.TelehealthData.addPropertyListener("",r._dataUpdated);r.Data.AppointmentBuilder.addPropertyListener("ReasonForVisit",r.updateStep);r.Data.ReasonsForVisit.addCollectionEventListener("add",r.updateStep);r.Data.ReasonsForVisit.addCollectionEventListener("remove",r.updateStep);r.$root.on("focus",".card",r._onCardFocus);r.$root.on("blur",".card",r._onCardBlur)},v={updateViewModel:function(){var t=this,f=t.Data.TelehealthOrganizations.getFirstInIndex(n,l.StatesEnum.Selected);if(t.Data.TelehealthData.IsOrgSelectionComplete&&!f||!t.Data.TelehealthData.IsXOrgEnabled||f&&f.ConsentCaptured()||t.Data.TelehealthData.SelectedWorkflow===a.TelehealthWorkflow.QuickSchedule){t.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.NotRequired);t.ViewModel={StepShouldBeActive:i};return}f===u?(t.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete),t.ViewModel={StepShouldBeActive:i}):(t.ViewModel={Count:1,StepShouldBeActive:r,SelectedValue:f,HomeOrganizationName:t.Data.HomeOrganizationName,OrganizationName:f.OrganizationName,IsMobile:$$WP.Utilities.UI.IsMobile},t.Data.TelehealthData.IsOrgSelectionComplete||t._onConsentChanged())},afterRender:function(){var i=this,r;$afe.select(".cardlist.matchHeights").each($$WP.Utilities.UI.Cards.MatchHeights);i.$root.find(".jqHidden").fadeIn("slow");r=i.Data.TelehealthOrganizations.getFirstInIndex(n,t.StatesEnum.Selected);r&&i.$root.find(f).hide();$$WP.Utilities.UI.MatchColumnHeights();i.$root.find("h2.header").focus()},_dataUpdated:function(n){switch(n.propertyName){case"TelehealthLoaded":this.Data.TelehealthData.IsXOrgEnabled||this.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.NotRequired);break;default:this.updateStep()}},_onClick:function(i){var e=$afe.jq(i.target).data("id"),u,f,r;if(typeof e!="undefined"&&!$afe.jq(i.target).hasClass("disabled")){u=$afe.jq(i.target).data("id").split("-");f=u[0];switch(f){case"continue":i.preventDefault();this._linkAndContinue();break;case"reselect":case"cancel":i.preventDefault();r=this.Data.TelehealthOrganizations.getFirstInIndex(n,t.StatesEnum.Selected);r&&(r.setProperty(n,t.StatesEnum.Unselected),this.updateStep())}}},_onOrgStateChanged:function(){var i=this.Data.TelehealthOrganizations.getFirstInIndex(n,t.StatesEnum.Selected);i?this.$root.find(f).hide():this._onConsentChanged()},_onConsentChanged:function(){var i=this,r=i.Data.TelehealthOrganizations.getFirstInIndex(n,t.StatesEnum.Selected);r?(i.Data.TelehealthData.setProperty(s,r.ConsentCaptured()),r.ConsentCaptured()&&(i.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.NotRequired),i.updateStep())):i._setIncomplete()},_setIncomplete:function(){this.Data.TelehealthData.setProperty(s,i);this.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete);this.updateStep()},_linkAndContinue:function(){var i=this.Data.TelehealthOrganizations.getFirstInIndex(n,t.StatesEnum.Selected);i&&this._tryEstablishLink()},_tryEstablishLink:function(){var u=this,h=u.Data.TelehealthOrganizations.getFirstInIndex(n,t.StatesEnum.Selected),l=u.Data.AppointmentBuilder.ReasonForVisit,e=u.Data.TelehealthLocations.getFirstInIndex(n,c.StatesEnum.Selected),o,s;e&&(o=e.SubLocations.getFirstInIndex(n,c.StatesEnum.Selected));h&&l&&e&&(o||e.SubLocations.size()===0)&&(s=u.$root.find(f),s.show(),WP.DOM.Browser.isIE&&dangerou$.setHtml(s,s.get(0).innerHTML),$.post({url:makeLink("Scheduling/TryEstablishLink"),data:{orgId:h.OrganizationId,rfvId:l.OnDemandRFV,locationId:e.Id,sublocationId:o?o.Id:""},cache:i,async:r,success:u._tryEstablishLinkSuccess,failure:$.proxy(u._connectionProblem,u,h)}))},_tryEstablishLinkSuccess:function(i){var r=this.Data.TelehealthOrganizations.getFirstInIndex(n,t.StatesEnum.Selected);if(i.LinkFailed||i.Error||!i.LinkEstablished){this._connectionProblem(r);return}r&&this._formH2GLink(r)},_formH2GLink:function(n){var t=this,i;n&&(t.$root.find(f).hide(),i=new $$WP.Community.CommunityController(u,r),i.CreateLinkToOrganization(n.OrganizationId,$.proxy(t._h2gLinkSuccess,t,n),$.proxy(t._connectionProblem,t,n),$.proxy(t._notMyAccount,t,n)))},_h2gLinkSuccess:function(r,u){var f=this,e=f.Data.TelehealthOrganizations.getFirstInIndex(n,t.StatesEnum.Selected);if(!u||u.UserMyChartStatus!==1&&u.UserMyChartStatus!==4){f._connectionProblem(r);return}e&&e===r&&(f._clearConnectionProblem(r),e.setProperty(h,i),f.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Complete),f.updateStep())},_connectionProblem:function(i){var u=this.Data.TelehealthOrganizations.getFirstInIndex(n,t.StatesEnum.Selected);u===i&&(i.setProperty(o,r),this.Data.TelehealthData.setProperty("HadConnectionFailure",r),i.setProperty(n,t.StatesEnum.Unselected))},_clearConnectionProblem:function(n){n.setProperty(o,i)},_notMyAccount:function(n){this._connectionProblem(n)},_onCardFocus:function(){this.$root.addClass("active")},_onCardBlur:function(){this.$root.removeClass("active")}};e.prototype=v;$$WP.Scheduling.OnDemandTelehealth=$$WP.Scheduling.OnDemandTelehealth||{};$$WP.Scheduling.OnDemandTelehealth.OrganizationAuthStepController=e;e.extend($$WP.Scheduling.StepController,"WP$Scheduling$OnDemandTelehealth$OrganizationAuthStepController")}(),function(){var i="SelectedWorkflow",o=".content",s=".loadingoverlay",t=!1,n=null,f="resize",u="State",h=$$WP.Scheduling.Provider,a=$$WP.Common.SelectableViewBinder,r=$$WP.Scheduling.TelehealthData,c=$$WP.Scheduling.TelehealthFilters,l=$$WP.Scheduling.TelehealthLocation,e=function(n,t,i,r,e,o,s,c,l){var v=this;v.WP$Scheduling$StepController(n,t,i,r,e,$$WP.Templates.Scheduling.OnDemandTelehealth.QuickScheduleStep);v.proxify("updateStep","_onClick","clearModel","_dataUpdated","_onSlotsLoaded","_matchHeights");v.$root.on("click",v._onClick);v.setViewBinder(new a(u,h.StatesEnum.Selected,h.StatesEnum.Unselected));v.Data.TelehealthData.addPropertyListener("",v._dataUpdated);v.Data.AppointmentBuilder.addPropertyListener("ReasonForVisit",v.clearModel);v.Data.ReasonsForVisit.addCollectionEventListener("add",v.clearModel);v.Data.TelehealthLocations.addPropertyListener(u,v.updateStep);v._workflowSettings=s;v._hasProviderDetailsSecurity=v._workflowSettings.HasProviderDetailsSecurity;v._isAnonymous=c;v._isGuest=l;window.addEventListener(f,v._matchHeights)},v={$root:n,_mode:n,_rfvStateListenerId:n,_allowSelectProvider:t,_errorCount:0,_csn:n,_timerFinished:t,_hardwareTested:t,_hasProviderDetailsSecurity:t,_isAnonymous:t,_isGuest:t,updateViewModel:function(){var i=this,r,u,f;r=i.Data.AppointmentBuilder.ReasonForVisit;(i._isAnonymous||i._isGuest)&&(i.Data.TelehealthData.TelehealthSelectedPlatform=c.PlatformFilterValueEnum.Web);r!==n&&(!i.Data.TelehealthData.ShouldShowHardwareTest||i.Data.TelehealthData.IsHardwareTestComplete)&&i.Data.TelehealthData.TelehealthSelectedPlatform?(i._allowSelectProvider=r.AllowProviderSelect,i.ViewModel&&i.ViewModel.Slots?(i.ViewBinder.bindAllModels(i.ViewModel.Slots),i.ViewModel.LoadingClasses="jqHidden",i.ViewModel.SelectedWorkflow=i.Data.TelehealthData.SelectedWorkflow,i.ViewModel.QuickScheduleSlotIndex=parseInt(i.Data.TelehealthData.QuickScheduleSlotIndex,10)):($afe.select(s).addClass("quickschedule"),u=$$WP.Scheduling.TelehealthFilters.IsRFVEnabledForOnDemand(r,i.Data.TelehealthData.TelehealthSelectedPlatform,i.Data.TelehealthData.IsXOrgEnabled),f=$$WP.Scheduling.TelehealthFilters.IsRFVEnabledForQuickSchedule(r,i.Data.TelehealthData.TelehealthSelectedPlatform),i.ViewModel={Slots:n,StepShouldBeActive:!0,HasOnDemandVideoVisitSecurity:i._workflowSettings.HasOnDemandVideoVisitSecurity,HasQuickScheduleSecurity:i._workflowSettings.HasQuickScheduleSecurity,HasAppointmentDetailsSecurity:i._workflowSettings.HasAppointmentDetailsSecurity,HasProviderDetailsSecurity:i._workflowSettings.HasProviderDetailsSecurity&&!WP.DOM.Browser.isMobile,EnableLinkToDirectScheduling:!0,EnabledForOnDemandVideoVisits:u,EnabledForQuickSchedule:f,NoneAvailable:!(u||f),Organization:r.OnDemandOrganization,AvailableExternally:r.ExternallyAvailableForTelehealth,IsIE:WP.DOM.Browser.isIE,IsAnonymous:i._isAnonymous},i.ViewModel.Providers=i.Data.Providers.Models,i._loadSlots())):(i.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete),i.ViewModel={StepShouldBeActive:t})},clearModel:function(){this.ViewModel!==n&&(this.ViewModel.Slots=n);this.updateStep()},_onSlotsLoaded:function(n){var t=this,i,o,r,f,h,a,e;for(t.ViewModel.Slots=[],t.ViewModel.AllowProviderSelect=t._allowSelectProvider,o=!t._allowSelectProvider&&n.length>0?1:n.length,e=0,i=0;i<o;i++)r=t._getProviderById(n[i].ProviderId),f=t.Data.TelehealthLocations.getFirstInIndex(u,l.StatesEnum.Selected),h=f.SubLocations.getFirstInIndex(u,l.StatesEnum.Selected),a=c.IsProviderEnabledAtLocation(r,f,h),a&&(t.ViewModel.Slots.push(new $$WP.Scheduling.Slot(n[i])),t.ViewModel.Slots[e].Provider=r,e+=1);if(t.ViewModel.HasLoadedData=!0,t._errorCount!==0){t._reloadSlots();return}t.updateStep();setTimeout($.proxy(function(){this.$root.find(s).hide()},t),500)},_reloadSlots:function(){this.updateStep();setTimeout(function(){$afe.select(o).trigger(f)},500)},_getProviderById:function(t){var i,r=this.ViewModel.Providers;if(r)for(i=0;i<r.length;i++)if(t===r[i].ID)return r[i];return n},_onClick:function(u){var c="QuickScheduleSlot",l="schedule",a="joinqueuephoto",v="joinqueue",f=this,b=$afe.jq(u.target).data("id"),h,p,s,w;if(typeof b!="undefined"&&!$afe.jq(u.target).hasClass("disabled")){var y=$afe.jq(u.target).data("id").split("-"),o=y[0],e=y[1];if((o===v||o===a)&&f.Data.TelehealthData.SelectedWorkflow===r.TelehealthWorkflow.Queueing||o===l&&f.Data.TelehealthData.SelectedWorkflow===r.TelehealthWorkflow.QuickSchedule&&f.Data.TelehealthData.QuickScheduleSlotIndex===e){f.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete);f.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Complete);return}switch(o){case v:case a:(!f._isAnonymous||f._isGuest)&&(f.Data.TelehealthData.setProperty("IsOrgSelectionComplete",t),u.preventDefault());f.Data.TelehealthData.setProperty(i,r.TelehealthWorkflow.Queueing);f.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Complete);f.updateStep();break;case l:f.Data.TelehealthData.setProperty(c,f.ViewModel.Slots[e]);f.Data.TelehealthData.SelectedProviderName=f.ViewModel.Slots[e].Provider.Name;f.Data.TelehealthData.setProperty("QuickScheduleSlotIndex",e);f.Data.TelehealthData.setProperty(i,r.TelehealthWorkflow.QuickSchedule);f.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Complete);f.updateStep();break;case"provider":case"providerphoto":f._hasProviderDetailsSecurity&&!WP.DOM.Browser.isMobile&&(h="inside1.asp",f._isAnonymous&&(h="publicforms.asp"),p=makeLink(h+"?mode=provider&widgetmode=1&id="+encodeURIComponent(f.ViewModel.Slots[e].ProviderId)),window.open(p,n,"width=1024,height=600,resizable,status,scrollbars").focus());break;case"moretimes":f.Data.TelehealthData.setProperty(c,n);s=f.ViewModel.Slots[e];f.Data.AppointmentBuilder.getFirstAppointment().Providers=f.Data.Providers;f.Data.AppointmentBuilder.getFirstAppointment().Locations=f.Data.Locations;w=new $$WP.Scheduling.ProviderDepartmentPair({ProviderId:s.ProviderId,DepartmentId:s.DepartmentId});f.Data.TelehealthData.SelectedProviderName=s.Provider.Name;f.Data.AppointmentBuilder.getFirstAppointment().Slot=n;f.Data.AppointmentBuilder.getFirstAppointment().ProviderDepartmentPairs=[];f.Data.AppointmentBuilder.getFirstAppointment().ProviderDepartmentPairs.push(w);f.Data.AppointmentBuilder.ReasonForVisit.Id=f.Data.AppointmentBuilder.LineInWDF15000;f.Data.TelehealthData.setProperty(i,n);f.Data.TelehealthData.setProperty(i,r.TelehealthWorkflow.SlotSelection);f.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Complete)}}},_loadSlots:function(){var n=this,t=n.Data.AppointmentBuilder.ReasonForVisit,i=$$WP.Scheduling.TelehealthFilters.IsRFVEnabledForQuickSchedule(t,n.Data.TelehealthData.TelehealthSelectedPlatform);i?$$WP.Scheduling.SlotLoader.LoadQuickScheduleSlots(t,1,$.proxy(n._onSlotsLoaded,n),n._isAnonymous):n._onSlotsLoaded({})},_dataUpdated:function(n){switch(n.propertyName){case i:case"TelehealthSelectedPlatform":this.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete)}},afterRender:function(){var t=".popupinstructionsicon",n=this;n.$root.find(".popupInstructions").removeAttr("style");n.$root.find(t).hover($$WPUtil.handlePopupInstructions);n.$root.find(t).blur($$WPUtil.handlePopupInstructions).focus($$WPUtil.handlePopupInstructions);$afe.select(o).trigger(f);n._matchHeights();n.$root.find("h2.header").focus()},_matchHeights:function(){for(var i=$afe.select("div.providerinfo"),r=0,t,n=0;n<i.length;n++)t=$afe.jq(i[n]),t.height("auto"),t.height()>r&&(r=t.height());for(n=0;n<i.length;n++)t=$afe.jq(i[n]),t.height(r)}};e.prototype=v;$$WP.Scheduling.OnDemandTelehealth=$$WP.Scheduling.OnDemandTelehealth||{};$$WP.Scheduling.OnDemandTelehealth.QuickScheduleStepController=e;e.extend($$WP.Scheduling.StepController,"WP$Scheduling$OnDemandTelehealth$QuickScheduleStepController")}(),function(){var r=!0,s="IsHardwareTestComplete",u="ShouldShowMobileInfo",f="ShouldShowHardwareTest",i=!1,h="State",n=null,t=$$WP.Scheduling.TelehealthFilters,l=$$WP.Scheduling.TelehealthLocation,e={NotTested:0,TestComplete:1,TestSkipped:2},o=5,c=function(t,i,r){var u=this;u.WP$Scheduling$StepController(t,i,n,n,n,$$WP.Templates.Scheduling.OnDemandTelehealth.PlatformStep);u.proxify("updateStep","_onCardFocus","_onCardBlur","_onClick","_dataUpdated","_onPlatformFilterSelect");u.$root.on("click",u._onClick);u._isAnonymous=r;u.Data.AppointmentBuilder.addPropertyListener("ReasonForVisit",u.updateStep);u.Data.TelehealthLocations.addPropertyListener(h,u.updateStep);u.Data.ReasonsForVisit.addCollectionEventListener("add",u.updateStep);u.Data.TelehealthData.addPropertyListener("",u._dataUpdated);u.$root.on("click","input.platformFilter",u._onPlatformFilterSelect);u.$root.on("focus",".card",u._onCardFocus);u.$root.on("blur",".card",u._onCardBlur)},a={_mode:n,_prerequisiteSteps:n,_viewMode:e.NotTested,_selectedPlatformFilter:n,_isAnonymous:i,_dataUpdated:function(r){var o=this,h;switch(r.propertyName){case f:case u:o._viewMode=e.NotTested;o.Data.TelehealthData.setProperty(s,i);o.Data.TelehealthData.AutoSelectedWorkflow===n&&o.Data.TelehealthData.setProperty("SelectedWorkflow",n);h=n;o.Data.TelehealthData.ShouldShowMobileInfo?h=t.PlatformFilterValueEnum.Mobile:o.Data.TelehealthData.ShouldShowHardwareTest&&(h=t.PlatformFilterValueEnum.Web);o._selectedPlatformFilter!==h&&(o._selectedPlatformFilter=h)}},_onPlatformFilterSelect:function(n){var t=n.target.value;this._onPlatformFilterSelectHelper(t)},_onPlatformFilterSelectHelper:function(n){var e=this;if(n&&e._selectedPlatformFilter!==n){e._selectedPlatformFilter=n;e.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete);switch(e._selectedPlatformFilter){case t.PlatformFilterValueEnum.Web:e.Data.TelehealthData.setProperty(f,r);e.Data.TelehealthData.setProperty(u,i);break;case t.PlatformFilterValueEnum.Mobile:e.Data.TelehealthData.setProperty(u,r);e.Data.TelehealthData.setProperty(f,i)}e._updateViewModelHelper();e._updatePlatformContent()}},_updatePlatformContent:function(){var n=this.$root.find(".platformStepContainer > div"),t;n&&(t=$afe.renderTemplate($$WP.Templates.Scheduling.OnDemandTelehealth.PlatformContainer,this.ViewModel),n.safeReplaceWith(t))},updateViewModel:function(){this._updateViewModelHelper()},_updateViewModelHelper:function(){var u=this,a,f,s,c,v,y,p;u._selectedPlatformFilter||(a=WP.DOM.Browser.isMobile?t.PlatformFilterValueEnum.Mobile:t.PlatformFilterValueEnum.Web,u._onPlatformFilterSelectHelper(a));u.Data.TelehealthData.setProperty("TelehealthSelectedPlatform",u._selectedPlatformFilter);u.Data.TelehealthData.setProperty("TelehealthSelectedPlatformString",t.GetPlatformString(u._selectedPlatformFilter));f=u.Data.AppointmentBuilder.ReasonForVisit;s=u.Data.TelehealthLocations.getFirstInIndex(h,l.StatesEnum.Selected);f===n||s===n?(u.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete),u.ViewModel={StepShouldBeActive:i}):(c=i,u._isAnonymous||(c=parseInt(f.ScheduledTelemedicineVendorId,10)===o||parseInt(f.OnDemandTelemedicineVendorId)===o),v=c||f.TelemedicineHardwareTestFdiId!=n&&f.TelemedicineHardwareTestFdiId!="",u.Data.TelehealthData.ShouldShowHardwareTest&&!u.Data.TelehealthData.IsHardwareTestComplete&&(u._viewMode=e.NotTested,u.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete)),y=s.SubLocations.getFirstInIndex(h,l.StatesEnum.Selected),p=t.IsRFVEnabledForPlatformAtLocation(f,u.Data.TelehealthData.TelehealthSelectedPlatform,s,y,u.Data.TelehealthData.IsXOrgEnabled),u.ViewModel={IsVidyoWeb:c,ViewMode:u._viewMode,StepShouldBeActive:r,SupportsHardwareTest:v,PlatformFilters:t.PlatformFilters,PlatformFilter:u._selectedPlatformFilter,ShouldShowMobileInfo:u.Data.TelehealthData.ShouldShowMobileInfo,ShouldShowHardwareTest:u.Data.TelehealthData.ShouldShowHardwareTest,ShouldPlatformBeEnabled:p,AlreadyComplete:u.getComplete()===$$WP.Scheduling.SchedulingStep.CompleteEnum.Complete})},_onClick:function(n){var t=this,y=$afe.jq(n.target).data("id"),c,l,h,a,v;if(y!==undefined&&!$afe.jq(n.target).hasClass("disabled")){c=$afe.jq(n.target).data("id").split("-");l=c[0];switch(l){case"testhardware":h=t.Data.AppointmentBuilder.ReasonForVisit;a=parseInt(h.ScheduledTelemedicineVendorId)===o||parseInt(h.OnDemandTelemedicineVendorId)===o;a?(v=parseInt(h.ScheduledTelemedicineVendorId)===o?h.DefaultVisitTypeId:h.TelemedicineVisitTypeId,WP.TelehealthUtils.telemedPopup(makeLink("TelemedicineHome/StartTelemedSession?mode=TestOnly&prcId="+encodeURIComponent(v)))):h.TelemedicineHardwareTestFdiId!=""&&WP.TelehealthUtils.telemedExecuteFDI(h.TelemedicineHardwareTestFdiId);t._viewMode=e.TestComplete;t.Data.TelehealthData.setProperty(s,r);t.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Complete);t.updateStep();break;case"skiptesthardware":case"nohardwaretest":t._viewMode=e.TestSkipped;t.Data.TelehealthData.setProperty(s,r);t.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Complete);t.updateStep();break;case"useweb":t.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete);t.Data.TelehealthData.setProperty(f,r);t.Data.TelehealthData.setProperty(u,i);t.updateStep();break;case"usemobile":t.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete);t.Data.TelehealthData.setProperty(u,r);t.Data.TelehealthData.setProperty(f,i);t.updateStep();break;case"verifyhasapp":t.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Complete);t.updateStep()}}},_onCardFocus:function(){this.$root.addClass("active")},_onCardBlur:function(){this.$root.removeClass("active")},afterRender:function(){$afe.select(".content").trigger("resize");this.$root.find("h2.header").focus()}};c.prototype=a;$$WP.Scheduling.OnDemandTelehealth=$$WP.Scheduling.OnDemandTelehealth||{};$$WP.Scheduling.OnDemandTelehealth.PlatformStepController=c;c.extend($$WP.Scheduling.StepController,"WP$Scheduling$OnDemandTelehealth$PlatformStepController")}(),function(){var e="toolbarSomeoneElse",i=!0,r="State",t=!1,n=null,s=$$WP.Scheduling.TelehealthData,o=$$WP.Scheduling.TelehealthLocation,u=$$WP.Scheduling.TelehealthOrganization,f=function(t,i,r,u,f,e,o){var s=this;s.WP$Scheduling$StepController(t,i,n,n,n,$$WP.Templates.Scheduling.OnDemandTelehealth.SummaryStep);s.proxify("updateStep","_onCardFocus","_onCardBlur","_onKeyDown","_dataUpdated","_hideStep","_onClick","_onChange");s.$root.on("click",s._onClick);s.Data.TelehealthData.addPropertyListener("",s._dataUpdated);s.Data.AppointmentBuilder.addPropertyListener("ReasonForVisit",s._hideStep);s._workflowSettings=r;s._onWorkflowCompleteCallback=u;s._isAnonymous=f;s._isGuest=e;s._anonymousSettings=o;s._viewMode=$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ViewMode.Initial;s.$root.on("focus",".card",s._onCardFocus);s.$root.on("blur",".card",s._onCardBlur);s.$root.on("keydown",s._onKeyDown)},h={_workflowSettings:n,_viewMode:0,_notificationOptions:n,_timerFinished:t,_redirectCallbackId:n,_isAnonymous:t,_idPrefix:n,_isGuest:t,_anonymousSettings:n,updateViewModel:function(){var f=this,e,o;if((f._isAnonymous||f._isGuest)&&f.Data.AppointmentBuilder.ReasonForVisit!=n&&(f.Data.TelehealthOrganizations=u.createTelehealthOrganizationCollection(),u.convertRawTelehealthOrganizations([f.Data.AppointmentBuilder.ReasonForVisit.OnDemandOrganization],f.Data.TelehealthOrganizations),f.Data.TelehealthOrganizations.Models[0].setProperty(r,u.StatesEnum.Selected),f.Data.TelehealthOrganizations.Models[0].setProperty("IsLocal",i)),e=f.Data.TelehealthData.SelectedWorkflow,o=f.Data.TelehealthOrganizations.getFirstInIndex(r,u.StatesEnum.Selected),e!==n&&f.Data.AppointmentBuilder.ReasonForVisit!==n&&(e!==s.TelehealthWorkflow.Queueing||f._isAnonymous||f._isGuest||o!==n&&o.ConsentCaptured())){if(f._notificationOptions===n){f._getNotificationOptions();return}f.ViewModel=$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.UpdateViewModel(f.$root,f,f.Data,f._workflowSettings,f._isAnonymous,t,t,f._anonymousSettings);f._shouldHideStep=t}else f.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete),f.ViewModel={StepShouldBeActive:t}},_getID:function(n){return $$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.GetID(n,this)},_getIDPrefix:function(){return $$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.GetIDPrefix(this)},_getComments:function(){return $$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.GetComments(this.$root)},_onClick:function(n){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.OnClick(n,this,this.Data)},_signUp:function(){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.SignUp(this.$root,this,this.Data)},_saveEmail:function(){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.SaveEmail(this.$root,this)},_savePhone:function(){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.SavePhone(this.$root,this)},_enqueuePatient:function(){var n=this;$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.EnqueuePatient(n.$root,n,n.Data,n._isAnonymous)},_scheduleAppointment:function(){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ScheduleAppointment(this.$root,this,this.Data)},_redirectToLogin:function(){var n=this,r=n._buildRedirectionParameters();n._changeOverlayText(i,i);$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ShowOverlay(n.$root,n.Data);$.post({url:makeLink("Scheduling/Anonymous/TelehealthRedirectTologin"),data:$$WPUtil.postify(r),cache:t,success:$.proxy(n._loginUrlLoaded,n),error:$.proxy(n._onScheduleError,n)})},_buildRedirectionParameters:function(t){var i=this,f=i.Data.TelehealthLocations.getFirstInIndex(r,o.StatesEnum.Selected),s=n,e,c,h;return f&&(s={Number:f.Id,Title:f.Name},e=f.SubLocations.getFirstInIndex(r,o.StatesEnum.Selected),e&&(c={Number:e.Id,Title:e.Name},s.SubLocations=[c])),h=i.Data.TelehealthData,i.Data.TelehealthData.QuickScheduleSlot&&(h.Provider=i.Data.Providers.getFromIndex("ID",i.Data.TelehealthData.QuickScheduleSlot.ProviderId)),{telehealthData:h,workflowSettings:i._workflowSettings,appointmentBuilder:i.Data.AppointmentBuilder,telehealthLocation:s,telehealthOrganization:i.Data.TelehealthOrganizations.getFirstInIndex(r,u.StatesEnum.Selected),isForSomeoneElse:t}},_loginUrlLoaded:function(n){WP.Events.cancelBeforeUnload();window.top.location.href=makeLink(n.Url)},_selfSignup:function(){var s="previousstep",u="ondemandtelehealth",r=this,f=t,o=t,h;r._anonymousSettings&&(r._anonymousSettings.ProxyWorkflowEnabled&&(o=i),r._anonymousSettings.AdultWorkflowEnabled&&(f=i));f&&o?(h=new $$WPComp.MessageComponent({TitleText:$$WP.Strings.get("WhoIsVisitForTitle",u),Message:$$WP.Strings.get("WhoIsVisitForMessage",u),ToolbarButtons:[new $$WPComp.ComplexObjects.Button($$WP.Strings.get("ScheduleForMe",u),n,s,"Me"),new $$WPComp.ComplexObjects.Button($$WP.Strings.get("ScheduleForSomeoneElse",u),n,s,"SomeoneElse")],callback:$.proxy(r._selfSignupUserTypeSelected,r)}),$$WPUtil.quickPopup(h)):f?r._selfSignupUserTypeSelected("toolbarMe"):o&&r._selfSignupUserTypeSelected(e)},_selfSignupUserTypeSelected:function(n){var r=this,u,f;n!=="close"&&(u=n===e,f=r._buildRedirectionParameters(u),r._changeOverlayText(i,i),$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ShowOverlay(r.$root,r.Data),$.post({url:makeLink("Scheduling/Anonymous/TelehealthRedirectToSelfSignup"),data:$$WPUtil.postify(f),cache:t,success:$.proxy(r._selfSignupUrlLoaded,r),error:$.proxy(r._onScheduleError,r)}))},_selfSignupUrlLoaded:function(n){var t=n.Url;t==""&&(t="Home/LogOut?skipAbandonCurrent=1&postlogoutmode=signup&postloginmode=schedulingproxysel&schedulingSession="+n.Token,n.IsForSomeoneElse&&(t+="&signupOption=2&anonymousTelehealth=1"),n.SignupMethod&&(t+="&signupOption="+n.SignupMethod),t=makeLink(t));WP.Events.cancelBeforeUnload();window.top.location.href=t},_onScheduled:function(n,t,i,r,u,f,e){var o=this;$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.OnScheduled(n,t,i,r,u,f,e,o.$root,o,o.Data,o._workflowSettings)},_onScheduleError:function(){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.OnScheduleError(this.$root,this,this.Data)},_checkRedirectFromOverlay:function(n){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.CheckRedirectFromOverlay(n,this)},_redirectToVisitDetails:function(t,i){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.RedirectToVisitDetails(t,i,this._csn,this.ViewModel.SelectedOrg?this.ViewModel.SelectedOrg.OrganizationId:n)},_onEnqueued:function(n,t){var r=t.CSN,u=i,f=t.DxoId,e=t.IsECheckInAvailable,o=t.DidRefreshH2GLink,s=t.Error;this._onScheduled(r,u,n,f,e,o,s)},_onQuickScheduled:function(r){var u=n,f="",o=t,s=i,e=t,h=t,c=r.Error;r.Appointments.length>0&&(u=r.Appointments[0],f=u.CSN,e=u.IsECheckInAvailable);this._onScheduled(f,o,s,"",e,h,c)},_changeOverlayText:function(n,t){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ChangeOverlayText(n,t,this.$root,this._workflowSettings)},_onCardFocus:function(){this.$root.addClass("active")},_onCardBlur:function(n){this.$root.removeClass("active");$afe.jq(n.target).hasClass("comments")&&WP.DOM.Browser.isMobile&&window.scrollTo(document.body.scrollLeft,document.body.scrollTop+1)},_dataUpdated:function(n){(n.propertyName==="SelectedWorkflow"||n.propertyName==="QuickScheduleSlot"||n.propertyName==="IsOrgSelectionComplete")&&this.updateStep()},_hideStep:function(){this._shouldHideStep=i;this.updateStep()},afterRender:function(){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.AfterRender(this.$root,this,this.Data)},_renderNotifications:function(n){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.RenderNotifications(n,this.$root,this,this.Data)},_getNotificationOptions:function(){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.GetNotificationOptions(this,this.Data);this.updateStep()},_onChange:function(n){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.OnChange(n,this.$root,this)},_resetFocus:function(n){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ResetFocus(n,this.$root)},_onKeyDown:function(n){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.OnKeyDown(n,this.$root,this)}};f.prototype=h;$$WP.Scheduling.OnDemandTelehealth=$$WP.Scheduling.OnDemandTelehealth||{};$$WP.Scheduling.OnDemandTelehealth.SummaryStepController=f;f.extend($$WP.Scheduling.StepController,"WP$Scheduling$OnDemandTelehealth$SummaryStepController")}(),function(){var e="cancelworkflow",t=!1,n=null,i=!0,r=$$WP.Scheduling.TelehealthLocation,u=$$WP.Scheduling.TelehealthOrganization,f=function(n,t,f,e,o,s,h){var l="State",c=this,a,v,y;c.WP$Controllers$Controller();WP.Events.beforeUnload();c.proxify("_onKeyDown","_onClick","_onChange","_onCancelPopupClosed");c._data=t;c.$root=n;c.$root.on("mousedown",c._onClick);c._workflowSettings=f;c._viewMode=$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ViewMode.Initial;c.$root.on("keydown",c._onKeyDown);c._data.TelehealthLocations=r.createTelehealthLocationCollection();r.convertRawTelehealthLocations(e,c._data.TelehealthLocations);a=0;c._data.TelehealthLocations.Models[0].SubLocations.Models&&c._data.TelehealthLocations.Models[0].SubLocations.Models[0].Id==r.FakeLocationId&&(a=1);c._data.TelehealthLocations.Models[0].SubLocations.Models?c._data.TelehealthLocations.Models[0].SubLocations.Models[a].setProperty(l,r.StatesEnum.Selected):c._data.TelehealthLocations.Models[0].SubLocations=r.createTelehealthLocationCollection();c._data.TelehealthLocations.Models[0].setProperty(l,r.StatesEnum.Selected);c._data.TelehealthOrganizations=u.createTelehealthOrganizationCollection();u.convertRawTelehealthOrganizations(o,c._data.TelehealthOrganizations);c._data.TelehealthOrganizations.Models[0].setProperty(l,u.StatesEnum.Selected);c._data.TelehealthOrganizations.Models[0].setProperty("IsLocal",i);c._data.TelehealthData.QuickScheduleSlot&&(v=new $$WP.Scheduling.Slot(c._data.TelehealthData.QuickScheduleSlot),v.Provider=c._data.TelehealthData.QuickScheduleSlot.Provider,c._data.TelehealthData.QuickScheduleSlot=v,c._data.TelehealthData.QuickScheduleSlot.setProperty(l,$$WP.Scheduling.Slot.StatesEnum.Unselected));c._data.TelehealthData.ShowCancelButton=i;c._errorUrlOverride=s;c._isGuest=h;c._hasGuestNotifications=h;c._updateViewModel();c._onWorkflowCompleteCallback=c._schedulingComplete;y=$afe.renderTemplate($$WP.Templates.Scheduling.OnDemandTelehealth.SummaryStep,c.ViewModel);$afe.select("#telehealthSummary").safeReplaceWith(y);c._afterRender()},o={$root:n,ViewModel:n,_workflowSettings:n,_viewMode:0,_notificationOptions:n,_timerFinished:t,_redirectCallbackId:n,_onWorkflowCompleteCallback:n,_data:n,_csn:"",_errorCount:0,_idPrefix:n,_errorUrlOverride:"",_hasGuestNotifications:t,_isGuest:t,_updateViewModel:function(){var r=this;r._notificationOptions===n&&r._getNotificationOptions();r.ViewModel=$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.UpdateViewModel(r.$root,r,r._data,r._workflowSettings,t,i,r._hasGuestNotifications)},_getID:function(n){return $$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.GetID(n,this)},_getIDPrefix:function(){return $$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.GetIDPrefix(this)},_getComments:function(){return $$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.GetComments(this.$root)},_afterRender:function(){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.AfterRender(this.$root,this,this._data)},_onClick:function(n){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.OnClick(n,this,this._data)},_signUp:function(){var n=this;$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.SignUp(n.$root,n,n._data,n._hasGuestNotifications)},_saveEmail:function(){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.SaveEmail(this.$root,this)},_savePhone:function(){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.SavePhone(this.$root,this)},_enqueuePatient:function(){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.EnqueuePatient(this.$root,this,this._data,t)},_scheduleAppointment:function(){var n=this;$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ScheduleAppointment(n.$root,n,n._data,n._hasGuestNotifications)},_onScheduled:function(n,t,r,u,f,e,o){var s=this;$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.OnScheduled(n,t,r,u,f,e,o,s.$root,s,s._data,s._workflowSettings,i,s._errorUrlOverride)},_onScheduleError:function(){var t="Scheduling",i=new $$WPComp.MessageComponent({TitleText:$$WP.Strings.get("ScheduleErrorTitle",t),Message:$$WP.Strings.get("ErrorMessage",t),ToolbarButtons:[new $$WPComp.ComplexObjects.Button($$WP.Strings.get("ScheduleErrorButtonLabel",t),n,e,"")]});$$WPUtil.quickPopup(i);WP.Events.cancelBeforeUnload();$$WP.Utilities.TryRedirect(makeLink("Scheduling?workflow=OnDemandTelehealth"))},_checkRedirectFromOverlay:function(n){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.CheckRedirectFromOverlay(n,this)},_redirectToVisitDetails:function(n,t){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.RedirectToVisitDetails(n,t,this._csn,this.ViewModel.SelectedOrg.OrganizationId)},_onEnqueued:function(n,t){var r=t.CSN,u=i,f=t.DxoId,e=t.IsECheckInAvailable,o=t.DidRefreshH2GLink,s=t.Error;this._onScheduled(r,u,n,f,e,o,s)},_onQuickScheduled:function(r){var u=n,f="",o=t,s=i,e=t,h=t,c=r.Error;r.Appointments.length>0&&(u=r.Appointments[0],f=u.CSN,e=u.IsECheckInAvailable);this._onScheduled(f,o,s,"",e,h,c)},_schedulingComplete:function(){WP.Events.cancelBeforeUnload();$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.RedirectToVisitDetails("1",i,this._csn,"")},_changeOverlayText:function(n,t){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ChangeOverlayText(n,t,this.$root,this._workflowSettings)},_getNotificationOptions:function(){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.GetNotificationOptions(this,this._data)},_renderNotifications:function(n){var t=this;$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.RenderNotifications(n,t.$root,t,t._data,t._hasGuestNotifications)},_onChange:function(n){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.OnChange(n,this.$root,this)},_resetFocus:function(n){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ResetFocus(n,this.$root)},_onKeyDown:function(n){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.OnKeyDown(n,this.$root,this)},_onCancel:function(){var t="ondemandtelehealth";confirmComponent=new $$WPComp.MessageComponent({TitleText:$$WP.Strings.get("CancelSchedulingTitle",t),Message:$$WP.Strings.get("CancelSchedulingMessage",t),ToolbarButtons:[new $$WPComp.ComplexObjects.Button($$WP.Strings.getForTemplate("StayButtonText","Global.SafeToRedirectPopup"),n,"previousstep",""),new $$WPComp.ComplexObjects.Button($$WP.Strings.get("CancelSchedulingCaption",t),n,e,"")],callback:this._onCancelPopupClosed});$$WPUtil.quickPopup(confirmComponent)},_onCancelPopupClosed:function(n){n!=="toolbar0"&&n!=="close"&&($.post({url:makeLink("Scheduling/CancelSchedulingAppointment")}),WP.Events.cancelBeforeUnload(),this._redirectSafely("inside.asp"))},_redirectSafely:function(n){this._errorUrlOverride?$$WP.Utilities.TryRedirect(makeLink(this._errorUrlOverride)):$$WP.Utilities.TryRedirect(makeLink(n))}};f.prototype=o;$$WP.Scheduling.OnDemandTelehealth.StandaloneSummaryStepController=f;f.extend($$WP.Controllers.Controller,"WP$Scheduling$OnDemandTelehealth$StandaloneSummaryStepController")}();$$WP.Scheduling.OnDemandTelehealth=$$WP.Scheduling.OnDemandTelehealth||{};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore=$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore||{};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.BuildLink=function(n){var t='data-id="';return'<a tabindex="0" class="'+n.cssClass+'" '+t+n.dataId+'" title="'+n.title+'">'+n.content+'<img class="testimage" '+t+n.dataId+'" src="'+makeStaticLink("images/edit_pencil.svg")+'" alt="" aria-hidden="true" /><\/a>'};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ViewMode={Initial:0,EditEmail:1,EditPhone:2};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.UpdateViewModel=function(n,t,i,r,u,f,e,o){var s=!0,k=i.AppointmentBuilder.ReasonForVisit,a=i.TelehealthOrganizations.getFirstInIndex("State",$$WP.Scheduling.TelehealthOrganization.StatesEnum.Selected),d=r.MaxCommentsLength,h,v,b,c="",y,l,p=s,w=s;return u?(h=!1,v=!1):(h=a===null||a.IsLocal?r.RequireComments:s,v=r.AllowComments||h),b=new $$WP.FormValidation.ValidationSettings({required:h,maxLength:d,showCharacterCounter:s}),y=n.find('[name="comments"]'),y&&(c=y.val(),(c===undefined||$$WPUtil.IsNullOrEmpty(c))&&(c="")),i.TelehealthData.SelectedWorkflow===$$WP.Scheduling.TelehealthData.TelehealthWorkflow.SlotSelection&&i.TelehealthData.QuickScheduleSlot===null&&(i.TelehealthData.QuickScheduleSlot=i.AppointmentBuilder.getFirstAppointment().Slot),l=i.TelehealthData.Provider,!l&&i.TelehealthData.QuickScheduleSlot&&(l=i.Providers.getFromIndex("ID",i.TelehealthData.QuickScheduleSlot.ProviderId)),t._idPrefix="OnDemandSummaryStep_"+(t.Id||""),o&&(p=o.AdultWorkflowEnabled,w=o.ProxyWorkflowEnabled),{ReasonForVisit:k.Title,Workflow:i.TelehealthData.SelectedWorkflow,Slot:i.TelehealthData.QuickScheduleSlot,Provider:l,DayString:i.TelehealthData.QuickScheduleSlot?i.TelehealthData.QuickScheduleSlot.DateString:"",HasProviderDetailsSecurity:r.HasProviderDetailsSecurity&&!$$WP.Utilities.UI.IsMobile,AllowComments:v,RequireComments:h,Comments:t._getComments(),CommentsValidationSettings:b,CommentsInitiallyInvalid:s,StepShouldBeActive:s,LoadingClasses:"fullscreenOverlay",SelectedOrg:a,HideNotifications:$$WP.Utilities.UI.IsMobile&&i.TelehealthData.TelehealthNotificationSettings.IsPushNotificationEnabled||u||i.TelehealthData.SelectedWorkflow===$$WP.Scheduling.TelehealthData.TelehealthWorkflow.SlotSelection&&!e,IsAnonymous:u,AllowSelfSignup:r.AllowSelfSignup&&p||w,ShowCancelButton:i.TelehealthData.ShowCancelButton,ShowOrganization:!u&&!f,ProxyOnly:w&&!p,IdPrefix:t._getIDPrefix(),CommentsTextId:t._getID("comments")}};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.OnClick=function(n,t,i){var u="disabled",s=$afe.jq(n.target).data("id"),f,e,r,o;if(typeof s!="undefined"){if($afe.jq(n.target).hasClass(u)||$afe.jq(n.target).safeAttr(u)){n.preventDefault();return}if(!i.IsSchedulingCompleting){f=$afe.jq(n.target).data("id").split("-");e=f[0];switch(e){case"signup":t._signUp();break;case"redirectToLogin":t._redirectToLogin();break;case"selfSignup":t._selfSignup();break;case"provider":case"providerphoto":t._workflowSettings.HasProviderDetailsSecurity&&!$$WP.Utilities.UI.IsMobile&&(r="inside1.asp",(this._isAnonymous||this._isGuest)&&(r="publicforms.asp"),o=makeLink(r+"?mode=provider&widgetmode=1&id="+encodeURIComponent(i.TelehealthData.QuickScheduleSlot.ProviderId)),window.open(o,null,"width=1024,height=600,resizable,status,scrollbars").focus());break;case"smsNotificationSelect":t._viewMode=$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ViewMode.EditPhone;t._renderNotifications(!0);break;case"emailNotificationSelect":t._viewMode=$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ViewMode.EditEmail;t._renderNotifications(!0);break;case"saveEmail":t._saveEmail();break;case"savePhone":t._savePhone();break;case"cancelPhone":case"cancelEmail":t._viewMode=$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ViewMode.Initial;t._renderNotifications(!1);break;case"cancel":t._onCancel();break;case"startOver":WP.Events.cancelBeforeUnload();location.reload()}}}};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.GetID=function(n,t){return $$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.GetIDPrefix(t)+"_"+n};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.GetIDPrefix=function(n){return n._idPrefix===null&&(n._idPrefix="OnDemandSummaryStep_"+(n.Id||"")),n._idPrefix};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.GetComments=function(n){var t="",i=n.find('[data-id="comments"]');return i&&(t=i.val(),(t===undefined||$$WPUtil.IsNullOrEmpty(t))&&(t="")),t};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.SignUp=function(n,t,i,r){i.TelehealthData.SelectedWorkflow===$$WP.Scheduling.TelehealthData.TelehealthWorkflow.Queueing?($$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ParseNotificationsForSaving(n,t,i),t._enqueuePatient()):(r&&$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ParseNotificationsForSaving(n,t,i),t._scheduleAppointment())};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ParseNotificationsForSaving=function(n,t,i){var r=":checked";i.TelehealthData.ShouldSaveNotifications=!0;i.TelehealthData.NotificationSelection=new $$WP.Scheduling.TelehealthNotificationSelection(n.find("#"+t._getID("smsNotificationCheckbox")).is(r),n.find("#"+t._getID("emailNotificationCheckbox")).is(r),t._notificationOptions.PhoneNumber,t._notificationOptions.EmailAddress)};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.SaveEmail=function(n,t){var i=n.find('[data-id="emailEntry"]')[0].value;i===""?t._notificationOptions.CheckEmailOption=!1:i!==t._notificationOptions.EmailAddress&&(t._notificationOptions.CheckEmailOption=!0);t._notificationOptions.EmailAddress=i;t._viewMode=$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ViewMode.Initial;t._renderNotifications(!1)};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.SavePhone=function(n,t){var i=n.find('[data-id="textEntry"]')[0].value;i===""?t._notificationOptions.CheckSMSOption=!1:i!==t._notificationOptions.PhoneNumber&&(t._notificationOptions.CheckSMSOption=!0);t._notificationOptions.PhoneNumber=i;t._viewMode=$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ViewMode.Initial;t._renderNotifications(!1)};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.EnqueuePatient=function(n,t,i,r){var u=!1,h="State",l=i.AppointmentBuilder.ReasonForVisit,f=i.TelehealthLocations.getFirstInIndex(h,$$WP.Scheduling.TelehealthLocation.StatesEnum.Selected),c,e,o=u,s;if(f&&(c=f.SubLocations.getFirstInIndex(h,$$WP.Scheduling.TelehealthLocation.StatesEnum.Selected)),r?o=!0:(e=i.TelehealthOrganizations.getFirstInIndex(h,$$WP.Scheduling.TelehealthOrganization.StatesEnum.Selected),o=e?e.IsLocal:u),l&&f)s={rfvId:l.OnDemandRFV,locationId:f.Id,subLocationId:c?c.Id:"",comments:t._getComments(),sendSMS:t._notificationOptions?t._notificationOptions.CheckSMSOption:u,sendEmail:t._notificationOptions?t._notificationOptions.CheckEmailOption:u,phoneNumber:t._notificationOptions?t._notificationOptions.PhoneNumber:"",emailAddress:t._notificationOptions?t._notificationOptions.EmailAddress:"",shouldSaveNotifications:i.TelehealthData.ShouldSaveNotifications,isLocal:o,orgId:o?"":e.OrganizationId};else return;n.find('[data-id="signup"]').addClass("disabled");$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ShowOverlay(n,i);n.find(".loadingoverlay").show();t._redirectCallbackId=setTimeout($.proxy(t._checkRedirectFromOverlay,t,s.isLocal),5e3);$.post({url:makeLink("TelemedicineHome/EnqueuePatient"),data:s,cache:u,async:!0,success:$.proxy(t._onEnqueued,t,s.isLocal)})};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ScheduleAppointment=function(n,t,i,r){var u=!1,e=$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.BuildWorkflowObject(),o=$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.BuildAppointmentBuilderForSlot(i),f;selectedNotificationOptions=r?{SendSMS:t._notificationOptions?t._notificationOptions.CheckSMSOption:u,SendEmail:t._notificationOptions?t._notificationOptions.CheckEmailOption:u,PhoneNumber:t._notificationOptions?t._notificationOptions.PhoneNumber:"",EmailAddress:t._notificationOptions?t._notificationOptions.EmailAddress:"",ShouldSaveNotifications:i.TelehealthData.ShouldSaveNotifications}:{ShouldSaveNotifications:u};f={workflow:e.toRawRequestObject(),appointmentBuilder:o.toRawRequestObject(),comments:t._getComments(),selectedNotificationOptions:selectedNotificationOptions};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ShowOverlay(n,i);n.find(".loadingoverlay").show();$.post({url:makeLink("Scheduling/ScheduleAppointment"),data:$$WPUtil.postify(f),cache:u,success:$.proxy(t._onQuickScheduled,t),error:$.proxy(t._onScheduleError,t)})};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.BuildWorkflowObject=function(){return new $$WP.Scheduling.Workflow({Type:$$WP.Scheduling.Workflow.WorkflowTypesEnum.OnDemandTelehealth})};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.BuildAppointmentBuilderForSlot=function(n){var t=n.TelehealthData.QuickScheduleSlot,i=null,r=null,e=null,o=n.AppointmentBuilder.ReasonForVisit.OnDemandRFV,u=n.TelehealthLocations.getFirstInIndex("State",$$WP.Scheduling.TelehealthLocation.StatesEnum.Selected),f;return u&&(f=u.SubLocations.getFirstInIndex("State",$$WP.Scheduling.TelehealthLocation.StatesEnum.Selected)),i=new $$WP.Scheduling.AppointmentBuilder({ReasonForVisit:new $$WP.Scheduling.ReasonForVisit({Id:n.AppointmentBuilder.ReasonForVisit.LineInWDF15000,CategoryValue:n.AppointmentBuilder.ReasonForVisit.CategoryValue}),OnDemandReasonForVisitValue:o,PatientLocationId:u.Id,PatientSublocationId:f?f.Id:""}),r=new $$WP.Scheduling.Appointment({VisitType:new $$WP.Scheduling.VisitType({ID:t.VisitTypeId,AllowedProviderDepartmentPairs:[]})}),e=new $$WP.Scheduling.ProviderDepartmentPair({ProviderId:t.ProviderId,DepartmentId:t.DepartmentId}),r.Slot=t,r.ProviderDepartmentPairs.push(e),i.Appointments.empty(),i.Appointments.add(r),i};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.OnScheduled=function(n,t,i,r,u,f,e,o,s,h,c,l,a){var nt="disabled",tt="@MYCHART@OrganizationName@",v=null,p="ondemandtelehealth",it=3e3,rt,ut=e&&!$$WPUtil.IsNullOrEmpty(e.ErrorCode),ft=[],w,et,b,k,d,g,y;if(ut||$$WPUtil.IsNullOrEmpty(n)){if($$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.HideOverlay(o,h),s._changeOverlayText(!1),w=$$WP.Strings.get("TelehealthErrorMessage",p),et=$$WP.Strings.get("DismissErrorPopupButtonText",p),b=v,s._redirectCallbackId!==v&&(clearTimeout(s._redirectCallbackId),s._redirectCallbackId=v,s._timerFinished=!1),ut){k=h.TelehealthOrganizations.getFirstInIndex("State",$$WP.Scheduling.TelehealthOrganization.StatesEnum.Selected);$$WP.Strings.addMnemonic(tt,k.OrganizationName,v,p);switch(e.ErrorCode){case"14":s._viewMode=$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ViewMode.EditPhone;s._renderNotifications(!0);$$WP.FormValidation.addValidationError(o.find('[data-id="textEntry"]'),"InputNotPhoneNumber");$afe.select('[data-id="signup"]').removeClass(nt);return;case"ALREADY-IN-QUEUE":if(l&&!$$WPUtil.IsNullOrEmpty(n)){d=i;g=k;$$WPUtil.IsNullOrEmpty(r)||(d=!1,g=r);WP.Events.cancelBeforeUnload();$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.RedirectToVisitDetails("1",d,n,g);return}w=$$WP.Strings.get("AlreadyInQueueNoVisits",p);break;case"ALREADY-IN-QUEUE-VISITS":w=$$WP.Strings.get("AlreadyInQueueVisits",p);b=function(){WP.Events.cancelBeforeUnload();$$WP.Utilities.TryRedirect(makeLink("Visits/visitslist"))};break;case"NO-WPR-SECURITY":w=$$WP.Strings.get("NoSecurityText","SelfTriage.AddOnDemandVideoVisitNode");y="";y=a?makeLink(a):makeLink("inside.asp");b=function(){WP.Events.cancelBeforeUnload();$$WP.Utilities.TryRedirect(y)};break;default:l&&(y="",y=a?makeLink(a):makeLink("Scheduling?workflow=OnDemandTelehealth"),b=function(){WP.Events.cancelBeforeUnload();$$WP.Utilities.TryRedirect(y)})}$$WP.Strings.removeMnemonic(tt)}rt=new $$WPComp.MessageComponent({TitleText:$$WP.Strings.get("ErrorTitle",p),Message:w,ToolbarButtons:[new $$WPComp.ComplexObjects.Button(et,v,"cancelworkflow","")],callback:b});$$WPUtil.quickPopup(rt);$afe.select('[data-id="joinqueue"]').removeClass(nt);s._errorCount===0&&s._loadSlots&&s._loadSlots();s._errorCount++}else{if(s._csn=n,s._onWorkflowCompleteCallback!==v&&c.IsEmbedded===!0){ft=[{CSN:n,isLocal:i}];s._onWorkflowCompleteCallback(ft);return}WP.Events.cancelBeforeUnload();i&&c.RequireECheckInForTelemedicine&&u?$$WP.Utilities.TryRedirect(makeLink("echeckin?csn="+encodeURIComponent(n))):t?s._timerFinished?f?s._redirectCallbackId=setTimeout($.proxy(s._checkRedirectFromOverlay,s,i),it):s._redirectToVisitDetails("0",i):(f&&(s._redirectCallbackId!==v&&clearTimeout(s._redirectCallbackId),s._redirectCallbackId=setTimeout($.proxy(s._checkRedirectFromOverlay,s,i),it)),s._timerFinished=!0):s._redirectToVisitDetails("1",i)}};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.OnScheduleError=function(n,t,i){var r="ondemandtelehealth",u;$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.HideOverlay(n,i);t._changeOverlayText(!1);u=new $$WPComp.MessageComponent({TitleText:$$WP.Strings.get("ErrorTitle",r),Message:$$WP.Strings.get("TelehealthSchedulingErrorMessage",r),ToolbarButtons:[new $$WPComp.ComplexObjects.Button("Okay",null,"cancelworkflow","")]});$$WPUtil.quickPopup(u);$afe.select('[data-id="joinqueue"]').removeClass("disabled");t._errorCount===0&&t._loadSlots();t._errorCount++};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.GetErrorMessage=function(n){var t="ondemandtelehealth";return n==="POOL-EMPTY"?$$WP.Strings.get("TelehealthEmptyPoolErrorMessage",t):$$WP.Strings.get("TelehealthErrorMessage",t)};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.CheckRedirectFromOverlay=function(n,t){t._timerFinished?t._redirectToVisitDetails("0",n):t._timerFinished=!0};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.RedirectToVisitDetails=function(n,t,i,r){var u="&xorgid=",f="Home/LogOut?mode=OnDemandTelehealth&workflowcomplete=1&eCSN=";$$WP.Utilities.UI.IsMobile?t?$$WP.Utilities.TryRedirect(makeLink(f+encodeURIComponent(i))):$$WP.Utilities.TryRedirect(makeLink(f+encodeURIComponent(i)+u+encodeURIComponent(r))):t?$$WP.Utilities.TryRedirect(makeLink("Visits/VisitDetails?csn="+encodeURIComponent(i)+"&scheduled="+n)):$$WP.Utilities.TryRedirect(makeLink("Visits/visitslist?xorgcsn="+encodeURIComponent(i))+u+encodeURIComponent(r))};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ChangeOverlayText=function(n,t,i,r){var u="ondemandtelehealth",f=$$WP.Strings.get("LoadingMessage","Scheduling");n&&(f=r.RequireECheckInForTelemedicine&&t?$$WP.Strings.get("OnDemandLoadingMessageWithEcheckin",u):$$WP.Strings.get("OnDemandLoadingMessageNoEcheckin",u));i.find('[data-id="loadingmessage"]').text(f)};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.AfterRender=function(n,t,i){$$WP.FormValidation.initializeDOMSubtree(n);t._renderNotifications(t._autoFocus);setTimeout($.proxy(function(){$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.HideOverlay(n,i)},t),0);$afe.select(".content").trigger("resize");n.find("h2.header").focus()};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.RenderNotifications=function(n,t,i,r,u){var l="disabled",a="TelehealthEditPhoneTooltip",v="smsNotificationSelect",y="TelehealthEditEmailTooltip",p="emailNotificationSelect",o="notificationSelect",f="ondemandtelehealth",e,w,b,s,h,c,k,d=r.TelehealthOrganizations.getFirstInIndex("State",$$WP.Scheduling.TelehealthOrganization.StatesEnum.Selected);if((i.ViewModel.Workflow===$$WP.Scheduling.TelehealthData.TelehealthWorkflow.Queueing||u)&&d){if(k=u?$$WP.Strings.get("TelehealthNotificationsGuestProxyPretext",f):$$WP.Strings.get("TelehealthNotificationsPretext",f),e={NotificationGroup:new $$WP.FormValidation.ValidationGroup({}),ShowEmailOption:i._notificationOptions.ShowEmailOption,ShowSMSOption:i._notificationOptions.ShowSMSOption,CheckEmailOption:i._notificationOptions.CheckEmailOption,CheckSMSOption:i._notificationOptions.CheckSMSOption,EmailAddress:i._notificationOptions.EmailAddress,PhoneNumber:i._notificationOptions.PhoneNumber,ViewMode:i._viewMode,IsEmailEmpty:$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.IsNullOrEmpty(i._notificationOptions.EmailAddress),IsPhoneEmpty:$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.IsNullOrEmpty(i._notificationOptions.PhoneNumber),IdPrefix:i._getIDPrefix(),HasGuestNotifications:u,Pretext:k,NoEmailMessage:$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.BuildLink({cssClass:o,dataId:p,title:$$WP.Strings.get(y,f),content:$$WP.Strings.get("TelehealthNotificationsNoEmail",f)}),NoPhoneMessage:$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.BuildLink({cssClass:o,dataId:v,title:$$WP.Strings.get(a,f),content:$$WP.Strings.get("TelehealthNotificationsNoPhone",f)}),TextEditLink:$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.BuildLink({cssClass:o,dataId:v,title:$$WP.Strings.get(a,f),content:i._notificationOptions.PhoneNumber}),EmailEditLink:$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.BuildLink({cssClass:o,dataId:p,title:$$WP.Strings.get(y,f),content:i._notificationOptions.EmailAddress}),Validation:{Required:new $$WP.FormValidation.ValidationSettings({atLeastOneChecked:!0}),Email:new $$WP.FormValidation.ValidationSettings({isEmail:!0,required:!1}),Phone:new $$WP.FormValidation.ValidationSettings({required:!1})}},i.ViewModel.HideNotifications)return;w=$afe.renderTemplate($$WP.Templates.Scheduling.OnDemandTelehealth.NotificationStep,e);b=t.find(".notificationContainer > div");b.safeReplaceWith(w);s=t.find(".testhardware.confirmNotifications.completeworkflow");h=e.IsEmailEmpty&&e.IsPhoneEmpty||!e.CheckEmailOption&&!e.CheckSMSOption;c=i._viewMode===$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ViewMode.EditEmail||i._viewMode===$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ViewMode.EditPhone;h&&!c&&$$WP.FormValidation.addValidationError(t.find(".fakeValidation > input").first());h||c?s.safeAttr(l,!0):s.removeAttr(l)}t.find("div.notificationStep input").on("change",i._onChange);n&&!WP.DOM.Browser.isMobile&&$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.FocusInputElement(t,i._viewMode)};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.FocusInputElement=function(n,t){var i,r;switch(t){case $$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ViewMode.EditEmail:i=n.find('input[data-id="emailEntry"]');break;case $$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ViewMode.EditPhone:i=n.find('input[data-id="textEntry"]');break;case $$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ViewMode.Initial:i=n.find("textarea")}i&&i.length>0&&(i.focus(),r=i.val().length,i.get(0).setSelectionRange(r,r))};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.IsNullOrEmpty=function(n){return!(n&&n.length>0)};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.GetNotificationOptions=function(n,t){n._notificationOptions={ShowEmailOption:t.TelehealthData.TelehealthNotificationSettings.ShowEmailOption,ShowSMSOption:t.TelehealthData.TelehealthNotificationSettings.ShowSMSOption,CheckEmailOption:t.TelehealthData.TelehealthNotificationSettings.CheckEmailOption,CheckSMSOption:t.TelehealthData.TelehealthNotificationSettings.CheckSMSOption,EmailAddress:t.TelehealthData.TelehealthNotificationSettings.EmailAddress,PhoneNumber:t.TelehealthData.TelehealthNotificationSettings.PhoneNumber}};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.OnChange=function(n,t,i){var r=":checked",u="emailNotificationCheckbox",f="smsNotificationCheckbox";(n.target.id===i._getID(f)||n.target.id===i._getID(u))&&(i._notificationOptions.CheckEmailOption=t.find("#"+i._getID(u)).is(r),i._notificationOptions.CheckSMSOption=t.find("#"+i._getID(f)).is(r),i._renderNotifications(!1))};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ResetFocus=function(n,t){switch(n){case"smsSignupDiv":case"emailSignupDiv":t.find('[data-id="'+n+'"]').focus();break;case"textEntry":case"cancelPhone":case"savePhone":t.find('[data-id="smsNotificationSelect"]').focus();break;case"emailEntry":case"cancelEmail":case"saveEmail":t.find('[data-id="emailNotificationSelect"]').focus()}};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.OnKeyDown=function(n,t,i){var u=13,f=32,o=$afe.jq(n.target).data("id"),e,r;if(o!==undefined&&!$afe.jq(n.target).hasClass("disabled")){e=$afe.jq(n.target).data("id").split("-");r=e[0];switch(r){case"comments":return;case"textEntry":if(n.which!==u)return;n.preventDefault();i._savePhone();i._resetFocus(r);break;case"emailEntry":if(n.which!==u)return;n.preventDefault();i._saveEmail();i._resetFocus(r);break;case"smsSignupDiv":(n.which===u||n.which===f)&&(t.find("#"+i._getID("smsNotificationCheckbox")).click(),i._resetFocus(r));break;case"emailSignupDiv":(n.which===u||n.which===f)&&(t.find("#"+i._getID("emailNotificationCheckbox")).click(),i._resetFocus(r));break;case"signup":case"redirectToLogin":case"selfSignup":case"emailNotificationSelect":case"smsNotificationSelect":case"cancelEmail":case"cancelPhone":case"saveEmail":case"savePhone":case"startOver":(n.which===u||n.which===f)&&(n.preventDefault(),i._onClick(n),i._resetFocus(r))}}};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.ShowOverlay=function(n,t){t.IsSchedulingCompleting=!0;n.find(".loadingoverlay").show()};$$WP.Scheduling.OnDemandTelehealth.SummaryStepCore.HideOverlay=function(n,t){t.IsSchedulingCompleting=!1;n.find(".loadingoverlay").hide()},function(){var f="ID",i=!0,n=!1,r=null,u=$$WP.Scheduling.Provider,h=$$WP.Common.SelectableViewBinder,o=$$WP.Scheduling.Workflow,e=function(i,f,e,o,c,l,a,v,y,p){var w=this;w.WP$Scheduling$SingleAppointmentStepController(i,f,e,o,c,$$WP.Templates.Scheduling.ProviderStep,$$WP.Templates.Scheduling.ProviderStepCollapsed,r,n,y);w.proxify("_onProviderAdded","_onProviderRemoved","_onAncillaryDataChanged","_onViewModelChanged","updateStep","__onChangeProviderClicked");w._providersToUse=a||s.Standard;w._mode=l||t.NoFiltering;w._workflowType=v;w._onStopSchedulingCallback=y;w._fromFavorite=p;w._preselectedProviders=[];w.setViewBinder(new h(w.__viewStatePropertyName,u.StatesEnum.Selected,u.StatesEnum.Unselected));w.Data.Providers.addMonitoredProperty(w.__viewStatePropertyName);w.linkAppointment(w.Data.AppointmentBuilder.getFirstAppointment());w.$root.on("click","[data-id='editstep']",w.__onChangeProviderClicked);w._autoFocus=$$WP.Utilities.UI.IsMobile||w._mode===t.FilterOnSelectedReasonForVisit||w._mode===t.Request||w._mode===t.FilterOnSelectedReasonForVisitAndLocation},c={_mode:r,_providersToUse:r,_workflowType:r,_onStopSchedulingCallback:r,_preselectedProviders:r,_fromFavorite:n,__isStepCollapsed:n,__isStepCollapsing:n,__spacerHeightPx:0,__attachAppointmentListeners:function(n,i){var u="ReasonForVisit",r=this;i.addCollectionPropertyListener(r.Data.Providers,r.__viewStatePropertyName,r._onViewModelChanged);switch(r._mode){case t.FilterOnSelectedReasonForVisit:case t.Request:i.addModelPropertyListener(r.Data.AppointmentBuilder,u,r._onAncillaryDataChanged);break;case t.FilterOnSelectedReasonForVisitAndLocation:i.addModelPropertyListener(r.Data.AppointmentBuilder,u,r._onAncillaryDataChanged)}i.addCollectionEventListener(n.Providers,"add",r._onProviderAdded);i.addCollectionEventListener(n.Providers,"remove",r._onProviderRemoved);(r._mode===t.FilterOnSelectedReasonForVisitAndLocation||r._mode===t.FilterOnSelectedLocation)&&(i.addCollectionEventListener(n.Locations,"add",r._onAncillaryDataChanged),i.addCollectionEventListener(n.Locations,"remove",r._onAncillaryDataChanged))},updateViewModel:function(){var n=this,t=[];n.ViewModel={};n.WP$Scheduling$SingleAppointmentStepController$updateViewModel();t=n.__getViewModelAvailableProviders();n.ViewModel.Providers=t;n.ViewModel.SelectedProviders=n._appointment.Providers.toArray();n.ViewModel.IsAnyProviderSelected=n._appointment.IsProviderAnyOptionSelected;n.ViewModel.Count=t.length;n.ViewModel.StepShouldBeActive=i;n.ViewModel.ShowSmallCard=t.length>11;n.ViewModel.FavoritedProviderNotAvailable=n._fromFavorite&&n._preselectedProviders.length===0;n.ViewModel.VisitType=n._appointment.VisitType;n.ViewModel.SpacerHeightPx=n.__spacerHeightPx},__getViewModelAvailableProviders:function(){var t=this,n=[],i=r;return n=t._getAvailableProviders(),t._shouldIncludeAnyOption(n)&&(i=t.Data.Providers.getFromIndex(f,"-2"),n.push(i)),t._setViewModelSelectedStates(n),n.sort($$WP.Scheduling.Provider.sortProvidersByListDisplayName)},arePrerequisitesComplete:function(){var n=this,i=n.Data.AppointmentBuilder.ReasonForVisit,u=n._appointment.Locations.toArray();return n._mode===t.NoFiltering||n._mode!==t.FilterOnSelectedReasonForVisitAndLocation&&i!==r||n._mode===t.FilterOnSelectedReasonForVisitAndLocation&&u.length>0&&i!==r||n._mode===t.FilterOnSelectedLocation&&u.length>0},_setViewModelSelectedStates:function(n){var r=this,t,e,f,i;for(e=r._appointment.Providers,f=r._appointment.IsProviderAnyOptionSelected,t=0;t<n.length;t++)i=n[t],i[r.__viewStatePropertyName]=f&&i.AnyOption||!f&&e.contains(i)?u.StatesEnum.Selected:u.StatesEnum.Unselected},beforeFirstRender:function(){var n=this,t,i;n._shouldAttemptToPreselectProviders()&&(i=n.ViewModel.Providers,t=n.getModelsToPreSelect(i,f),t.length>0&&(n._appointment.Providers.addRange(t),n._preselectedProviders=t))},_shouldAttemptToPreselectProviders:function(){var t=this,r=t.ViewModel.Providers;return r.length===1&&t.hasPreselectedIds()&&!t.isModelPreselected(r[0].ID)?n:t._appointment.Providers.size()>0?n:i},beforeRender:function(){var n=this;n.stepSettings.Hide=n.stepSettings.Hide||!n._allowProviderSelect();n.renderCollapsed=n.__isStepCollapsed;n.__autoSelectProvidersIfHidden()},__autoSelectProvidersIfHidden:function(){var n=this;n.shouldRenderHidden()&&!n.hasPreselectedIds()&&(n.__selectProviders(n.ViewModel.Providers),n._appointment.hasAProviderSelected()||n.showError())},__selectProviders:function(n){for(var i=[],t=0,t=0;t<n.length;t++)n[t].OtherOption||n[t].AnyOption||this._appointment.Providers.contains(n[t])||i.push(n[t]);this._appointment.Providers.addRange(i)},afterRender:function(){$$WP.Utilities.UI.MatchColumnHeights();this.$root.find("h2.header").focus();this.__isStepCollapsing&&($$WPSchedulingUtil.ScrollToTopOfPage(),this.__collapseSpacer())},__initializeSpacer:function(){this.__spacerHeightPx=this.$root.find(".providerlist").height();this.__isStepCollapsing=i},__collapseSpacer:function(){this.$root.find(".spacer").addClass("slideup");this.__spacerHeightPx=0;this.__isStepCollapsing=n},__onChangeProviderClicked:function(){this.__isStepCollapsed=n;this.updateStep()},_onViewModelChanged:function(n){var t=this,i,r;t._appointment.Providers.openChangeBatch();for(r in n)if(i=n[r].model,i.AnyOption)n[r].to===u.StatesEnum.Selected?t.__setAnyProviderSelected(t._appointment):t.__setAnyProviderUnselected(t._appointment);else{t._appointment.IsProviderAnyOptionSelected&&t.__setAnyProviderUnselected(t._appointment);switch(n[r].to){case u.StatesEnum.Selected:t._appointment.Providers.add(i);break;case u.StatesEnum.Unselected:t._appointment.Providers.remove(i)}}t._appointment.Providers.closeChangeBatch()},__setAnyProviderSelected:function(n){var f=this,e=0,o=[],t=r;for(n.IsProviderAnyOptionSelected=i,e=0;e<f.ViewModel.Providers.length;e++)t=f.ViewModel.Providers[e],t.AnyOption?t[f.__viewStatePropertyName]=u.StatesEnum.Selected:(t[f.__viewStatePropertyName]=u.StatesEnum.Unselected,t.OtherOption||o.push(t));n.Providers.empty();n.Providers.addRange(o)},__setAnyProviderUnselected:function(t){var i=0,f=r;for(t.IsProviderAnyOptionSelected=n,i=0;i<this.ViewModel.Providers.length;i++)f=this.ViewModel.Providers[i],f.AnyOption&&(f[this.__viewStatePropertyName]=u.StatesEnum.Unselected);t.Providers.empty()},_onAncillaryDataChanged:function(){var t=this,i,u,e,o,s,h=r;if(t.__isAppointmentIncludedInBuilder()){for(o=[],u=t._getAvailableProviders(),e=t._appointment.Providers.toArray(),i=0;i<e.length;i++)s=e[i],u.indexOf(s)===-1&&o.push(s);t._appointment.Providers.removeRange(o);(o.length>0||u.length!==e.length||!t._shouldIncludeAnyOption(u))&&(t._appointment.IsProviderAnyOptionSelected=n);h=t.Data.SchedulingSteps.getFromIndex(f,t.Id);h.IsHidden=!t._allowProviderSelect();t.updateStep()}},__isAppointmentIncludedInBuilder:function(){return this.Data.AppointmentBuilder.Appointments.contains(this._appointment)},_onProviderAdded:function(){var t=this,i,r,u,f;r=t._appointment.Providers.toArray();i=r[r.length-1];u=t._canMultiselectProviders();!i||(t._appointment.Providers.openChangeBatch(),i.OtherOption?u=n:t.__deselectOtherProvider(),!u&&r.length>1&&(t._appointment.Providers.empty(),t._appointment.Providers.add(i)),t._appointment.Providers.closeChangeBatch());f=t.__isStepCollapsed;t._updateStepStatus();f||t.__isStepCollapsed?t.updateStep():t.ViewBinder.syncModelsToDOM()},__deselectOtherProvider:function(){var n=this.Data.Providers.getFromIndex(f,-1);this._appointment.Providers.remove(n)},_onProviderRemoved:function(){this._updateStepStatus();this.ViewBinder.syncModelsToDOM()},_updateStepStatus:function(){var t=this,r=t.getComplete()===$$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete;t._appointment.Providers.size()>0?(t.shouldRenderHidden()?t.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.NotRequired):t.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Complete),t.__isStacked()&&r&&(t.__isStepCollapsed=i,t.__initializeSpacer())):(t.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete),t.__isStepCollapsed=n)},_allowProviderSelect:function(){return this._mode===t.NoFiltering?i:o.allowProviderSelectForAppointment(this.Data.AppointmentBuilder,this._appointment)},_canMultiselectProviders:function(){return this._mode===t.Request?n:i},_getAvailableProviders:function(){var r=this,h=[],u=n,e=n,o=n,s=n;if(r.arePrerequisitesComplete())if(r._mode===t.NoFiltering)h=r._buildProvidersNoFiltering();else{switch(r._mode){case t.FilterOnSelectedReasonForVisit:u=i;e=n;o=n;s=n;break;case t.Request:u=i;e=n;o=i;s=i;break;case t.FilterOnSelectedLocation:u=n;e=i;o=n;s=n;break;case t.FilterOnSelectedReasonForVisitAndLocation:u=i;e=i;o=n;s=i}h=r.__buildProvidersFiltered(u,e,o,s)}return r.filterByAllowedIds(h,f)},_shouldIncludeAnyOption:function(t){var s=this,c,h,r,e,u,l,a;if(a=!$$WPUtil.IsNullOrEmpty(s.Data.Providers.getFromIndex(f,"-2")),!a)return n;for(h=s._appointment.VisitType,u=[],r=0;r<t.length;r++)t[r].OtherOption||t[r].AnyOption||(u.push(t[r]),t[r].Specialties.length>0&&$$WPUtil.IsNullOrEmpty(l)&&(l=t[r].Specialties[0].Value));if(c=u.length>1,s._workflowType===o.WorkflowTypesEnum.Request)return n;if(s._workflowType===o.WorkflowTypesEnum.Ticket||s._workflowType===o.WorkflowTypesEnum.Reschedule||!$$WPUtil.IsNullOrEmpty(h)&&h.IsAdvanced)return c;if(!$$WPUtil.IsNullOrEmpty(h)){for(e=i,r=0;r<u.length;r++)if(!u[r].IsPrimaryCare&&u[r].Specialties.length>0){e=n;break}if(!e)for(e=i,r=1;r<u.length;r++)if(u[r].Specialties.length>0&&u[r].Specialties[0].Value!==l){e=n;break}return e&&c}return n},_buildProvidersNoFiltering:function(){var r=this,u,e,t,n,f,o,h;if(r._providersToUse===s.All)for(u=[],n=0;n<r.Data.Providers.toArray().length;n++)t=r.Data.Providers.toArray()[n],t.AnyOption||u.push(t);else for(u=[],o=r.Data.Providers.getFromIndex("IsStandardProvider",i),n=0;n<o.length;n++)for(t=o[n],e=r.Data.ProviderDepartmentPairs.getFromIndex("ProviderId",t.ID),f=0;f<e.length;f++)if(r._isValidProviderDepartmentPair(e[f])){u.push(t);break}if(r.__isAdvancedRfvSelected())for(h=r.__getSelectedProvidersFromCurrentRfv(),n=0;n<h.length;n++)t=h[n],u.indexOf(t)===-1&&u.push(t);return u},_isValidProviderDepartmentPair:function(t){return $$WP.Scheduling.Workflow.hasProviderFirstOptionsProvDepPairs([t])?t.AllowedDirectScheduleReasonsForVisit.length>0||t.AllowedRequestReasonsForVisit.length>0:n},__getSelectedProvidersFromCurrentRfv:function(){for(var r=[],u=[],f=this._appointment.Providers.toArray(),t=0,e=i,o=n,r=this.__buildProvidersFiltered(e,o,n,n),t=0;t<r.length;t++)f.indexOf(r[t])!==-1&&u.push(r[t]);return u},__isAdvancedRfvSelected:function(){return this.Data.AppointmentBuilder.ReasonForVisit&&this._appointment.VisitType&&this._appointment.VisitType.IsAdvanced},__buildProvidersFiltered:function(n,t,i,r){var u=this,f=u.Data.AppointmentBuilder.ReasonForVisit,e=u._appointment.VisitType,o=u._appointment.getSelectedDepartmentsCollection().toArray(),s=u.Data.ProviderDepartmentPairs.toArray();return $$WPSchedulingUtil.BuildProvidersFiltered(n,t,i,f,e,o,s,r)}},t={NoFiltering:0,FilterOnSelectedReasonForVisit:1,Request:2,FilterOnSelectedReasonForVisitAndLocation:3,FilterOnSelectedLocation:4},s={Standard:0,All:1};e.prototype=c;e.ModesEnum=t;e.ProvidersToUseEnum=s;$$WP.Scheduling.ProviderStepController=e;e.extend($$WP.Scheduling.SingleAppointmentStepController,"WP$Scheduling$ProviderStepController")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var e="ProviderId",c=".card.helptip select",l=".card.helptip",r=!0,o="remove",i=!1,n=null,u=$$WP.Scheduling.Location,a=$$WP.Common.SelectableViewBinder,s=$$WP.Scheduling.ReasonForVisitDepartmentOverride,f=function(r,f,e,s,h,c,l,v,y,p){var b="ViewState",w=this;w.WP$Scheduling$StepController(r,e,s,h,c,$$WP.Templates.Scheduling.LocationStep,n,i,y);w.proxify("_onViewModelChanged","updateStep","_onSelectProviderClicked","_onProviderSelected","_onAncillaryDataChanged","_onLocationAdded","_onLocationRemoved","__onAppointmentsChanged");w._mode=l||t.FilterOnSelectedReasonForVisitAndProviders;w.__locationGroupingBehavior=v;w._fromFavorite=p;w._preselectedLocations=[];w._eventManager=new $$WP.Scheduling.EventManager;w.setViewBinder(new a(b,u.StatesEnum.Selected,u.StatesEnum.Unselected));w.Data.Locations.addPropertyListener(b,w._onViewModelChanged);w.Data.AppointmentBuilder.Appointments.addCollectionEventListener("add",w.__onAppointmentsChanged);w.Data.AppointmentBuilder.Appointments.addCollectionEventListener(o,w.__onAppointmentsChanged);(w._mode===t.FilterOnSelectedReasonForVisitAndProviders||w._mode===t.FilterOnSelectedReasonForVisit||w._mode===t.Request)&&w.Data.AppointmentBuilder.addPropertyListener("ReasonForVisit",w._onAncillaryDataChanged);w.__stepShouldListenForRfvChanges()&&w.Data.AppointmentBuilder.Appointments.addPropertyListener("VisitType",w._onAncillaryDataChanged);w.__onAppointmentsChanged()},v={_eventManager:n,_mode:n,_preselectedLocations:n,__locationGroupingBehavior:n,_fromFavorite:i,updateViewModel:function(){var n=this,t,i,f;i=n._allowMultiselect();t=n._getAvailableLocations();n._shouldIncludeAnyOption(t)&&(f=n.Data.Locations.getFromIndex("Id","-1"),t.push(f));n._setViewModelSelectedStates(t);t=t.sort(u.sortLocations);n.ViewModel={Locations:t,Count:t.length,StepShouldBeActive:r,MultiSelectable:i,ShowSmallCards:t.length>11,AvailableProviders:n._getAvailableProvidersForLocationStep(),FavoritedLocationNotAvailable:n._fromFavorite&&n._preselectedLocations.length===0}},arePrerequisitesComplete:function(){var n=this,i=n.Data.AppointmentBuilder.ReasonForVisit,r=n.Data.AppointmentBuilder.allAppointmentsHaveAProviderSelected(),u=n.Data.AppointmentBuilder.allAppointmentsHaveAVisitTypeSpecified();return n._mode===t.FilterOnSelectedVisitType||n._mode===t.FilterOnSelectedReasonForVisit&&!!i&&u||n._mode===t.FilterOnSelectedProviders&&r||n._mode===t.FilterOnSelectedReasonForVisitAndProviders&&!!i&&r&&u||n._mode===t.Request&&!!i&&r},_setViewModelSelectedStates:function(n){var t,e,r,i,f;for(f=this.Data.AppointmentBuilder.getFirstAppointment(),e=f.Locations.toArray(),r=f.IsLocationAnyOptionSelected,t=0;t<n.length;t++)i=n[t],i.ViewState=r&&i.IsAnyOption||!r&&e.indexOf(i)!==-1?u.StatesEnum.Selected:u.StatesEnum.Unselected},beforeFirstRender:function(){for(var t=this,i=0,r=n,i=0;i<t.Data.AppointmentBuilder.numAppointments();i++)r=t.Data.AppointmentBuilder.getAppointment(i),t.__shouldAttemptToPreselectLocations(r)&&t.__preselectAllAvailableLocationsForAppointment(r)},__shouldAttemptToPreselectLocations:function(n){var t=this.ViewModel.Locations;return t.length===1&&this.hasPreselectedIds()&&!this._doesLocationContainAtLeastOnePreselectedDepartmentId(t[0])?i:n.hasALocationSelected()?i:r},_doesLocationContainAtLeastOnePreselectedDepartmentId:function(n){for(var t=0;t<n.Departments.length;t++)if(this.isModelPreselected(n.Departments[t].ID))return r;return i},__preselectAllAvailableLocationsForAppointment:function(n){for(var u=this,r=0,f=0,t=[],i=[],t=u.ViewModel.Locations,r=0;r<t.length;r++)for(f=0;f<t[r].Departments.length;f++)if(u.preselectedIds[t[r].Departments[f].ID]){i.push(t[r]);break}t.length===1&&i.length===0&&i.push(t[0]);i.length>0&&(i.length===1||u.ViewModel.MultiSelectable)&&(n.Locations.empty(),n.Locations.addRange(i),u._preselectedLocations=i)},beforeRender:function(){this._autoSelectLocationsIfHidden()},_autoSelectLocationsIfHidden:function(){var t=this,r=n,u=[],i=0;if(t.shouldRenderHidden()&&!t.hasPreselectedIds()){for(u=t.ViewModel.Locations,i=0;i<t.Data.AppointmentBuilder.numAppointments();i++)r=t.Data.AppointmentBuilder.getAppointment(i),t.__selectLocationsForAppointment(r,u);t.Data.AppointmentBuilder.allAppointmentsHaveALocationSelected()||t.showError()}},__selectLocationsForAppointment:function(t,i){for(var r=0,u=n,f=[],r=0;r<i.length;r++)u=i[r],u.IsAnyOption||t.Locations.contains(u)||f.push(u);this.ViewModel.MultiSelectable?t.Locations.addRange(f):t.Locations.add(f[0])},afterRender:function(){$$WP.Utilities.UI.MatchColumnHeights();this.$root.find("h2.header").focus();this.$root.find("#providerselect").click(this._onSelectProviderClicked)},_onSelectProviderClicked:function(){this.$root.find(l).addClass("expanded");this.$root.find(c).change(this._onProviderSelected)},_onProviderSelected:function(){var t=this,u,r,e,o,f,s,i,h=n;(u=t.$root.find(c).val(),$$WPUtil.IsNullOrEmpty(u))||(r=t.Data.Providers.getFromIndex("ID",u),$$WPUtil.IsNullOrEmpty(r))||$$WPUtil.IsNullOrEmpty(t.ViewModel.Locations)||t.ViewModel.Locations.length<1||(i=t.Data.AppointmentBuilder.getFirstAppointment(),i.Locations.empty(),f=t.Data.AppointmentBuilder.ReasonForVisit,h=i.VisitType,e=f?t._getDepartmentIdsFilterOnSelectedReasonForVisitAndProviders(f,h,[r]):t._getDepartmentIdsFilterOnSelectedProviders([r]),s=t._isLocationArrayGrouped(t.ViewModel.Locations),o=t._getLocationsForDepartments(e,s),i.Locations.addRange(o),i.Providers.empty(),i.Providers.add(r),t.$root.find(l).hide())},_onViewModelChanged:function(t){var r=this,o=0,f="",s=n,e=n,i=n;for(f in t){if(s=t[f].to,e=t[f].model,$$WP.Utilities.IsNullOrEmpty(e))break;for(o=0;o<r.Data.AppointmentBuilder.numAppointments();o++){if(i=r.Data.AppointmentBuilder.getAppointment(o),i.Locations.openChangeBatch(),e.IsAnyOption)t[f].to===u.StatesEnum.Selected?r.__setAnyLocationSelected(i):r.__setAnyLocationUnselected(i);else{i.IsLocationAnyOptionSelected&&r.__setAnyLocationUnselected(i);switch(t[f].to){case u.StatesEnum.Selected:i.Locations.add(e);break;case u.StatesEnum.Unselected:i.Locations.remove(e)}}i.Locations.closeChangeBatch()}}},__setAnyLocationSelected:function(t){var f=0,e=[],i=n;for(t.IsLocationAnyOptionSelected=r,f=0;f<this.ViewModel.Locations.length;f++)i=this.ViewModel.Locations[f],i.IsAnyOption?i.ViewState=u.StatesEnum.Selected:(i.ViewState=u.StatesEnum.Unselected,i.OtherOption||e.push(i));t.Locations.empty();t.Locations.addRange(e)},__setAnyLocationUnselected:function(t){var r=0,f=n;for(t.IsLocationAnyOptionSelected=i,r=0;r<this.ViewModel.Locations.length;r++)f=this.ViewModel.Locations[r],f.IsAnyOption&&(f.ViewState=u.StatesEnum.Unselected);t.Locations.empty()},__onAppointmentsChanged:function(){var t=this,i=0,r=n;for(t._eventManager.removeAllListeners(),i=0;i<t.Data.AppointmentBuilder.numAppointments();i++)r=t.Data.AppointmentBuilder.getAppointment(i),t.__attachAppointmentListeners(r)},__attachAppointmentListeners:function(n){var t=this;t._eventManager.addCollectionEventListener(n.Locations,"add",t._onLocationAdded,n);t._eventManager.addCollectionEventListener(n.Locations,o,t._onLocationRemoved,n);t.__stepShouldListenForProviderChanges()&&(t._eventManager.addCollectionEventListener(n.Providers,"add",t._onAncillaryDataChanged,n),t._eventManager.addCollectionEventListener(n.Providers,o,t._onAncillaryDataChanged,n))},__stepShouldListenForProviderChanges:function(){return this._mode===t.FilterOnSelectedProviders||this._mode===t.FilterOnSelectedReasonForVisitAndProviders||this._mode===t.Request},__stepShouldListenForRfvChanges:function(){return this._mode===t.FilterOnSelectedReasonForVisitAndProviders||this._mode===t.FilterOnSelectedReasonForVisit||this._mode===t.Request},_onAncillaryDataChanged:function(){for(var n=this,e,u,f,o,s,t,h,c,l,v=n._allowMultiselect(),a=i,r=0;r<n.Data.AppointmentBuilder.numAppointments();r++){for(t=n.Data.AppointmentBuilder.getAppointment(r),o=[],u=n._getAvailableLocations(),f=t.Locations.toArray(),h=n._isLocationArrayGrouped(u),c=n._isLocationArrayGrouped(f),l=h&&!c,a=!v&&f.length>1,e=0;e<f.length;e++)s=f[e],(u.indexOf(s)===-1||a)&&(l&&n._selectGroupedLocationThatContainsDepartmentIfAvailable(t,s,u),o.push(s));t.Locations.removeRange(o);t.IsLocationAnyOptionSelected&&(o.length>0||u.length!==f.length||!n._shouldIncludeAnyOption(u))&&n.__setAnyLocationUnselected(t)}if(!n.__doAllAppointmentsHaveTheSameLocationsSelected())for(r=0;r<n.Data.AppointmentBuilder.numAppointments();r++)t=n.Data.AppointmentBuilder.getAppointment(r),t.IsAnyLocationSelected=i,t.Locations.empty();n._updateStepStatus();n.updateStep()},_isLocationArrayGrouped:function(t){for(var r=0,u=n,r=0;r<t.length;r++)if(u=t[r],!u.IsAnyOption&&!u.OtherOption)return!u.IsSingleDepartment;return i},_selectGroupedLocationThatContainsDepartmentIfAvailable:function(n,t,i){var f,e,u;t.IsSingleDepartment&&(f=t.DepartmentIds[0],e=this._getLocationsForDepartments(f,r),u=e[0],i.indexOf(u)!==-1&&n.Locations.add(u))},__doAllAppointmentsHaveTheSameLocationsSelected:function(){var u=[],n=0,f=this.Data.AppointmentBuilder.numAppointments(),t=i;if(f===1)t=r;else{for(n=0;n<f;n++)u.push(this.Data.AppointmentBuilder.getAppointment(n).Locations.toArray());t=$$WPSchedulingUtil.DoAllArraysContainTheSameValues(u)}return t},_onLocationAdded:function(t){var i=this,f=t.Locations.toArray(),e=f[f.length-1],s=i._allowMultiselect(),o=n,r=0;if(!!e){if(t.Locations.openChangeBatch(),!s&&f.length>1)for(t.Locations.empty(),t.Locations.add(e),r=0;r<i.ViewModel.Locations.length;r++)o=i.ViewModel.Locations[r],o!==e&&(o.ViewState=u.StatesEnum.Unselected);t.Locations.closeChangeBatch()}i._updateStepStatus();i.ViewBinder.syncModelsToDOM()},_onLocationRemoved:function(){this._updateStepStatus();this.ViewBinder.syncModelsToDOM()},_updateStepStatus:function(){var n=this;n.Data.AppointmentBuilder.allAppointmentsHaveALocationSelected()?n.shouldRenderHidden()||n.__isOtherLocationSelected()?n.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.NotRequired):n.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Complete):n.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete)},__isOtherLocationSelected:function(){var t=n,i=n;return i=this.Data.AppointmentBuilder.getFirstAppointment(),t=i.Locations,t.size()===1&&t.toArray()[0].OtherOption},shouldRenderHidden:function(){var n=this;return n.resetStepSettings(),n.stepSettings.Hide=n.stepSettings.Hide||n._isTelemedicineVisitTypeSelected()||n.__isOtherLocationTheOnlyAvailableLocation(),n.WP$Scheduling$StepController$shouldRenderHidden()},__isOtherLocationTheOnlyAvailableLocation:function(){var n=this.ViewModel.Locations;return n.length===1&&n[0].OtherOption},_getAvailableLocations:function(){for(var t=this,u=[],f=i,r=0,e=n,o=[],s=[],r=0;r<t.Data.AppointmentBuilder.numAppointments();r++)e=t.Data.AppointmentBuilder.getAppointment(r),u=t._getAvailableDepartmentIds(e),f=t._shouldGroupByLocation(u),o=t._getLocationsForDepartments(u,f),s.push(o);return $$WPSchedulingUtil.GetIntersectionOfArrays(s)},_getAvailableDepartmentIds:function(n){var i=this,u=i.Data.AppointmentBuilder.ReasonForVisit,f=n.VisitType,e=n.Providers.toArray(),r=[];if(i.arePrerequisitesComplete())switch(i._mode){case t.FilterOnSelectedVisitType:r=i.__getDepartmentIdsFilterOnSelectedVisitType(f);break;case t.Request:r=i._getDepartmentIdsForRequest(u,e);break;case t.FilterOnSelectedReasonForVisitAndProviders:r=i._getDepartmentIdsFilterOnSelectedReasonForVisitAndProviders(u,f,e);break;case t.FilterOnSelectedProviders:r=i._getDepartmentIdsFilterOnSelectedProviders(e);break;case t.FilterOnSelectedReasonForVisit:r=i._getDepartmentIdsFilterOnSelectedReasonForVisit(u,f)}return i.filterIdArrayByAllowedIds(r)},_getLocationsForDepartments:function(n,t){var f,r,u,e,i;for(f=[],e=this.Data.Locations.toArray(),r=0;r<e.length;r++)if(i=e[r],!i.IsAnyOption&&i.IsSingleDepartment!==t)for(u=0;u<i.Departments.length;u++)if(n.indexOf(i.Departments[u].ID)!==-1){f.push(i);break}return f},_allowMultiselect:function(){return this._directOptionsExistForAnyAppointment()&&!this._hasMultipleLqfs()},_shouldIncludeAnyOption:function(n){return n.length>1&&this._allowMultiselect()},_hasMultipleLqfs:function(){var u=this,t=0,y=n,p=[],o=n,h="",f=n,w={},c=0,l=i,e=[],b=n,a=[],k="",v=n,d=n,g=[];if(!u.Data.AppointmentBuilder.ReasonForVisit)return i;for(t=0;t<u.Data.AppointmentBuilder.numAppointments();t++)y=u.Data.AppointmentBuilder.getAppointment(t),g.push(u._getAvailableDepartmentIds(y));for(p=$$WPSchedulingUtil.GetUnionOfArrays(g),a=u._getLocationsForDepartments(p,r),t=0;t<a.length;t++)b=a[t],e=e.concat(b.Departments);for(d=u.Data.AppointmentBuilder.ReasonForVisit,t=0;t<e.length;t++)o=e[t],v=s.getOverride(d,o.ID,u.Data.ReasonForVisitDepartmentOverrides),$$WPUtil.IsNullOrEmpty(v)?o.ID!=="-1"&&(l=r):(f=v.VisitType,$$WPUtil.IsNullOrEmpty(f)||$$WPUtil.IsNullOrEmpty(f.QuestionnaireId)&&$$WPUtil.IsNullOrEmpty(f.DecisionTreeId)?l=r:(k=f.QuestionnaireId+"|"+f.DecisionTreeId,h=f.ID+"^"+k,w[h]!==r&&(w[h]=r,c++)));return c>1||c===1&&l},_directOptionsExistForAnyAppointment:function(){for(var t=this,u=0,f=n,e=[],o=n,s=n,o=t.Data.AppointmentBuilder.ReasonForVisit,u=0;u<t.Data.AppointmentBuilder.numAppointments();u++)if(f=t.Data.AppointmentBuilder.getAppointment(u),e=f.Providers.toArray(),s=f.VisitType,t._directOptionsExist(o,s,e))return r;return i},_directOptionsExist:function(n,u,f){var o=this,s,h,l,c;if(o._mode===t.FilterOnSelectedVisitType||o._mode===t.FilterOnSelectedProviders||o._mode===t.FilterOnSelectedReasonForVisit)return r;if(!n||!u)return i;if(!n.AllowProviderSelect||u.AllowedProviderDepartmentPairs.length>0)return r;for(s=0;s<f.length;s++)for(l=f[s],c=o.Data.ProviderDepartmentPairs.getFromIndex(e,l.ID),h=0;h<c.length;h++)if(c[h].AllowedDirectScheduleReasonsForVisitSet[n.Id])return r;return i},__getDepartmentIdsFilterOnSelectedVisitType:function(t){var r=[],f=n,u=[],i=0;if(t.AllowedProviderDepartmentPairs.length>0)u=this._getDepartmentIdsFilterOnSelectedReasonForVisit(n,t);else if(!t.IsAdvanced)for(r=this.Data.ProviderDepartmentPairs.toArray(),i=0;i<r.length;i++)f=r[i],u.push(f.DepartmentId);return u},_getDepartmentIdsFilterOnSelectedReasonForVisit:function(t,i){var r,u,f,l,e,h,o,c;if(u=[],l={},f=i.AllowedProviderDepartmentPairs,f.length===0)for(f=this.Data.ProviderDepartmentPairs.Models,r=0;r<f.length;r++)e=f[r],(e.AllowedDirectScheduleReasonsForVisitSet[t.Id]||e.AllowedRequestReasonsForVisitSet[t.Id])&&u.indexOf(e.DepartmentId)===-1&&(e.DepartmentId==="-1"?h=e.DepartmentId:u.push(e.DepartmentId));else for(r=0;r<f.length;r++)(o=f[r].DepartmentId,t&&t.AllowProviderSelect&&(c=s.getOverride(t,o,this.Data.ReasonForVisitDepartmentOverrides),c!==n&&!c.CanDirectSchedule))||u.indexOf(o)===-1&&u.push(o);return u.length!==0||$$WPUtil.IsNullOrEmpty(h)||u.push(h),u},_getDepartmentIdsFilterOnSelectedReasonForVisitAndProviders:function(t,i,u){var f,o,p,a,c,w,v,h,l,y;if(a=[],c=[],t.AllowProviderSelect)for(f=0;f<u.length;f++)if(p=u[f],v=i.AllowedProviderDepartmentPairs,v.length===0)for(h=this.Data.ProviderDepartmentPairs.getFromIndex(e,p.ID),o=0;o<h.length;o++)l=h[o],(l.AllowedDirectScheduleReasonsForVisitSet[t.Id]||l.AllowedRequestReasonsForVisitSet[t.Id])&&!c[l.DepartmentId]&&(a.push(l.DepartmentId),c[l.DepartmentId]=r);else for(o=0;o<v.length;o++)(y=v[o].DepartmentId,w=s.getOverride(t,y,this.Data.ReasonForVisitDepartmentOverrides),w===n||w.CanDirectSchedule)&&(v[o].ProviderId!==p.ID||c[y]||(a.push(y),c[y]=r));else for(h=i.AllowedProviderDepartmentPairs,f=0;f<h.length;f++)c[h[f].DepartmentId]||(a.push(h[f].DepartmentId),c[h[f].DepartmentId]=r);return a},_getDepartmentIdsFilterOnSelectedProviders:function(n){for(var i,f,u,r=[],t=0;t<n.length;t++)for(f=n[t],u=this.Data.ProviderDepartmentPairs.getFromIndex(e,f.ID),i=0;i<u.length;i++)r.push(u[i].DepartmentId);return r},_getDepartmentIdsForRequest:function(n,t){for(var o,r,i,f=[],u=0;u<t.length;u++)for(o=t[u],r=this.Data.ProviderDepartmentPairs.getFromIndex(e,o.ID),i=0;i<r.length;i++)r[i].AllowedRequestReasonsForVisitSet[n.Id]&&f.push(r[i].DepartmentId);return f},_shouldGroupByLocation:function(n){var r=this;switch(r._mode){case t.Request:return i;case t.FilterOnSelectedVisitType:case t.FilterOnSelectedReasonForVisit:case t.FilterOnSelectedReasonForVisitAndProviders:case t.FilterOnSelectedProviders:return u.areAllDepartmentsGrouped(r.Data.Locations,r.Data.Departments)&&!r._hasMultipleLqfs(n)&&r.__shouldDepartmentsBeGroupedBasedOnGroupingBehavior()}},__shouldDepartmentsBeGroupedBasedOnGroupingBehavior:function(){switch(this.__locationGroupingBehavior){case h.AlwaysGroup:return r;case h.GroupForMultipleAppointmentsOnly:return this.Data.AppointmentBuilder.numAppointments()>1}},_getAvailableProvidersForLocationStep:function(){var t=this,u=n,f=n,e=n,r=[],o=[],s=[],h=i,c=i,l=i;return t.__shouldShowProviderSelection()&&(u=t.Data.AppointmentBuilder.getFirstAppointment(),f=t.Data.AppointmentBuilder.ReasonForVisit,e=u.VisitType,o=u.getSelectedDepartmentsCollection().toArray(),s=t.Data.ProviderDepartmentPairs.toArray(),h=!!f,r=$$WPSchedulingUtil.BuildProvidersFiltered(h,c,l,f,e,o,s,i),r=r.sort($$WP.Scheduling.Provider.sortProvidersByLastName)),r},__shouldShowProviderSelection:function(){var n=this.Data.AppointmentBuilder.getFirstAppointment(),t=$$WP.Scheduling.Workflow.allowProviderSelectForAppointment(this.Data.AppointmentBuilder,n);return!n.hasAProviderSelected()&&!n.hasALocationSelected()&&this.Data.AppointmentBuilder.numAppointments()===1&&t},_isTelemedicineVisitTypeSelected:function(){for(var t=0,f=n,i=n,u=r,t=0;t<this.Data.AppointmentBuilder.numAppointments();t++)f=this.Data.AppointmentBuilder.getAppointment(t),i=f.VisitType,u=u&&!!i&&i.IsTelemedicine;return u}},t={FilterOnSelectedReasonForVisitAndProviders:0,FilterOnSelectedProviders:1,Request:2,FilterOnSelectedReasonForVisit:3,FilterOnSelectedVisitType:4},h={AlwaysGroup:0,GroupForMultipleAppointmentsOnly:1};f.prototype=v;f.ModesEnum=t;f.LocationGroupingBehaviorEnum=h;$$WP.Scheduling.LocationStepController=f;f.extend($$WP.Scheduling.StepController,"WP$Scheduling$LocationStepController")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var tt="absolute",it="SolutionListSeparator",rt="ProviderId",ut="LocationGroupKey",ft="ProviderGroupKey",et=".expandedrequestsection",ot="previewmode",st=".slot[data-model-id='",w="#solutionpreview",e="']",b="data-model-id",ht="#fromDate_",l="aria-expanded",u="",r="ID",ct="data-dte",o="Slot",a="remove",v="add",h="UseTeams",c=".slotsData",k=".filtertogglesection",d=".loadanotherbatchbutton",y="change",lt='input[name="fromDate"]',t=!1,i=!0,n=null,g={Standard:0,RequestOnly:1},wt=function(n){var u,t,r,i;t=[];for(u in n)t.push(Number(u));for(t.sort(function(n,t){return n-t}),r=[],i=0;i<t.length;i++)r.push(n[t[i]]);return r},bt=function(t){for(var r,i=0;i<t.length;i++)for(r=0;r<t[i].length;r++)if(t[i][r]!==n)return t[i];return n},at=function(n){return n.sort().join("|")+"|"},vt=function(n,t){var i=new $$WP.Scheduling.SolutionViewModel;return i.populateFromSolution(n,t),i},kt=function(n,t){return new $$WP.FormValidation.ValidationSettings({required:i,isDate:i,minDate:n,maxDate:t})},dt=makeStaticLink("images/calendar.svg"),yt=$$WP.Common.Model,pt=$$WP.Scheduling.VisitType,f=$$WP.Scheduling.Slot,nt=$$WP.Scheduling.Workflow,gt=$$WP.Scheduling.Location,s=$$WP.Utilities.UI.TimePreferenceWidgetController,p=function(i,r,u,e,o){var l="click",s=this;s.WP$Scheduling$StepController(i,u,n,n,n,$$WP.Templates.Scheduling.SlotStep);s.proxify("__onAncillaryDataChanged","__onVisitTypeChanged","__onSlotChanged","updateStep","__onCalendarDatePicked","__onDateInputChanged","__onLoadAnotherBatchKeyDown","__onScroll","__onLoadAnotherBatchClicked","__onRequestOptionClicked","__onExpandRequestClicked","__onTimePreferenceChanged","__onUseTeamsCheckboxClicked","__onUseTeamsButtonClicked","__onShowDetailsCheckboxClicked","__onSlotsLoaded","__onFilterToggleClicked","__onSolutionClicked","__onAppointmentsChanged","__onRetryClick","__onTelehealthWorkflowSelected","__onDateInputKeydown","__afterSolutionPreviewSlide");s.__workflow=r;s.__slotStepSettings=e;s.__mode=o||g.Standard;s.__queryStringPreferences=s.__slotStepSettings.TimePreferences;s.__focusOnTimePreferenceLabel=t;e.StartDate!==n?(s.__firstDteToShow=WP.Utils.date2dte(new Date(e.StartDate)),s.__firstDteToShow<f.todaysDte&&(s.__firstDteToShow=f.todaysDte)):s.__firstDteToShow=f.todaysDte;s.$root.on("keydown",lt,s.__onDateInputKeydown);$afe.select("body").on(y,"input#fromDate_"+s.Id,s.__onDateInputChanged);s.$root.on("keydown",d,s.__onLoadAnotherBatchKeyDown);s.$root.on(l,d,s.__onLoadAnotherBatchClicked);s.$root.on(l,".request .departmentbutton",s.__onRequestOptionClicked);s.$root.on(l,".requestheader .expandrequestoptions",s.__onExpandRequestClicked);s.$root.on(y,'input[name="toggleTeams"]',s.__onUseTeamsCheckboxClicked);s.$root.on(l,'input[name="enableTeams"]',s.__onUseTeamsButtonClicked);s.$root.on(y,'input[name="toggleDetails"]',s.__onShowDetailsCheckboxClicked);s.$root.on(l,k,s.__onFilterToggleClicked);s.$root.on(l,c,s.__onSolutionClicked);s.$root.on(l,".retryButton",s.__onRetryClick);if(s.__eventManager=new $$WP.Scheduling.EventManager,s.Data.AppointmentBuilder.addPropertyListener("ReasonForVisit",s.__onAncillaryDataChanged),s.Data.AppointmentBuilder.addPropertyListener(h,s.__onAncillaryDataChanged),s.Data.AppointmentBuilder.Appointments.addCollectionEventListener(v,s.__onAppointmentsChanged),s.Data.AppointmentBuilder.Appointments.addCollectionEventListener(a,s.__onAppointmentsChanged),s.Data.AppointmentBuilder.Appointments.addPropertyListener("VisitType",s.__onVisitTypeChanged),s.__onAppointmentsChanged(),s.Data.TelehealthData.addPropertyListener("SelectedWorkflow",s.__onTelehealthWorkflowSelected),navigator.userAgent.match(/Trident\/7./))s.$root.on("mousewheel",c,function(n){n.stopPropagation()})},ni={$root:n,TimePreferenceWidget:n,__workflow:n,__selectedTimes:n,__selectedLabel:n,__checkedBox:n,__focusOnTimePreferenceLabel:n,__handleFocusAfterRedrawingSlotStep:t,__queryStringPreferences:n,__slotStepSettings:n,__mode:n,__renderHidden:i,__isDirty:i,__areFiltersCollapsed:i,__minDte:0,__maxDte:0,__firstDteToShow:0,__batchCount:0,__eventManager:n,__currentPreviewedSolution:n,__showDetailedSolutionsView:t,__forceDetailedSolutionsView:t,__haveIncludedProviderTeam:t,$preRedrawFocusedElement:n,__preRedrawLastDTE:0,__shouldFocusOnNextDTE:t,__onAppointmentsChanged:function(){var t=this,u=0,r=0,i=n;for(t.__eventManager.removeAllListeners(),u=t.Data.AppointmentBuilder.numAppointments(),r=0;r<u;r++)i=t.Data.AppointmentBuilder.getAppointment(r),t.__eventManager.addCollectionEventListener(i.Providers,v,t.__onAncillaryDataChanged),t.__eventManager.addCollectionEventListener(i.Providers,a,t.__onAncillaryDataChanged),t.__eventManager.addCollectionEventListener(i.Locations,v,t.__onAncillaryDataChanged),t.__eventManager.addCollectionEventListener(i.Locations,a,t.__onAncillaryDataChanged),t.__eventManager.addCollectionEventListener(i.Lqfs,v,t.__onAncillaryDataChanged),t.__eventManager.addCollectionEventListener(i.Lqfs,a,t.__onAncillaryDataChanged),t.__eventManager.addModelPropertyListener(i,o,t.__onSlotChanged)},updateViewModel:function(){var n=this;n.__initializeDateRange();n.__isDirty?n.__resetAndLoad():(n.__buildViewModel(),n.ViewModel.StepShouldBeActive=i)},arePrerequisitesComplete:function(){for(var r=0,n=0,r=this.Data.AppointmentBuilder.numAppointments(),n=0;n<r;n++)if(!this.__arePrerequisitesCompleteForSingleAppointment(this.Data.AppointmentBuilder.getAppointment(n)))return t;return i},__arePrerequisitesCompleteForSingleAppointment:function(n){var t=this,i=n.Providers,r=n.Locations,u=t.Data.AppointmentBuilder.ReasonForVisit;return i.size()>0&&(t.__isRescheduleWorkflow()||t.__isTicketWorkflow()||t.__isDecisionTreeNodeWorkflow()||!!u)&&r.size()>0},show:function(){this.__deselectAllSlots();this.__renderHidden=t;this.WP$Scheduling$StepController$show()},__deselectAllSlots:function(){for(var r=0,t=0,u=n,i=n,r=this.Data.AppointmentBuilder.numAppointments(),t=0;t<r;t++)i=this.Data.AppointmentBuilder.getAppointment(t),u=i.Slot,u!==n&&i.setProperty(o,n)},hide:function(){this.__renderHidden=i;this.WP$Scheduling$StepController$hide()},beforeFirstRender:function(){Handlebars.registerPartial("Scheduling.Solution",$$WP.Templates.Scheduling.Solution);Handlebars.registerPartial("Scheduling.SolutionDetailed",$$WP.Templates.Scheduling.SolutionDetailed);Handlebars.registerPartial("Scheduling.SolutionAlerts",$$WP.Templates.Scheduling.SolutionAlerts);var n=this.__slotStepSettings.ShowTeamBeforeSearch===2;n&&this.__shouldShowTeamSchedulingOption()&&this.Data.AppointmentBuilder.setProperty(h,i)},beforeRender:function(){var i=this,u=[],f=n,e=t,r=n;i.$preRedrawFocusedElement=i.$root.find(":focus");i.__preRedrawLastDTE=i.$root.find(".day:last").safeAttr(ct);i.Data.AppointmentBuilder.numAppointments()===1&&(r=i.Data.AppointmentBuilder.getFirstAppointment(),u=i.__getAvailableRequestSolutions(r),f=i.__getAvailableDirectProviderDepartmentPairs(r),u.length===1&&f.length===0&&r.setProperty(o,u[0].Slots[0]));e=i.__renderHidden||!i.__isSlotStepStackActive();e&&(i.Active=t,i.$root.hide())},__isSlotStepStackActive:function(){var t=this,i=n,u=n;return i=t.Data.SchedulingSteps.getFromIndex(r,t.Id),!i||(u=t.Data.SchedulingSteps.getFromIndex(r,i.StackId)),t.__isStepActive(i)||t.__isStepActive(u)},__isStepActive:function(n){return!!n&&n.ActiveStatus===$$WP.Scheduling.SchedulingStep.ActiveEnum.Active},afterRender:function(){var h=".timepreferencecontainer",r=this,f=r.$root,e=n,o=n,c,a=u,v=n;if(e=r.__getLoadingOverlay(),o=f.find(".nodata"),r.Data.SlotLoader.isLoading()?(e.show(),o.hide(),!!r.ViewModel.Days&&r.ViewModel.Days.length>0&&r.__lockLoadOverlayPosition()):(e.hide(),o.show(),r.ViewModel.Days&&r.ViewModel.Days.length!==0||f.find(".requestSection").empty()),r.__setupStartDateField(),!isDataTile())$afe.jq(window).on("scroll",r.__onScroll);r.__allowTimePreferences()&&(($$WP.Utilities.UI.IsMobile||r.__handleFocusAfterRedrawingSlotStep)&&(r.__focusOnTimePreferenceLabel=t),c=f.find(h),c.length>0&&(a=$$WP.Utilities.UI.IsMobile?s.OrientationEnum.Horizontal:s.OrientationEnum.Vertical,r.TimePreferenceWidget=new s(f.find(h),r.__selectedTimes,r.__onTimePreferenceChanged,r.__selectedLabel,r.__slotStepSettings.OnFileSchedulePreferences,r.__slotStepSettings.DaysOfWeekList,r.__focusOnTimePreferenceLabel,r.__checkedBox,a),r.__selectedLabel===n&&r.$root.find("input.clearradio:checked").val()!=="1"&&r.__onTimePreferenceChanged(f.find(".timepreferencewidget input.radio:checked"),f.find(".timepreferencewidget input.clearradio:checked"),i),$$WP.Strings.setDefaultNamespace("Scheduling")));r.__tryLoadOnScroll();r.__handleFocusAfterRedrawingSlotStep?r.__afterSlotStepRedrawFocusHandler():r.__focusOnTimePreferenceLabel||r.$root.find("h2.header").focus();!r.__currentPreviewedSolution||(v=r.__currentPreviewedSolution,r.__currentPreviewedSolution=n,r.__openSolutionPreview(v,i));r.__handleFocusAfterRedrawingSlotStep=t;r.$preRedrawFocusedElement=n;r.__preRedrawLastDTE=0;r.__shouldFocusOnNextDTE=t;r.$root.find(k).safeAttr(l,!r.__areFiltersCollapsed);$$WP.Utilities.UI.MatchColumnHeights()},__setupStartDateField:function(){var i="fromDate_",t=this;t.__slotStepSettings.DateRangeSettings!==n&&t.__slotStepSettings.DateRangeSettings.ReadOnly?t.$root.find(ht+t.Id).safeAttr("disabled"):writeCalendar(i+t.Id,"range",dt,t.__minDte,t.__maxDte,t.__onCalendarDatePicked,n,i+t.Id+"_calendar");$$WP.FormValidation.initializeDOMSubtree(t.$root)},__afterSlotStepRedrawFocusHandler:function(){var t=this,u=n,f=n,r=n;if(t.__shouldFocusOnNextDTE)t.__focusOnNextDTE();else if(t.$preRedrawFocusedElement&&t.$preRedrawFocusedElement.length!==0)if(t.$preRedrawFocusedElement.hasClass("slot"))u=t.$root.find("[data-model-id='"+t.$preRedrawFocusedElement.safeAttr(b)+e),$$WPUtil.IsElementInView(u)?u.focus():t.__focusOnNextDTE();else if(t.$preRedrawFocusedElement.hasClass("daterangeinput"))r=t.$root.find(ht+t.Id),r.focus(),r.length>0&&(r[0].selectionStart=r[0].selectionEnd=r.val().length);else if(t.$preRedrawFocusedElement.hasClass("togglebutton"))$$WPUtil.IsElementInView(t.$preRedrawFocusedElement)?t.$root.find(".timepreferencewidget input.togglebutton[value='"+t.$preRedrawFocusedElement.val()+e).focus():t.__focusOnNextDTE();else return;else{t.SkipAfterRenderRefocus=i;return}t.SkipAfterRenderRefocus=i},__focusOnNextDTE:function(){var r="[data-dte='",i=this,t=i.$root.find(r+i.__preRedrawLastDTE+e).next();t!==n&&t.length!==0&&t.safeAttr(ct)||(t=i.$root.find(r+i.__preRedrawLastDTE+e));t.find(".slot:first").focus()},__allowTimePreferences:function(){var n=this;return!n.__slotStepSettings.DateRangeSettings.ReadOnly&&!n.__slotStepSettings.UseOnFileTimePreferences&&!n.__queryStringPreferences&&!n.__forceDetailedSolutionsView},__tryLoadOnScroll:function(){this.__isOkToLoadByScroll()&&this.__loadNextSlotsBatch()},__isOkToLoadByScroll:function(){var n=this;return n.__isSlotStepStackActive()&&n.__canSearchMoreDates()&&!n.Data.SlotLoader.isLoading()&&!n.Data.SlotLoader.isLastLoadTemporaryFail()&&n.__isWithinScrollLoadLimit()&&n.__isBottomOfSlotsInView()},__canSearchMoreDates:function(){return this.Data.SlotLoader.getSearchRangeEndDte()<this.__maxDte},__isWithinScrollLoadLimit:function(){return this.__batchCount<4},__isBottomOfSlotsInView:function(){var n=this.$root.find(c).contentHeight(),t=$afe.jq(window).scrollTop();return n<=window.innerHeight+t},__isOkToShowLoadMoreLink:function(){var n=this;return n.__canSearchMoreDates()&&!n.Data.SlotLoader.isLoading()&&(!n.__isWithinScrollLoadLimit()||isDataTile())&&!n.__slotStepSettings.DateRangeSettings.NoIncremental},__onSolutionClicked:function(n){var i=this,u=$afe.jq(n.target).closest("[data-model-id]"),e=u.safeAttr(b),r=yt.getInstance(e),f=t;if(r&&r.Slots.length===i.Data.AppointmentBuilder.numAppointments())i.__shouldPreviewSolution(r,u)?i.__previewSolution(r):i.__selectSolution(r);else{f=$afe.jq(n.target).closest(w).length>0;f||i.__closeSolutionPreview(i.__currentPreviewedSolution);return}},__shouldPreviewSolution:function(n,t){return n.Slots.length>1&&t.hasClass("slot")},__previewSolution:function(n){var t=this;t.__currentPreviewedSolution===n?t.__closeSolutionPreview(t.__currentPreviewedSolution):t.__currentPreviewedSolution?(t.__closeSolutionPreview(t.__currentPreviewedSolution,i),t.__openSolutionPreview(n,i)):t.__openSolutionPreview(n)},__openSolutionPreview:function(t,r){var f=this,o=n,h=n,a=n,s=n,v=n,y={},p=r?0:400;o=f.$root.find(st+t.ModelId+e);o.length>0&&(h=o.parent(),s=f.$root.find(w),v=f.$root.find(c),a=f.__findLastSlotGroupElementInRow(h),y={Solution:t,SolutionViewModel:vt(f.Data,t)},s.empty().safeAppend($afe.renderTemplate($$WP.Templates.Scheduling.SolutionPreview,y)),v.addClass(ot),h.addClass("preview"),o.safeAttr(l,i),s.safeInsertAfter(a).slideDown(p,u,f.__afterSolutionPreviewSlide),s.find(".verticalSubwayStop:first-child").focus(),f.__currentPreviewedSolution=t)},__closeSolutionPreview:function(i,r){var f=this,o=n,s=n,h=n,a=n,v=r?0:400;!i||(o=f.$root.find(st+i.ModelId+e),s=o.parent(),h=f.$root.find(w),a=f.$root.find(c),a.removeClass(ot),s.removeClass("preview"),h.slideUp(v,u,f.__afterSolutionPreviewSlide),o.safeAttr(l,t).blur());f.__currentPreviewedSolution=n},__afterSolutionPreviewSlide:function(){$$WP.Utilities.UI.MatchColumnHeights()},__findLastSlotGroupElementInRow:function(t){for(var i=n,r=n,u=0,i=t,u=0;u<t.siblings().length;u++){if(r=i.next(),r.length===0||r.position().top>i.position().top)return i;i=r}return i},__selectSolution:function(t){for(var u=0,i=0,r=n,f=n,u=this.Data.AppointmentBuilder.numAppointments(),i=0;i<u;i++)r=this.Data.AppointmentBuilder.getAppointment(i),f=t.Slots[i],r.setProperty(o,n),r.setProperty(o,f),r.setProperty("SearchStartDte",this.__firstDteToShow)},__onSlotChanged:function(){var n=this;n.Data.AppointmentBuilder.allAppointmentsHaveASlotSelected()?n.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Complete):n.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete);n.updateStep()},__allAppointmentsHaveASlot:function(){for(var u=0,r=0,f=n,e=n,u=this.Data.AppointmentBuilder.numAppointments(),r=0;r<u;r++)if(f=this.Data.AppointmentBuilder.getAppointment(r),e=f.Slot,!e)return t;return i},__onVisitTypeChanged:function(){var n=this;n.__showDetailedSolutionsView=n.Data.AppointmentBuilder.showAsMultipleVisits(n.Data.VisitTypes);n.__forceDetailedSolutionsView=t;n.__onAncillaryDataChanged()},__onAncillaryDataChanged:function(){for(var t=this,f=0,r=0,u=n,f=t.Data.AppointmentBuilder.numAppointments(),r=0;r<f;r++)u=t.Data.AppointmentBuilder.getAppointment(r),u.ProviderDepartmentPairs=t.__getAvailableDirectProviderDepartmentPairs(u);t.__areAllSelectedSlotsValid()||t.__deselectAllSlots();t.__isDirty=i;t.__firstDteToShow===t.__minDte&&(t.__firstDteToShow=0);t.updateStep()},__areAllSelectedSlotsValid:function(){for(var f=this,e=n,c=[],l=[],a=u,h=n,v=n,y=0,s=0,o=n,p=i,y=f.Data.AppointmentBuilder.numAppointments(),s=0;s<y;s++)o=f.Data.AppointmentBuilder.getAppointment(s),e=o.Slot,!e||(a=f.__getSlotKeyForCurrentSelections(),h=f.Data.Providers.getFromIndex(r,e.ProviderId),v=f.Data.Departments.getFromIndex(r,e.DepartmentId),c=o.getSelectedDepartmentsCollection(),l=o.Providers,f.__isProviderAvailableForSlots(h,o)&&c.contains(v)&&l.contains(h)&&e.SlotKey===a||(p=t));return p},__onTelehealthWorkflowSelected:function(){var n=this;n.Data.TelehealthData.SelectedWorkflow===$$WP.Scheduling.TelehealthData.TelehealthWorkflow.Queueing||n.Data.TelehealthData.SelectedWorkflow===$$WP.Scheduling.TelehealthData.TelehealthWorkflow.QuickSchedule?n.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.NotRequired):(n.__isDirty=i,n.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete));n.updateStep()},__isProviderAvailableForSlots:function(n,r){for(var f=this.__getAvailableDirectProviderDepartmentPairs(r),u=0;u<f.length;u++)if(f[u].ProviderId===n.ID)return i;return t},__shouldShowTeamSchedulingOption:function(){var r=this,o=[],s=n,h=[],f=0,u=n,e=n;if(r.__isTicketWorkflow()||r.__isRescheduleWorkflow()||r.Data.AppointmentBuilder.numAppointments()>1)return t;for(e=r.Data.AppointmentBuilder.getFirstAppointment(),o=e.getSelectedDepartmentsCollection().toArray(),h=e.Providers.Models,f=0;f<o.length;f++)if((u=o[f],u.ID!=="-1")&&(s=pt.getVisitTypeForDepartment(r.Data,e,u),!$$WPUtil.IsNullOrEmpty(u)&&r.__containsValidTeamSchedulingOptions(s,u,h)))return i;return t},__containsValidTeamSchedulingOptions:function(n,r,u){var e,f;if(n.IsAdvanced||(e=this.__getAllowTeamScheduling(n,r),e===0))return t;for(f=0;f<u.length;f++)if((e!==1||u[f].IsPCP)&&u[f].TeamProviders.length>0)return i;return t},__getAllowTeamScheduling:function(n,t){var r,i;return n.IsAdvanced?0:(r=this.Data.VisitTypeDepartmentOverrides.getFromIndex("Id",n.ID+"^"+t.ID),$$WPUtil.IsNullOrEmpty(r)||(i=r.AllowTeamScheduling),$$WP.Utilities.IsNullOrEmpty(i)&&(i=t.AllowTeamScheduling),$$WP.Utilities.IsNullOrEmpty(i)&&(i=n.AllowTeamScheduling),$$WP.Utilities.IsNullOrEmpty(i)&&(i=this.__slotStepSettings.AllowTeamScheduling||0),i)},__onCalendarDatePicked:function(n,t,i,r){var u=0;r&&(u=new Date(n,t,i),r.value=$$WP.I18N.formatPatientGivenDate(u),this.$root.find(".timeTable .togglebutton:checked").focus(),this.__changeSlotDateRange(WP.Utils.date2dte(u)))},__onUseTeamsCheckboxClicked:function(n){this.Data.AppointmentBuilder.setProperty(h,n.currentTarget.checked);this.ViewModel.TeamSchedulingDefaultChecked=this.Data.AppointmentBuilder.UseTeams},__onUseTeamsButtonClicked:function(){var n=this;n.__lockLoadOverlayPosition();n.Data.AppointmentBuilder.setProperty(h,i);n.__haveIncludedProviderTeam=i;n.ViewModel.TeamSchedulingDefaultChecked=n.Data.AppointmentBuilder.UseTeams},__onShowDetailsCheckboxClicked:function(){this.__showDetailedSolutionsView=!this.__showDetailedSolutionsView;this.updateStep()},__onDateInputKeydown:function(n){var t=n.which;t===13&&(n.preventDefault(),WP.Events.fireEvent(n.target,y))},__onDateInputChanged:function(r){var u=n,f=$$WP.FormValidation.checkIfFormIsValid(this.$root.find("form.daterangecontainer"),t),e=i;f&&(u=parseDate(r.target.value,e),this.__changeSlotDateRange(WP.Utils.date2dte(u)))},__onFilterToggleClicked:function(){var n=this;n.$root.find(".filterIcon").toggleClass("selected");n.$root.find(".filtertogglecontent").slideToggle(400);n.__areFiltersCollapsed=!n.__areFiltersCollapsed;n.$root.find(k).safeAttr(l,!n.__areFiltersCollapsed)},__onRetryClick:function(){this.__resetAndLoad()},__changeSlotDateRange:function(n){var t=this,i=t.__getValidSlotDte(n);t.__firstDteToShow!==i&&(t.__lockLoadOverlayPosition(),t.__firstDteToShow=i,t.__resetAndLoad(),t.$root.find(lt).val($$WP.I18N.formatPatientGivenDate(f.Dte2Date(t.__firstDteToShow))))},__onScroll:function(){this.__tryLoadOnScroll()},__onLoadAnotherBatchKeyDown:function(n){n.which===13&&(this.__getLoadAnotherBatchButton().click(),n.preventDefault())},__onLoadAnotherBatchClicked:function(n){var t=this;t.__shouldFocusOnNextDTE=i;t.__loadNextSlotsBatch();t.__handleFocusAfterRedrawingSlotStep=i;t.__getLoadAnotherBatchButton().css("visibility","hidden");n.preventDefault()},__onRequestOptionClicked:function(n){var t=this,r,u,f;r=$afe.jq(n.target).closest(".departmentbutton");u=r.safeAttr(b);f=yt.getInstance(u);t.Data.AppointmentBuilder.getFirstAppointment().setProperty(o,f);t.$root.find(et).hide();t.__renderHidden=i;t.$root.hide();$$WP.Utilities.UI.MatchColumnHeights()},__onExpandRequestClicked:function(){this.$root.find(et).show();this.$root.find(".expandedrequestsection a").first().focus();$$WP.Utilities.UI.MatchColumnHeights()},__onTimePreferenceChanged:function(t,i,r,u){var f=this,h,e,o,c,l;f.__focusOnTimePreferenceLabel=!r;f.__selectedLabel=i.safeAttr("value");f.__checkedBox=u;switch(f.__selectedLabel){case s.LabelValueEnum.AllAvailable:f.__slotStepSettings.TimePreferences=n;break;case s.LabelValueEnum.OnFile:f.__slotStepSettings.TimePreferences=f.TimePreferenceWidget.OnFilePreferences;break;case s.LabelValueEnum.Other:if(f.__selectedTimes=[],t.length===0)f.__slotStepSettings.TimePreferences=n;else for(f.__slotStepSettings.TimePreferences=Array([],[],[],[],[],[],[]),h=0;h<t.length;h++)e=$afe.jq(t[h]),o=e.data("day-index"),c=f.__parseTime(e.data("begin-time")),l=f.__parseTime(e.data("end-time")),f.__slotStepSettings.TimePreferences[o]=f.__slotStepSettings.TimePreferences[o]||[],f.__slotStepSettings.TimePreferences[o].push([c,l]),f.__selectedTimes.push({DayIndex:o,RangeElement:e.data("range-element")})}f.updateStep()},__parseTime:function(n){var i,t;if(t=n.toUpperCase().split(" "),t.length===2){if(t[1]==="PM")i=12;else if(t[1]==="AM")i=0;else return;i+=parseInt(t[0])%12}else if(t.length===1)i=parseInt(t[0]);else return;if(t=t[0].split(":"),t.length===2)return i+parseInt(t[1])/60},__resetAndLoad:function(){var n=this;n.__isDirty=t;n.__batchCount=0;n.__shouldShowTeamSchedulingOption()||n.__isTicketWorkflow()||n.Data.AppointmentBuilder.setProperty(h,t);n.Data.SlotLoader.initialize(n.__firstDteToShow,n.__workflow,n.Data.AppointmentBuilder,n.__slotStepSettings.UseOnFileTimePreferences);n.__loadNextSlotsBatch()},__loadNextSlotsBatch:function(){var n=this;n.Data.SlotLoader.loadNextSlots(n.__onSlotsLoaded);n.Active?n.Data.SlotLoader.isLoading()?(n.__handleFocusAfterRedrawingSlotStep=i,n.__getLoadingOverlay().show(),n.$root.find(".nodata").hide(),$$WP.Utilities.UI.MatchColumnHeights()):n.__getLoadAnotherBatchButton().show():(n.__handleFocusAfterRedrawingSlotStep=t,n.updateStep())},__onSlotsLoaded:function(n){var t=this;t.__generateSolutionGroupKeys(n);t.__generateSolutionViewModelProperties(n);t.__batchCount++;t.__releaseLoadOverlayPosition();t.__handleFocusAfterRedrawingSlotStep=i;t.updateStep()},__generateSolutionGroupKeys:function(t){for(var r=0,i=n,r=0;r<t.length;r++)i=t[r],i.setProperty(ft,this.__getSolutionProviderGroupKey(i)),i.setProperty(ut,this.__getSolutionLocationGroupKey(i))},__getSolutionProviderGroupKey:function(n){return at(this.__getVisibleSolutionProviderIds(n))},__getVisibleSolutionProviderIds:function(n){for(var r=[],u=t,i=0,i=0;i<n.Slots.length;i++)u=$$WP.Scheduling.Workflow.allowProviderSelectForAppointment(this.Data.AppointmentBuilder,this.Data.AppointmentBuilder.getAppointment(i)),u&&r.push(n.Slots[i].ProviderId);return r},__getSolutionLocationGroupKey:function(n){return at(this.__getVisibleSolutionLocationIds(n))},__getVisibleSolutionLocationIds:function(n){for(var r=[],i=0,u=t,i=0;i<n.Slots.length;i++)u=!this.Data.AppointmentBuilder.getAppointment(i).VisitType.IsTelemedicine,u&&r.push(n.Slots[i].DepartmentId);return this.__getLocationIdsFromDepartmentIds(r)},__getLocationIdsFromDepartmentIds:function(t){for(var i=0,u=[],f=n,e=n,o=this.Data.AppointmentBuilder.areLocationsGrouped(),i=0;i<t.length;i++)f=this.Data.Departments.getFromIndex(r,t[i]),e=gt.getLocationFromDepartment(f,this.Data.Locations,o),u.push(e.Id);return u},__generateSolutionViewModelProperties:function(t){for(var r=0,u=n,r=0;r<t.length;r++)u=t[r],this.__doesSolutionRequireDetailedView(u)&&(this.__forceDetailedSolutionsView=i)},__doesSolutionRequireDetailedView:function(n){return!n.areAllSlotsOnTheSameDay()},__getAvailableDirectProviderDepartmentPairs:function(n){var t=[],i=[];return t=this.__getAvailableDirectNonTeamProviderDepartmentPairs(n),i=this.__getAvailableDirectTeamProviderDepartmentPairs(n),t.concat(i)},__getAvailableDirectNonTeamProviderDepartmentPairs:function(t){var i=this,e=[],v=n,c=[],l=[],o=[],u=0,s=0,y=n,p=n,a=[],f=n,w=n,b=n,h=n;if(i.__mode===g.RequestOnly||!i.arePrerequisitesComplete())return e;if(v=i.Data.AppointmentBuilder.ReasonForVisit,c=t.Providers.toArray(),l=t.getSelectedDepartmentsCollection(),h=t.VisitType,$$WPUtil.IsNullOrEmpty(h)||(o=h.AllowedProviderDepartmentPairs),o.length!==0&&h.IsAdvanced)for(u=0;u<o.length;u++)f=o[u],w=i.Data.Providers.getFromIndex(r,f.ProviderId),b=i.Data.Departments.getFromIndex(r,f.DepartmentId),t.Providers.contains(w)&&l.contains(b)&&e.push(f);else for(u=0;u<c.length;u++)for(y=c[u],a=i.Data.ProviderDepartmentPairs.getFromIndex(rt,y.ID),s=0;s<a.length;s++)f=a[s],p=i.Data.Departments.getFromIndex(r,f.DepartmentId),l.contains(p)&&(i.__isTicketWorkflow()||i.__isRescheduleWorkflow()||i.__isDecisionTreeNodeWorkflow()||f.AllowedDirectScheduleReasonsForVisitSet[v.Id])&&e.push(f);return e},__getAvailableDirectTeamProviderDepartmentPairs:function(n){var t=this,e,f,u,i,l,o,s,h,y,c,a,v;if(e=t.__getAvailableDirectNonTeamProviderDepartmentPairs(n),h=n.VisitType,v=n.getSelectedDepartmentsCollection(),c=[],!t.arePrerequisitesComplete()||!t.Data.AppointmentBuilder.UseTeams||t.__isTicketWorkflow()||t.__isRescheduleWorkflow()||h.IsAdvanced)return[];for(f=0;f<e.length;f++)if(i=t.Data.Providers.getFromIndex(r,e[f].ProviderId),y=i.TeamProviders,l=t.Data.Departments.getFromIndex(r,e[f].DepartmentId),s=t.__getAllowTeamScheduling(h,l),s!==0&&(s!==1||i.IsPCP))for(u=0;u<i.TeamProviders.length;u++)a=t.Data.Providers.getFromIndex(r,i.TeamProviders[u].ProviderId),o=t.Data.Departments.getFromIndex(r,i.TeamProviders[u].DepartmentId),!a||!o||!v.contains(o)||c.push(new $$WP.Scheduling.ProviderDepartmentPair({ProviderId:i.TeamProviders[u].ProviderId,DepartmentId:i.TeamProviders[u].DepartmentId}));return c},__initializeDateRange:function(){var t=this,s=n,p=n,v=[],i=n,l=0,a=0,y=0,h=0,c=0,e=n,o=n,u=n;for(p=t.Data.AppointmentBuilder.ReasonForVisit,y=t.Data.AppointmentBuilder.numAppointments(),h=0;h<y;h++)for(s=t.Data.AppointmentBuilder.getAppointment(h),v=s.getSelectedDepartmentsCollection().toArray(),c=0;c<v.length;c++)(e=v[c],e&&e.ID==="-1")||(i=$$WPUtil.IsNullOrEmpty(s.PanelId)?pt.getVisitTypeForDepartment(t.Data,s,e):t.Data.VisitTypes.getFromIndex(r,s.PanelId),o=n,!i||(o=t.Data.VisitTypeDepartmentOverrides.getFromIndex("Id",i.ID+"^"+e.ID)),u=bt([[o&&o.FromMinutesOffset,o&&o.FromDaysOffset,o&&o.ToDaysOffset],[e.FromMinutesOffset,e.FromDaysOffset,e.ToDaysOffset],[i&&i.FromMinutesOffset,i&&i.FromDaysOffset,i&&i.ToDaysOffset],[t.__slotStepSettings.FromMinutesOffset,t.__slotStepSettings.FromDaysOffset,t.__slotStepSettings.ToDaysOffset],[n,5,30]]),$$WP.Utilities.IsNullOrEmpty(u[1])&&(u[1]=5),$$WP.Utilities.IsNullOrEmpty(u[2])&&(u[2]=30),h===0&&c===0?(l=u[1],a=u[2]):(l=Math.min(l,u[1]),a=Math.max(a,u[2])));t.__minDte=f.todaysDte+l;t.__maxDte=f.todaysDte+a;!(t.__isTicketWorkflow()||t.__isRescheduleWorkflow())||$$WP.Utilities.IsNullOrEmpty(t.__slotStepSettings.FromDte)||$$WP.Utilities.IsNullOrEmpty(t.__slotStepSettings.ToDte)||(t.__minDte=Math.max(t.__minDte,t.__slotStepSettings.FromDte),t.__maxDte=Math.min(t.__maxDte,t.__slotStepSettings.ToDte));t.__firstDteToShow=t.__getValidSlotDte(t.__firstDteToShow)},__getValidSlotDte:function(n){var t=n;return t=Math.max(t,this.__minDte),Math.min(t,this.__maxDte)},__buildViewModel:function(){var i=this,e=t,o=t,h=u,s=t,r=t;(s=$$WP.Utilities.UI.IsSmallScreen(),r=$$WP.Utilities.UI.IsMobile,i.__shouldShowTeamSchedulingOption()?(e=i.__shouldOfferTeamsBeforeSlots(),o=i.__shouldOfferTeamsOnNoData()):i.__isTicketWorkflow()||(e=t,o=t),i.ViewModel={StepControllerId:i.Id,Days:[],ShowLocationHeaders:t,ShowProviderHeaders:t,ShowLoadAnotherBatch:i.__isOkToShowLoadMoreLink(),FromDate:$$WP.I18N.formatPatientGivenDate(f.Dte2Date(i.__firstDteToShow)),ProvidersForRequest:n,ShowDirectRequestLink:t,AskTeamsBeforeSlots:e,TeamSchedulingDefaultChecked:i.Data.AppointmentBuilder.UseTeams,AskTeamsOnNoData:o,AreFiltersCollapsible:s||r,AreFiltersCollapsed:i.__areFiltersCollapsed,ShowRequestsInSidebar:!(s||r),ShowSidebar:!r,SlotsLoadingMessage:i.__getSlotLoadingMessage(),SlotsLoadingMoreMessage:i.SchedulingStringsNamespace.getString("SlotsLoadingMoreMessage"),ShowRetryButton:i.Data.SlotLoader.isLastLoadTemporaryFail(),ShowSolutionDetails:t,ShowDetailsToggleInSidebar:t,ShowTimePreferences:i.__allowTimePreferences(),StartDateValidationSettings:kt(WP.Utils.dte2date(i.__minDte),WP.Utils.dte2date(i.__maxDte))},h=i.__getSlotKeyForCurrentSelections(),i.arePrerequisitesComplete())&&(i.__buildViewModelForProvidersForRequest(),i.__buildViewModelForAllSlots(h),i.ViewModel.AskTeamsOnNoData&&(i.ViewModel.AskTeamsOnNoData=i.ViewModel.Days.length===0||i.ViewModel.Days[0].Dte>i.__firstDteToShow+28))},__getSlotLoadingMessage:function(){if(($$WP.Debug.IsLocalhost||window.location.hostname==="mint.webqa.epic.com"||window.location.hostname==="zorro.webqa.epicexplorers.info")&&Math.floor(Math.random()*50)===1)return"Reticulating splines...";this.SchedulingStringsNamespace.getString("SlotsLoadingMessage")},__getSlotKeyForCurrentSelections:function(){return f.getSlotKeyForBuilder(this.__workflow,this.Data.AppointmentBuilder)},__buildViewModelForAllSlots:function(t){var i=this,e=n,s=n,h=0,r=0,o=n,c=n,l=n;if(c=i.Data.Solutions.getIndex(["SlotKey","DisplayDte",ft,ut,"StartTime"]),e=c[t],i.__isTypeObject(e))for(i.ViewModel.ShowLocationHeaders=i.__shouldShowLocationHeaders(),i.ViewModel.ShowProviderHeaders=i.__shouldShowProviderHeaders(),i.ViewModel.Instructions=i.__buildViewModelInstructions(),i.ViewModel.ShowInstructions=i.ViewModel.Instructions.join(u).length!==0,i.ViewModel.Appointments=i.Data.AppointmentBuilder.Appointments.toArray(),h=Math.min(i.Data.SlotLoader.getSearchRangeEndDte(),i.__maxDte),r=i.__firstDteToShow;r<=h;r++)l=f.Dte2Date(r),i.__isDateIncludedInSelectedPreferences(l)&&(s=e[r],o=i.__buildViewModelForDay(s,r),!o||i.ViewModel.Days.push(o));i.ViewModel.ShowDetailsToggleInSidebar=i.__shouldShowDetailsToggleInSidebar();i.ViewModel.ShowSolutionDetails=i.__shouldShowDetailedSolutionView()},__shouldShowDetailsToggleInSidebar:function(){var n=this.Data.AppointmentBuilder.numAppointments()>1;return n&&!this.__forceDetailedSolutionsView},__shouldShowDetailedSolutionView:function(){var n=this.Data.AppointmentBuilder.numAppointments()>1;return n&&(this.__forceDetailedSolutionsView||this.__showDetailedSolutionsView)},__shouldShowLocationHeaders:function(){return this.__doesAnyNonTelemedicineAppointmentHaveMultipleSelectedLocations()},__doesAnyNonTelemedicineAppointmentHaveMultipleSelectedLocations:function(){for(var e=0,r=0,u=n,f=n,e=this.Data.AppointmentBuilder.numAppointments(),r=0;r<e;r++)if(u=this.Data.AppointmentBuilder.getAppointment(r),f=u.VisitType,!!f&&!f.IsTelemedicine&&u.Locations.toArray().length>1)return i;return t},__shouldShowProviderHeaders:function(){return this.__doesAnyAppointmentHaveMultipleSelectedProviders()||this.__doesMoreThanOneAppointmentAllowProviderSelection()||this.Data.AppointmentBuilder.UseTeams},__doesAnyAppointmentHaveMultipleSelectedProviders:function(){for(var f=0,r=0,u=n,e=t,f=this.Data.AppointmentBuilder.numAppointments(),r=0;r<f;r++)if(u=this.Data.AppointmentBuilder.getAppointment(r),e=$$WP.Scheduling.Workflow.allowProviderSelectForAppointment(this.Data.AppointmentBuilder,u),e&&u.Providers.toArray().length>1)return i;return t},__doesMoreThanOneAppointmentAllowProviderSelection:function(){for(var r=0,i=0,u=t,f=0,e=n,r=this.Data.AppointmentBuilder.numAppointments(),i=0;i<r;i++)e=this.Data.AppointmentBuilder.getAppointment(i),u=$$WP.Scheduling.Workflow.allowProviderSelectForAppointment(this.Data.AppointmentBuilder,e),u&&f++;return f>1},__isDateIncludedInSelectedPreferences:function(n){var t=this,i=!(Array.isArray(t.__slotStepSettings.TimePreferences)&&Array.isArray(t.__slotStepSettings.TimePreferences[n.getDay()])&&Array.isArray(t.__slotStepSettings.TimePreferences[n.getDay()][0])&&t.__slotStepSettings.TimePreferences[n.getDay()][0][0]===-1),r=!t.__allowTimePreferences();return r||i},__buildViewModelInstructions:function(){for(var o=this,h=0,t=0,i=[],f=n,s=n,e=n,c=[],l=[],h=o.Data.AppointmentBuilder.numAppointments(),t=0;t<h;t++)f=o.Data.AppointmentBuilder.getAppointment(t),s=$$WPUtil.IsNullOrEmpty(f.PanelId)?f.VisitType:o.Data.VisitTypes.getFromIndex(r,f.PanelId),s.SchedulingInstructions.join(u).length!==0&&c.indexOf(s)===-1&&(i.length>0&&i.push(u),i.push.apply(i,s.SchedulingInstructions),c.push(s));for(t=0;t<o.Data.AppointmentBuilder.numAppointments();t++)f=o.Data.AppointmentBuilder.getAppointment(t),f.Lqfs.size()>0&&(e=f.Lqfs.toArray()[f.Lqfs.toArray().length-1],!e||!e.Result||$$WPUtil.IsNullOrEmpty(e.Result.Instructions)||l.indexOf(e)!==-1||(i.length>0&&i.push(u),i.push(e.Result.Instructions),l.push(e)));return i},__buildViewModelForDay:function(t,i){var r=n,e=n,o=u;if(!this.__isTypeObject(t))return n;r={Dte:i,DayString:f.Dte2DateString[i],ProviderGroups:[]};for(o in t)o!==u&&(e=this.__buildViewModelForProviders(t[o]),!e||r.ProviderGroups.push(e));return r.ProviderGroups.length===0?n:r},__buildViewModelForProviders:function(t){var i={},r=n,f=u;if(!this.__isTypeObject(t))return n;i={Providers:{},LocationGroups:[]};for(f in t)$$WPUtil.IsNullOrEmpty(f)||(r=this.__buildViewModelForLocations(t[f]),r!==n&&i.LocationGroups.push(r));return i.LocationGroups.length>0&&(i.Providers=this.__getProviderHeaderViewModel(i.LocationGroups[0].SlotGroups[0][0])),i.LocationGroups.length>0?i:n},__getProviderHeaderViewModel:function(t){for(var i=0,f=[],u=n,e={},o=[],s=[],f=this.__getVisibleSolutionProviderIds(t),i=0;i<f.length;i++)u=this.Data.Providers.getFromIndex(r,f[i]),o.indexOf(u)===-1&&(o.push(u),s.push(u.Name));return e.Models=o,e.Names=s.join(this.SchedulingStringsNamespace.getString(it)),e},__buildViewModelForLocations:function(t){var e=this,r={},s=u,h=[],o=n,i=0,c=0,l=n,a={};if(!e.__isTypeObject(t))return n;r={Locations:{},SlotGroups:[]};for(s in t)for(h=t[s],s=Number(s),l=f.Dte2Date(h[0].Dte).getDay(),i=0;i<h.length;i++)(o=h[i],!Array.isArray(e.__slotStepSettings.TimePreferences)||e.__isSlotInSelectedPreferences(s,e.__slotStepSettings.TimePreferences[l]))&&(a[o.StartTime]=o);for(r.SlotGroups=wt(a),i=0;i<r.SlotGroups.length;i++)r.SlotGroups[i]=[r.SlotGroups[i]];if(e.__forceDetailedSolutionsView||e.__showDetailedSolutionsView)for(i=0;i<r.SlotGroups.length;i++)for(c=0;c<r.SlotGroups[i].length;c++)o=r.SlotGroups[i][c],o.SolutionViewModel||(o.SolutionViewModel=vt(e.Data,o));return r.SlotGroups.length>0&&(r.Locations=e.__getLocationHeaderViewModel(r.SlotGroups[0][0])),r.SlotGroups.length>0?r:n},__getLocationHeaderViewModel:function(t){for(var i=0,u=[],r=n,o=[],f=[],e={},u=this.__getVisibleSolutionLocationIds(t),i=0;i<u.length;i++)r=this.Data.Locations.getFromIndex("Id",u[i]),f.indexOf(r)===-1&&(f.push(r),o.push(r.Name));return e.Models=f,e.Names=o.join(this.SchedulingStringsNamespace.getString(it)),e},__isSlotInSelectedPreferences:function(n,r){for(var f=n/3600,u=0,e=t,o=!this.__allowTimePreferences(),u=0;u<r.length;u++)if(f>=r[u][0]&&f<r[u][1]){e=i;break}return o||e},__getAvailableRequestSolutions:function(t){var i=this,e=0,o=0,s=n,v=n,y=u,p=n,w=n,h=n,c=[],l=[],b=n,a=[];if(s=i.Data.AppointmentBuilder.ReasonForVisit,s===n||i.Data.AppointmentBuilder.numAppointments()>1)return c;for(l=t.Providers.toArray(),y=f.getRequestSlotKey(s.Id),v=t.getSelectedDepartmentsCollection(),e=0;e<l.length;e++)for(b=l[e],a=i.Data.Solutions.getFromIndex(["SlotKey",rt],[y,b.ID]),o=0;o<a.length;o++)h=a[o],p=h.Slots[0],w=i.Data.Departments.getFromIndex(r,p.DepartmentId),v.contains(w)&&c.push(h);return c},__buildViewModelForProvidersForRequest:function(){var f=this,v=[],w=0,s=0,h=0,c=0,l=n,y=n,p=u,b=u,k=n,o=n,e=[],a=[],d=t;for(f.ViewModel.ProvidersForRequest=[],w=f.Data.AppointmentBuilder.numAppointments(),c=0;c<w;c++)for(l=f.Data.AppointmentBuilder.getAppointment(c),e=f.__getAvailableRequestSolutions(l),d=f.__getAvailableDirectProviderDepartmentPairs(l).length>0,v=l.Providers.toArray(),s=0;s<v.length;s++){for(y=v[s],a=[],h=0;h<e.length;h++)o=e[h].Slots[0],o.ProviderId===y.ID&&(k=f.Data.Departments.getFromIndex(r,o.DepartmentId),f.SchedulingStringsNamespace.addMnemonics({"@MYCHART@DEPARTMENT@":{Value:k.Name,EncodingType:$$WP.Strings.EncodingTypes.None}}),o.DepartmentLink=f.SchedulingStringsNamespace.getString("DepartmentRequestString"),f.SchedulingStringsNamespace.clearMnemonics(),a.push(o),b=o.ModelId);a.length>0&&f.ViewModel.ProvidersForRequest.push({Provider:y,Slots:a})}d?e.length===1?(f.ViewModel.ShowSingleRequestLink=i,p="<a href='#' class='departmentbutton' data-model-id='"+b+"'>"+f.SchedulingStringsNamespace.getString("RequestableProvidersLinkSinglePair")+"<\/a>",f.stepSettings.Hide=t):e.length>1&&(f.ViewModel.ShowExpandableRequestLink=i,p="<a href='#' class='expandrequestoptions' id='requestoption_"+f.Id+"'>"+f.SchedulingStringsNamespace.getString("RequestableProvidersLinkMultiplePairs")+"<\/a>",f.stepSettings.Hide=t):e.length===1?f.stepSettings.Hide=i:e.length>1&&(f.ViewModel.ShowExpandedRequestOptions=i,f.stepSettings.Hide=t);f.SchedulingStringsNamespace.addMnemonics({"@MYCHART@REQUESTLINK@":{Value:p,EncodingType:$$WP.Strings.EncodingTypes.None}})},__shouldOfferTeamsBeforeSlots:function(){return this.__slotStepSettings.ShowTeamBeforeSearch===1||this.__slotStepSettings.ShowTeamBeforeSearch===2},__shouldOfferTeamsOnNoData:function(){return this.__slotStepSettings.ShowTeamBeforeSearch===0&&!this.__haveIncludedProviderTeam&&!this.Data.SlotLoader.isLoading()},__getLoadingOverlay:function(){return this.$root.find(".loadingoverlay")},__lockLoadOverlayPosition:function(){this.__getLoadingOverlay().addClass(tt)},__releaseLoadOverlayPosition:function(){this.__getLoadingOverlay().removeClass(tt)},__getLoadAnotherBatchButton:function(){return this.$root.find(d)},__isTicketWorkflow:function(){return this.__workflow.Type===nt.WorkflowTypesEnum.Ticket},__isRescheduleWorkflow:function(){return this.__workflow.Type===nt.WorkflowTypesEnum.Reschedule},__isDecisionTreeNodeWorkflow:function(){return this.__workflow.Type===nt.WorkflowTypesEnum.DecisionTreeNode},__isTypeObject:function(n){return $.type(n)==="object"}};p.prototype=ni;p.ModesEnum=g;$$WP.Scheduling.SlotStepController=p;p.extend($$WP.Scheduling.StepController,"WP$Scheduling$SlotStepController")}(),function(){var c=":checked",l="#schedulingoverlay",a="relative",o="change",v="textarea[name='comments']",s=".loadingoverlay",f="Scheduling",y="ScheduleErrorTitle",i=!0,r="",e="ID",t=!1,n=null,u=$$WP.Scheduling.Workflow,h=function(i,r,f,o,s,h,c,l,a,v,y,p,w,b){var k=this;k.WP$Scheduling$StepController(i,f,n,n,n,$$WP.Templates.Scheduling.ConfirmationStep);k.proxify("updateStep","_onClickSchedule","_onScheduled","_loadReviewData","_onReviewDataLoaded","_onCommentsModified","_onFavoriteCheckboxChanged","_onWaitListCheckboxChanged","__returnToSlotStep","__onSchedulingStopButtonClicked");k.__workflow=r;k.__isRescheduling=k.__workflow.Type===u.WorkflowTypesEnum.Reschedule;k.__isRescheduling?(k.__requireComments=t,k.__allowComments=k.Data.Departments.getFromIndex(e,k.__workflow.OriginalAppointment.DepartmentIds[0]).AllowRescheduleComments):(k.__requireComments=s||t,k.__allowComments=o||k.__requireComments);k.__maxCommentsLength=h;k.__rescheduleReasons=v||[];k.__requireRescheduleReason=y||t;k.__campaignID=c||n;k.__onSchedulingCompleteCallback=l;k.__onErrorCallback=a;k.__disableFavoriteAppointments=p||t;k.__disableAddToWaitList=w||t;k.__topicId=b||n},p={__workflow:n,__comments:n,__allowComments:n,__requireComments:n,__maxCommentsLength:n,__disableFavoriteAppointments:n,__disableAddToWaitList:n,__campaignID:n,__requireRescheduleReason:n,__rescheduleReasons:n,__selectedRescheduleReason:n,__onSchedulingCompleteCallback:n,__onErrorCallback:n,__previouslySelectedSlot:n,__reviewResult:n,__isLoaded:t,__isCurrentlyLoading:t,__favoriteCheckboxValue:t,__waitListCheckboxValue:t,__isRescheduling:t,__topicId:n,updateViewModel:function(){var u=this,d,g,e,a,v,o,p,s,nt,tt,it=t,rt=-1,h=n,w=n,c=n,b=r,l=t,k=n;d=new $$WP.FormValidation.ValidationSettings({required:u.__requireComments,maxLength:u.__maxCommentsLength,showCharacterCounter:i});g=new $$WP.FormValidation.ValidationSettings({required:u.__requireRescheduleReason});u.template=$$WP.Templates.Scheduling.ConfirmationStep;u.__selectedRescheduleReason=u._getSelectedRescheduleReasonFromDOM();u.__isLoaded?u.__reviewResult.Success?(rt=u.Data.AppointmentBuilder.getFirstAppointmentIndex(),h=u.__reviewResult.Appointments[rt],l=u.Data.AppointmentBuilder.showAsMultipleVisits(u.Data.VisitTypes),w=u.__getProviderToUseForPhoto(),c=new $$WP.Scheduling.SolutionViewModel,c.populateFromReviewResult(u.Data,u.__reviewResult),k=u.__getPrimaryAppointmentViewModel(c),b=u.__getCompiledInstructionsFromReviewResult(u.__reviewResult),a=h.IsTelemedicine,e=h.DepartmentInstructions.length>0&&!a&&!l,p=b!==r,v=p||e||o||s||u.__allowComments||u.__rescheduleReasons.length>0,it=v&&!p&&!e,o=u._canFavoriteAppointment(),s=u._canAddToWaitList(),nt=u._getAddToWaitListByDefault(),u.ViewModel={StepShouldBeActive:i,IsLoading:t,PrimaryAppointmentViewModel:k,ShowProvider:!!w&&!l,Provider:w,Warnings:u.__reviewResult.Warnings,AllowComments:u.__allowComments,RequireComments:u.__requireComments,TallComments:it,CommentsValidationSettings:d,Comments:u.__comments,RescheduleReasons:u.__rescheduleReasons,RequireRescheduleReason:u.__requireRescheduleReason,RescheduleReasonsValidationSettings:g,HasRightColumnContent:v,ShowDepartmentDirections:e,DepartmentDirections:h.DepartmentInstructions,PatientInstructions:b,IsTelemedicine:a,CommentsElementId:"schedulingConfirmationComments_"+u.Id,IsMobile:$$WP.Utilities.UI.IsMobile,IsRescheduling:u.__isRescheduling,CanFavoriteAppointment:o,CanAddToWaitList:s,AddToWaitListByDefault:nt,ShowExtraOptions:o||s,HasMultipleAppointments:u.Data.AppointmentBuilder.numAppointments()>1,SolutionViewModel:c,ShowSolutionDetails:l},u.SchedulingStringsNamespace.addMnemonics({"@MYCHART@DEPARTMENT@":{Value:k.Department.Name,EncodingType:$$WP.Strings.EncodingTypes.HTML}})):(tt=u.__getErrorMessage(u.__reviewResult.Error.ErrorCode),u.ViewModel={StepShouldBeActive:i,IsLoading:t,SchedulingStoppedTitle:$$WP.Strings.get(y,f),SchedulingStoppedPretext:tt,SchedulingStoppedButtontext:$$WP.Strings.get("PickNewTimeButton",f)},u.template=$$WP.Templates.Scheduling.SchedulingStopped):(u.ViewModel={StepShouldBeActive:i,IsLoading:i},u._loadReviewData())},__getPrimaryAppointmentViewModel:function(n){var i=n.Appointments[0],t=new $$WP.Scheduling.AppointmentViewModel(i.toRawObject());return t.TitleHtml=this.__getCardTitleHtml(),t.LengthInMinutes=this.__shouldShowDuration()?this.Data.AppointmentBuilder.getTotalLengthInMinutes():0,t},__getCompiledInstructionsFromReviewResult:function(t){var i=this,l=i.__getSortedInstructions(t,i.Data.AppointmentBuilder),e=n,o=[],u=0,s=i.Data.AppointmentBuilder.numAppointments(),h=s>1,c=n,f=r;for(t.PatientInstructionsHtml!==n&&t.PatientInstructionsHtml.length>0&&i.__appendInstructionsToArray(t.PatientInstructionsHtml,i.__getAppointmentNameForCardTitle(),h,o),u=0;u<s;u++)e=l[u],f=e.InstructionsHtml,c=e.VisitType,f!==n&&f.length>0&&i.__appendInstructionsToArray(f,c.DisplayName,h,o);return o.join(r)},__getSortedInstructions:function(t,i){for(var r=0,u=n,e=n,o=n,s={},f=[],r=0;r<i.numAppointments();r++)u=i.getAppointment(r),e=u.Slot,o=t.Appointments[r],s={DateTimeUtc:e.DateTimeUtc,InstructionsHtml:o.PatientInstructionsHTML,VisitType:u.VisitType},f.push(s);return f.sort($$WP.Scheduling.Slot.slotSortFunction),f},__appendInstructionsToArray:function(n,t,i,r){i&&r.push("<section><div class='bold'>"+HTMLEncode(t)+"<\/div>");r.push(n);i&&r.push("<\/section>")},arePrerequisitesComplete:function(){for(var r=0,f=n,u=n,e=t,r=0;r<this.Data.AppointmentBuilder.numAppointments();r++)if(f=this.Data.AppointmentBuilder.getAppointment(r),u=f.Slot,e=u!==n?u.IsRequest:t,!u||e)return t;return i},__getProviderToUseForPhoto:function(){for(var t=this,i=0,f=n,o=n,r=[],i=0;i<t.Data.AppointmentBuilder.numAppointments();i++)f=t.Data.AppointmentBuilder.getAppointment(i),u.allowProviderSelectForAppointment(t.Data.AppointmentBuilder,f)&&(o=t.Data.Providers.getFromIndex(e,f.Slot.ProviderId),r.indexOf(o)===-1&&r.push(o));return r.length===1?r[0]:n},__shouldShowDuration:function(){return this.__reviewResult.Appointments[0].AppointmentLength>0},__getCardTitleHtml:function(){var i=this,h=r,f=n,o=n,c=n,s=t;return f=i.Data.AppointmentBuilder.getFirstAppointment(),h=i.__getAppointmentNameForCardTitle(),c=i.Data.Departments.getFromIndex(e,f.Slot.DepartmentId),i.Data.AppointmentBuilder.numAppointments()===1?(o=i.Data.Providers.getFromIndex(e,f.Slot.ProviderId),s=u.allowProviderSelectForAppointment(i.Data.AppointmentBuilder,f)):(o=i.__getProviderToUseForPhoto(),s=!!o),$$WPSchedulingUtil.ConstructAppointmentStringHtml(o,c,h,s)},__getAppointmentNameForCardTitle:function(){var n=this,t;switch(n.__workflow.Type){case u.WorkflowTypesEnum.Ticket:return n.__workflow.TicketInfo.DisplayName;case u.WorkflowTypesEnum.Reschedule:case u.WorkflowTypesEnum.DecisionTreeNode:return n.Data.AppointmentBuilder.getFirstAppointment().VisitType.DisplayName;default:return t=n.Data.AppointmentBuilder.ReasonForVisit,t.Title}},__getErrorMessage:function(n){var t=r;return t=$$WP.Strings.get("ScheduleErrorMessage_"+n,f),t===r&&(t=$$WP.Strings.get("ScheduleErrorMessage",f)),t},beforeFirstRender:function(){Handlebars.registerPartial("Scheduling.SolutionDetailed",$$WP.Templates.Scheduling.SolutionDetailed);Handlebars.registerPartial("Scheduling.SolutionAlerts",$$WP.Templates.Scheduling.SolutionAlerts);Handlebars.registerPartial("Scheduling.SlotArrivalAndTime",$$WP.Templates.Scheduling.SlotArrivalAndTime);Handlebars.registerPartial("Scheduling.Payment",$$WP.Templates.Scheduling.Payment)},afterRender:function(){var i=this,r,u,f;if($$WP.FormValidation.initializeDOMSubtree(i.$root),i.$root.find("#reschedulereason_label_"+i.__selectedRescheduleReason).trigger("click"),$afe.select(".cardlist.matchHeights").each($$WP.Utilities.UI.Cards.MatchHeights),i.SchedulingStringsNamespace.clearMnemonics(),$$WP.Utilities.UI.IsMobile&&$$WP.Utilities.Mobile.Optimization.ChangeToFlexboxLayout(),i.__isLoaded){i.$root.find(s).hide();r=i.Data.AppointmentBuilder.getFirstAppointment().Slot;r===n||i.__previouslySelectedSlot===r||r.IsRequest||i.$root.find("h2.header").focus();i.__previouslySelectedSlot=r;i.$root.find("[data-id='schedule']").on("click",i._onClickSchedule);i.$root.find(v).on(o,i._onCommentsModified);i.$root.find("#favoriteCheckbox").on(o,i._onFavoriteCheckboxChanged);i.$root.on(o,"#waitListCheckbox",i._onWaitListCheckboxChanged);i.$root.find("#schedulingstop-button").click(i.__onSchedulingStopButtonClicked);u=$afe.select(".visitinstructionscontent");u.length>0&&new $$WP.Visits.PatientInstructionController(u,i.ViewModel.PatientInstructions)}else f=i.$root.find(s),f.addClass(a),f.show();i.__isLoaded=t;i.__waitListCheckboxValue=i._getAddToWaitListByDefault();i.__setAddToWaitListForAllAppointments(i.__waitListCheckboxValue);$$WP.Utilities.UI.MatchColumnHeights()},_canFavoriteAppointment:function(){var n=this,r;return!n.__reviewResult||!n.__reviewResult.Appointments[0].CanSaveAsFavorite?t:n.__disableFavoriteAppointments?t:(r=n.__workflow.Type,r===u.WorkflowTypesEnum.Standard||r===u.WorkflowTypesEnum.Procedure||r===u.WorkflowTypesEnum.ExistingProvider?i:t)},_canAddToWaitList:function(){return this.__disableAddToWaitList?t:this.__reviewResult?this.__reviewResult.Appointments[0].CanAddToWaitListWithFastPass:t},_getAddToWaitListByDefault:function(){return this.__disableAddToWaitList?t:this.__reviewResult?this.__reviewResult.Appointments[0].AddToWaitListByDefault:t},_loadReviewData:function(){var r=this,u;r.__isCurrentlyLoading||(u=r._getAjaxParametersToReviewAppointment(),u!==n)&&($.post({url:makeLink("Scheduling/ReviewAppointment"),data:$$WPUtil.postify(u),cache:t,success:r._onReviewDataLoaded,error:r.__onErrorCallback}),r.__isCurrentlyLoading=i)},_onReviewDataLoaded:function(n){var r=this;r.__reviewResult=n;r.__isLoaded=i;r.updateStep();r.__isCurrentlyLoading=t},_onClickSchedule:function(r){var u=this,f,e;(r.preventDefault(),u.Data.IsSchedulingCompleting)||(u.Data.AppointmentBuilder.setProperty("TopicId",u.__topicId),f=u._getAjaxParametersToScheduleAppointment(),f!==n)&&(e=u.$root.find(s),e.removeClass(a),e.show(),$afe.select(l).css("z-index",1e3),u.Data.IsSchedulingCompleting=i,$.post({url:makeLink("Scheduling/ScheduleAppointment"),data:$$WPUtil.postify(f),cache:t,success:u._onScheduled,error:u.__onErrorCallback}))},_getAjaxParametersToReviewAppointment:function(){return this._getSharedAjaxParameters()},_getAjaxParametersToScheduleAppointment:function(){var t=this,i=n;return!t._areCommentsValid()||!t._isSelectedRescheduleReasonValid()?n:(i=t._getSharedAjaxParameters(),i.comments=t.__comments,i.rescheduleReason=t._getSelectedRescheduleReasonFromDOM(),i.saveAsFavorite=t.__favoriteCheckboxValue,i)},_getSharedAjaxParameters:function(){return{workflow:this.__workflow.toRawRequestObject(),appointmentBuilder:this.Data.AppointmentBuilder.toRawRequestObject(),campaignID:this.__campaignID}},_areCommentsValid:function(){var n=this,u;return n._updateCommentsValidationUI(),u=n.__comments||r,u.length===0&&n.__requireComments?t:u.length>0&&!n.__allowComments?t:u.length>n.__maxCommentsLength?t:i},_updateCommentsValidationUI:function(){this.$root.find("[name='comments']").trigger(o)},_getSelectedRescheduleReasonFromDOM:function(){return this.$root.find("input[name='reschedulereason']:checked").val()||r},_isSelectedRescheduleReasonValid:function(){var n=this._getSelectedRescheduleReasonFromDOM();return n.length===0&&this.__requireRescheduleReason?t:n.length>0&&this.__rescheduleReasons.length===0?t:i},_onScheduled:function(i){var u=this,o,e;u.Data.IsSchedulingCompleting=t;$$WPUtil.IsNullOrEmpty(i)?($$WP.Debug.log("Error scheduling appointment. No response from web server."),e=u.__getErrorMessage("UNKNOWN-ERROR")):i.Success?u.__onSchedulingCompleteCallback!==n&&u.__onSchedulingCompleteCallback(i.Appointments,u.Data.AppointmentBuilder.showAsMultipleVisits(u.Data.VisitTypes),i.HasMobileLoginToken):e=u.__getErrorMessage(i.Error.ErrorCode);$$WPUtil.IsNullOrEmpty(e)||(u.$root.find(s).hide(),o=new $$WPComp.MessageComponent({TitleText:$$WP.Strings.get(y,f),Message:e,ToolbarButtons:[new $$WPComp.ComplexObjects.Button($$WP.Strings.get("ScheduleErrorButtonLabel",f),n,"cancelworkflow",r)],callback:u.__returnToSlotStep}),$$WPUtil.quickPopup(o),$afe.select(l).css("z-index",-1e3))},_onCommentsModified:function(){this.__comments=this._getCommentsFromDOM()},_getCommentsFromDOM:function(){return this.$root.find(v).val()||r},_onFavoriteCheckboxChanged:function(n){var t=$afe.jq(n.target);this.__favoriteCheckboxValue=t.is(c)},_onWaitListCheckboxChanged:function(n){var t=$afe.jq(n.target);this.__waitListCheckboxValue=t.is(c);this.__setAddToWaitListForAllAppointments(this.__waitListCheckboxValue)},__setAddToWaitListForAllAppointments:function(t){for(var i=0,r=n,i=0;i<this.Data.AppointmentBuilder.numAppointments();i++)r=this.Data.AppointmentBuilder.getAppointment(i),r.setProperty("AddToWaitList",t)},__onSchedulingStopButtonClicked:function(){this.__returnToSlotStep()},__returnToSlotStep:function(){for(var t=this,i=n,f=n,u=0;u<t.Data.SchedulingSteps.Models.length;u++)t.Data.SchedulingSteps.Models[u].Type===$$WP.Scheduling.SchedulingStep.StepTypeEnum.Slot&&(i=t.Data.SchedulingSteps.Models[u],f=i.StackId!==r?t.Data.SchedulingSteps.getFromIndex(e,i.StackId):i);f!==n&&f.setProperty("ActiveStatus",$$WP.Scheduling.SchedulingStep.ActiveEnum.Active)}};h.prototype=p;$$WP.Scheduling.ConfirmationStepController=h;h.extend($$WP.Scheduling.StepController,"WP$Scheduling$ConfirmationStepController")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var s="fromDate",e=".loadingoverlay",r=!0,h="input[name='otherrfv']",c="input[name='otherprovider']",l="textarea[name='comments']",u="change",i=!1,t="",n=null,f=$$WP.Utilities.UI.TimePreferenceWidgetController,o=function(r,f,e,o,s){var a=this,v;if(a.WP$Scheduling$StepController(r,f,n,n,n,$$WP.Templates.Scheduling.RequestStep),a.proxify("_onClickRequest","_onRequestCompleted","_onCommentsModified","_onCalendarDatePicked","_onDateInputChanged","_onViewersModified","_onSlotChanged"),a._appointment=a.Data.AppointmentBuilder.getFirstAppointment(),a._viewers=e.Viewers||[],a._viewersString=t,a._allowSelectViewers=e.AllowSelectViewers||i,a._showViewers=e.ShowViewers||i,a._drawViewersSection=(a._allowSelectViewers||a._showViewers)&&!(a._viewers.length===1&&a._viewers[0].IsSelf),!a._allowSelectViewers&&a._showViewers)for(v=0;v<a._viewers.length;v++)$$WP.Utilities.IsNullOrEmpty(a._viewers[v].Name)||(a._viewersString!==t&&(a._viewersString=a._viewersString+a.SchedulingStringsNamespace.getString("RequestViewersListDelimiter")),a._viewersString=a._viewers[v].IsSelf?a._viewersString+a.SchedulingStringsNamespace.getString("RequestViewerButtonSelf"):a._viewersString+a._viewers[v].Name);a._onFilePreferences=e.SchedulePreferences||n;a._daysOfWeekList=e.DaysOfWeekList||[t,t,t,t,t,t,t];a._campaignID=s||n;a._requireComments=e.RequireRequestComments;a._maxCommentsLength=e.MaxCommentsLength;typeof o=="function"&&(a._onRequestCompletedCallback=o);e.StartDate!==n&&(a._startDte=WP.Utils.date2dte(new Date(e.StartDate)));e.EndDate!==n&&(a._endDte=WP.Utils.date2dte(new Date(e.EndDate)));a._appointment.addPropertyListener("Slot",a._onSlotChanged);a.$root.on("click","[data-id='request']",a._onClickRequest);a.$root.on(u,"input[name='fromDate'],input[name='toDate']",a._onDateInputChanged);a.$root.on(u,l,a._onCommentsModified);a.$root.on(u,c,a._onCommentsModified);a.$root.on(u,h,a._onCommentsModified);a.$root.on("click","[data-id='viewers']",a._onViewersModified)},a={_appointment:n,TimePreferenceWidget:n,_startDte:n,_endDte:n,_drawViewersSection:i,_viewers:n,_viewersString:n,_allowSelectViewers:i,_showViewers:i,_otherProviderText:n,_otherRfvText:n,_comments:n,_requireComments:n,_maxCommentsLength:n,_maxOtherLength:200,_onRequestCompletedCallback:n,_onFilePreferences:n,_daysOfWeekList:n,_campaignID:n,_previouslySelectedSlot:n,updateViewModel:function(){var n=this,u,f,o,i,s,e;s=new $$WP.FormValidation.ValidationSettings({required:n._requireComments,maxLength:n._maxCommentsLength,showCharacterCounter:r});e=new $$WP.FormValidation.ValidationSettings({required:r,maxLength:n._maxOtherLength});i=n._getCurrentRequestSelections();f=i.ReasonForVisit;u=i.Provider;o=i.Department;n.ViewModel={StepControllerId:n.Id,Provider:u,ReasonForVisit:f,Department:o,LoadingSpinnerUrl:makeStaticLink("/images/spinner64.gif"),StepShouldBeActive:r,Viewers:n._viewers,ViewersString:n._viewersString,AllowSelectViewers:n._allowSelectViewers,ShowViewers:n._showViewers,DrawViewersSection:n._drawViewersSection,Comments:n._comments,FromDate:n._startDte?formatDate(WP.Utils.dte2date(n._startDte)):t,ToDate:n._endDte?formatDate(WP.Utils.dte2date(n._endDte)):t,RequireComments:n._requireComments,CommentsValidationSettings:s,CommentsInitiallyInvalid:!$$WPUtil.IsNullOrEmpty(n._comments),CommentsElementId:"requestComments_"+n.Id,IsMobile:$$WP.Utilities.UI.IsMobile,OtherProviderValidationSettings:e,OtherRfvValidationSettings:e};n.SchedulingStringsNamespace.addMnemonics({"@MYCHART@PROVIDER@":{Value:u.Name,EncodingType:$$WP.Strings.EncodingTypes.HTML},"@MYCHART@REASONFORVISIT@":{Value:f.Title,EncodingType:$$WP.Strings.EncodingTypes.HTML}})},arePrerequisitesComplete:function(){var t=this._getCurrentRequestSelections();return t!==n},afterRender:function(){var r=this,u,e,o,s,h;r.SchedulingStringsNamespace.clearMnemonics();s=$$WP.Utilities.UI.IsSmallScreen();h=s&&!$$WP.Utilities.UI.IsMobile?f.OrientationEnum.Vertical:f.OrientationEnum.Horizontal;r.TimePreferenceWidget=new f(r.$root.find(".timepreferencecontainer"),n,n,n,r._onFilePreferences,r._daysOfWeekList,i,n,h);$$WP.Strings.setDefaultNamespace("Scheduling");u=makeStaticLink("images/calendar.svg");e=WP.Utils.date2dte(new Date);clearCalendarDateRange();writeCalendar("fromDate_"+r.Id,"range",u,e,t,r._onCalendarDatePicked);writeCalendar("toDate_"+r.Id,"range",u,e,t,r._onCalendarDatePicked);o=r._appointment.Slot;r.$root.find("h2.header").focus();r._previouslySelectedSlot=o;$$WP.FormValidation.initializeDOMSubtree(r.$root);$$WP.Utilities.UI.MatchColumnHeights()},_onSlotChanged:function(){var n=this,t=n._appointment.Slot;$$WPUtil.IsNullOrEmpty(t)?n.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete):t.IsRequest?n.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete):n.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.NotRequired);n.updateStep()},_getCurrentRequestSelections:function(){var i=this,t,r,u,f;return(t=i._appointment.Slot,t===n||!t.IsRequest)?n:(r=i.Data.AppointmentBuilder.ReasonForVisit,u=i.Data.Providers.getFromIndex("ID",t.ProviderId),f=i.Data.Departments.getFromIndex("ID",t.DepartmentId),{Slot:t,ReasonForVisit:r,Provider:u,Department:f})},_getPreferredTimes:function(){var t=this,h=n,u=n,e=n,c=n,l=n,o=0,s=0,a=[],v=n;h=t.$root.find(".timepreferencewidget input.clearradio:checked");switch(h.safeAttr("value")){case f.LabelValueEnum.AllAvailable:u=t.__setPreferredTimes(r,i);break;case f.LabelValueEnum.OnFile:u=t.__setPreferredTimes(i,r);break;case f.LabelValueEnum.Other:if(e=t.$root.find(".timepreferencewidget input[type='checkbox']:checked"),e.length===0)u=t.__setPreferredTimes(r,i);else{for(o=0;o<7;o++)for(e=t.$root.find(".timepreferencewidget input[type='checkbox']:checked[data-day-index='"+o+"']"),s=0;s<e.length;s++)c=$afe.jq(e[s]),v=c.data("message-range-value"),l={DayOfWeek:o,RangeMessageDescriptor:v},a.push(l);u=t.__setPreferredTimes(i,i,a)}}return u},__setPreferredTimes:function(t,i,r){var u=n;return{IsAllAvailable:t,IsUseOnFile:i,PreferredDays:r}},_onClickRequest:function(f){var o=this,h,s,c,l,a,v,y;if(f.preventDefault(),s=o._getCurrentRequestSelections(),s!==n){if(s.Provider.OtherOption&&($$WPUtil.IsNullOrEmpty(o._otherProviderText)||o._otherProviderText.length>o._maxOtherLength)){o.$root.find("[name='otherprovider']").trigger(u);return}if(s.ReasonForVisit.IsOtherRfv&&($$WPUtil.IsNullOrEmpty(o._otherRfvText)||o._otherRfvText.length>o._maxOtherLength)){o.$root.find("[name='otherrfv']").trigger(u);return}if(c=o._comments||t,c.length===0&&o._requireComments||c.length>o._maxCommentsLength){o.$root.find("[name='comments']").trigger(u);return}if(l=[],o._drawViewersSection)for(a=o.$root.find("[name='viewers']:checked"),h=0;h<a.size();h++)l.push($afe.jq(a.get(h)).val());else if(o._allowSelectViewers)for(h=0;h<o._viewers.length;h++)l.push(o._viewers[h].WprId);y=o._getPreferredTimes();v={reasonForVisitId:s.ReasonForVisit.IsOtherRfv?t:s.ReasonForVisit.Id,providerId:s.Provider.OtherOption?t:s.Provider.ID,departmentId:s.Department.ID==="-1"?t:s.Department.ID,comments:c,viewers:l,startDte:o._startDte,endDte:o._endDte,preferredTimesObject:y,otherProvider:s.Provider.OtherOption?o._otherProviderText:t,otherRfv:s.ReasonForVisit.IsOtherRfv?o._otherRfvText:t,campaignID:o._campaignID};o.$root.find(e).show();o.Data.IsSchedulingCompleting=r;$.post({url:makeLink("Scheduling/RequestAppointment"),data:$$WPUtil.postify(v),cache:i,success:o._onRequestCompleted,traditional:r})}},_onRequestCompleted:function(r){var o="cancelworkflow",s="RequestErrorButtonLabel",h="RequestErrorMessage",c="RequestErrorTitle",u=this,f;u.Data.IsSchedulingCompleting=i;$.type(r)!=="object"?(u.$root.find(e).hide(),f=new $$WPComp.MessageComponent({TitleText:u.SchedulingStringsNamespace.getString(c),Message:u.SchedulingStringsNamespace.getString(h),ToolbarButtons:[new $$WPComp.ComplexObjects.Button(u.SchedulingStringsNamespace.getString(s),n,o,t)]}),$$WPUtil.quickPopup(f)):r.Success?(u.$root.find(e).hide(),u._onRequestCompletedCallback!==n&&u._onRequestCompletedCallback(r.HasMobileLoginToken)):($$WP.Debug.log("Error sending appointment request. "+r.Error.ErrorCode+": "+r.Error.ErrorMessage),u.$root.find(e).hide(),f=new $$WPComp.MessageComponent({TitleText:u.SchedulingStringsNamespace.getString(c),Message:u.SchedulingStringsNamespace.getKeyedString(h,r.Error.ErrorCode),ToolbarButtons:[new $$WPComp.ComplexObjects.Button(u.SchedulingStringsNamespace.getString(s),n,o,t)]}),$$WPUtil.quickPopup(f))},_onCommentsModified:function(){var n=this,i,r;n._comments=n.$root.find(l).val()||t;i=n.$root.find(c);n._otherProviderText=i.length>0?i.val().trim():t;r=n.$root.find(h);n._otherRfvText=r.length>0?r.val().trim():t},_onCalendarDatePicked:function(n,t,i,r){var u=this,e,f;typeof r!="undefined"&&(e=new Date(n,t,i),f=WP.Utils.date2dte(e),r.name===s?(u._startDte=f,u.$root.find(".daterangeinput[name=toDate]").focus()):(u._endDte=f,u.$root.find(".timeTable .togglebutton:checked").focus()),u._validateDates(),u._updateDateFields())},_onDateInputChanged:function(t){var i=this,r,f,e,u;r=t.target.value;u=n;f=r.length>0&&IsDateValid(r,3);f&&(e=parseDate(r),u=WP.Utils.date2dte(e));t.target.name===s?i._startDte=u:i._endDte=u;i._validateDates();i._updateDateFields()},_validateDates:function(){var r=this,t,i,u,e,f;t=r._startDte;i=r._endDte;u=WP.Utils.date2dte(new Date);f=u+3650;t&&(t<u||t>f)&&(t=n);i&&(i<u||i>f)&&(i=n);t&&i&&t>i&&(e=i,i=t,t=e);r._startDte=t;r._endDte=i},_updateDateFields:function(){var n=this,i,r;i=n._startDte?formatDate(WP.Utils.dte2date(n._startDte)):t;r=n._endDte?formatDate(WP.Utils.dte2date(n._endDte)):t;n.$root.find("input[name='fromDate']").val(i);n.$root.find("input[name='toDate']").val(r)},_onViewersModified:function(){for(var t=this,n=0;n<t._viewers.length;n++)t._viewers[n].Selected=t.$root.find("input[name='viewers'][value='"+t._viewers[n].WprId+"']").get(0).checked}};o.prototype=a;$$WP.Scheduling.RequestStepController=o;o.extend($$WP.Scheduling.StepController,"WP$Scheduling$RequestStepController")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var i="Scheduling",n=null,t=function(t,i,r){this.WP$Scheduling$StepController(t,i,n,n,n,$$WP.Templates.Scheduling.OriginalAppointment);this.__originalAppointment=r},r={__originalAppointment:n,updateViewModel:function(){var t=this,r=n,f=n,u=n,e=$$WP.Strings.getNamespace(i);r=t.Data.Providers.getFromIndex("ID",t.__originalAppointment.ProviderIds[0]);f=t.Data.Departments.getFromIndex("ID",t.__originalAppointment.DepartmentIds[0]);u=t.Data.VisitTypes.getFromIndex("ID",t.__originalAppointment.VisitTypeId);e.addMnemonics({"@MYCHART@VISITTYPE@":{Value:u.DisplayName,EncodingType:$$WP.Strings.EncodingTypes.HTML},"@MYCHART@PROVIDER@":{Value:r.Name,EncodingType:$$WP.Strings.EncodingTypes.HTML},"@MYCHART@TIMEDURATION@":{Value:t.__originalAppointment.Slot.LengthInMinutes,EncodingType:$$WP.Strings.EncodingTypes.None}});t.ViewModel={Provider:r,Department:f,Slot:t.__originalAppointment.Slot,VisitType:u,ShowAppointmentLength:t.__originalAppointment.Slot.LengthInMinutes>0,StepShouldBeActive:!0}},beforeFirstRender:function(){this.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.NotRequired)},afterRender:function(){var n=$$WP.Strings.getNamespace(i);n.clearMnemonics()}};t.prototype=r;$$WP.Scheduling.OriginalApptStepController=t;t.extend($$WP.Scheduling.StepController,"WP$Scheduling$OriginalApptStepController")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var n=null,t=function(t,i){var r=this;r.WP$Scheduling$StepController(t,i,n,n,n,$$WP.Templates.Scheduling.CustomStep);r.proxify("updateStep","_onClick","clearStepStatus");r.Data.AppointmentBuilder.addPropertyListener("ReasonForVisit",r.clearStepStatus);r.$root.on("click","[data-id='custom']",r._onClick)},i={updateViewModel:function(){var t=this,i;(i=t.__getCustomStepVisitType(),t.ViewModel={Count:0,StepShouldBeActive:!1},i!==n)&&($$WPUtil.IsNullOrEmpty(i.CustomStepBodyKey)?t.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.NotRequired):t.ViewModel={Count:0,StepShouldBeActive:!0,VisitType:i})},__getCustomStepVisitType:function(){var t=n,i=n;return t=this.Data.AppointmentBuilder.getFirstAppointment(),$$WPUtil.IsNullOrEmpty(t.PanelId)?t.VisitType:this.Data.VisitTypes.getFirstInIndex("ID",t.PanelId)},afterRender:function(){this.$root.find("h2.header").focus();$$WP.Utilities.UI.MatchColumnHeights()},hide:function(n){this.clearStepStatus();this.WP$Scheduling$StepController$hide(n)},clearStepStatus:function(){this.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete)},_onClick:function(){this.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Complete)}};t.prototype=i;$$WP.Scheduling.CustomStepController=t;t.extend($$WP.Scheduling.StepController,"WP$Scheduling$CustomStepController")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var n=null,t=function(t,i,r,u){var f=this;f.proxify("updateStep","_onClick","_onSelectionChange","_onCoverageChange");f.WP$Scheduling$StepController(t,i,n,n,n,$$WP.Templates.Scheduling.InsuranceVerificationStep,$$WP.Templates.Scheduling.InsuranceVerificationStep);f._showStep=r;f._isAlwaysSelfPay=u},i={_showStep:!1,updateViewModel:function(){var n=this;n.ViewModel={Count:0,StepShouldBeActive:!1};n._showStep?n.ViewModel={Count:0,StepShouldBeActive:!0,StepControllerId:n.Id,Settings:{ShowInsurance:!0,ShowUseInsuranceForVisitQuestion:!n._isAlwaysSelfPay,VerifyCallback:n._onClick,ChangeCallback:n._onCoverageChange}}:n.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.NotRequired)},afterRender:function(){var t=this,r,u,i;u=t.Data.AppointmentBuilder.getAppointment(0);i=u.Slot;r=new $$WP.Insurance.CoveragesController(t.$root.find(".insuranceVerificationContainer"),!1,n,n,i.DepartmentId,i.Dte);r.render(t.ViewModel);t.$root.find("h2.header:first").focus();t.$root.find("[data-id='custom']").on("click",t._onClick)},_onSelectionChange:function(){this.Active||this.updateStep()},_onClick:function(){var n=this,t;n.Data.BlockDemographicInsuranceVerification||(t=n.$root.find("input[name='useInsuranceForVisitButton']:checked"),t.length>0&&(n.Data.AppointmentBuilder.UseInsuranceForVisit=t.val()),n.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Complete))},_onCoverageChange:function(){this.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete)}};t.prototype=i;$$WP.Scheduling.InsuranceVerificationStepController=t;t.extend($$WP.Scheduling.StepController,"WP$Scheduling$InsuranceVerificationStepController")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var r="input, select, textarea",i=".button",n=null,t=function(n,t){var r="click",i=this;i.WP$Controllers$Controller();$.isFunction(t)||$$WP.Debug.logError("EditableViewController subclass did not provide the Handlebars template needed to render this view.");i.$root=n;i._template=t;i.loadData();i.proxify("onEditClicked","onSaveClicked","onCancelClicked");i.$root.on(r,".editButton",i.onEditClicked);i.$root.on(r,".saveButton",i.onSaveClicked);i.$root.on(r,".cancelButton",i.onCancelClicked)},u={$root:n,ViewModel:n,_template:n,focusAfterRender:!0,onEditClicked:function(n){this.$root.find(i).remove();this.render(!0);n.preventDefault()},onSaveClicked:function(n){this.$root.find(i).remove();this.$root.find(r).prop("disabled",!0);this.saveData();n.preventDefault()},onCancelClicked:function(n){this.$root.find(i).remove();this.render(!1);n.preventDefault()},loadData:function(){$$WP.Debug.logError("EditableViewController subclass did not override the virtual loadData method.")},saveData:function(){$$WP.Debug.logError("EditableViewController subclass did not override the virtual saveData method.")},render:function(n){var t=this;t.$root.empty();t.ViewModel=t.ViewModel||{};t.ViewModel.DisplayEditable=n;t.$root.safeAppend($afe.renderTemplate(t._template,t.ViewModel));t.afterRender()},afterRender:function(){$$WP.Utilities.UI.MatchColumnHeights();$afe.select(":focus").length===0&&this.focusAfterRender&&this.$root.find(r).filter(":visible:enabled").first().focus()},dispose:function(){this.$root.empty()}},f=function(t){return t.length===1?t.val():n};t.prototype=u;t.getValIfExists=f;$$WPUtil.guaranteeExistence($$WP,"Controllers");$$WP.Controllers.EditableViewController=t;t.extend($$WP.Controllers.Controller,"WP$Controllers$EditableViewController")}(),function(){var e="_Country",t="#",r=null,n="",i,u=[],f=function(n,t,i,r,f,e,o){var s=this;s._prefix=n;s._requiredFields=r||[];s._isPatientAddress=f===!0;s.__disableRTL=e;s._vrkFields=o||[];i&&i.DefaultCountryCat!=="153"&&(s._defaultAddressConfiguration=i.DefaultCountryCat,i.DefaultCountryCat&&!u[i.DefaultCountryCat]&&(u[i.DefaultCountryCat]=i));s.WP$Controllers$Controller();s.proxify("_onCountryChanged");s.setViewModel(t)},o={ViewModel:{},_isPatientAddress:!1,_prefix:n,_requiredFields:[],_vrkFields:[],_defaultAddressConfiguration:"1",_lastFocusedElementId:n,__disableRTL:!1,_onCountryChanged:function(){this.updateViewModel();this.render()},_onAddressConfigurationLoadSuccess:function(n){n.DefaultCountryCat=String(n.DefaultCountryCat);u[n.DefaultCountryCat]=n;this._trueRender();this.onDataLoadEnd()},onDataLoadStart:function(){},onDataLoadEnd:function(){},setViewModel:function(t){var i=this,f,u;for(i.ViewModel=t?{HouseNumber:t.HouseNumber,Street:t.Street,City:t.City,County:{Number:t.County.Number},State:{Number:t.State.Number},Zip:t.Zip,Country:{Number:t.Country.Number||i._defaultAddressConfiguration},District:{Number:t.District.Number},Building:i._isPatientAddress?t.Building:n,Floor:i._isPatientAddress?t.Floor:n,Unit:i._isPatientAddress?t.Unit:n}:{HouseNumber:n,Street:n,City:n,County:{Number:r},State:{Number:r},Zip:n,Country:{Number:i._defaultAddressConfiguration},District:{Number:r},Building:n,Floor:n,Unit:n},i.ViewModel.Prefix=i._prefix,f={},u=0;u<i._requiredFields.length;u++)i._vrkFields[i._requiredFields[u]]||(f[i._requiredFields[u]]=!0);i.ViewModel.RequiredFieldNames=f;i.ViewModel.VRKFieldNames=i._vrkFields;i.ViewModel.Validation={Required:$$WP.FormValidation.ValidationSettings.Required};i.ViewModel.Validation.StreetAddress=new $$WP.FormValidation.ValidationSettings({required:i.ViewModel.RequiredFieldNames.Street,maxLength:254});i.ViewModel.Validation.City=new $$WP.FormValidation.ValidationSettings({required:i.ViewModel.RequiredFieldNames.City,maxLength:50});i.ViewModel.Validation.HouseNumber=new $$WP.FormValidation.ValidationSettings({required:i.ViewModel.RequiredFieldNames.HouseNumber,maxLength:254});i.ViewModel.Validation.Building=new $$WP.FormValidation.ValidationSettings({required:i.ViewModel.RequiredFieldNames.Building,maxLength:254});i.ViewModel.Validation.Floor=new $$WP.FormValidation.ValidationSettings({required:i.ViewModel.RequiredFieldNames.Floor,maxLength:254});i.ViewModel.Validation.Unit=new $$WP.FormValidation.ValidationSettings({required:i.ViewModel.RequiredFieldNames.Unit,maxLength:18})},updateViewModel:function(){var u=this,h,c,l,a,v,y,p,w,f,o,s;u.$root!==r&&(h=$afe.select(t+u._prefix+"_HouseNumber",u.$root),c=$afe.select(t+u._prefix+"_Street",u.$root),l=$afe.select(t+u._prefix+"_City",u.$root),a=$afe.select(t+u._prefix+"_County",u.$root),v=$afe.select(t+u._prefix+"_State",u.$root),y=$afe.select(t+u._prefix+"_Zip",u.$root),p=$afe.select(t+u._prefix+e,u.$root),w=$afe.select(t+u._prefix+"_District",u.$root),u._isPatientAddress?(f=$afe.select(t+u._prefix+"_Building",u.$root),o=$afe.select(t+u._prefix+"_Floor",u.$root),s=$afe.select(t+u._prefix+"_Unit",u.$root)):(f=n,o=n,s=n),u.ViewModel=u.ViewModel||{},u.ViewModel.HouseNumber=i(h),u.ViewModel.Street=i(c),u.ViewModel.City=i(l),u.ViewModel.County.Number=i(a),u.ViewModel.State.Number=i(v),u.ViewModel.Zip=i(y),u.ViewModel.Country.Number=i(p),u.ViewModel.District.Number=i(w),u.ViewModel.Building=i(f),u.ViewModel.Floor=i(o),u.ViewModel.Unit=i(s))},getViewModel:function(){var n=this;return n.updateViewModel(),{HouseNumber:n.ViewModel.HouseNumber,Street:n.ViewModel.Street,City:n.ViewModel.City,County:{Number:n.ViewModel.County.Number},State:{Number:n.ViewModel.State.Number},Zip:n.ViewModel.Zip,Country:{Number:n.ViewModel.Country.Number},District:{Number:n.ViewModel.District.Number},Building:n.ViewModel.Building,Floor:n.ViewModel.Floor,Unit:n.ViewModel.Unit}},_trueRender:function(){var i=this,f;i.$root.empty();i.ViewModel.AddressConfiguration=i.ViewModel.Country!==r?u[String(i.ViewModel.Country.Number)]:u[i._defaultAddressConfiguration];i.$root.safeAppend($afe.renderTemplate($$WP.Templates.PersonalInformation.BaseAddress,i.ViewModel)).removeClass("loading");f=$afe.select(t+i._lastFocusedElementId);f.length!==0&&f.focus();i._lastFocusedElementId=n;i.afterRender()},render:function(){var i="change.addressCountryChange",n=this;if(n.$root.length!==0){document.activeElement!==r&&(n._lastFocusedElementId=document.activeElement.getAttribute("id"));n.$root.off(i).on(i,t+n._prefix+e,n._onCountryChanged);if(u[n.ViewModel.Country.Number]){n._trueRender();return}n.onDataLoadStart();n.$root.find("textarea,input,select").prop("disabled",!0);n.$root.addClass("loading").safePrepend($$WP.SimpleTemplates.Div({"class":"loadingIndicator"}).safeAppend($$WP.SimpleTemplates.Div({"class":"indicator"})));$.ajax({type:"POST",url:makeLink("PersonalInformation/GetAddressConfiguration"),data:{countryId:n.ViewModel.Country.Number,isPatientAddress:n._isPatientAddress,disableRTL:n.__disableRTL},dataType:"json",success:$.proxy(n._onAddressConfigurationLoadSuccess,n)})}},renderTo:function(n){this.$root=n;this.render()},afterRender:function(){}};i=function(n){return n.length===1?n.val():r};f.prototype=o;$$WP.PersonalInformation=$$WP.PersonalInformation||{};$$WP.PersonalInformation.AddressController=f;f.extend($$WP.Controllers.Controller,"WP$PersonalInformation$Controllers$AddressController")}(),function(){var g="#ContactInformation_TemporaryPhoneNumber",nt="buttonList right",tt=".formbuttons",it="#ContactInformation_WorkPhone",rt="#ContactInformation_MobilePhone",ut="#ContactInformation_HomePhone",ft="input, select, textarea",et=".permanentInformation .address",w="form",r="undefined",f="data-validation-settings",e="disabled",s=".saveButton",ot=".cancelButton",b="#ContactInformation_PreferredDevice",st="#ContactInformation_PermanentDefaultOverrideCheck",o="checked",ht="#ContactInformation_TemporaryDefaultOverrideCheck",n=!0,t=!1,i=null,a=".cardlist.matchHeights",ct="#ContactInformation_TemporaryEndDate_Calendar",lt="#ContactInformation_TemporaryStartDate_Calendar",h="#ContactInformation_TemporaryEndDate",c="#ContactInformation_TemporaryStartDate",at=".preferredDeviceSelector",u=$$WP.Controllers.EditableViewController,v=new Date(1841,0,1),y=new Date(2114,9,15),p,vt,yt,k,l,pt,d=function(n,t){var r="click",i=this;i._settings=t||new p;i.WP$Controllers$EditableViewController(n,$$WP.Templates.PersonalInformation.ContactInformation);i.$root.addClass("contact-information-content card col-6");$$WP.Utilities.UI.IsMobile||i.$root.addClass("withButton");i.$root.parents(".cardlist").trigger("cardLoad");i.proxify("_onAddTemporaryAddressClicked","_onRemoveTemporaryAddressClicked","_onPreferredDeviceSelectorClicked","_onStartDateUpdate","_onEndDateUpdate","_onStartDateCalendarClick","_onEndDateCalendarClick","_afterTemporaryAddressRender","_onAddressLoadStart","_onAddressLoadEnd","_addressAfterRender","_onAddressListSelect");i.$root.on(r,".addTemporaryAddressLink",i._onAddTemporaryAddressClicked);i.$root.on(r,".removeTemporaryAddressLink",i._onRemoveTemporaryAddressClicked);i.$root.on(r,at,i._onPreferredDeviceSelectorClicked);i.$root.on(r,".defaultSelect",i._onAddressListSelect);i.$root.on("blur",c,i._onStartDateUpdate);i.$root.on("blur",h,i._onEndDateUpdate);i.$root.on(r,lt,i._onStartDateCalendarClick);i.$root.on(r,ct,i._onEndDateCalendarClick);i.$root.on("keyup",".addressDefaultListItem",function(n){n.keyCode===13&&n.target.click()});$afe.select("body").on("input change focusout",$.proxy(function(){this.$root.parents(a).each($$WP.Utilities.UI.Cards.MatchHeights)},i))},bt={_addressData:i,_initialViewModel:i,_permanentAddressController:i,_temporaryAddressController:i,_pendingAddressLoads:0,_wasJumpedToEditMode:t,_settings:i,_permanentAddressIndex:-1,_temporaryAddressIndex:-1,_hasTemporaryAddressDefaults:t,_hasPermanentAddressDefaults:t,onEditClicked:function(t){var i=this;i._initialViewModel=$.extend(n,{},i.ViewModel);i.ViewModel.EditTemporaryAddress=!i.ViewModel.HideTemporaryAddress;i.WP$Controllers$EditableViewController$onEditClicked(t);$.isFunction(i._settings.onEditClickedCallback)&&i._settings.onEditClickedCallback()},onSaveClicked:function(r){var u=this;if(u._hasTemporaryAddressDefaults===n?u._hasTemporaryAddressDefaults=t:u._hasPermanentAddressDefaults=t,u._addressData!=i&&(u._hasPermanentAddressDefaults||u._hasTemporaryAddressDefaults)){u._moveToNextDefaultScreen();r.preventDefault();return}u.$root.find(ht).prop(o)===n&&(u._temporaryAddressIndex=-2);u.$root.find(st).prop(o)===n&&(u._permanentAddressIndex=-2);u.WP$Controllers$EditableViewController$onSaveClicked(r)},onCancelClicked:function(n){var t=this;t._resetDefaults();t.ViewModel=t._initialViewModel;t._permanentAddressController.setViewModel(t._initialViewModel.PermanentAddress);t.ViewModel.IsNonPatientProxyRecord||t.ViewModel.IsTemporaryAddressDisabled||t._temporaryAddressController.setViewModel(t._initialViewModel.TemporaryAddress);t.WP$Controllers$EditableViewController$onCancelClicked(n);$.isFunction(t._settings.onCancelClickedCallback)&&t._settings.onCancelClickedCallback()},_onAddTemporaryAddressClicked:function(i){var r=this;r.ViewModel.DisplayEditable?(r.ViewModel.EditTemporaryAddress=n,r.ViewModel.HideTemporaryAddress=t,r.ViewModel.RemoveTemporaryAddress=t,r._showOrHideTemporaryAddress(),i.preventDefault()):(r._initialViewModel=$.extend(n,{},r.ViewModel),r.ViewModel.EditTemporaryAddress=n,r.ViewModel.HideTemporaryAddress=t,r.ViewModel.RemoveTemporaryAddress=t,r.WP$Controllers$EditableViewController$onEditClicked(i));$.isFunction(r._settings.onEditTemporaryAddressCallback)&&r._settings.onEditTemporaryAddressCallback()},_onRemoveTemporaryAddressClicked:function(i){var r=this;r.ViewModel.EditTemporaryAddress=t;r.ViewModel.HideTemporaryAddress=n;r.ViewModel.RemoveTemporaryAddress=!r._initialViewModel.HideTemporaryAddress;r.ViewModel.TemporaryAddress.EndDateDisplay=formatDate(l());r.ViewModel.TemporaryAddress.StartDateDisplay&&parseDate(r.ViewModel.TemporaryAddress.StartDateDisplay,n)>l()&&(r.ViewModel.TemporaryAddress.StartDateDisplay=formatDate(l()));r._showOrHideTemporaryAddress();i.preventDefault()},_onPreferredDeviceSelectorClicked:function(i){var r="selected",u="input",f=$afe.jq(i.currentTarget);$afe.jq(i.target).is(u)||i.preventDefault();f.hasClass(r)?(f.removeClass(r).find(u).prop(o,t),$afe.select(b).val("")):(this.$root.find(at).removeClass(r).find(u).prop(o,t),f.addClass(r),$afe.select(b).val(f.find(u).prop(o,n).val()));this._setPreferredDeviceToBeRequired()},_onLoadSuccess:function(i){var o="function",r=this,u,f,e=t;for(r.ViewModel=i,r.ViewModel.IsNonPatientProxyRecord||r.ViewModel.IsTemporaryAddressDisabled||!r.ViewModel.TemporaryAddress.StartDateDisplay||r.ViewModel.TemporaryAddress.EndDateDisplay&&parseDate(r.ViewModel.TemporaryAddress.EndDateDisplay,n)<=l()?r.ViewModel.HideTemporaryAddress=n:(r._initialHideTemporaryAddress=t,r.ViewModel.EditTemporaryAddress=n,r.ViewModel.HideTemporaryAddress=t,r.ViewModel.RemoveTemporaryAddress=t,r._initialTemporaryAddressEndDate=r.ViewModel.TemporaryAddress?r.ViewModel.TemporaryAddress.EndDateDisplay:""),u={},f=0;f<r.ViewModel.RequiredFieldNames.length;f++)u[r.ViewModel.RequiredFieldNames[f]]=n;if(r.ViewModel.RequiredFieldNames=u,e=r.ViewModel.RequiredFieldNames.HomePhone&&!r.ViewModel.HomePhone||r.ViewModel.RequiredFieldNames.MobilePhone&&!r.ViewModel.MobilePhone||r.ViewModel.RequiredFieldNames.WorkPhone&&!r.ViewModel.WorkPhone||r.ViewModel.RequiredFieldNames.Email&&!r.ViewModel.Email,!r.ViewModel.PermanentAddress.IsViewOnly){for(u={},f=0;f<r.ViewModel.PermanentAddress.RequiredFieldNames.length;f++)u[r.ViewModel.PermanentAddress.RequiredFieldNames[f]]=n;e=e||u.HouseNumber&&!r.ViewModel.PermanentAddress.HouseNumber||u.Street&&!r.ViewModel.PermanentAddress.Street||u.City&&!r.ViewModel.PermanentAddress.City||u.County&&!r.ViewModel.PermanentAddress.County.Number||u.State&&!r.ViewModel.PermanentAddress.State.Number||u.Zip&&!r.ViewModel.PermanentAddress.Zip||u.Country&&!r.ViewModel.PermanentAddress.Country.Number||u.District&&!r.ViewModel.PermanentAddress.District.Number||u.Building&&!r.ViewModel.PermanentAddress.Building||u.Floor&&!r.ViewModel.PermanentAddress.Floor||u.Unit&&!r.ViewModel.PermanentAddress.Unit}if(!r.ViewModel.HideTemporaryAddress){for(u={},f=0;f<r.ViewModel.TemporaryAddress.RequiredFieldNames.length;f++)u[r.ViewModel.TemporaryAddress.RequiredFieldNames[f]]=n;e=e||u.HouseNumber&&!r.ViewModel.TemporaryAddress.HouseNumber||u.Street&&!r.ViewModel.TemporaryAddress.Street||u.City&&!r.ViewModel.TemporaryAddress.City||u.County&&!r.ViewModel.TemporaryAddress.County.Number||u.State&&!r.ViewModel.TemporaryAddress.State.Number||u.Zip&&!r.ViewModel.TemporaryAddress.Zip||u.Country&&!r.ViewModel.TemporaryAddress.Country.Number||u.District&&!r.ViewModel.TemporaryAddress.District.Number||u.Building&&!r.ViewModel.TemporaryAddress.Building||u.Floor&&!r.ViewModel.TemporaryAddress.Floor||u.Unit&&!r.ViewModel.TemporaryAddress.Unit}r.ViewModel.Validation={Required:$$WP.FormValidation.ValidationSettings.Required};r.ViewModel.Validation.Email=new $$WP.FormValidation.ValidationSettings({isEmail:n,required:r.ViewModel.RequiredFieldNames.Email===n});r.ViewModel.IsNonPatientProxyRecord||r.ViewModel.IsTemporaryAddressDisabled||(r.ViewModel.TemporaryAddress.Validation={},r.ViewModel.TemporaryAddress.Validation.StartDate=new $$WP.FormValidation.ValidationSettings({isDate:n,minDate:v,maxDate:r.ViewModel.TemporaryAddress.EndDateDisplay?parseDate(r.ViewModel.TemporaryAddress.EndDateDisplay,n):y,required:n}),r.ViewModel.TemporaryAddress.Validation.EndDate=new $$WP.FormValidation.ValidationSettings({isDate:n,minDate:r.ViewModel.TemporaryAddress.StartDateDisplay?parseDate(r.ViewModel.TemporaryAddress.StartDateDisplay,n):v,maxDate:y,required:n}),$.inArray("Phone",r.ViewModel.TemporaryAddress.RequiredFieldNames)!==-1&&(r.ViewModel.TemporaryAddress.IsPhoneRequired=n));r._permanentAddressController=new $$WP.PersonalInformation.AddressController("PermanentAddress",r.ViewModel.PermanentAddress,r.ViewModel.AddressConfiguration,r.ViewModel.PermanentAddress.RequiredFieldNames,!r.ViewModel.IsNonPatientProxyRecord,r._settings.disableRTL);r._permanentAddressController.onDataLoadStart=r._onAddressLoadStart;r._permanentAddressController.onDataLoadEnd=r._onAddressLoadEnd;r._permanentAddressController.afterRender=r._addressAfterRender;r.ViewModel.IsNonPatientProxyRecord||r.ViewModel.IsTemporaryAddressDisabled||(r._temporaryAddressController=new $$WP.PersonalInformation.AddressController("TemporaryAddress",r.ViewModel.TemporaryAddress,r.ViewModel.AddressConfiguration,r.ViewModel.TemporaryAddress.RequiredFieldNames,n,r._settings.disableRTL),r._temporaryAddressController.onDataLoadStart=r._onAddressLoadStart,r._temporaryAddressController.onDataLoadEnd=r._onAddressLoadEnd,r._temporaryAddressController.afterRender=r._addressAfterRender);r.focusAfterRender=r._focusOnLoad;r.render(e);r.focusAfterRender=n;typeof r._settings.onLoadSuccessCallback===o&&r._settings.onLoadSuccessCallback();e&&(r._initialViewModel=$.extend(n,{},r.ViewModel),r.ViewModel.EditTemporaryAddress=!r.ViewModel.HideTemporaryAddress,r.$root.find(ot).remove(),r._wasJumpedToEditMode=n,r._settings.isEmbedded||WP.Events.beforeUnload(),typeof r._settings.onEditClickedCallback===o&&r._settings.onEditClickedCallback())},_onSaveSuccess:function(r){var u=this,f,e;if(u._resetDefaults(),u.ViewModel.EditTemporaryAddress||delete r.ViewModel.TemporaryAddress,u.ViewModel.PermanentAddress.IsViewOnly&&delete r.ViewModel.PermanentAddress,delete r.ViewModel.RequiredFieldNames,delete r.ViewModel.IsNonPatientProxyRecord,delete r.ViewModel.IsTemporaryAddressDisabled,u.ViewModel.TemporaryAddress&&delete u.ViewModel.TemporaryAddress.FormattedValues,u.ViewModel.PermanentAddress&&delete u.ViewModel.PermanentAddress.FormattedValues,u.ViewModel=$.extend(n,{},u.ViewModel,r.ViewModel),r.Success)(u.ViewModel.EditTemporaryAddress||u.ViewModel.RemoveTemporaryAddress)&&(u.ViewModel.HideTemporaryAddress=u.ViewModel.TemporaryAddress.EndDateDisplay&&parseDate(u.ViewModel.TemporaryAddress.EndDateDisplay,n)<=l(),u.ViewModel.EditTemporaryAddress=t,u.ViewModel.RemoveTemporaryAddress=t),u._showNoMatches(t,t,t),u.render(t),u._wasJumpedToEditMode=t,u._permanentAddressController.setViewModel(u.ViewModel.PermanentAddress),u.ViewModel.IsNonPatientProxyRecord||u.ViewModel.IsTemporaryAddressDisabled||u._temporaryAddressController.setViewModel(u.ViewModel.TemporaryAddress),$.isFunction(u._settings.onSaveSuccessCallback)&&u._settings.onSaveSuccessCallback();else{if((r.ViewModel.TemporaryAddress!==i||r.ViewModel.PermanentAddress!==i)&&r.ViewModel.AllowDefaults?r.ViewModel.TemporaryAddress&&!r.ViewModel.TemporaryAddress.Success&&r.ViewModel.TemporaryDefaults.length===0||r.ViewModel.PermanentAddress&&!r.ViewModel.PermanentAddress.Success&&r.ViewModel.PermanentDefaults.length===0?(u.render(n),u._showNoMatches(r.ViewModel.TemporaryAddress&&!r.ViewModel.TemporaryAddress.Success&&r.ViewModel.TemporaryDefaults.length===0,r.ViewModel.PermanentAddress&&!r.ViewModel.PermanentAddress.Success&&r.ViewModel.PermanentDefaults.length===0,r.ViewModel.AllowArbitraryInput)):(u._addressData=r,r.ViewModel.TemporaryAddress&&!r.ViewModel.TemporaryAddress.Success&&r.ViewModel.TemporaryDefaults.length>0&&(u._hasTemporaryAddressDefaults=n),r.ViewModel.PermanentAddress&&!r.ViewModel.PermanentAddress.Success&&r.ViewModel.PermanentDefaults.length>0&&(u._hasPermanentAddressDefaults=n),u._moveToNextDefaultScreen()):u.render(n),u._wasJumpedToEditMode&&u.$root.find(ot).remove(),r.ViewModel.ValidationErrors)for(f=0;f<r.ViewModel.ValidationErrors.length;f++)e=$afe.select(pt(r.ViewModel.ValidationErrors[f].ErrorIndex)),$$WP.FormValidation.addValidationError(e,r.ViewModel.ValidationErrors[f].ErrorKey);u.$root.parents(a).each($$WP.Utilities.UI.Cards.MatchHeights)}$$WP.Utilities.UI.MatchColumnHeights()},_onAddressListSelect:function(i){var o="#default",r=this,f,u;f=$afe.jq(i.target);u=parseInt(f.safeAttr("data-id"));r._hasTemporaryAddressDefaults?u===r._temporaryAddressIndex?($$WP.Utilities.UI.ToggleButtonClick(f,i,0),r._temporaryAddressIndex=-1,u=-1):(r._temporaryAddressIndex!==-1&&$$WP.Utilities.UI.ToggleButtonClick($(r.$root.find(o+r._temporaryAddressIndex)),i,0),$$WP.Utilities.UI.ToggleButtonClick(f,i,0),r._temporaryAddressIndex=u):r._hasPermanentAddressDefaults&&(u===r._permanentAddressIndex?($$WP.Utilities.UI.ToggleButtonClick(f,i,0),r._permanentAddressIndex=-1,u=-1):(r._permanentAddressIndex!==-1&&$$WP.Utilities.UI.ToggleButtonClick($(r.$root.find(o+r._permanentAddressIndex)),i,0),$$WP.Utilities.UI.ToggleButtonClick(f,i,0),r._permanentAddressIndex=u));u!==-1?r.$root.find(s).prop(e,t):r.$root.find(s).prop(e,n)},_onStartDateUpdate:function(t){var i=this.ViewModel.TemporaryAddress.Validation.EndDate;i.minDate=t.currentTarget.value?parseDate(t.currentTarget.value,n):v;$afe.select(h).safeAttr(f,i.toJSON());$afe.select("#ContactInformation_TemporaryEndDate.invalid").change()},_onStartDatePicked:function(n,t,i){typeof n!==r&&typeof t!==r&&typeof i!==r&&$afe.select(c).val(formatDate(new Date(n,t,i))).change().focus()},_onEndDatePicked:function(n,t,i){typeof n!==r&&typeof t!==r&&typeof i!==r&&$afe.select(h).val(formatDate(new Date(n,t,i))).change().focus()},_onEndDateUpdate:function(t){var i=this.ViewModel.TemporaryAddress.Validation.StartDate;i.maxDate=t.currentTarget.value?parseDate(t.currentTarget.value,n):y;$afe.select(c).safeAttr(f,i.toJSON());$afe.select("#ContactInformation_TemporaryStartDate.invalid").change()},_onStartDateCalendarClick:function(){var i=$afe.select(lt),t=$afe.select(c);new DateChooser(i[0],this._onStartDatePicked,vt,parseDate(t.val(),n),t).drawCalendar()},_onEndDateCalendarClick:function(){var i=$afe.select(ct),t=$afe.select(h);new DateChooser(i[0],this._onEndDatePicked,yt,parseDate(t.val(),n),t).drawCalendar()},_onAddressLoadStart:function(){this._pendingAddressLoads++;this.$root.find(s).prop(e,n)},_onAddressLoadEnd:function(){this._pendingAddressLoads--},_addressAfterRender:function(){var t=this;$$WP.FormValidation.initializeDOMSubtree(t.$root.find(w));t._pendingAddressLoads>1&&t.$root.find(s).prop(e,n);t.ViewModel.PermanentAddress.IsViewOnly&&t.$root.find(et).find(ft).prop(e,n);t.$root.parent(a).each($$WP.Utilities.UI.Cards.MatchHeights)},_setPreferredDeviceToBeRequired:function(){var l="label[for='ContactInformation_WorkPhone']",a="label[for='ContactInformation_MobilePhone']",i="aria-required",r="required",v="label[for='ContactInformation_HomePhone']",c=".preferredDeviceSelector.selected",u,e,o,s,h;s=$$WP.FormValidation.ValidationSettings.Required.toJSON();h=$$WP.FormValidation.ValidationSettings.None.toJSON();this.ViewModel.RequiredFieldNames.HomePhone||(u=$afe.select(ut),u.siblings(c).length?($afe.select(v).addClass(r),u.safeAttr(f,s).safeAttr(i,n).change()):($afe.select(v).removeClass(r),u.safeAttr(f,h).safeAttr(i,t).change()));this.ViewModel.RequiredFieldNames.MobilePhone||(e=$afe.select(rt),e.siblings(c).length?($afe.select(a).addClass(r),e.safeAttr(f,s).safeAttr(i,n).change()):($afe.select(a).removeClass(r),e.safeAttr(f,h).safeAttr(i,t).change()));this.ViewModel.RequiredFieldNames.WorkPhone||(o=$afe.select(it),o.siblings(c).length?($afe.select(l).addClass(r),o.safeAttr(f,s).safeAttr(i,n).change()):($afe.select(l).removeClass(r),o.safeAttr(f,h).safeAttr(i,t).change()))},_showNoMatches:function(n,t,i){var e=".permanentInformation p.buttoncheck",o=".permanentInformation .noMatchesMessage",s=".permanentInformation",h="unchecked",c="hidden checked",l=".temporaryInformation p.buttoncheck",u="hidden",a=".temporaryInformation .noMatchesMessage",f="noMatchesContainer",v=".temporaryInformation",r=this;n?(r.$root.find(v).addClass(f),r.$root.find(a).removeClass(u),i&&r.$root.find(l).removeClass(c).addClass(h)):(r.$root.find(v).removeClass(f),r.$root.find(a).addClass(u),r.$root.find(l).addClass(u));t?(r.$root.find(s).addClass(f),r.$root.find(o).removeClass(u),i&&r.$root.find(e).removeClass(c).addClass(h)):(r.$root.find(s).removeClass(f),r.$root.find(o).addClass(u),r.$root.find(e).addClass(u));(n||t)&&setupButtoncheck(r.$root.find(w))},_moveToNextDefaultScreen:function(){var t="PersonalInformation.ContactInformation",n=this,r;(n._hasPermanentAddressDefaults||n._hasTemporaryAddressDefaults)&&n._addressData!==i&&(n.$root.empty(),r=n._hasTemporaryAddressDefaults?{DefaultList:n._addressData.ViewModel.TemporaryDefaults,EnteredAddress:n._addressData.ViewModel.TemporaryAddress,Title:$$WP.Strings.get("TemporaryAddressLabel",t),AllowArbitraryInput:n._addressData.ViewModel.AllowArbitraryInput}:{DefaultList:n._addressData.ViewModel.PermanentDefaults,EnteredAddress:n._addressData.ViewModel.PermanentAddress,Title:$$WP.Strings.get("PermanentAddressLabel",t),AllowArbitraryInput:n._addressData.ViewModel.AllowArbitraryInput},n.$root.safeAppend($afe.renderTemplate($$WP.Templates.PersonalInformation.AddressDefaultsCard,r)),$$WP.Utilities.UI.IsMobile&&n.$root.find(tt).removeClass(nt),n.$root.find(".addressList .togglebutton").first().focus())},_resetDefaults:function(){var n=this;n._addressData=i;n._hasTemporaryAddressDefaults=t;n._hasPermanentAddressDefaults=t;n._temporaryAddressIndex=-1;n._permanentAddressIndex=-1;n.$root.find(ht).prop(o,t);n.$root.find(st).prop(o,t)},_afterTemporaryAddressRender:function(){var t=this;$$WP.FormValidation.checkIfFormIsValid(t.$root.find(w),n);t._pendingAddressLoads>0&&t.$root.find(s).prop(e,n);t.$root.parent(a).each($$WP.Utilities.UI.Cards.MatchHeights);t.WP$Controllers$EditableViewController$afterRender()},_showOrHideTemporaryAddress:function(){var n=".temporaryAddressContent",t=".addTemporaryAddressLinkContainer",i=".permanentHeader";this.ViewModel.EditTemporaryAddress?($afe.select(i).show(),$afe.select(t).hide(),$afe.select(n).slideDown(500,this._afterTemporaryAddressRender)):($afe.select(i).hide(),$afe.select(t).show(),$afe.select(n).slideUp(500,this._afterTemporaryAddressRender))},loadData:function(){var n=this,t={useLoginUserEpt:n._settings.useLoginUserEpt,disableRTL:n._settings.disableRTL};$.ajax({type:"POST",url:makeLink("PersonalInformation/GetContactInformation"),data:$$WPUtil.postify(t),dataType:"json",success:$.proxy(n._onLoadSuccess,n)})},saveData:function(){var t=this,u,r,f;t.$root.find(".loadingIndicator").show();t.updateViewModel();r=i;(t.ViewModel.EditTemporaryAddress||t.ViewModel.RemoveTemporaryAddress)&&(t.ViewModel.EditTemporaryAddress&&t.ViewModel.AddressConfiguration.AddressHxEnabled&&!t.ViewModel.TemporaryAddress.StartDateDisplay&&(t.ViewModel.TemporaryAddress.StartDateDisplay=formatDate(new Date)),t.ViewModel.TemporaryAddress.StartDateISO=k(t.ViewModel.TemporaryAddress.StartDateDisplay),t.ViewModel.TemporaryAddress.EndDateISO=k(t.ViewModel.TemporaryAddress.EndDateDisplay),t._temporaryAddressIndex===-1||t._addressData===i?r=$.extend(n,{},t.ViewModel.TemporaryAddress):t._temporaryAddressIndex===-2?(r=t._addressData.ViewModel.TemporaryAddress,r.StartDateISO=t.ViewModel.TemporaryAddress.StartDateISO,r.EndDateISO=t.ViewModel.TemporaryAddress.EndDateISO):(r=t._addressData.ViewModel.TemporaryDefaults[t._temporaryAddressIndex],r.StartDateISO=t.ViewModel.TemporaryAddress.StartDateISO,r.EndDateISO=t.ViewModel.TemporaryAddress.EndDateISO),delete r.Validation);f=t._permanentAddressIndex===-1||t._addressData===i?t.ViewModel.PermanentAddress:t._permanentAddressIndex===-2?t._addressData.ViewModel.PermanentAddress:t._addressData.ViewModel.PermanentDefaults[t._permanentAddressIndex];u={PermanentAddress:f,TemporaryAddress:r,Email:t.ViewModel.Email,MobilePhone:t.ViewModel.MobilePhone,HomePhone:t.ViewModel.HomePhone,WorkPhone:t.ViewModel.WorkPhone,PreferredDevice:t.ViewModel.PreferredDevice};$.ajax({type:"POST",url:makeLink("PersonalInformation/UpdateContactInformation"),data:{viewModelJson:JSON.stringify(u),useLoginUserEpt:t._settings.useLoginUserEpt,needTempDefault:t._temporaryAddressIndex!==-2,needPermDefault:t._permanentAddressIndex!==-2,disableRTL:t._settings.disableRTL},dataType:"json",success:$.proxy(t._onSaveSuccess,t)});t.WP$Controllers$EditableViewController$afterRender()},updateViewModel:function(){var t=this,i,r,f,e,o,s,l,a,v,y,p;t.$root.find(".addressDefaults").length>0||(t.ViewModel.EditTemporaryAddress&&(e=$afe.select(g,t.$root),o=$afe.select(c,t.$root),s=$afe.select(h,t.$root),t.ViewModel=t.ViewModel||{},t.ViewModel.TemporaryAddress=t.ViewModel.TemporaryAddress||{},i=t.ViewModel.TemporaryAddress.RequiredFieldNames,f=t.ViewModel.TemporaryAddress.Validation,r=t.ViewModel.TemporaryAddress.FormattedValues,t.ViewModel.TemporaryAddress=t._temporaryAddressController.getViewModel(),t.ViewModel.TemporaryAddress.PhoneNumber=u.getValIfExists(e),t.ViewModel.TemporaryAddress.StartDateDisplay=u.getValIfExists(o),t.ViewModel.TemporaryAddress.EndDateDisplay=u.getValIfExists(s),t.ViewModel.TemporaryAddress.RequiredFieldNames=i,t.ViewModel.TemporaryAddress.Validation=f,t.ViewModel.TemporaryAddress.FormattedValues=r,$.inArray("Phone",i)!==-1&&(t.ViewModel.TemporaryAddress.IsPhoneRequired=n)),t.ViewModel=t.ViewModel||{},t.ViewModel.PermanentAddress=t.ViewModel.PermanentAddress||{},t.ViewModel.PermanentAddress.IsViewOnly||(i=t.ViewModel.PermanentAddress.RequiredFieldNames,r=t.ViewModel.PermanentAddress.FormattedValues,t.ViewModel.PermanentAddress=t._permanentAddressController.getViewModel(),t.ViewModel.PermanentAddress.RequiredFieldNames=i,t.ViewModel.PermanentAddress.FormattedValues=r),l=$afe.select(ut,t.$root),a=$afe.select(rt,t.$root),v=$afe.select(it,t.$root),y=$afe.select("#ContactInformation_Email",t.$root),p=$afe.select(b,t.$root),t.ViewModel=t.ViewModel||{},t.ViewModel.HomePhone=u.getValIfExists(l),t.ViewModel.MobilePhone=u.getValIfExists(a),t.ViewModel.WorkPhone=u.getValIfExists(v),t.ViewModel.Email=u.getValIfExists(y),t.ViewModel.PreferredDevice=u.getValIfExists(p))},afterRender:function(){var t=this;t.ViewModel.DisplayEditable?(t._permanentAddressController.renderTo(t.$root.find(".permanentAddress")),t.ViewModel.IsNonPatientProxyRecord||t.ViewModel.IsTemporaryAddressDisabled||t._temporaryAddressController.renderTo(t.$root.find(".temporaryAddress")),t._settings.isEmbedded||WP.Events.beforeUnload()):t._settings.isEmbedded||WP.Events.cancelBeforeUnload();t.ViewModel.PermanentAddress.IsViewOnly&&$afe.select(et).find(ft).prop(e,n);t._showOrHideTemporaryAddress();t._setPreferredDeviceToBeRequired();$$WP.FormValidation.initializeDOMSubtree(t.$root);t._pendingAddressLoads>0&&t.$root.find(s).prop(e,n);t.$root.find(".hideLongContentWithEllipses").each(function(){if(this.getClientRects().length>1){var n=$afe.jq(this);n.addClass("overflowHiddenWithEllipses").safeAttr("title",n.text())}});t.$root.parent(a).each($$WP.Utilities.UI.Cards.MatchHeights);$$WP.Utilities.UI.IsMobile&&t.$root.find(tt).removeClass(nt);t.WP$Controllers$EditableViewController$afterRender()}},wt;vt=function(t,i,u){var f,e;return typeof t!==r&&typeof i!==r&&typeof u!==r?(f=$afe.select(h).val(),e=new Date(t,i,u),v<=e&&e<=(f?parseDate(f,n):y)):n};yt=function(t,i,u){var f,e;return typeof t!==r&&typeof i!==r&&typeof u!==r?(f=$afe.select(c).val(),e=new Date(t,i,u),(f?parseDate(f,n):v)<=e&&e<=y):n};k=function(n){return n?$$WP.I18N.parseDate(n).toISOString().split("T")[0]:""};l=function(){var n=new Date;return n.setDate(n.getDate()-1),n};pt=function(n){switch(n){case"PermanentAddress.Zip":return"#PermanentAddress_Zip";case"TemporaryAddress.Zip":return"#TemporaryAddress_Zip";case"TemporaryPhone":return g;case"HomePhone":case"MobilePhone":case"WorkPhone":return"#ContactInformation_"+n}return""};p=function(){};wt={onEditClickedCallback:i,onSaveSuccessCallback:i,onCancelClickedCallback:i,onEditTemporaryAddressCallback:i,onLoadSuccessCallback:i,useLoginUserEpt:t,focusOnLoad:n,isEmbedded:t,disableRTL:t};d.prototype=bt;p.prototype=wt;$$WP.PersonalInformation=$$WP.PersonalInformation||{};$$WP.PersonalInformation.ContactInformationController=d;$$WP.PersonalInformation.ContactInformationSettings=p;d.extend(u,"WP$PersonalInformation$Controllers$ContactInformationController");p.extend($$WP.BaseObject,"WP$PersonalInformation$Controllers$ContactInformationSettings")}(),function(){var e=".cancelButton",t=!0,n=!1,i=null,f=".cardlist.matchHeights",u,o,r=function(n,t){var i=this;i._settings=t||new u;i.WP$Controllers$EditableViewController(n,$$WP.Templates.PersonalInformation.OtherInformation);i.$root.addClass("other-information-content card col-6");$$WP.Utilities.UI.IsMobile||i.$root.addClass("withButton");i.$root.parents(".cardlist").trigger("cardLoad");i.$root.on("submit",function(n){n.preventDefault()});$afe.select("body").on("input change focusout",$.proxy(function(){this.$root.parents(f).each($$WP.Utilities.UI.Cards.MatchHeights)},i))},h={_settings:i,_initialViewModel:i,_wasJumpedToEditMode:n,_onLoadSuccess:function(i){var s="function",u=this,o,f,h=n;if(u.ViewModel=i,u.ViewModel.Fields.length===0){u.$root.hide();typeof u._settings.onLoadSuccessCallback===s&&u._settings.onLoadSuccessCallback();return}if(!r.WereRELFieldsShown)for(f=0;f<u.ViewModel.Fields.length;f++)(u.ViewModel.Fields[f].FieldId==="7"||u.ViewModel.Fields[f].FieldId==="8"||u.ViewModel.Fields[f].FieldId==="9"||u.ViewModel.Fields[f].FieldId==="10")&&(r.WereRELFieldsShown=t);for(o=0;o<u.ViewModel.Fields.length;o++)u.ViewModel.Fields[o].Type===1&&u.ViewModel.Fields[o].Values[0].length===0&&(u.ViewModel.Fields[o].Values=[]);for(u.ViewModel.ValidationSettings=$$WP.FormValidation.ValidationSettings.Required,f=0;f<u.ViewModel.Fields.length;f++)u.ViewModel.Fields[f].IsRequired&&(u.ViewModel.Fields[f].Type===1&&u.ViewModel.Fields[f].Values[0]===""||u.ViewModel.Fields[f].Values.length===0)&&(h=t);u.render(h);typeof u._settings.onLoadSuccessCallback===s&&u._settings.onLoadSuccessCallback();h&&(u._initialViewModel=$.extend(t,{},u.ViewModel),u.$root.find(e).remove(),u._wasJumpedToEditMode=t,u._settings.isEmbedded||WP.Events.beforeUnload(),typeof u._settings.onEditClickedCallback===s&&u._settings.onEditClickedCallback())},_onSaveSuccess:function(i){for(var u=this,s,r=0;r<i.ViewModel.Fields.length;r++)delete i.ViewModel.Fields[r].IsRequired;if(u.ViewModel=$.extend(t,{},u.ViewModel,i.ViewModel),i.Success){for(r=0;r<u.ViewModel.Fields.length;r++)u.ViewModel.Fields[r].Type===1&&u.ViewModel.Fields[r].Values[0].length===0&&(u.ViewModel.Fields[r].Values=[]);u.render(n);u._wasJumpedToEditMode=n;$.isFunction(u._settings.onSaveSuccessCallback)&&u._settings.onSaveSuccessCallback()}else{if(u.render(t),u._wasJumpedToEditMode&&u.$root.find(e).remove(),i.ViewModel.ValidationErrors)for(r=0;r<i.ViewModel.ValidationErrors.length;r++)s=$afe.select(o(i.ViewModel.ValidationErrors[r].ErrorIndex)),$$WP.FormValidation.addValidationError(s,i.ViewModel.ValidationErrors[r].ErrorKey);u.$root.parents(f).each($$WP.Utilities.UI.Cards.MatchHeights)}},onEditClicked:function(n){var i=this;i._initialViewModel=$.extend(t,{},i.ViewModel);i.WP$Controllers$EditableViewController$onEditClicked(n);$.isFunction(i._settings.onEditClickedCallback)&&i._settings.onEditClickedCallback()},onSaveClicked:function(n){this.WP$Controllers$EditableViewController$onSaveClicked(n)},onCancelClicked:function(n){var t=this;t.ViewModel=t._initialViewModel;t.WP$Controllers$EditableViewController$onCancelClicked(n);$.isFunction(t._settings.onCancelClickedCallback)&&t._settings.onCancelClickedCallback()},_getPostableViewModel:function(){for(var t=this,r,i,u=[],n=0;n<t.ViewModel.Fields.length;n++){if(t.ViewModel.Fields[n].Type===1)r=t.ViewModel.Fields[n].Values.length?t.ViewModel.Fields[n].Values:[""];else for(r=[],i=0;i<t.ViewModel.Fields[n].Categories.length;i++)t.ViewModel.Fields[n].Categories[i].IsSelected&&r.push(t.ViewModel.Fields[n].Categories[i].Number);u.push({FieldId:t.ViewModel.Fields[n].FieldId,Type:t.ViewModel.Fields[n].Type,Values:r})}return{Fields:u,disableRTL:t._settings.disableRTL}},loadData:function(){var n=this;$.ajax({type:"POST",url:makeLink("PersonalInformation/GetOtherInformation?checkRELFrequency="+n._settings.checkRELFrequency),data:$$WPUtil.postify({disableRTL:n._settings.disableRTL}),dataType:"json",success:$.proxy(n._onLoadSuccess,n)})},saveData:function(){var n=this;n.$root.find(".loadingIndicator").show();n.updateViewModel();$.ajax({type:"POST",url:makeLink("PersonalInformation/UpdateOtherInformation"),data:$$WPUtil.postify(n._getPostableViewModel()),dataType:"json",success:$.proxy(n._onSaveSuccess,n)})},afterRender:function(){var n=this;n._settings.isEmbedded||(n.ViewModel.DisplayEditable?WP.Events.beforeUnload():WP.Events.cancelBeforeUnload());$$WP.FormValidation.initializeDOMSubtree(n.$root);n.$root.find(".hideLongContentWithEllipses").each(function(){if(this.getClientRects().length>2){var n=$afe.jq(this);n.addClass("overflowHiddenWithEllipses").safeAttr("title",n.text())}});n.$root.parent(f).each($$WP.Utilities.UI.Cards.MatchHeights);$$WP.Utilities.UI.IsMobile&&n.$root.find(".formbuttons").removeClass("buttonList right");typeof n._settings.focusAfterRender!="undefined"&&(n.focusAfterRender=n._settings.focusAfterRender);n.WP$Controllers$EditableViewController$afterRender()},updateViewModel:function(){var f="disabled",e=".button, input, select, textarea",u=this,o,i,r;for(u.$root.find(e).prop(f,n),o=u.$root.find("form").serializeArray(),u.$root.find(e).prop(f,t),i=0;i<u.ViewModel.Fields.length;i++){if(u.ViewModel.Fields[i].Values=[],u.ViewModel.Fields[i].Type!==1)for(r=0;r<u.ViewModel.Fields[i].Categories.length;r++)u.ViewModel.Fields[i].Categories[r].IsSelected=n;$.each(o,$.proxy(function(n,u){var f=this;if(f.ViewModel.Fields[i].FieldId===u.name){if(f.ViewModel.Fields[i].Type===1)u.value&&f.ViewModel.Fields[i].Values.push(u.value);else for(r=0;r<f.ViewModel.Fields[i].Categories.length;r++)if(f.ViewModel.Fields[i].Categories[r].Number===u.value){f.ViewModel.Fields[i].Categories[r].IsSelected=t;f.ViewModel.Fields[i].Values.push(f.ViewModel.Fields[i].Categories[r].Title);break}return}},u))}}},s;o=function(){return"#OtherInformation_1"};u=function(){};s={checkRELFrequency:n,onEditClickedCallback:i,onSaveSuccessCallback:i,onCancelClickedCallback:i,onEditTemporaryAddressCallback:i,onLoadSuccessCallback:i,isEmbedded:n,disableRTL:n};r.prototype=h;r.WereRELFieldsShown=r.WereRELFieldsShown||n;u.prototype=s;$$WP.PersonalInformation=$$WP.PersonalInformation||{};$$WP.PersonalInformation.OtherInformationController=r;$$WP.PersonalInformation.OtherInformationSettings=u;r.extend($$WP.Controllers.EditableViewController,"WP$PersonalInformation$Controllers$OtherInformationController");u.extend($$WP.BaseObject,"WP$PersonalInformation$Controllers$OtherInformationSettings")}(),function(){var r="[data-id='demographicsVerifyButton']",n=!0,i=!1,t=null,o=$$WP.Scheduling.Slot,u=function(n,i,r,u){var f=this;f.proxify("updateStep","_onVerifyClick","_onSelectionChange","_onContactCardEdit","_onContactCardSaved","_onTemporaryAddressEdit","_onVerifyDemographicsSuccess");f.$demogContainer=$$WP.SimpleTemplates.Div({"class":"demogcontainer"});f.$otherInfoContainer=$$WP.SimpleTemplates.Div({"class":"otherInfoContainer"});f.$root=n;f._showStep=r;f.__disableRTL=u;f.WP$Scheduling$StepController(n,i,t,t,t,$$WP.Templates.Scheduling.DemographicsVerification,$$WP.Templates.Scheduling.DemographicsVerification)},f={$demogContainer:t,$otherInfoContainer:t,$root:t,ContactInformationController:t,OtherInformationController:t,_cardsBeingEdited:0,_showStep:i,_verified:i,__disableRTL:i,updateViewModel:function(){var t=this,r=t.Data.SchedulingSteps.getFromIndex("ID",t.Id).isComplete===$$WP.Scheduling.SchedulingStep.CompleteEnum.Complete;t.ViewModel={Count:0,StepShouldBeActive:i,Incomplete:!r};t._showStep?t.ViewModel={Count:0,ShowOtherInformation:n,StepShouldBeActive:n,StepControllerId:t.Id,Incomplete:!r}:t.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.NotRequired)},afterRender:function(){var e=".contactCards > .row",t=this,u,f;t._cardsBeingEdited=0;u=new $$WP.PersonalInformation.ContactInformationSettings;u.jumpToEditModeWithMissingRequiredFields=n;u.onEditClickedCallback=t._onContactCardEdit;u.onEditTemporaryAddressCallback=t._onTemporaryAddressEdit;u.onCancelClickedCallback=t._onContactCardSaved;u.onSaveSuccessCallback=t._onContactCardSaved;u.isEmbedded=n;u.disableRTL=t.__disableRTL;f=new $$WP.PersonalInformation.OtherInformationSettings;f.jumpToEditModeWithMissingRequiredFields=n;f.onEditClickedCallback=t._onContactCardEdit;f.onCancelClickedCallback=t._onContactCardSaved;f.onSaveSuccessCallback=t._onContactCardSaved;f.checkRELFrequency=n;f.isEmbedded=n;f.disableRTL=t.__disableRTL;t.ContactInformationController=new $$WP.PersonalInformation.ContactInformationController(t.$demogContainer,u);t.OtherInformationController=new $$WP.PersonalInformation.OtherInformationController(t.$otherInfoContainer,f);t.$root.find(e).safeAppend(t.$demogContainer);t.$root.find(e).safeAppend(t.$otherInfoContainer);t.$root.find(r).on("click",t._onVerifyClick);t.$root.find("h2.header").focus();$afe.select(".cardlist.matchHeights").each($$WP.Utilities.UI.Cards.MatchHeights);$$WP.Utilities.UI.MatchColumnHeights();t._verified=i},_onTemporaryAddressEdit:function(){this._cardsBeingEdited--;this._onContactCardEdit()},_onContactCardEdit:function(){this._cardsBeingEdited++;this.$root.find(r).hide();this.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete);$$WP.Utilities.UI.MatchColumnHeights()},_onContactCardSaved:function(){var n=this;n._cardsBeingEdited--;n._cardsBeingEdited<=0&&(n._cardsBeingEdited=0,n.$root.find(r).show());$$WP.Utilities.UI.MatchColumnHeights()},_onSelectionChange:function(){this.Active||this.updateStep()},_onVerifyClick:function(){if(!this.Data.BlockDemographicInsuranceVerification){var n=$$WP.PersonalInformation.OtherInformationController.WereRELFieldsShown;$.post({url:e,data:{verifyREL:n},cache:i,success:this._onVerifyDemographicsSuccess})}},_onVerifyDemographicsSuccess:function(){var t=this;t._verified||(t._verified=n,t.$root.find(r).hide(),t.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Complete))}},e=makeLink("PersonalInformation/VerifyPatientInformation");u.prototype=f;$$WP.Scheduling.DemographicVerificationStepController=u;u.extend($$WP.Scheduling.StepController,"WP$Scheduling$DemographicVerificationStepController")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var n=$$WP.Scheduling.Workflow,t=function(n,t,i){var r=this;r.WP$Controllers$Controller();r.proxify("_update");r._linksSidebarWidget=n;r._workflow=t;r._workflowSettings=i;r._update()},i={_linksSidebarWidget:null,_workflow:null,_workflowSettings:null,_update:function(){this._linksSidebarWidget&&this._linksSidebarWidget.update(this._getLinksViewModel())},_getLinksViewModel:function(){var r="Scheduling/OnMyWay/PostLogin",u="OpenScheduling/PostLogin",f="inside.asp?mode=evisit",e="Scheduling?workflow=OnDemandTelehealth",i=this,t;return t={},t.NumLinks=0,t.ShowDisclaimer=!1,i._workflowSettings.ShowSidebarLinks&&(i._workflow?(i._workflow.Type===n.WorkflowTypesEnum.OnDemandTelehealth&&(t.ShowDisclaimer=!0),i._workflow.Type!==n.WorkflowTypesEnum.Reschedule&&i._workflow.Type!==n.WorkflowTypesEnum.OnDemandTelehealth&&(i._workflowSettings.HasOnDemandVideoVisitSecurity||i._workflowSettings.HasQuickScheduleSecurity)&&(t.VideoVisitQuickLink=makeLink(e),t.NumLinks++),i._workflow.Type!==n.WorkflowTypesEnum.Reschedule&&i._workflowSettings.HasEvisitSecurity&&(t.EVisitQuickLink=makeLink(f),t.NumLinks++),i._workflow.Type!==n.WorkflowTypesEnum.Reschedule&&i._workflow.Type!==n.WorkflowTypesEnum.OnDemandTelehealth&&i._workflowSettings.AllowOpenSchedulingWizard&&(t.OpenSchedulingWizardLink=makeLink(u),t.NumLinks++),i._workflow.Type!==n.WorkflowTypesEnum.Reschedule&&i._workflowSettings.AllowOnMyWay&&(t.OnMyWayLink=makeLink(r),t.NumLinks++),i._workflow.ShowSchedulingHubLink&&(t.HubLink=makeLink("Scheduling"),t.NumLinks++)):((i._workflowSettings.HasOnDemandVideoVisitSecurity||i._workflowSettings.HasQuickScheduleSecurity)&&(t.VideoVisitQuickLink=makeLink(e),t.NumLinks++),i._workflowSettings.HasEvisitSecurity&&(t.EVisitQuickLink=makeLink(f),t.NumLinks++),i._workflowSettings.AllowOpenSchedulingWizard&&(t.OpenSchedulingWizardLink=makeLink(u),t.NumLinks++),i._workflowSettings.AllowOnMyWay&&(t.OnMyWayLink=makeLink(r),t.NumLinks++))),t}};t.prototype=i;$$WP.Scheduling.SidebarController=t;t.extend($$WP.Controllers.Controller,"WP$Scheduling$SidebarController")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var c="[data-model-id]",u="ID",s="data-model-id",t=!0,i=!1,h="[data-type]",n=null,f=$$WP.Common.Model,e=$$WP.Scheduling.Workflow,r={Workflow:"workflow",Provider:"provider",ReasonForVisit:"rfv",Slot:"slot"},o=function(t,i){var u=".card.favorite .removeButton",r=this;r.WP$Scheduling$StepController(t,n,n,n,n,$$WP.Templates.Scheduling.LandingPage);r.proxify("updateStep","_onWorkflowElementClick","_onRemoveFavoriteButtonClicked","_onRemoveFavoriteButtonKeyPress","_onRemoveFavoritePopupButtonClicked");r._workflows=i;r._providerWorkflow=r._workflows.getFromIndex("Id","ExistingProvider");r._reasonWorkflow=r._workflows.getFromIndex("Id","Procedure");r._isMobile=$$WP.Utilities.UI.IsMobile;r.$root.on("click",h,r._onWorkflowElementClick);r._workflows.addCollectionEventListener("remove",r.updateStep);r.$root.on("click",u,r._onRemoveFavoriteButtonClicked);r.$root.on("keypress",u,r._onRemoveFavoriteButtonKeyPress)},l={$root:n,_workflows:n,_providerWorkflow:n,_reasonWorkflow:n,_isMobile:i,_isFirstRender:t,_loadOneClickSlots:function(){var n,i,t;if(n=this._workflows.getFromIndex("Type",e.WorkflowTypesEnum.Ticket),n&&n.length!==0)for(t=0;t<n.length;t++)i=n[t],i.SchedulingDataPool.SlotLoader.loadOneClickTicketSlots(i.TicketInfo.TicketId,this.updateStep)},updateViewModel:function(){var r=this;r.ViewModel={Workflows:n,Count:0,StepShouldBeActive:t,HasDirectOptions:i,Providers:n,ReasonsForVisit:n,CardColumns:n,SideBySide:i,HasTickets:i,TicketWorkflows:n,HasFavorites:i,FavoriteAppointmentWorkflows:n,HasTicketsOrFavorites:i,ShouldFadeIn:i,DataTypes:n,HasMultipleOptionsInMobile:i};r.__updateProvidersWorkflowViewModel();r.__updateReasonsForVisitWorkflowViewModel();r.__updateCardDisplay();r.__updateTicketWorkflowsViewModel();r.__updateFavoriteAppointmentWorkflowsViewModel();r.ViewModel.HasTicketsOrFavorites=r.ViewModel.HasTickets||r.ViewModel.HasFavorites;r.ViewModel.HasMultipleOptionsInMobile=r.ViewModel.Count>1&&r._isMobile;r.ViewModel.ShouldFadeIn=r._isFirstRender},__updateProvidersWorkflowViewModel:function(){var n=this,i;n._providerWorkflow&&(i=n._buildProviderArray(),n.ViewModel.Providers=i,i.length>0&&(n.ViewModel.Count++,n.ViewModel.HasDirectOptions=t),n.ViewModel.ProvidersWorkflow=n._providerWorkflow)},__updateReasonsForVisitWorkflowViewModel:function(){var n=this,i;n._reasonWorkflow&&(i=n._getUnfilteredReasonsForVisit(),n.ViewModel.ReasonsForVisit=i,i.length>0&&(n.ViewModel.Count++,n.ViewModel.HasDirectOptions=t),n.ViewModel.ReasonsForVisitWorkflow=n._reasonWorkflow)},__updateCardDisplay:function(){var n=this;n.ViewModel.Count!==2||isDataTile()?n.ViewModel.Count===2&&isDataTile()?(n.ViewModel.CardColumns=12,n.ViewModel.SideBySide=t):(n.ViewModel.CardColumns=4,n.ViewModel.SideBySide=i):(n.ViewModel.CardColumns=6,n.ViewModel.SideBySide=t)},__updateTicketWorkflowsViewModel:function(){var r=this,u,n,f,o;if(u=r._workflows.getFromIndex("Type",e.WorkflowTypesEnum.Ticket),u&&u.length!==0){for(r.ViewModel.HasTickets=t,f=0;f<u.length;f++)n=u[f],n.Title=n.TicketInfo.DisplayName,n.ExpireDateString=n.getTicketExpireDateString(),n.AvailableDateString=n.getTicketAvailableDateString(),o=n.TicketInfo.HasPool?n.TicketInfo.PoolName:n.TicketInfo.ProviderNameString,n.Subtitle=r.__getTicketWorkflowSubtitle(o),r.__organizeOrders(n.TicketInfo),r._buildOneClickSlots(n);u.sort(r.__sortTickets);r.ViewModel.TicketWorkflows=u;r.ViewModel.Count++;r.ViewModel.Count===1&&(r.ViewModel.HasDirectOptions=i)}},__sortTickets:function(n,t){return n.IsCurrentlyAvailable&&!t.IsCurrentlyAvailable?-1:!n.IsCurrentlyAvailable&&t.IsCurrentlyAvailable?1:0},__updateFavoriteAppointmentWorkflowsViewModel:function(){var n=this,i,e,u,f;if(i=n._workflows.getFromIndex("IsFavorite",t),i&&i.length!==0&&n.ViewModel.HasDirectOptions)for(n.ViewModel.HasFavorites=t,n.ViewModel.FavoriteAppointmentWorkflows=i,n.ViewModel.Count++,f=0;f<i.length;f++)e=i[f],u=e.FavoriteAppointmentInfo,e.Title=n.__getFavoriteWorkflowTitle(u.ReasonForVisitTitle,u.ProviderName,u.HideProviderName);n.ViewModel.DataTypes=r},__getFavoriteWorkflowTitle:function(n,t,i){if($$WPUtil.IsNullOrEmpty(t)||i)return n;this.SchedulingStringsNamespace.addMnemonics({"@MYCHART@REASONFORVISIT@":{Value:n,EncodingType:$$WP.Strings.EncodingTypes.None},"@MYCHART@PROVIDER@":{Value:t,EncodingType:$$WP.Strings.EncodingTypes.None}});var r=this.SchedulingStringsNamespace.getString("WorkflowProviderRfvTitle");return this.SchedulingStringsNamespace.clearMnemonics(),r},__getTicketWorkflowSubtitle:function(n){var t="";return $$WPUtil.IsNullOrEmpty(n)||(this.SchedulingStringsNamespace.addMnemonics({"@MYCHART@PROVIDER@":{Value:n,EncodingType:$$WP.Strings.EncodingTypes.None}}),t=this.SchedulingStringsNamespace.getString("TicketScheduleWithProviders"),this.SchedulingStringsNamespace.clearMnemonics()),t},afterRender:function(){this._isFirstRender=i;$afe.select(".cardlist.matchHeights").each($$WP.Utilities.UI.Cards.MatchHeights);$$WP.Utilities.UI.MatchColumnHeights();this._matchHeaderHeights();this.$root.find("h2.header").first().focus()},_matchHeaderHeights:function(){var t=".headerwrapper",n=0;$afe.select(t).each(function(){$afe.jq(this).outerHeight()>n&&(n=$afe.jq(this).outerHeight())});$afe.select(t).css("minHeight",n)},_onWorkflowElementClick:function(n){var l,a,e,v,t,o,y,c,p,i;n.preventDefault();v=$afe.jq(n.target).closest("[data-workflow-model-id]").safeAttr("data-workflow-model-id");t=f.getInstance(v);i=t.SchedulingDataPool.AppointmentBuilder.getAppointment(0);l=$afe.jq(n.target).closest(h).safeAttr("data-type");a=$afe.jq(n.target).closest(h).safeAttr(s);e=f.getInstance(a);t.setProperty("State",$$WP.Scheduling.Workflow.StatesEnum.Selected);switch(l){case r.Slot:c=e;o=t.SchedulingDataPool.Providers.getFromIndex(u,c.ProviderId);y=this._getLocationForSlot(c,t);i.Providers.add(o);i.Locations.add(y);i.setProperty("Slot",c);break;case r.Provider:o=e;i.Providers.add(o);break;case r.ReasonForVisit:p=e;t.SchedulingDataPool.AppointmentBuilder.setProperty("ReasonForVisit",p)}},_getLocationForSlot:function(n,t){for(var r,u=t.SchedulingDataPool.Locations.toArray(),i=0;i<u.length;i++)if(r=u[i],r.DepartmentIds.indexOf(n.DepartmentId)!==-1&&!r.IsSingleDepartment)return r},__organizeOrders:function(n){var r=[],u=this.SchedulingStringsNamespace;n.OrderingProviderString="";n.HasMultipleOrders=i;r=n.Orders;Array.isArray(r)&&(r.length===1?n.OrderingProviderString=this.__buildOrderingProviderString(r[0].ProviderName,u):r.length>1&&(n.OrderGroups=this.__buildOrderGroups(r,u),n.HasMultipleOrders=t));u.clearMnemonics()},__buildOrderingProviderString:function(n,t){return t.addMnemonics({"@MYCHART@ORDERINGPROVIDER@":{Value:n,EncodingType:$$WP.Strings.EncodingTypes.None}}),t.getString("TicketOrderingProvider")},__buildOrderGroups:function(t,i){for(var o=0,f=0,e=n,u="",r=n,s=[],h=[],o=t.length,f=0;f<o;f++)e=t[f],u=e.ProviderName,r=s[u],r||(r={},r.Orders=[],r.ProviderName=u,r.OrderingProviderString=this.__buildOrderingProviderString(u,i),s[u]=r,h.push(r)),r.Orders.push(e);return h},_buildOneClickSlots:function(i){var f,o,r,h,c,s;if(i.Slots=i.getOneClickSlots(),i.Slots.length>0){for(s=e.allowProviderSelect(e.WorkflowTypesEnum.Ticket,"",i.TicketInfo.VisitType),i.AllowProviderSelect=s,i.SlotGroups=[],f=n,o=0;o<i.Slots.length;o++)r=i.Slots[o],s&&(h=i.SchedulingDataPool.Providers.getFromIndex(u,r.ProviderId)),c=i.SchedulingDataPool.Departments.getFromIndex(u,r.DepartmentId),($$WPUtil.IsNullOrEmpty(f)||r.ProviderId!==f.ProviderId||r.DepartmentId!==f.DepartmentId||r.Dte!==f.Dte)&&(f={ProviderId:r.ProviderId,Provider:h,DepartmentId:r.DepartmentId,Department:c,Dte:r.Dte,DateString:r.DateString,Slots:[]},i.SlotGroups.push(f)),f.Slots.push(r);i.HasOneClickSlots=t}},_onRemoveFavoriteButtonClicked:function(n){var t;t=$afe.jq(n.target).closest(c).safeAttr(s);this._promptToRemoveFavorite(t)},_onRemoveFavoriteButtonKeyPress:function(n){var t;(n.key===" "||event.key==="Enter")&&(t=$afe.jq(n.target).closest(c).safeAttr(s),this._promptToRemoveFavorite(t))},_promptToRemoveFavorite:function(n){var t="Scheduling",i,r;i=$$WPUtil.createRemoveGoBackButtons();r=[n];$$WPUtil.quickMessageBox($$WP.Strings.get("RemoveSchedulingFavoriteConfirmation",t),$$WP.Strings.get("RemoveSchedulingFavoritePopupTitle",t),i,this._onRemoveFavoritePopupButtonClicked,r)},_onRemoveFavoritePopupButtonClicked:function(n,t){t==="toolbarcontinue"&&this._removeFavorite(n)},_removeFavorite:function(n){this._removeFavoriteFromDatabase(n);this._removeFavoriteFromWorkflows(n)},_removeFavoriteFromDatabase:function(n){var t;t=f.getInstance(n).FavoriteAppointmentInfo.Csn;$.post({url:makeLink("Scheduling/RemoveFavoriteAppointment"),data:{csn:t}})},_removeFavoriteFromWorkflows:function(n){var t=f.getInstance(n);this._workflows.remove(t)},_buildProviderArray:function(){var n,r,f,e,t;for(n=[],r=this._providerWorkflow.getStandardProviders(i),t=0;t<r.length;t++)f=r[t],e=this._providerWorkflow.SchedulingDataPool.ProviderDepartmentPairs.getFromIndex("ProviderId",f.ID),$$WP.Scheduling.Workflow.hasProviderFirstOptionsProvDepPairs(e)&&n.push(f);return n=this.filterByAllowedIds(n,u),n.sort($$WP.Scheduling.Provider.sortProvidersByListDisplayName)},_getUnfilteredReasonsForVisit:function(){var n,i,r,u;return n=this._reasonWorkflow.SchedulingDataPool.ReasonsForVisit.Models,i=this._reasonWorkflow.SchedulingDataPool.ProviderDepartmentPairs.Models,r=t,u=t,$$WP.Scheduling.Workflow.buildReasonsForVisitNoFiltering(n,i,r,u)}};o.prototype=l;o.LandingPageDataTypesEnum=r;$$WP.Scheduling.LandingPageController=o;o.extend($$WP.Scheduling.StepController,"WP$Scheduling$LandingPageController")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var n=null,t=function(n,t){var i=this;i.WP$Controllers$Controller();i.$root=n;i._stepControllers=[];i._stepMapById={};i.proxify("showPrevStep","startover");(t===!0||$$WP.Utilities.UI.IsMobile)&&(i._promptUnsavedChanges=!1)},i={$root:n,_stepControllers:n,_stepMapById:n,_currentStep:0,_continueButton:n,_cancelButton:n,_promptUnsavedChanges:!0,showStep:function(n){var t=this;t._stepMapById[n]!==undefined&&t._stepMapById[n]!==t._currentStep&&t._showStepInArray(t._stepMapById[n])},_showStepInArray:function(n){var i="hasFloatingNavigation",t=this;n<t._stepControllers.length&&(t.deactivateStep(t._stepControllers[t._currentStep]),t._currentStep=n,t.activateStep(t._stepControllers[n]));t._continueButton&&(t.isComplete(t._stepControllers[t._currentStep].Id)?(t.$root.addClass(i),t._continueButton.show()):(t._continueButton.hide(),t.$root.removeClass(i)))},showNextStep:function(n){var t=this;t._currentStep<t._stepControllers.length&&(t._showStepInArray(t._currentStep+1),n&&(n.stopPropagation(),n.preventDefault()))},showPrevStep:function(n){this._currentStep>0&&(this._showStepInArray(this._currentStep-1),n&&(n.stopPropagation(),n.preventDefault()))},getStep:function(n){return this._stepControllers[n]},getCurrentStep:function(){return this.getStep(this._currentStep)},deactivateRange:function(n){for(var t=this,i=0,r=t._stepMapById[n],i=r+1;i<t._stepControllers.length;i++)t.deactivateStep(t._stepControllers[i],!0);t._currentStep>r&&(t._currentStep=r)},activateAllSteps:function(){this.activateRange(0,this._stepControllers.length-1)},activateUpToCurrentStep:function(){this.activateRange(0,this._currentStep)},activateRange:function(n,t){for(var i=0,i=n;i<=t;i++)this.activateStep(this._stepControllers[i])},hookupNavigationButtons:function(n,t,i,r){var u=this;u._continueButton=n;u._cancelButton=t;n&&$.isFunction(i)&&u._continueButton.click(i);t&&$.isFunction(r)&&u._cancelButton.click(r)},startover:function(){this.clearBeforeUnload();location.reload()},clearBeforeUnload:function(){this._promptUnsavedChanges&&WP.Events.cancelBeforeUnload()},addStep:function(n){this._stepControllers.push(n);this._stepMapById[n.Id]=this._stepControllers.length-1},removeStep:function(n){n.dispose();this._stepControllers.splice(this._stepControllers.indexOf(n),1)},render:function(){this._currentStep=-1;this.showNextStep();this._promptUnsavedChanges&&WP.Events.beforeUnload()},destroy:function(){$$WP.Debug.logError("Virtual method destroy must be overridden")},activateStep:function(){$$WP.Debug.logError("Virtual method activateStep must be overridden")},deactivateStep:function(){$$WP.Debug.logError("Virtual method deactivateStep must be overridden")},isComplete:function(){$$WP.Debug.logError("Virtual method isComplete must be overridden")}};t.prototype=i;$$WP.Scheduling=$$WP.Scheduling||{};$$WP.Scheduling.WorkflowController=t;t.extend($$WP.Controllers.Controller,"WP$Scheduling$WorkflowController")}(),function(){var t=null,i=!0,n=$$WP.Scheduling.SchedulingStep,r=function(t,r,u,f){var e=this,o;e.WP$Scheduling$WorkflowController(t);e.$root.safeAppend($afe.renderTemplate($$WP.Templates.Scheduling.VerificationStep,{}));e.proxify("_onStepCompleteChanged","_update");e.$root=t;e._dataPool=r.SchedulingDataPool;e._stackId=e.Id;e._summarySteps=[];e._stepContainers=[];e._isMobile=$$WP.Utilities.UI.IsMobile;e._isEmbedded=u.IsEmbedded;f=$$WPUtil.IsNullOrEmpty(f)?new $$WP.Scheduling.StepFactory(r,u):f;u.ShowDemographicVerificationStep&&(o=f.createStep(n.StepTypeEnum.Demographics),n.addSchedulingStepToCollection(e._dataPool.SchedulingSteps,o.Id,i,e._stackId),e._stepContainers.push(o.$root),e.addStep(o),e._summarySteps.push({type:"Demographic",Id:o.Id}));u.ShowInsuranceVerificationStep&&(o=f.createStep(n.StepTypeEnum.Insurance),n.addSchedulingStepToCollection(e._dataPool.SchedulingSteps,o.Id,i,e._stackId),e._stepContainers.push(o.$root),e.addStep(o),e._summarySteps.push({type:"Insurance",Id:o.Id}));o=f.createStep(n.StepTypeEnum.Confirmation);n.addSchedulingStepToCollection(e._dataPool.SchedulingSteps,o.Id,i,e._stackId);e._stepContainers.push(o.$root);e.addStep(o);e._summarySteps.push({type:"Confirmation",Id:o.Id});e._dataPool.SchedulingSteps.addPropertyListener("CompleteStatus",e._onStepCompleteChanged)},u={$root:t,Id:"verification_step",_dataPool:t,_stackId:t,_summarySteps:t,_stepContainers:t,_isMobile:!1,_isEmbedded:!1,show:function(){this._update();this.render();this.$root.parent().css({"min-height":""})},hide:function(n){var t=this;t.$root.hide();n!==undefined&&t.setComplete(n);t.deactivateRange(t._summarySteps[0].Id,i)},activateStep:function(n){n.show();this._isEmbedded||$$WPSchedulingUtil.ScrollToTopOfPage();this._dataPool.BlockDemographicInsuranceVerification=!1},deactivateStep:function(n){n&&n.hide($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete)},_update:function(){var n=this,t;for(n.$root.show(),n.$root.empty().safeAppend($afe.renderTemplate($$WP.Templates.Scheduling.VerificationStep)),t=0;t<n._stepContainers.length;t++)n.$root.find(".verificationContent").safeAppend(n._stepContainers[t]);n._isMobile&&($afe.select(".verificationContent .formbuttons").addClass("floatingButtonContainer"),$afe.select(".verificationContent .button").addClass("floating"))},_onStepCompleteChanged:function(t){var u=this,i,e,r,f;for(i in t)(e=t[i].from,r=t[i].to,f=t[i].model||$$WP.Common.Model.getInstance(i),f.IsStacked&&f.StackId===u._stackId)&&(e!==r&&r===n.CompleteEnum.Complete?(u.showNextStep(),u._update()):e!==r&&r===n.CompleteEnum.Incomplete&&u.deactivateRange(f.ID))}};r.prototype=u;$$WP.Scheduling.VerificationStepController=r;r.extend($$WP.Scheduling.WorkflowController,"WP$Scheduling$VerificationStepController")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var n=null,t=function(t,i,r,u,f,e,o,s,h){var c=this;c.WP$Scheduling$StepController(t,r.SchedulingDataPool,n,n,n,$$WP.Templates.Scheduling.StackedStep,$$WP.Templates.Scheduling.StackedStep,!0);c.proxify("_onStepCompleteChanged");c.stackId=c.Id;c._dataPool=r.SchedulingDataPool;c._stackedWorkflowController=new $$WP.Scheduling.StackedWorkflowController(t,i,r,u,f,c.stackId,e,o,s,h);c._dataPool.SchedulingSteps.addPropertyListener("CompleteStatus",c._onStepCompleteChanged)},i={_stackedWorkflowController:n,stackId:n,_dataPool:n,_isComplete:!1,updateViewModel:function(){this.ViewModel={Count:1,StepShouldBeActive:!0}},beforeFirstRender:function(){var n=this;n._stackedWorkflowController.render();n._stackedWorkflowController.showNextIncompleteStep();(n._isComplete||n._dataPool.SchedulingSteps.getFromIndex("ID",n.Id).CompleteStatus===$$WP.Scheduling.SchedulingStep.CompleteEnum.NotRequired)&&(n.Active=!1)},_onStepCompleteChanged:function(n){var t=this,i,r,u,o,f,e;f=0;e=0;for(u in n)if(o=n[u].model||$$WP.Common.Model.getInstance(u),o.StackId===t.stackId&&n[u].to!==n[u].from){for(i=t._dataPool.SchedulingSteps.getFromIndex("StackId",t.stackId),r=0;r<i.length;r++)if(i[r].CompleteStatus===$$WP.Scheduling.SchedulingStep.CompleteEnum.Complete)f++;else if(i[r].CompleteStatus===$$WP.Scheduling.SchedulingStep.CompleteEnum.NotRequired)e++;else if(i[r].CompleteStatus===$$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete){t._isComplete=!1;t.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete);return}f>0?(t._isComplete=!0,t.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Complete)):e===i.length&&t.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.NotRequired)}},afterRender:function(){var n=this;n._dataPool.SchedulingSteps.openChangeBatch();n._stackedWorkflowController.activateStack();n._dataPool.SchedulingSteps.closeChangeBatch();n._dataPool.SchedulingSteps.getFromIndex("ID",n.Id).CompleteStatus===$$WP.Scheduling.SchedulingStep.CompleteEnum.NotRequired&&(n.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete),n.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.NotRequired))}};t.prototype=i;$$WP.Scheduling=$$WP.Scheduling||{};$$WP.Scheduling.StackedStepController=t;t.extend($$WP.Scheduling.StepController,"WP$Scheduling$StackedStepController")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var n=null,t=function(n,t,i,r,u,f,e){var o=this;o.WP$Scheduling$StackedStepController(n,[t],i,r,$$WP.Scheduling.StackedWorkflowController.ModesEnum.ShowAllAtOnce,u,f,e);o.__stepDefinition=t;o.proxify("__onAppointmentsChanged");o.Data.AppointmentBuilder.Appointments.addCollectionEventListener("add",o.__onAppointmentsChanged);o.Data.AppointmentBuilder.Appointments.addCollectionEventListener("remove",o.__onAppointmentsChanged)},i={__stepDefinition:n,__onAppointmentsChanged:function(){var t=this,r=n,i=0,u=n;for(t.__resetSteps(),i=0;i<t.Data.AppointmentBuilder.numAppointments();i++)u=t.Data.AppointmentBuilder.getAppointment(i),r=t._stackedWorkflowController.createStepAndAddToDom(t.__stepDefinition),r.linkAppointment(u);t.setComplete($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete)},__resetSteps:function(){var t=0,r=n,i=[];if(i=this._stackedWorkflowController._stepControllers,i.length>0)for(t=i.length-1;t>=0;t--)r=i[t],this._stackedWorkflowController.destroyStepAndRemoveFromDom(r)}};t.prototype=i;$$WP.Scheduling=$$WP.Scheduling||{};$$WP.Scheduling.MultiAppointmentStepController=t;t.extend($$WP.Scheduling.StackedStepController,"WP$Scheduling$MultiAppointmentStepController")}(),function(){var e=!1,r=null,n=$$WP.Scheduling.SchedulingStep.StepTypeEnum,t=$$WP.Scheduling.Workflow,i=$$WP.Scheduling.ProviderStepController,u=$$WP.Scheduling.LocationStepController,o=$$WP.Scheduling.SlotStepController,s=$$WP.Scheduling.LqfStepController,a=$$WP.Scheduling.StackedStepController,c=$$WP.Scheduling.CustomStepController,v=$$WP.Scheduling.DemographicVerificationStepController,y=$$WP.Scheduling.InsuranceVerificationStepController,l=$$WP.Scheduling.ConfirmationStepController,p=$$WP.Scheduling.RequestStepController,w=$$WP.Scheduling.OriginalApptStepController,b=$$WP.Scheduling.VerificationStepController,f=$$WP.Scheduling.ReasonForVisitStepController,k=$$WP.Scheduling.OnDemandTelehealth.QuickScheduleStepController,d=$$WP.Scheduling.OnDemandTelehealth.PatientLocationStepController,g=$$WP.Scheduling.OnDemandTelehealth.OrganizationStepController,nt=$$WP.Scheduling.OnDemandTelehealth.OrganizationAuthStepController,tt=$$WP.Scheduling.OnDemandTelehealth.PlatformStepController,it=$$WP.Scheduling.OnDemandTelehealth.SummaryStepController,h=function(n,t,i,r,u,f,e){var o=this;o._workflow=n;o._workflowSettings=t;o._onSchedulingCompleteCallback=i;o._onRequestCompletedCallback=r;o._stopSchedulingCallback=u;o._workflowStepErrorCallback=f;o.__disableRTL=e},rt={_workflow:r,_workflowSettings:r,_onSchedulingCompleteCallback:r,_onRequestCompletedCallback:r,_stopSchedulingCallback:r,_workflowStepErrorCallback:r,__disableRTL:e,createStep:function(t,i){var u=this,r;switch(t){case n.Provider:r=u._getProviderStep();break;case n.Location:r=u._getLocationStep();break;case n.Slot:r=u._getSlotStep();break;case n.ReasonForVisit:r=u._getReasonForVisitStep();break;case n.StandardLqf:r=u._getStandardLqfStep();break;case n.Stacked:r=u._getStackedStep(i);break;case n.DepartmentLqf:r=u._getDepartmentLqfStep();break;case n.Custom:r=u._getCustomStep();break;case n.Demographics:r=u._getDemographicStep();break;case n.Insurance:r=u._getInsuranceStep();break;case n.Confirmation:r=u._getConfirmationStep();break;case n.Request:r=u._getRequestStep();break;case n.QuickSchedule:r=u._getQuickScheduleStep();break;case n.OriginalApptInfo:r=u._getOriginalApptInfoStep();break;case n.Verification:r=u._getVerificationStep();break;case n.TelehealthLocation:r=u._getPatientLocationStep();break;case n.TelehealthSummary:r=u._getTelehealthSummaryStep();break;case n.TelehealthOrganization:r=u._getTelehealthOrganizationStep();break;case n.TelehealthAuth:r=u._getTelehealthAuthStep();break;case n.PlatformStep:r=u._getTelehealthPlatformStep();break;case n.MultiAppointment:r=u._getMultiAppointmentStep(i[0]);break;case n.Onboarding:r=u._getOnboardingStep()}return r},_getTelehealthSummaryStep:function(){var n=this;return new it(n._createStepContainer(),n._workflow.SchedulingDataPool,n._workflowSettings,n._onSchedulingCompleteCallback,n._workflow.IsAnonymous,n._workflow.IsGuest,n._workflow.AnonymousSettings)},_getPatientLocationStep:function(){return new d(this._createStepContainer(),this._workflow.SchedulingDataPool)},_getVerificationStep:function(){var n=this;return new b(n._createStepContainer(),n._workflow,n._workflowSettings,n)},_getTelehealthOrganizationStep:function(){return new g(this._createStepContainer(),this._workflow.SchedulingDataPool,this._workflowSettings)},_getTelehealthAuthStep:function(){return new nt(this._createStepContainer(),this._workflow.SchedulingDataPool,this._workflowSettings)},_getTelehealthPlatformStep:function(){return new tt(this._createStepContainer(),this._workflow.SchedulingDataPool,this._workflow.IsAnonymous)},_getOriginalApptInfoStep:function(){return new w(this._createStepContainer(),this._workflow.SchedulingDataPool,this._workflow.OriginalAppointment)},_getQuickScheduleStep:function(){var n=this;return new k(n._createStepContainer(),n._workflow.SchedulingDataPool,n._workflowSettings.AllowedProviderIds,n._workflowSettings.PreselectedProviderIds,n._workflowSettings.ProviderStepSettings,n._workflowSettings.RequireECheckInForTelemedicine,n._workflowSettings,n._workflow.IsAnonymous,n._workflow.IsGuest)},_getRequestStep:function(){var n=this;return new p(n._createStepContainer(),n._workflow.SchedulingDataPool,n._workflowSettings,n._onRequestCompletedCallback,n._workflowSettings.CampaignID)},_getConfirmationStep:function(){var n=this;switch(n._workflow.Type){case t.WorkflowTypesEnum.Reschedule:return new l(n._createStepContainer(),n._workflow,n._workflow.SchedulingDataPool,n._workflowSettings.AllowComments,n._workflowSettings.RequireComments,n._workflowSettings.MaxCommentsLength,"",n._onSchedulingCompleteCallback,n._workflowStepErrorCallback,n._workflowSettings.RescheduleReasons,n._workflowSettings.RequireRescheduleReason,n._workflowSettings.DisableFavoriteAppointments||n._workflow.IsFavorite,!0);default:return new l(n._createStepContainer(),n._workflow,n._workflow.SchedulingDataPool,n._workflowSettings.AllowComments,n._workflowSettings.RequireComments,n._workflowSettings.MaxCommentsLength,n._workflowSettings.CampaignID,n._onSchedulingCompleteCallback,n._workflowStepErrorCallback,r,e,n._workflowSettings.DisableFavoriteAppointments||n._workflow.IsFavorite,e,n._workflowSettings.TopicId)}},_getInsuranceStep:function(){var n=this;return new y(n._createStepContainer(),n._workflow.SchedulingDataPool,n._workflowSettings.ShowInsuranceVerificationStep,n._workflowSettings.IsAlwaysSelfPay)},_getDemographicStep:function(){var n=this;return new v(n._createStepContainer(),n._workflow.SchedulingDataPool,n._workflowSettings.ShowDemographicVerificationStep,n.__disableRTL)},_getCustomStep:function(){var n=this;switch(n._workflow.Type){case t.WorkflowTypesEnum.Reschedule:return new c(n._createStepContainer(),n._workflow.SchedulingDataPool);default:return new c(n._createStepContainer(),n._workflow.SchedulingDataPool)}},_getMultiAppointmentStep:function(n){var t=this;return new $$WP.Scheduling.MultiAppointmentStepController(t._createStepContainer(),n,t._workflow,t._workflowSettings,t._onRequestCompletedCallback,t._stopSchedulingCallback,t._onSchedulingCompleteCallback)},_getOnboardingStep:function(){return new $$WP.Scheduling.OnboardingStepController(this._createStepContainer(),this._workflow.SchedulingDataPool)},_getStackedStep:function(n){var t=this;return new a(t._createStepContainer(),n,t._workflow,t._workflowSettings,$$WP.Scheduling.StackedWorkflowController.ModesEnum.ShowOneAtATime,t._onRequestCompletedCallback,t._stopSchedulingCallback,t._onSchedulingCompleteCallback,t._workflowStepErrorCallback)},_getStandardLqfStep:function(){var n=this;return new s(n._createStepContainer(),n._workflow.SchedulingDataPool,s.ModesEnum.Standard,n._stopSchedulingCallback,n._workflow)},_getDepartmentLqfStep:function(){var n=this;return new s(n._createStepContainer(),n._workflow.SchedulingDataPool,s.ModesEnum.DepartmentOverride,n._stopSchedulingCallback,n._workflow)},_getReasonForVisitStep:function(){var n=this;switch(n._workflow.Type){case t.WorkflowTypesEnum.ExistingProvider:return new f(n._createStepContainer(),n._workflow.SchedulingDataPool,n._workflowSettings.AllowedReasonForVisitIds,n._workflowSettings.PreselectedReasonForVisitId,n._workflowSettings.ReasonForVisitStepSettings,f.ModesEnum.FilterOnSelectedProviders,n._stopSchedulingCallback);case t.WorkflowTypesEnum.Request:return new f(n._createStepContainer(),n._workflow.SchedulingDataPool,n._workflowSettings.AllowedReasonForVisitIds,n._workflowSettings.PreselectedReasonForVisitId,n._workflowSettings.ReasonForVisitStepSettings,f.ModesEnum.Request,n._stopSchedulingCallback);case t.WorkflowTypesEnum.OnDemandTelehealth:return new f(n._createStepContainer(),n._workflow.SchedulingDataPool,n._workflowSettings.AllowedReasonForVisitIds,n._workflowSettings.PreselectedReasonForVisitId,n._workflowSettings.ReasonForVisitStepSettings,f.ModesEnum.OnDemandTelehealth,n._stopSchedulingCallback,n._workflowSettings.IsEmbedded&&!n._workflow.IsAnonymous);default:return new f(n._createStepContainer(),n._workflow.SchedulingDataPool,n._workflowSettings.AllowedReasonForVisitIds,n._workflowSettings.PreselectedReasonForVisitId,n._workflowSettings.ReasonForVisitStepSettings,f.ModesEnum.NoFiltering,n._stopSchedulingCallback)}},_getSlotStep:function(){var n=this,i;i={FromMinutesOffset:n._workflowSettings.FromMinutesOffset,FromDaysOffset:n._workflowSettings.FromDaysOffset,ToDaysOffset:n._workflowSettings.ToDaysOffset,StartDate:n._workflowSettings.StartDate,EndDate:n._workflowSettings.EndDate,DateRangeSettings:n._workflowSettings.DateRangeSettings,TimePreferences:n._workflowSettings.TimePreferences,UseOnFileTimePreferences:n._workflowSettings.UseOnFileTimePreferences,ShowTeamBeforeSearch:n._workflowSettings.ShowTeamBeforeSearch,AllowTeamScheduling:n._workflowSettings.AllowTeamScheduling,OnFileSchedulePreferences:n._workflowSettings.SchedulePreferences,DaysOfWeekList:n._workflowSettings.DaysOfWeekList};i.DateRangeSettings=i.DateRangeSettings||{ReadOnly:e,NoIncremental:e,NoMinimum:e};switch(n._workflow.Type){case t.WorkflowTypesEnum.Ticket:return i.FromDte=n._workflow.TicketInfo.FromDte,i.ToDte=n._workflow.TicketInfo.ToDte,new o(n._createStepContainer(),n._workflow,n._workflow.SchedulingDataPool,i);case t.WorkflowTypesEnum.Request:return new o(n._createStepContainer(),n._workflow,n._workflow.SchedulingDataPool,i,o.ModesEnum.RequestOnly);case t.WorkflowTypesEnum.Reschedule:return i.FromDte=n._workflow.OriginalAppointment.TicketFromDte,i.ToDte=n._workflow.OriginalAppointment.TicketToDte,new o(n._createStepContainer(),n._workflow,n._workflow.SchedulingDataPool,i);default:return new o(n._createStepContainer(),n._workflow,n._workflow.SchedulingDataPool,i)}},_getLocationStep:function(){var n=this;switch(n._workflow.Type){case t.WorkflowTypesEnum.Reschedule:n._workflowSettings.DepartmentStepSettings.HideIfOne=!0;case t.WorkflowTypesEnum.DecisionTreeNode:return new u(n._createStepContainer(),n._workflow,n._workflow.SchedulingDataPool,n._workflowSettings.AllowedDepartmentIds,n._workflowSettings.PreselectedDepartmentIds,n._workflowSettings.DepartmentStepSettings,u.ModesEnum.FilterOnSelectedProviders,n._workflowSettings.LocationGroupingBehavior,n._stopSchedulingCallback);case t.WorkflowTypesEnum.Ticket:return new u(n._createStepContainer(),n._workflow,n._workflow.SchedulingDataPool,n._workflowSettings.AllowedDepartmentIds,n._workflowSettings.PreselectedDepartmentIds,n._workflowSettings.DepartmentStepSettings,u.ModesEnum.FilterOnSelectedVisitType,n._workflowSettings.LocationGroupingBehavior,n._stopSchedulingCallback);case t.WorkflowTypesEnum.Request:return new u(n._createStepContainer(),n._workflow,n._workflow.SchedulingDataPool,n._workflowSettings.AllowedDepartmentIds,n._workflowSettings.PreselectedDepartmentIds,n._workflowSettings.DepartmentStepSettings,u.ModesEnum.Request,n._workflowSettings.LocationGroupingBehavior,n._stopSchedulingCallback);case t.WorkflowTypesEnum.Procedure:return new u(n._createStepContainer(),n._workflow,n._workflow.SchedulingDataPool,n._workflowSettings.AllowedDepartmentIds,n._workflowSettings.PreselectedDepartmentIds,n._workflowSettings.DepartmentStepSettings,u.ModesEnum.FilterOnSelectedReasonForVisit,n._workflowSettings.LocationGroupingBehavior,n._stopSchedulingCallback,n._workflow.IsFavorite);default:return new u(n._createStepContainer(),n._workflow,n._workflow.SchedulingDataPool,n._workflowSettings.AllowedDepartmentIds,n._workflowSettings.PreselectedDepartmentIds,n._workflowSettings.DepartmentStepSettings,r,n._workflowSettings.LocationGroupingBehavior,n._stopSchedulingCallback,n._workflow.IsFavorite)}},_getProviderStep:function(){var n=this,f,u;switch(n._workflow.Type){case t.WorkflowTypesEnum.Procedure:return new i(n._createStepContainer(),n._workflow.SchedulingDataPool,n._workflowSettings.AllowedProviderIds,n._workflowSettings.PreselectedProviderIds,n._workflowSettings.ProviderStepSettings,i.ModesEnum.FilterOnSelectedReasonForVisitAndLocation,r,n._workflow.Type,n._stopSchedulingCallback,n._workflow.IsFavorite);case t.WorkflowTypesEnum.ExistingProvider:return new i(n._createStepContainer(),n._workflow.SchedulingDataPool,n._workflowSettings.AllowedProviderIds,n._workflowSettings.PreselectedProviderIds,n._workflowSettings.ProviderStepSettings,i.ModesEnum.NoFiltering,i.ProvidersToUseEnum.Standard,n._workflow.Type,n._stopSchedulingCallback,n._workflow.IsFavorite);case t.WorkflowTypesEnum.Ticket:return f={ReadOnly:n._workflowSettings.ProviderStepSettings.ReadOnly,HideIfOne:n._workflowSettings.ProviderStepSettings.HideIfOne,Collapse:n._workflowSettings.ProviderStepSettings.Collapse,CollapseIfOne:n._workflowSettings.ProviderStepSettings.CollapseIfOne},new i(n._createStepContainer(),n._workflow.SchedulingDataPool,n._workflowSettings.AllowedProviderIds,n._workflowSettings.PreselectedProviderIds,f,i.ModesEnum.FilterOnSelectedLocation,i.ProvidersToUseEnum.All,n._workflow.Type,n._stopSchedulingCallback);case t.WorkflowTypesEnum.DecisionTreeNode:return u=n._workflow.SchedulingDataPool.VisitTypes.toArray()[0],f={ReadOnly:n._workflowSettings.ProviderStepSettings.ReadOnly,HideIfOne:n._workflowSettings.ProviderStepSettings.HideIfOne,Collapse:n._workflowSettings.ProviderStepSettings.Collapse,CollapseIfOne:n._workflowSettings.ProviderStepSettings.CollapseIfOne,Hide:u.IsAdvanced&&!u.AllowProviderSelect},new i(n._createStepContainer(),n._workflow.SchedulingDataPool,n._workflowSettings.AllowedProviderIds,n._workflowSettings.PreselectedProviderIds,f,i.ModesEnum.NoFiltering,i.ProvidersToUseEnum.All,n._workflow.Type,n._stopSchedulingCallback);case t.WorkflowTypesEnum.Request:return new i(n._createStepContainer(),n._workflow.SchedulingDataPool,n._workflowSettings.AllowedProviderIds,n._workflowSettings.PreselectedProviderIds,n._workflowSettings.ProviderStepSettings,i.ModesEnum.Request,r,n._workflow.Type,n._stopSchedulingCallback);case t.WorkflowTypesEnum.Reschedule:return u=n._workflow.SchedulingDataPool.VisitTypes.getFirstInIndex("ID",n._workflow.OriginalAppointment.VisitTypeId),n._workflowSettings.ProviderStepSettings.Hide=!u.AllowChangeProvAndLocInResched||!u.AllowProviderSelect,n._workflowSettings.ProviderStepSettings.HideIfOne=!0,new i(n._createStepContainer(),n._workflow.SchedulingDataPool,n._workflowSettings.AllowProviderIds,n._workflowSettings.PreselectedProviderIds,n._workflowSettings.ProviderStepSettings,i.ModesEnum.NoFiltering,i.ProvidersToUseEnum.All,n._workflow.Type,n._stopSchedulingCallback);default:return new i(n._createStepContainer(),n._workflow.SchedulingDataPool,n._workflowSettings.AllowProviderIds,n._workflowSettings.PreselectedProviderIds,n._workflowSettings.ProviderStepSettings,i.ModesEnum.NoFiltering,i.ProvidersToUseEnum.All,n._workflow.Type,n._stopSchedulingCallback,n._workflow.IsFavorite)}},_createStepContainer:function(){return $$WP.SimpleTemplates.Div({"class":"jqHidden stepcontainer"})}};h.prototype=rt;$$WP.Scheduling=$$WP.Scheduling||{};$$WP.Scheduling.StepFactory=h;h.extend($$WP.Controllers.Controller,"WP$Scheduling$StepFactory")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var e="CompleteStatus",i="ActiveStatus",r="ID",t=null,o="#scheduling-continue",u=!1,n=$$WP.Scheduling.SchedulingStep,s=$$WP.Scheduling.SidebarController,f=function(i,r,f,e,s,h,c,l,a,v){var y=this,p,nt,w,b,it,tt,k,d,g;for(y.$root=i,y._workflow=f||{},y._workflowSettings=e||{},y._dataPool=f.SchedulingDataPool||{},y._summarySteps=[],y._onRestartScheduling=l,y._isEmbedded=e.IsEmbedded,y.WP$Scheduling$WorkflowController(i,u),y.proxify("_onStepActiveChanged","_onStepCompleteChanged","showNextStep"),nt=new $$WP.Scheduling.StepFactory(y._workflow,y._workflowSettings,s,h,c,a,v),p=0;p<r.length;p++)r[p].isReadOnly?b="-1":(w=nt.createStep(r[p].type,r[p].stackedSteps),y.addStep(w),b=w.Id,w.$root.addClass("fadeIn delay"),y.$root.safeAppend(w.$root)),y._summarySteps.push({Id:b,summaryType:r[p].summaryType}),it=n.addSchedulingStepToCollection(y._dataPool.SchedulingSteps,b,u,"",r[p].type,r[p].isReadOnly);y.$root.safeAppend($afe.renderTemplate($$WP.Templates.Scheduling.NavigationButtons));tt=y.$root.find(".startover");k=$afe.select("body").find("#scheduling-startover");d=tt.add(k);g=y.$root.find(o);y._isEmbedded?(d.remove(),y.hookupNavigationButtons(g,t,y.showNextStep)):(k.removeClass("hidden"),y.hookupNavigationButtons(g,d,y.showNextStep,y.startover));y._setupSummaryHeader();y._setupSidebar();y._startListening()},h={$root:t,_workflow:t,_workflowSettings:t,_dataPool:t,_summarySteps:t,_stepActiveListenerId:t,_stepCompleteListenerId:t,_sidebarController:t,_onRestartScheduling:t,_isEmbedded:u,activateStep:function(t){var u=this,f=u._dataPool.SchedulingSteps.getFromIndex(r,t.Id);f.CompleteStatus===n.CompleteEnum.NotRequired?u.showNextStep():(u._stopListening(),f.setProperty(i,n.ActiveEnum.Active),u._startListening(),u._isEmbedded&&!$$WP.Utilities.UI.IsMobile||$$WPSchedulingUtil.ScrollToTopOfPage(),t.show())},deactivateStep:function(t){if(t){this._stopListening();var u=this._dataPool.SchedulingSteps.getFromIndex(r,t.Id);u.setProperty(i,n.ActiveEnum.Active);u.setProperty(i,n.ActiveEnum.Inactive);this._startListening();t.hide()}},destroy:function(n){var t=this;n||t.deactivateStep(t.getCurrentStep());t.clearBeforeUnload();t._stopListening();n||(t.$root.empty(),t._sidebarController&&t._sidebarController._linksSidebarWidget.remove())},startover:function(){$.isFunction(this._onRestartScheduling)&&this._onRestartScheduling()},isComplete:function(t){return this._dataPool.SchedulingSteps.getFromIndex(r,t).CompleteStatus===n.CompleteEnum.Complete},_setupSummaryHeader:function(){var n=this,t=$$WP.SimpleTemplates.Div({"class":"summaryBannerContainer"});n.$root.safePrepend(t);new $$WP.Scheduling.SummaryHeader(t,n._summarySteps,n._dataPool,n._workflow)},_setupSidebar:function(){var n=this,t;n._isEmbedded||(t=$$WP.Utilities.UI.SidebarManager.addWidget($$WP.Templates.Scheduling.SchedulingSidebarLinks,{},3,u),n._sidebarController=new s(t,n._workflow,n._workflowSettings))},_onStepCompleteChanged:function(t){var u=this,f,s,r,i,e;for(f in t){if(s=t[f].from,r=t[f].to,i=t[f].model,e=u.getCurrentStep(),!i)return;s===r||r!==n.CompleteEnum.Complete&&r!==n.CompleteEnum.NotRequired||i.IsStacked||e.Id!==i.ID?r!==n.CompleteEnum.Incomplete||i.IsStacked||i.ID!==e.Id||(u.$root.find(o).hide(),u.$root.removeClass("hasFloatingNavigation")):u.showNextIncompleteStep()}},showNextIncompleteStep:function(){for(var t=this;t._currentStep<t._stepControllers.length-1&&t._dataPool.SchedulingSteps.getFromIndex(r,t.getCurrentStep().Id).CompleteStatus!==n.CompleteEnum.Incomplete;)t.showNextStep()},_onStepActiveChanged:function(t){var i,f,r,u;for(i in t)f=t[i].from,r=t[i].to,u=t[i].model,r===f||r!==n.ActiveEnum.Active||u.IsStacked||this.showStep(u.ID)},_startListening:function(){var n=this;n._stepActiveListenerId=n._dataPool.SchedulingSteps.addPropertyListener(i,n._onStepActiveChanged);n._stepCompleteListenerId=n._dataPool.SchedulingSteps.addPropertyListener(e,n._onStepCompleteChanged)},_stopListening:function(){var n=this;n._dataPool.SchedulingSteps.removePropertyListener(i,n._stepActiveListenerId);n._dataPool.SchedulingSteps.removePropertyListener(e,n._stepCompleteListenerId)}};f.prototype=h;$$WP.Scheduling=$$WP.Scheduling||{};$$WP.Scheduling.SchedulingWorkflowController=f;f.extend($$WP.Scheduling.WorkflowController,"WP$Scheduling$SchedulingWorkflowController")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var n=null,u=$$WP.Scheduling.StepFactory,t=$$WP.Scheduling.SchedulingStep,f=$$WP.Scheduling.Workflow,r=function(n,t,r,e,o,s,h,c,l,a){var v=this,y=0;for(v.$root=n,v._dataPool=r.SchedulingDataPool||{},v._stackId=s,v._mode=o||i.ShowOneAtATime,v.WP$Scheduling$WorkflowController(n,r.Type===f.WorkflowTypesEnum.OnDemandTelehealth),v.proxify("_onStepCompleteChanged"),v._stepFactory=new u(r,e,l,h,c,a),y=0;y<t.length;y++)v.createStepAndAddToDom(t[y]);v._dataPool.SchedulingSteps.addPropertyListener("CompleteStatus",v._onStepCompleteChanged)},e={$root:n,_dataPool:n,_stackId:n,_stepFactory:n,_mode:0,createStepAndAddToDom:function(i){var r=this,u=n;return u=r._stepFactory.createStep(i.type,i.stackedSteps),r.addStep(u),t.addSchedulingStepToCollection(r._dataPool.SchedulingSteps,u.Id,!0,r._stackId,i.type),r.$root.safeAppend(u.$root),u},destroyStepAndRemoveFromDom:function(n){this.removeStep(n);this._dataPool.SchedulingSteps.remove(this._dataPool.SchedulingSteps.getFromIndex("ID",n.Id));n.$root.remove()},activateStack:function(){switch(this._mode){case i.ShowOneAtATime:this.activateUpToCurrentStep();break;case i.ShowAllAtOnce:this.activateAllSteps()}},activateStep:function(n){n.show()},deactivateStep:function(n,t){n&&t&&n.hide($$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete)},showNextIncompleteStep:function(){for(var n=this;n._currentStep<n._stepControllers.length-1&&n._dataPool.SchedulingSteps.getFromIndex("ID",n.getCurrentStep().Id).CompleteStatus!==t.CompleteEnum.Incomplete;)n.showNextStep()},_onStepCompleteChanged:function(n){var e=this,u,o,r,f;for(u in n)(o=n[u].from,r=n[u].to,f=n[u].model||$$WP.Common.Model.getInstance(u),f&&f.IsStacked&&f.StackId===e._stackId)&&(o!==r&&(r===t.CompleteEnum.Complete||r===t.CompleteEnum.NotRequired)?e.showNextIncompleteStep():o!==r&&r===t.CompleteEnum.Incomplete&&e._mode===i.ShowOneAtATime&&e.deactivateRange(f.ID))}},i={ShowOneAtATime:0,ShowAllAtOnce:1};r.prototype=e;$$WP.Scheduling=$$WP.Scheduling||{};$$WP.Scheduling.StackedWorkflowController=r;$$WP.Scheduling.StackedWorkflowController.ModesEnum=i;r.extend($$WP.Scheduling.WorkflowController,"WP$Scheduling$StackedWorkflowController")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var t=!0,i=!1,n=null,f="ActiveStatus",e="remove",s=3,r={None:0,ReasonForVisit:1,Location:2,Time:3,Provider:4,Questionnaire:5,Confirmation:6,Request:7,TelehealthLocation:8,QuickSchedule:9,TelehealthOrganization:10,TelehealthSummary:11,Ticket:12,TelehealthPlatform:13},u={Incomplete:0,Complete:1,Inactive:2},o=function(n,t,i,u){var o=this,s;for(o.WP$Controllers$Controller(),o.$root=n,o._steps=[],o._dataPool=i,o._workflow=u,o._summaryTemplate=$$WP.Templates.Scheduling.SummaryHeader,s=0;s<t.length;s++)t[s].summaryType&&t[s].summaryType!==r.None&&o._steps.push(t[s]);o.proxify("_update","_onSummaryClick","_updateBuffer","_onAppointmentsChanged","_matchHeights");o._eventManager=new $$WP.Scheduling.EventManager;o._dataPool.AppointmentBuilder.Appointments.addCollectionEventListener("add",o._onAppointmentsChanged);o._dataPool.AppointmentBuilder.Appointments.addCollectionEventListener(e,o._onAppointmentsChanged);o._dataPool.AppointmentBuilder.addPropertyListener("ReasonForVisit",o._updateBuffer);o._dataPool.SchedulingSteps.addPropertyListener("CompleteStatus",o._updateBuffer);o._dataPool.SchedulingSteps.addPropertyListener(f,o._updateBuffer);o.$root.click(o._onSummaryClick);$afe.jq(window).on("resize",o._matchHeights);o._onAppointmentsChanged();o._update()},h={$root:n,_steps:n,_dataPool:n,_workflow:n,_summaryTemplate:n,_previouslyActiveStepId:n,_timerId:n,_eventManager:n,_onAppointmentsChanged:function(){var t=this,r=0,i=n;for(t._eventManager.removeAllListeners(),r=0;r<t._dataPool.AppointmentBuilder.numAppointments();r++)i=t._dataPool.AppointmentBuilder.getAppointment(r),t._eventManager.addCollectionEventListener(i.Providers,"add",t._updateBuffer),t._eventManager.addCollectionEventListener(i.Providers,e,t._updateBuffer),t._eventManager.addCollectionEventListener(i.Locations,"add",t._updateBuffer),t._eventManager.addCollectionEventListener(i.Locations,e,t._updateBuffer)},_update:function(){var n=this,t,i;n.$root.empty();t=n._getViewModel();i=$afe.renderTemplate(n._summaryTemplate,t);n.$root.safeAppend(i);n._matchHeights()},_updateBuffer:function(){clearTimeout(this._timerId);this._timerId=setTimeout(this._update,0)},_getViewModel:function(){var n=this,t={},f=n._dataPool.AppointmentBuilder.ReasonForVisit,i=n._getSlotsViewModel(),r=n._getHeaderComponentsViewModel(),e=n._getLocationsViewModel(),o=n._getProvidersViewModel(),s=i.length===1&&i[0].IsRequest,u;if(t={ShouldShow:r.length>0,Steps:r,Locations:e,ReasonForVisit:f,Providers:o,Slots:i,numSteps:r.length,TicketInfo:n._workflow.TicketInfo,TelehealthSelectedPlatformString:n._dataPool.TelehealthData.TelehealthSelectedPlatformString,IsAnonymous:n._workflow.IsAnonymous,IsRequestWorkflow:s},u=n._dataPool.TelehealthData.SelectedWorkflow,n._dataPool.TelehealthLocations&&n._dataPool.TelehealthLocations.Models&&n._dataPool.TelehealthLocations.Models.length>0){var h=n._dataPool.TelehealthLocations.getFirstInIndex("State",$$WP.Scheduling.TelehealthLocation.StatesEnum.Selected),c=n._dataPool.TelehealthOrganizations.getFirstInIndex("State",$$WP.Scheduling.TelehealthOrganization.StatesEnum.Selected),l=u===$$WP.Scheduling.TelehealthData.TelehealthWorkflow.Queueing;t.TelehealthLocation=h;t.TelehealthOrganization=c;l?t.ProviderName=$$WP.Strings.get("NextProvider","ondemandtelehealth"):n._dataPool.TelehealthData.SelectedProviderName&&(t.ProviderName=n._dataPool.TelehealthData.SelectedProviderName)}return t},_getHeaderComponentsViewModel:function(){var f=this,s,o,e,n,h,c,l;for(h=-1,s=[],l=f._dataPool.AppointmentBuilder.ReasonForVisit,c=f._dataPool.AppointmentBuilder.getFirstAppointment().Slot,o=0;o<f._steps.length;o++)(e=f._dataPool.SchedulingSteps.getFromIndex("ID",f._steps[o].Id),n=f._steps[o],n.IsActive=i,n.Animate=i,n.CanBeSelected=i,e.CompleteStatus!==$$WP.Scheduling.SchedulingStep.CompleteEnum.NotRequired&&(n.summaryType!==r.Questionnaire||e.CompleteStatus!==$$WP.Scheduling.SchedulingStep.CompleteEnum.Complete)&&(n.summaryType!==r.Confirmation||$$WPUtil.IsNullOrEmpty(c)||c.IsRequest!==t)&&(n.summaryType!==r.Provider||f._allowProviderSelectForAnyAppointment()))&&(h>-1?n.Status=u.Inactive:e.CompleteStatus===$$WP.Scheduling.SchedulingStep.CompleteEnum.Incomplete?(h=o,n.Status=u.Incomplete,e.IsReadOnly||(n.CanBeSelected=t)):(n.Status=u.Complete,e.IsReadOnly||(n.CanBeSelected=t)),f._isStepOrChildActive(e)&&(n.IsActive=t,f._previouslyActiveStepId!==n.Id&&(n.Animate=t),f._previouslyActiveStepId=n.Id),s.push(n));return s},_allowProviderSelectForAnyAppointment:function(){for(var t=0,f=n,r=i,u=this._dataPool.AppointmentBuilder,t=0;t<u.numAppointments();t++)f=u.getAppointment(t),r=r||$$WP.Scheduling.Workflow.allowProviderSelectForAppointment(u,f);return r},_getLocationsViewModel:function(){for(var i=this,r=0,u=n,t=[],f=[],e=n,r=0;r<i._dataPool.AppointmentBuilder.numAppointments();r++)u=i._dataPool.AppointmentBuilder.getAppointment(r),u.IsLocationAnyOptionSelected?(e=i._dataPool.Locations.getFromIndex("Id","-1"),t.indexOf(e)===-1&&t.push(e)):(f=u.Locations.toArray().slice(),f.sort($$WP.Scheduling.Location.sortLocations),t=t.concat(f));return i._trimViewModelArray(t)},_getProvidersViewModel:function(){for(var t=this,u=0,f=n,r=[],e=[],o=n,s=i,u=0;u<t._dataPool.AppointmentBuilder.numAppointments();u++)f=t._dataPool.AppointmentBuilder.getAppointment(u),s=$$WP.Scheduling.Workflow.allowProviderSelectForAppointment(t._dataPool.AppointmentBuilder,f),s&&(f.IsProviderAnyOptionSelected?(o=t._dataPool.Providers.getFromIndex("ID","-2"),r.indexOf(o)===-1&&r.push(o)):(e=f.Providers.toArray().slice(),e.sort($$WP.Scheduling.Provider.sortProviders),r=r.concat(e)));return t._trimViewModelArray(r)},_getSlotsViewModel:function(){var t=this,r=[],u=n,i=0,f=n;if(t._dataPool.AppointmentBuilder.showAsMultipleVisits(t._dataPool.VisitTypes))for(i=0;i<t._dataPool.AppointmentBuilder.numAppointments();i++)f=t._dataPool.AppointmentBuilder.getAppointment(i),!f.Slot||r.push(f.Slot);else u=t._dataPool.AppointmentBuilder.getFirstAppointment().Slot,!u||r.push(u);return t._trimViewModelArray(r,1)},_trimViewModelArray:function(n,t){var r=0,i=[];return $$WPUtil.IsNullOrEmpty(t)&&(t=s),i=$$WPSchedulingUtil.RemoveDuplicateElementsFromArray(n),i.length>t+1&&(r=i.length,i.splice(t),i.push({Name:r-t+" "+$$WP.Strings.get("MoreLabel","Scheduling")})),i},_isStepOrChildActive:function(n){var r;return n.ActiveStatus===$$WP.Scheduling.SchedulingStep.ActiveEnum.Active?t:(r=this._dataPool.SchedulingSteps.getFirstInIndex(f,$$WP.Scheduling.SchedulingStep.ActiveEnum.Active),!$$WPUtil.IsNullOrEmpty(r)&&r.StackId===n.ID?t:i)},_matchHeights:function(){var t="minHeight",n,r,i;n=$afe.select(".summaryInfo");r=n.css(t);i=0;n.css(t,"");n.each(function(){$afe.jq(this).outerHeight()>i&&(i=$afe.jq(this).outerHeight())});n.css(t,i);r!==n.css(t)&&setAppropriateHeight()},_onSummaryClick:function(i){var r=this,u=0,e=n;(WP.Events.preventDefault(i),r._dataPool.IsSchedulingCompleting)||(u=parseInt($afe.jq(i.target).closest("[data-model-id]").safeAttr("data-model-id")),r.__isStepSelectable(u)&&(u!==r._previouslyActiveStepId&&(r._dataPool.BlockDemographicInsuranceVerification=t),e=r._dataPool.SchedulingSteps.getFromIndex("ID",u),e.setProperty(f,$$WP.Scheduling.SchedulingStep.ActiveEnum.Active)))},__isStepSelectable:function(t){for(var u={},r=0,f=n,u=this._getHeaderComponentsViewModel(),r=0;r<u.length;r++)if(f=u[r],f.Id===t)return f.CanBeSelected;return i}};o.prototype=h;$$WP.Scheduling.SummaryHeader=o;$$WP.Scheduling.SummaryHeader.SummaryComponentEnum=r;$$WP.Scheduling.SummaryHeader.StatusEnum=u;o.extend($$WP.Controllers.Controller,"WP$Scheduling$SummaryHeader")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert}),function(){var n="OnDemandTelehealth",i="#scheduling-workflow",r="#preloginSchedulingSidebar",u="disabled",f=$$WP.Controllers.Controller,t=function(n,t){var i=this;if(!$$WPUtil.canWriteCookies()){n.hide();self===top?$afe.select("#noCookiesError").show():$afe.select("#noCookies").show();$afe.select("#splashPage").hide();return}i.WP$Controllers$Controller();i.$root=n;i._data=t;i._data.embedded=!0;i._data.isAnonymous=!0;i.proxify("_onKeyDown","_onClick","_onRedirectUrl","_onSettingsLoaded");i.$root.on("keydown",i._onKeyDown);i.$root.on("click",i._onClick);$.post({url:makeLink("Scheduling/Anonymous/GetAnonymousSchedulingSettings"),cache:!1,success:i._onSettingsLoaded})},e={$root:null,_data:null,_onClick:function(n){var t=this,s=$afe.jq(n.target).data("id"),f,e,o;if(typeof s!="undefined"&&!$afe.jq(n.target).hasClass(u)){f=$afe.jq(n.target).data("id").split("-");e=f[0];switch(e){case"redirectToLogin":$.post({url:makeLink("Scheduling/Anonymous/RedirectToLoginStartWorkflow"),data:{workflow:t._data.workflow},cache:!1,success:t._onRedirectUrl});break;case"continueToScheduling":t.$root.hide();o=$afe.select(r);o.empty();new $$WP.Scheduling.SchedulingController($afe.select(i),t._data)}}},_onKeyDown:function(n){var t=$afe.jq(n.target).data("id");t!==undefined&&($afe.jq(n.target).hasClass(u)||(n.which===13||n.which===32)&&(n.preventDefault(),this._onClick(n)))},_onRedirectUrl:function(n){$$WP.Utilities.TryRedirect(makeLink(n.Url))},_onSettingsLoaded:function(n){var t=this,e=t._getSplashPageTemplate(t._data.workflow),o=t._getSplashPageSidebarTemplate(t._data.workflow),s=t._getSplashPageViewModel(t._data.workflow,n),u,f;$$WP.Utilities.IsNullOrEmpty(o)||(u=$afe.renderTemplate(o,s),f=$afe.select(r),f.safeAppend(u));$$WP.Utilities.IsNullOrEmpty(e)?(t.$root.hide(),new $$WP.Scheduling.SchedulingController($afe.select(i),t._data)):(u=$afe.renderTemplate(e,s),f=$afe.select("#splashText"),f.safeReplaceWith(u),$$WP.Utilities.UI.MatchColumnHeights(),setTimeout($$WP.Utilities.UI.MatchColumnHeights,1e3))},_getSplashPageTemplate:function(t){switch(t){case n:return $$WP.Templates.Scheduling.OnDemandTelehealth.SplashPage}},_getSplashPageSidebarTemplate:function(t){switch(t){case n:return $$WP.Templates.Scheduling.OnDemandTelehealth.SplashPageSidebar}},_getSplashPageViewModel:function(t,i){switch(t){case n:return this._getTelehealthSplashPageViewModel(i)}},_getTelehealthSplashPageViewModel:function(n){for(var f="PreloginSidebarStepDetails",t="ondemandtelehealth",e="PreloginSidebarStep",o,u=[],i=1;i<4;i++)$$WP.Utilities.IsNullOrEmpty($$WP.Strings.get(e+i,t))&&$$WP.Utilities.IsNullOrEmpty($$WP.Strings.get(f+i,t))||(o={StepNumber:i,Title:$$WP.Strings.get(e+i,t),Details:$$WP.Strings.get(f+i,t)},u.push(o));var l=!$$WP.Utilities.IsNullOrEmpty($$WP.Strings.get("SplashPageWarning",t)),s=!$$WP.Utilities.IsNullOrEmpty($$WP.Strings.get("SplashPageHardwareTitle",t))||!$$WP.Utilities.IsNullOrEmpty($$WP.Strings.get("SplashPageHardwareDetails",t)),h=!$$WP.Utilities.IsNullOrEmpty($$WP.Strings.get("SplashPagePaymentTitle",t))||!$$WP.Utilities.IsNullOrEmpty($$WP.Strings.get("SplashPagePaymentDetails",t)),c=!$$WP.Utilities.IsNullOrEmpty($$WP.Strings.get("SplashPageAccountTitle",t))||!$$WP.Utilities.IsNullOrEmpty($$WP.Strings.get("SplashPageAccountDetails",t)),r=0;return s&&r++,h&&r++,c&&r++,{Steps:u,MinimumAge:n.MinimumAge,HasWarning:l,ColType:12/r,HasHardwareRequirement:s,HasPaymentRequirement:h,HasAccountRequirement:c}}};t.prototype=e;$$WP.Scheduling.AnonymousSchedulingController=t;t.extend(f,"WP$Scheduling$AnonymousSchedulingController")}(),function(){var a="#schedulingstop-button",c="StartOverButton",f=!1,v="a.button.previousstep",l="relative",e=".loadingoverlay",r="Scheduling",o=!0,n=null,y="Scheduling/GetSchedulingWorkflowData",p=$$WP.Controllers.Controller,u=$$WP.Scheduling.Workflow,i=$$WP.Scheduling.SchedulingStep.StepTypeEnum,w=$$WP.Scheduling.SchedulingWorkflowController,t=$$WP.Scheduling.SummaryHeader.SummaryComponentEnum,s=function(t,i,u){var s=this,h=y,c=n,a="";if(s.WP$Controllers$Controller(),i.isAnonymous){if(!$$WPUtil.canWriteCookies()){t.hide();self===top?$afe.select("#noCookiesError").show():$afe.select("#noCookies").show();return}s.__isAnonymous=o;s.__anonymousSettings=new $$WP.Scheduling.AnonymousSettings;s.__anonymousSettings.AdultWorkflowEnabled=i.adultWorkflowEnabled;s.__anonymousSettings.ProxyWorkflowEnabled=i.proxyWorkflowEnabled;h="Scheduling/Anonymous/GetSchedulingWorkflowData";$afe.select("#ajaxspinner").remove()}i.isGuest&&(s.__isGuest=o);s.$root=t;s.$root.empty();s.__onSchedulingCompleteCallback=u;i.embedded&&(s.__isEmbedded=o,$$WP.Utilities.UI.IsMobile||s.__isAnonymous||(s.$root.addClass("scheduling-embedded"),t.addClass("lightGrayBG")));s.__params=i;s.proxify("__onWorkflowSelected","__onRequestCompleted","__onStopScheduling","__onDataLoaded","__onSchedulingComplete","__onStartOver","__onError","__onWorkflowStepError","__onReturn");$$WPUtil.IsNullOrEmpty(i.workflow)&&(c=$$WP.Strings.getNamespace(r),a=c.getString("SchedulingPageLoadingMessage"));Handlebars.registerPartial("loadingMessage",$$WP.Templates.Scheduling.LoadingMessage);s.$root.safeAppend($afe.renderTemplate($$WP.Templates.Scheduling.LoadingMessage,a));isDataTile()&&s.$root.find(e).addClass(l);s.$root.find(e).show();s.__isEmbedded||$afe.select("body").find(v).hide();$.post({url:makeLink(h),data:{schedulingParameters:i,disableRTL:i.disableRTL},cache:f,error:s.__onError,success:s.__onDataLoaded})},h={VisitScheduled:0,VisitRequested:1,NotScheduled:2},b={HasNoLicensedTelehealthProviders:0},k={$root:n,__params:n,__workflowSettings:n,__workflows:n,__workflowSelectionListenerId:n,__landingPageController:n,$workflowsContainer:n,$requestFinishedContainer:n,$schedulingStoppedContainer:n,__schedulingWorkflowController:n,__sidebarController:n,__linksSidebarWidget:n,__onSchedulingCompleteCallback:n,__preventAppendingErrorMessageOnStop:f,__isEmbedded:f,__isAnonymous:f,__isGuest:f,__anonymousSettings:n,__onDataLoaded:function(t){var o="&xorgid=",s="Home/LogOut?mode=OnDemandTelehealth&workflowcomplete=1&eCSN=",i=this,h=n,c=n,a=n,v=n,r=n;if(h=t,c=t.Tickets,a=t.FavoriteAppointments,v=t.OriginalAppointment,i.__workflowSettings=t.WorkflowSettings,i.__workflowSettings.IsEmbedded=i.__isEmbedded,$$WPUtil.IsNullOrEmpty(t)){i.__onStopScheduling();return}if(i.__workflowSettings.WorkflowType===u.WorkflowTypesEnum.OnDemandTelehealth&&(!$$WPUtil.IsNullOrEmpty(t.OnDemandTelehealthData.OnDemandVideoVisitCSN)||t.OnDemandTelehealthData.InXOrgQueue)){t.OnDemandTelehealthData.InXOrgQueue?$$WP.Utilities.UI.IsMobile?i.__workflowSettings.IsXOrgFeatureAvailableOnMobile?$$WP.Utilities.TryRedirect(makeLink(s+encodeURIComponent(t.OnDemandTelehealthData.XOrgCSN)+o+encodeURIComponent(t.OnDemandTelehealthData.XOrgId))):$$WP.Utilities.TryRedirect(makeLink("Home/LogOut?mode=OnDemandTelehealth&workflowcomplete=1&visitslist=1")):$$WP.Utilities.TryRedirect(makeLink("Visits/visitslist?xorgcsn="+encodeURIComponent(t.OnDemandTelehealthData.XOrgCSN)+o+encodeURIComponent(t.OnDemandTelehealthData.XOrgId))):$$WP.Utilities.UI.IsMobile?$$WP.Utilities.TryRedirect(makeLink(s+encodeURIComponent(t.OnDemandTelehealthData.OnDemandVideoVisitCSN))):$$WP.Utilities.TryRedirect(makeLink("Visits/VisitDetails?csn="+encodeURIComponent(t.OnDemandTelehealthData.OnDemandVideoVisitCSN)));return}i.$workflowsContainer=i.__createContainer();i.$root.safeAppend(i.$workflowsContainer);i.$workflowsContainer.show();i.$requestFinishedContainer=i.__createContainer();i.$requestFinishedContainer.safeAppend($afe.renderTemplate($$WP.Templates.Scheduling.RequestFinishedStep));i.$schedulingStoppedContainer=i.__createContainer();i.$root.safeAppend(i.$schedulingStoppedContainer);i.$root.find(e).hide();isDataTile()&&i.$root.find(e).removeClass(l);i.__workflows=$$WP.Scheduling.Workflow.createWorkflowCollection(i.__workflowSettings.WorkflowType,h,c,a,v,i.__workflowSettings.ShowOtherProviderOption,i.__workflowSettings.ShowOtherRfvOption,i.__workflowSettings.RootDecisionTreeId,i.__workflowSettings.DecisionTreeNodeId,i.__workflowSettings.DecisionTreeNodeCsn,i.__isAnonymous,i.__isGuest,i.__anonymousSettings);$$WPUtil.IsNullOrEmpty(i.__workflowSettings.WorkflowType)||(r=$$WP.Scheduling.Workflow.getWorkflowFromType(i.__workflows,i.__workflowSettings.WorkflowType,i.__workflowSettings.TicketId));i.__preventAppendingErrorMessageOnStop=f;r?i.__runWorkflow(r):i.__runWorkflowSelectionStep()},__getWorkflowStepDefinitions:function(n){var i=this,r;switch(n){case u.WorkflowTypesEnum.ExistingProvider:r=[i.__createProviderStepDefinition(),i.__createStackedWorkflowStepDefinition([i.__createReasonForVisitStepDefinition(),i.__createStandardLqfStepDefinition()],t.ReasonForVisit),i.__createStackedWorkflowStepDefinition([i.__createLocationStepDefinition(),i.__createDepartmentLqfStepDefinition()],t.Location),i.__createCustomWorkflowStepDefinition(),i.__createStackedWorkflowStepDefinition([i.__createSlotStepDefinition(),i.__createRequestStepDefinition()],t.Time),i.__createVerificationStepDefinition()];break;case u.WorkflowTypesEnum.Procedure:r=[i.__createStackedWorkflowStepDefinition([i.__createReasonForVisitStepDefinition(),i.__createStandardLqfStepDefinition()],t.ReasonForVisit),i.__createOnboardingStepDefinition(),i.__createStackedWorkflowStepDefinition([i.__createLocationStepDefinition(),i.__createDepartmentLqfStepDefinition()],t.Location),i.__createMultiAppointmentStepDefinition(i.__createProviderStepDefinition(),t.Provider),i.__createCustomWorkflowStepDefinition(),i.__createStackedWorkflowStepDefinition([i.__createSlotStepDefinition(),i.__createRequestStepDefinition()],t.Time),i.__createVerificationStepDefinition()];break;case u.WorkflowTypesEnum.Ticket:r=[i.__createTicketStepDefinition(),i.__createStandardLqfStepDefinition(),i.__createOnboardingStepDefinition(),i.__createLocationStepDefinition(),i.__createMultiAppointmentStepDefinition(i.__createProviderStepDefinition(),t.Provider),i.__createSlotStepDefinition(),i.__createVerificationStepDefinition()];break;case u.WorkflowTypesEnum.Request:r=[i.__createReasonForVisitStepDefinition(),i.__createProviderStepDefinition(),i.__createLocationStepDefinition(),i.__createCustomWorkflowStepDefinition(),i.__createStackedWorkflowStepDefinition([i.__createSlotStepDefinition(),i.__createRequestStepDefinition()],t.Request)];break;case u.WorkflowTypesEnum.Reschedule:r=[i.__createStackedWorkflowStepDefinition([i.__createOriginalAppointmentStepDefinition(),i.__createMultiAppointmentStepDefinition(i.__createProviderStepDefinition())],t.Provider),i.__createStackedWorkflowStepDefinition([i.__createOriginalAppointmentStepDefinition(),i.__createLocationStepDefinition()],t.Location),i.__createStackedWorkflowStepDefinition([i.__createOriginalAppointmentStepDefinition(),i.__createSlotStepDefinition()],t.Time),i.__createConfirmationStepDefinition()];break;case u.WorkflowTypesEnum.DecisionTreeNode:r=[i.__createProviderStepDefinition(),i.__createLocationStepDefinition(),i.__createCustomWorkflowStepDefinition(),i.__createStackedWorkflowStepDefinition([i.__createSlotStepDefinition(),i.__createRequestStepDefinition()],t.Time),i.__createVerificationStepDefinition()];break;case u.WorkflowTypesEnum.OnDemandTelehealth:r=[i.__createStackedWorkflowStepDefinition([i.__createTelehealthLocationStepDefinition()],t.TelehealthLocation),i.__createStackedWorkflowStepDefinition([i.__createReasonForVisitStepDefinition()],t.ReasonForVisit)];$$WP.Utilities.UI.IsMobile||i.__isAnonymous||i.__isGuest||r.push(i.__createStackedWorkflowStepDefinition([i.__createTelehealthPlatformStepDefinition()],t.TelehealthPlatform));i.__workflowSettings.QuickScheduleStepSettings&&i.__workflowSettings.QuickScheduleStepSettings.Hide===o||(r.push(i.__createStackedWorkflowStepDefinition([i.__createTelehealthQuickScheduleStepDefinition()],t.QuickSchedule)),r.push(i.__createStackedWorkflowStepDefinition([i.__createSlotStepDefinition()],t.Time)));i.__isAnonymous||i.__isGuest||r.push(i.__createStackedWorkflowStepDefinition([i.__createTelehealthOrganizationStepDefinition(),i.__createTelehealthAuthorizationStepDefinition()],t.TelehealthOrganization));r.push(i.__createStackedWorkflowStepDefinition([i.__createTelehealthSummaryStepDefinition()],t.TelehealthSummary));break;default:r=[i.__createHeaderlessProviderStepDefinition(),i.__createHeaderlessStackedWorkflowStepDefinition([i.__createReasonForVisitStepDefinition()]),i.__createHeaderlessSlotStepDefinition(),i.__createHeaderlessStackedWorkflowStepDefinition([i.__createDemographicsVerificationStepDefinition(),i.__createInsuranceVerificationStepDefinition(),i.__createConfirmationStepDefinition()])]}return r},__runWorkflowSelectionStep:function(){var n=this,t;t=n.__createContainer();n.$workflowsContainer.safeAppend(t);t.show();n.__workflowSelectionListenerId=n.__workflows.addPropertyListener("State",n.__onWorkflowSelected);n.__landingPageController=new $$WP.Scheduling.LandingPageController(t,n.__workflows);n.__landingPageController.show();n.__setupSidebar()},__runWorkflow:function(n){var t=this,i;if(t.$workflowsContainer.hide(),t.__linksSidebarWidget&&t.__linksSidebarWidget.remove(),n.IsFavorite&&(t.__setFavoritePreselections(n),t.__auditFavoriteAppointmentUse(n.FavoriteAppointmentInfo.Csn)),t.__isWorkflowEmpty(n)&&!t.__canWorkflowRunWhenEmpty(n)){t.__onStopScheduling();return}i=t.__getWorkflowStepDefinitions(n.Type);t.__schedulingWorkflowController=new w(t.$root,i,n,t.__workflowSettings,t.__onSchedulingComplete,t.__onRequestCompleted,t.__onStopScheduling,t.__onStartOver,t.__onWorkflowStepError,t.__params.disableRTL);t.__schedulingWorkflowController.render();n.start()},__isWorkflowEmpty:function(n){return n.SchedulingDataPool.ProviderDepartmentPairs.Models.length===0},__canWorkflowRunWhenEmpty:function(n){var t=n.Type;return t===u.WorkflowTypesEnum.OnDemandTelehealth||t===u.WorkflowTypesEnum.Procedure||t===u.WorkflowTypesEnum.Ticket},__setFavoritePreselections:function(n){var u,i,t,r;u=n.FavoriteAppointmentInfo.ReasonForVisitCategoryValue;i=n.SchedulingDataPool.ReasonsForVisit.getFirstInIndex("CategoryValue",n.FavoriteAppointmentInfo.ReasonForVisitCategoryValue).Id;this.__workflowSettings.PreselectedReasonForVisitId=[i];t=n.FavoriteAppointmentInfo.ProviderId;$$WPUtil.IsNullOrEmpty(t)||(this.__workflowSettings.PreselectedProviderIds=[t]);r=n.FavoriteAppointmentInfo.DepartmentId;this.__workflowSettings.PreselectedDepartmentIds=[r]},__auditFavoriteAppointmentUse:function(n){$.post({url:makeLink("Scheduling/AuditFavoriteAppointmentUse"),data:{csn:n}})},__setupSidebar:function(){var t=this;t.__isEmbedded||(t.__linksSidebarWidget=$$WP.Utilities.UI.SidebarManager.addWidget($$WP.Templates.Scheduling.SchedulingSidebarLinks,{},3,f),t.__sidebarController=new $$WP.Scheduling.SidebarController(t.__linksSidebarWidget,n,t.__workflowSettings))},__onWorkflowSelected:function(){var n=this.__workflows.getFirstInIndex("State",u.StatesEnum.Selected);this.__runWorkflow(n)},__onRequestCompleted:function(t){var i=this;$$WPUtil.IsNullOrEmpty(i.__onSchedulingCompleteCallback)?t?$$WP.Utilities.TryRedirect(makeLink("Home/LogOut?mode=apptsched&workflowcomplete=1")):(i.__schedulingWorkflowController.destroy(),i.__schedulingWorkflowController=n,i.$root.safeAppend(i.$requestFinishedContainer),i.$requestFinishedContainer.fadeIn(matchWrapHeight),i.$root.find("h2.requestfinishedtitle").focus()):i.__onSchedulingCompleteCallback(h.VisitRequested)},__onSchedulingComplete:function(t,i,r){var u=this;$$WPUtil.IsNullOrEmpty(u.__schedulingWorkflowController)||(u.__schedulingWorkflowController.destroy(o),u.__schedulingWorkflowController=n);$$WPUtil.IsNullOrEmpty(u.__onSchedulingCompleteCallback)?r?u.__redirectToMobileDetails(t,i):u.__redirectToWebDetails(t,i):u.__onSchedulingCompleteCallback(h.VisitScheduled,t)},__redirectToMobileDetails:function(n,t){var i="&apptcount=",r="";n.length!==1&&t?$$WP.Utilities.TryRedirect(makeLink("Home/LogOut?mode=apptmake&workflowcomplete=1"+i+n.length.toString())):(r=n[0].CSN,$$WP.Utilities.TryRedirect(makeLink("Home/LogOut?mode=apptmake&workflowcomplete=1&eCSN="+encodeURIComponent(r)+i+n.length.toString())))},__redirectToWebDetails:function(n,t){var i="",r="",e=[],o=[],u=0,f="";if(n.length!==1&&t){for(u=0;u<n.length;u++)r=n[u].CSN,i=n[u].UCI,$$WPUtil.IsNullOrEmpty(r)||e.push(r),$$WPUtil.IsNullOrEmpty(i)||o.push(i);o.length>0?f="&ucilist="+encodeURI(o.join(",")):e.length>0&&(f="&csnlist="+encodeURIComponent(e.join(",")))}else r=n[0].CSN,i=n[0].UCI,f=$$WP.Utilities.IsNullOrEmpty(i)?"&csn="+encodeURIComponent(r):"&uci="+encodeURIComponent(i);$$WP.Utilities.TryRedirect(makeLink("inside.asp?mode=visitdetails"+f+"&scheduled=1"))},__onStopScheduling:function(t){var i=this,u;$$WPUtil.IsNullOrEmpty(i.__schedulingWorkflowController)||(i.__schedulingWorkflowController.destroy(),i.__schedulingWorkflowController=n);t=$$WPUtil.IsNullOrEmpty(t)?{}:t;$$WPUtil.IsNullOrEmpty(i.__onSchedulingCompleteCallback)?i.__preventAppendingErrorMessageOnStop||(t.IsOnDemandTelehealth&&(t=i.__setTelehealthStopSchedulingMessage(t)),$$WPUtil.IsNullOrEmpty(t.SchedulingStoppedTitle)&&(t.SchedulingStoppedTitle=$$WP.Strings.get("SchedulingStoppedTitle",r)),$$WPUtil.IsNullOrEmpty(t.SchedulingStoppedPretext)&&(t.SchedulingStoppedPretext=$$WP.Strings.get("SchedulingStoppedPretext",r)),$$WPUtil.IsNullOrEmpty(t.SchedulingStoppedButtontext)&&(t.SchedulingStoppedButtontext=$$WP.Strings.get(c,r)),i.$root.safeAppend($afe.renderTemplate($$WP.Templates.Scheduling.SchedulingStopped,t)),i.$root.find(a).click(i.__onStartOver),i.$schedulingStoppedContainer.fadeIn(matchWrapHeight),i.__preventAppendingErrorMessageOnStop=o,i.$root.find("h2").focus()):(t.HasNoLicensedTelehealthProviders&&(u=b.HasNoLicensedTelehealthProviders),i.__onSchedulingCompleteCallback(h.NotScheduled,n,u))},__setTelehealthStopSchedulingMessage:function(n){var t="VideoVisitStoppedTitle";return n=$$WPUtil.IsNullOrEmpty(n)?{}:n,n.HasNoLicensedTelehealthProviders?(n.SchedulingStoppedTitle=$$WP.Strings.get(t,r),n.SchedulingStoppedPretext=$$WP.Strings.get("VideoVisitNoLicensureStoppedPretext",r),n.SchedulingStoppedButtontext=$$WP.Strings.get(c,r)):(n.SchedulingStoppedTitle=$$WP.Strings.get(t,r),n.SchedulingStoppedPretext=$$WP.Strings.get("VideoVisitStoppedPretext",r),n.SchedulingStoppedButtontext=$$WP.Strings.get(c,r)),n},__onError:function(){var n=this,t={SchedulingStoppedTitle:$$WP.Strings.get("LandingPageErrorTitle",r),SchedulingStoppedPretext:$$WP.Strings.get("LandingPageErrorMessage",r),SchedulingStoppedButtontext:$$WP.Strings.get("LandingPageErrorButtonLabel",r)};n.$root.safeAppend($afe.renderTemplate($$WP.Templates.Scheduling.SchedulingStopped,t));n.$root.find(a).click(n.__onReturn);n.$root.find(e).hide()},__onWorkflowStepError:function(){var n={SchedulingStoppedTitle:$$WP.Strings.get("WorkflowStepErrorTitle",r),SchedulingStoppedPretext:$$WP.Strings.get("WorkflowStepErrorMessage",r),SchedulingStoppedButtontext:$$WP.Strings.get("WorkflowStepErrorButtonLabel",r)};this.__onStopScheduling(n)},__onStartOver:function(){var t=this;$$WPUtil.IsNullOrEmpty(t.__schedulingWorkflowController)||(t.__schedulingWorkflowController.destroy(),t.__schedulingWorkflowController=n);$afe.select("#scheduling-startover").unbind("click").addClass("hidden");t.$root.empty().safeAppend($afe.renderTemplate($$WP.Templates.Scheduling.LoadingMessage));isDataTile()&&t.$root.find(e).addClass(l);t.$root.find(e).show();t.__isEmbedded||$afe.select("body").find(v).hide();$.post({url:makeLink(y),data:{schedulingParameters:t.__params},cache:f,error:t.__onError,success:t.__onDataLoaded})},__onReturn:function(){window.history.back()},__createContainer:function(){return $$WP.SimpleTemplates.Div({"class":"jqHidden stepcontainer"})},__createTicketStepDefinition:function(){return this.__createReadOnlyWorkflowStepDefinition(t.Ticket)},__createProviderStepDefinition:function(){return this.__createWorkflowStepDefinition(i.Provider,t.Provider)},__createLocationStepDefinition:function(){return this.__createWorkflowStepDefinition(i.Location,t.Location)},__createVerificationStepDefinition:function(){return this.__createWorkflowStepDefinition(i.Verification,t.Confirmation)},__createConfirmationStepDefinition:function(){return this.__createWorkflowStepDefinition(i.Confirmation,t.Confirmation)},__createStandardLqfStepDefinition:function(){return this.__createWorkflowStepDefinition(i.StandardLqf,t.Questionnaire)},__createDepartmentLqfStepDefinition:function(){return this.__createWorkflowStepDefinition(i.DepartmentLqf,t.Questionnaire)},__createSlotStepDefinition:function(){return this.__createWorkflowStepDefinition(i.Slot,t.Time)},__createRequestStepDefinition:function(){return this.__createWorkflowStepDefinition(i.Request,n)},__createOriginalAppointmentStepDefinition:function(){return this.__createWorkflowStepDefinition(i.OriginalApptInfo,n)},__createReasonForVisitStepDefinition:function(){return this.__createWorkflowStepDefinition(i.ReasonForVisit,t.ReasonForVisit)},__createHeaderlessProviderStepDefinition:function(){return this.__createWorkflowStepDefinition(i.Provider,n)},__createHeaderlessSlotStepDefinition:function(){return this.__createWorkflowStepDefinition(i.Slot,n)},__createTelehealthLocationStepDefinition:function(){return this.__createWorkflowStepDefinition(i.TelehealthLocation,n)},__createTelehealthPlatformStepDefinition:function(){return this.__createWorkflowStepDefinition(i.PlatformStep,n)},__createTelehealthQuickScheduleStepDefinition:function(){return this.__createWorkflowStepDefinition(i.QuickSchedule,n)},__createTelehealthOrganizationStepDefinition:function(){return this.__createWorkflowStepDefinition(i.TelehealthOrganization,n)},__createTelehealthAuthorizationStepDefinition:function(){return this.__createWorkflowStepDefinition(i.TelehealthAuth,n)},__createTelehealthSummaryStepDefinition:function(){return this.__createWorkflowStepDefinition(i.TelehealthSummary,n)},__createInsuranceVerificationStepDefinition:function(){return this.__createWorkflowStepDefinition(i.Insurance,n)},__createDemographicsVerificationStepDefinition:function(){return this.__createWorkflowStepDefinition(i.Demographics,n)},__createMultiAppointmentStepDefinition:function(n,t){return{type:i.MultiAppointment,stackedSteps:[n],summaryType:t}},__createOnboardingStepDefinition:function(){return this.__createWorkflowStepDefinition(i.Onboarding,n)},__createStackedWorkflowStepDefinition:function(n,t){return{type:i.Stacked,stackedSteps:n,summaryType:t}},__createHeaderlessStackedWorkflowStepDefinition:function(t){return this.__createStackedWorkflowStepDefinition(t,n)},__createCustomWorkflowStepDefinition:function(){return{type:i.Custom}},__createWorkflowStepDefinition:function(n,t){return this.__createRawWorkflowStepDefinition(n,t,f)},__createReadOnlyWorkflowStepDefinition:function(n){return this.__createRawWorkflowStepDefinition("",n,o)},__createRawWorkflowStepDefinition:function(n,t,i){return{type:n,summaryType:t,isReadOnly:i}}};s.prototype=k;s.SchedulingStatusEnum=h;$$WP.Scheduling.SchedulingController=s;s.extend(p,"WP$Scheduling$SchedulingController")}();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function(){var n=$$WP.Debug.UnitTest.assert})
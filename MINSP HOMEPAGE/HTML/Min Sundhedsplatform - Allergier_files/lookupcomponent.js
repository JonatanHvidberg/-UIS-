/*! Copyright (c) Epic Systems Corporation 2017-2019 */
$$WPComp.LookupComponent=function $$WPComp$LookupComponent(b){var a=this;if(b){if(b.StartSearchAtCharCount&&0<b.StartSearchAtCharCount<5)a.StartSearchAtCharCount=b.StartSearchAtCharCount;if(b.AllowBlankSearches)a.AllowBlankSearches=true}a.Components$TemplateComponent(b);a.addEventListener("keyup",a._searchKeyUp);a.addEventListener("keydown",a._searchKeyDown);a.addEventListener("click",a._click);a.QueryDataMap=new Map};$$WPComp.LookupComponent.SearchImgSrc=makeStaticLink("Images/search_white.png");$$WPComp.LookupComponent.SelectImgSrc=makeStaticLink("Images/add_white.png");$$WPComp.LookupComponent.StartOverImgSrc=makeStaticLink("Images/edit.svg");$$WPComp.LookupComponent.LoadingImgSrc=makeStaticLink("Images/spinner64.gif");$$WPComp.LookupComponent.prototype={SupressTitle:true,template:$$WP.Templates.Lookup.LookupPopup,suggestionTemplate:$$WP.Templates.Core.LookupSuggestions,resultTemplate:$$WP.Templates.Lookup.LookupResults,Class:"lookup",Url:"",SearchKey:"",Namespace:"",QueryDataMap:null,LastClickTime:0,LastQueryMode:"",SUGGESTION:"suggestion",RESULT:"result",ResultsData:"",SuggestionsData:"",AllowCustomValues:true,StartSearchAtCharCount:3,AllowBlankSearches:false,AlwaysShowSearchMore:false,ShowDisclaimer:false,setData:function $$WP$Lookup$setData(a){a.SearchImgSrc=$$WPComp.LookupComponent.SearchImgSrc;a.SelectImgSrc=$$WPComp.LookupComponent.SelectImgSrc;a.StartOverImgSrc=$$WPComp.LookupComponent.StartOverImgSrc;a.LoadingImgSrc=$$WPComp.LookupComponent.LoadingImgSrc;a=this.updateMnemonics(a);this.Components$TemplateComponent$setData(a)},show:function $$WP$Lookup$show(){var a=this;a.Components$TemplateComponent$show();var b=".ghostInput input[type='text']";a.$content.on("focus",b,$$WP.Utilities.UI.FocusGhostableInput);a.$content.on("blur change",b,$$WP.Utilities.UI.BlurGhostableInput);a.$content.find(b).each($$WP.Utilities.UI.BlurGhostableInput);var c=".ghostInput label";a.$content.on("click",c,a._clickGhostableLabel)},updateMnemonics:function $$WP$Lookup$updateMnemonics(a){$$WP.Strings.setDefaultNamespace(this.Namespace);a.NameLabel=$$WP.Strings.getForTemplate("lookup_name_label");a.SearchPlaceholder=$$WP.Strings.getForTemplate("lookup_search_placeholder");a.CustomHeader=$$WP.Strings.getForTemplate("lookup_custom_pretext");a.CustomPlaceholder=$$WP.Strings.getForTemplate("lookup_custom_placeholder");a.FormHeader=$$WP.Strings.getForTemplate("lookup_form_header");a.AcceptButtonLabel=$$WP.Strings.getForTemplate("lookup_custom_accept");a.TrySearchButtonLabel=$$WP.Strings.getForTemplate("lookup_custom_trysearch");a.StartOverLabel=$$WP.Strings.getForTemplate("lookup_startover_label");a.OpenPopupText=$$WP.Strings.getForTemplate("lookup_open_popup_text");a.ClosePopupInstruction=$$WP.Strings.getForTemplate("lookup_close_popup_instruction");$$WP.Strings.clearDefaultNamespace();return a},updateSuggestionsMnemonics:function $$WP$Lookup$updateSuggestionsMnemonics(a){var d="@MYCHART@CUSTOMLINK@",c="suggestionlink linkcolorOverride",b=this;$$WP.Strings.setDefaultNamespace(b.Namespace);a.SearchTagLabel=$$WP.Strings.getForTemplate("lookup_suggestion_search_tag");var i=$$WP.Strings.getForTemplate("lookup_suggestion_has_more_results").string,e=$$WP.SimpleTemplates.Anchor({"class":c,"data-id":"searchmore"},i);a.NotAllResultsShown=new Handlebars.SafeString(e[0].outerHTML);if(b.AlwaysShowSearchMore){a.AllResultsShown=a.NotAllResultsShown;a.NoResultsFound=a.NotAllResultsShown}else if(b.AllowCustomValues){var g=$$WP.Strings.getForTemplate("lookup_suggestion_custom_link").string,h=$$WP.SimpleTemplates.Anchor({"class":c,"data-id":"custom",href:"#"},g),f=h[0].outerHTML;$$WP.Strings.addMnemonic(d,f,false,null,$$WP.Strings.EncodingTypes.None);a.AllResultsShown=$$WP.Strings.getForTemplate("lookup_suggestion_all_results_shown_allow_custom");a.NoResultsFound=$$WP.Strings.getForTemplate("lookup_suggestion_no_results_allow_custom");$$WP.Strings.removeMnemonic(d)}else{a.AllResultsShown=$$WP.Strings.getForTemplate("lookup_suggestion_all_results_shown");a.NoResultsFound=$$WP.Strings.getForTemplate("lookup_suggestion_no_results")}if(a.ResultRecords&&a.ResultRecords.length>0)if(a.HasMore)a.SuggestionInfoText=a.NotAllResultsShown;else a.SuggestionInfoText=a.AllResultsShown;else a.SuggestionInfoText=a.NoResultsFound;if(b.ShowDisclaimer)a.SuggestionDisclaimerText=$$WP.Strings.getForTemplate("lookup_suggestion_disclaimer");$$WP.Strings.clearDefaultNamespace();a=b.updateMnemonics(a);return a},updateResultsMnemonics:function $$WP$Lookup$updateResultsMnemonics(a){var d="@MYCHART@CUSTOMLINK@",c="@MYCHART@HITS@",b=this;$$WP.Strings.setDefaultNamespace(b.Namespace);a.NoResultsPreText=$$WP.Strings.getForTemplate("lookup_results_pretext_no_results");$$WP.Strings.addMnemonic(c,a.Hits);a.FewResultsPreText=$$WP.Strings.getForTemplate("lookup_results_pretext_few_results");a.MoreResultsPreText=$$WP.Strings.getForTemplate("lookup_results_pretext_more_results");$$WP.Strings.removeMnemonic(c);if(b.AllowCustomValues){var f=$$WP.Strings.getForTemplate("lookup_results_custom_link").string,g=$$WP.SimpleTemplates.Anchor({"class":"suggestionlink linkcolorOverride","data-id":"custom",href:"#"},f),e=g[0].outerHTML;$$WP.Strings.addMnemonic(d,e,false,null,$$WP.Strings.EncodingTypes.None);a.ResultsPostText=$$WP.Strings.getForTemplate("lookup_results_posttext_allow_custom");$$WP.Strings.removeMnemonic(d)}else a.ResultsPostText=$$WP.Strings.getForTemplate("lookup_results_posttext");if(b.ShowDisclaimer)a.ResultsDisclaimerText=$$WP.Strings.getForTemplate("lookup_results_disclaimer");$$WP.Strings.clearDefaultNamespace();a=b.updateMnemonics(a);return a},setSelectedObject:function setSelectedObject(a){this._returnResult(a,this.SUGGESTION)},_searchKeyDown:function $$WP$Lookup$_searchKeyDown(a){var b=38;a.which===b&&a.preventDefault()},_searchKeyUp:function $$WP$Lookup$_searchKeyUp(b){var f=false,j="searchbox",i="tabIndex",a=this,e,g,c,n=13,q=9,r=38,m=40,p=37,o=39,k;e=a.$content.find("input.search");g=a.$content.find("input.searchimg");c=e.val();if(c||a.AllowBlankSearches)g.removeAttr(i);else g.safeAttr(i,"-1");if(b.keyCode===n&&(c||a.AllowBlankSearches)){k=+new Date;if(k-a.LastClickTime>300)if(b.dataId===j)a._handleSubmit();else b.dataId==="custombox"&&a._customAccept()}else if((b.keyCode===m||b.keyCode===r)&&e.val()){if(b.dataId===j){var h=a.$content.find(".suggestion.selected");if(h.length===0)return f;var d;if(b.keyCode===m){d=h.next();if(d.safeAttr("data-id")==="suggestioninfo"&&d.find("a").length<1)return f}else d=h.prev();a._updateSelected(d)}}else if((b.keyCode===q||b.keyCode===p||b.keyCode===o)&&e.val())return f;else if(b.$target.safeAttr("type")==="text")if(c.length>=a.StartSearchAtCharCount)a._makeQuery(c,a.SUGGESTION);else if(e.val()){var l={};l.HideSuggestionInfo=true;a.SearchKey=c;a._processOutput(l,{mode:a.SUGGESTION,searchString:c})}else{a._cleanUpSuggestions();!a.AllowBlankSearches&&a._cleanUpResults()}return f},_updateSelected:function $$WP$Lookup$_updateSelected(a){var d="input.searchimg",e="data-key",c="selected",b=this,f=b.$content.find("input.search");if(a&&a.length>0){if(a.hasClass(c))return false;b.$content.find(".suggestion.selected").removeClass(c);a.addClass(c);if(a.safeAttr("data-id")==="suggestionsearch"){b.SearchKey=a.safeAttr(e);b.$content.find(d).safeAttr("src",$$WPComp.LookupComponent.SearchImgSrc)}else if(a.safeAttr("data-id")==="suggestioninfo"){var g=b.$content.find(".suggestion.suggestionsearch");b.SearchKey=g.safeAttr(e);b.$content.find(d).safeAttr("src",$$WPComp.LookupComponent.SelectImgSrc)}else{b.SearchKey=a[0].children.length>0?a[0].children[0].textContent:a[0].textContent;b.$content.find(d).safeAttr("src",$$WPComp.LookupComponent.SelectImgSrc)}f&&f.val(b.SearchKey)}},makeUrl:function $$WP$Lookup$makeUrl(){console.error("Descendents of LookupComponent should implement makeUrl method")},_makeQuery:function $$WP$Lookup$_makeQuery(d,f){var a=this,c,e,b,g=a;a.SearchKey=d;a.LastQueryMode=f;c=a.makeUrl(d,f);b={mode:f,searchString:d};e=a.QueryDataMap.get(c);if(e)a._processOutput(e,b);else{b.url=c;getCSRFTokenAsQS(function(a){g.makeRequest({url:c,type:"POST",dataType:"json",data:a,success:g._processOutput},"load",false,b)})}},_processOutput:function $$WP$Lookup$_processOutput(b,e){var a=this,c,f,d,h,g;if(!b)return false;e.url&&a.QueryDataMap.set(e.url,b);d=e.mode;if(d!==a.LastQueryMode)return false;if(d===a.SUGGESTION)if(a.SearchKey!==e.searchString)return false;a._hideLoading();b.SearchString=e.searchString;if(b.ResultRecords&&b.ResultRecords.length>0)if(b.HasMore)b.ResultsStatus="partialresults";else b.ResultsStatus="allresults";else b.ResultsStatus="noresults";if(d===a.RESULT){a.ResultsData=a.updateResultsMnemonics(b);f=$afe.renderTemplate(a.resultTemplate,a.ResultsData);c=a.$content.find("div.searchresults");h=f.find("div.resultspretext");g=a.$content.find("input.search");h.length>0&&g.safeAttr("aria-labelledby","searchresultstext");g.focus();a._cleanUpSuggestions();a.$content.find("div.searchcontainer").removeClass("center")}else if(d===a.SUGGESTION){a.SuggestionsData=a.updateSuggestionsMnemonics(b);f=$afe.renderTemplate(a.suggestionTemplate,a.SuggestionsData);c=a.$content.find("ul.searchsuggestions");a._cleanUpResults()}if(c){c.empty();c.safeAppend(f.children());c.removeClass("hidden")}if(d===a.SUGGESTION){a._addOverflowVisible();a.$content.find("input.searchimg").safeAttr("src",$$WPComp.LookupComponent.SearchImgSrc)}if(d===a.RESULT){a._removeOverflowVisible();$$WP.Behaviors.matchRowHeights(c,"div.results.list.hoverable a.anchorListElement.resultelement")}a.$container.trigger("resize",{forceShrink:true})},_cleanUpSuggestions:function $$WP$Lookup$_cleanUpSuggestions(){var a=this.$content.find("ul.searchsuggestions");if(a){a.addClass("hidden");a.empty();this.$container.trigger("resize",{forceShrink:true})}this.$content.find("input.searchimg").safeAttr("src",$$WPComp.LookupComponent.SearchImgSrc)},_cleanUpResults:function $$WP$Lookup$_cleanUpResults(){var a=this.$content.find("div.searchresults");if(a){a.addClass("hidden");a.empty();this.$container.trigger("resize",{forceShrink:true});this.$content.find("input.search").safeAttr("aria-labelledby","")}},_showLoading:function $$WP$Lookup$_showLoading(){this.$content.find("div.searchloading").removeClass("hidden");this.$container.trigger("resize",{forceShrink:true})},_hideLoading:function $$WP$Lookup$_hideLoading(){this.$content.find("div.searchloading").addClass("hidden");this.$container.trigger("resize",{forceShrink:true})},_addOverflowVisible:function $$WP$Lookup$_addOverflowVisible(){$afe.select(".Popup.lookupcontainer").addClass("overflowvisible")},_removeOverflowVisible:function $$WP$Lookup$_removeOverflowVisible(){$afe.select(".Popup.lookupcontainer").removeClass("overflowvisible")},startOver:function $$WP$Lookup$startOver(){var a=this;a.LastClickTime=+new Date;a._cleanUpSuggestions();a._cleanUpResults();a.$content.find(".beforeselection").removeClass("hidden");a.$content.find(".afterselection").addClass("hidden");a.$content.find("input.selectionlabel").val("");a.$content.find("div.searchcontainer").addClass("center");a.$content.find("input.searchimg").safeAttr("src",$$WPComp.LookupComponent.SearchImgSrc);a.$content.find("input.search").focus();a.$content.find("input.custom").focus();a.$container.trigger("resize",{forceShrink:true})},_click:function $$WP$Lookup$_click(d){var l="hidden",o="searchimg",n=".suggestion",i="input.search",m="data-index",f=false,b=true,a=this,p,h,k,q,g,c,j=b,e=f;if(d&&d.$target){a.LastClickTime=+new Date;switch(d.dataId){case"selectlianchor":p=d.$target.closest(".resultelement");g=parseInt(p.safeAttr(m),10);if(!isNaN(g)){k=a.ResultsData.ResultRecords[g];a.SearchKey=k.Name;c=a.$content.find(i);c&&c.val(a.SearchKey);a._returnResult(k,a.RESULT);return f}e=b;break;case"suggestionsearch":var r=d.$target.closest(n);a._updateSelected(r);a._doSearch();e=b;break;case"suggestionselect":a._updateSelected(d.$target);g=d.$target.closest(n).safeAttr(m);if(!isNaN(g)){k=a.SuggestionsData.ResultRecords[g];a._returnResult(k,a.SUGGESTION);return b}e=b;break;case"searchmore":case o:c=a.$content.find(i);if(c.val()||a.AllowBlankSearches){a._handleSubmit();e=b}else d.dataId===o&&c.focus();break;case"startover":case"startoverimg":case"startoveranchor":a.startOver();j=f;e=b;break;case"custom":case"customshow":a._showCustom();j=f;e=b;break;case"customback":a.$content.find(i).val(a.$content.find("input.custom").val());a.$content.find("div.searchcontainer").removeClass(l);a.$content.find("div.customcontainer").addClass(l);a.$content.find(i).focus();a.$container.trigger("resize",{forceShrink:b});j=f;e=b;break;case"customaccept":a._customAccept();j=f;e=b}h=a.$content.find("ul.searchsuggestions");if(h&&e){if(d.dataId==="suggestioninfo"){if(q.hasClass("moreresults"))return f}else if(d.dataId==="searchbox"){c=a.$content.find(i);if(c&&c.val()&&c.val()===a.SearchKey)h&&h.find("li").length>0&&h.removeClass(l)}else h.addClass(l);a.$container.trigger("resize",{forceShrink:b})}}return j},_clickGhostableLabel:function $$WP$Lookup$_clickGhostableLabel(){var a=$afe.jq(this).parent();a.addClass("ghosted");a.find("input[type='text']").focus()},_showCustom:function $$WP$Lookup$_showCustom(){var b="input.custom",a=this;a._cleanUpSuggestions();a._cleanUpResults();a._removeOverflowVisible();a.$content.find("div.searchcontainer").addClass("hidden");a.$content.find("div.customcontainer").removeClass("hidden");a.$content.find(b).focus();a.$content.find(b).val(a.$content.find("input.search").val())},_customAccept:function $$WP$Lookup$_customAccept(){var a=this;a.SearchKey=a.$content.find("input.custom").val();var b={ID:"",Name:a.SearchKey,IsCustom:true};a._returnResult(b,a.RESULT)},_handleSubmit:function $$WP$Lookup$_handleSubmit(){var c="data-id",a=this,d,e,b=a.$content.find(".suggestion.selected");if(b.safeAttr(c)==="suggestionselect"){d=b.safeAttr("data-index");if(!isNaN(d))e=a.SuggestionsData.ResultRecords[d];a._returnResult(e,a.SUGGESTION)}else if(b.safeAttr(c)==="suggestioninfo")if(b.find("a").safeAttr(c)==="custom")a._showCustom();else b.find("a").safeAttr(c)==="searchmore"&&a._doSearch();else a._doSearch()},_doSearch:function $$WP$Lookup$_doSearch(){var a=this,b;a._cleanUpSuggestions();a._cleanUpResults();a._showLoading();b=a.$content.find("input.search");(b&&b.val()||a.AllowBlankSearches)&&a._makeQuery(b.val(),a.RESULT)},_returnResult:function $$WP$Lookup$_returnResult(b,c){var a=this;a._cleanUpSuggestions();a._cleanUpResults();a._removeOverflowVisible();a.updateNameLabel(b.Name);a.$content.find(".beforeselection").addClass("hidden");a.$content.find(".afterselection").removeClass("hidden");a.$content.find(".formheader").focus();a.selectedResult(b,c)},selectedResult:function $$WP$Lookup$selectedResult(){console.error("Descendents of LookupComponent should implement selectedResult method")},updateNameLabel:function $$WP$Lookup$updateNameLabel(a){this.$content.find("span.selectionlabel").text(a).safeAttr("title",a)}};$$WPComp.LookupComponent.extend("Components.TemplateComponent")